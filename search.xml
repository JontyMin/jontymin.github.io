<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>关于闰年那些事</title>
    <url>/2021/11/29/about-leap-year/</url>
    <content><![CDATA[<p>判断某一年是否是闰年几乎是所有编程语言的基础练习题之一，而我们必然也熟知其规则：</p>
<ul>
<li>整除但4不能整除100</li>
<li>整除100又能整除400</li>
</ul>
<blockquote>
<p>这就是俗语中的“四年一闰，百年不闰，四百年再润”，我们当然可以根据这个规则编写程序判断闰年，但你知道为什么这样规定闰年的算法么？</p>
</blockquote>
<hr>
<p>事实上，闰年是为了弥补因人为历法规定，造成的年度天数与地球实际公转周期的时间差而设立的。所以闰年有366天。</p>
<p>那么具体是怎么弥补的呢？</p>
<blockquote>
<p>我们知道，平年一年只有365天，而实际上地球绕太阳的公转周期为365天5小时48分46秒。即一回归年。所以公历的每一年都比回归年短0.2422天，四年累计起来，共短0.9688天。</p>
</blockquote>
<p>大概就是一天，所以为了弥补这一天的时间差。给2月加上1天，就有了闰年。这样一来，每四年里就有一个闰年，3个平年。这就是<strong>四年一闰</strong>。</p>
<p>那么<strong>百年不闰，四百年再闰</strong>又是怎么回事呢？</p>
<blockquote>
<p>是这样的，刚才说四年累计起来的时间差只有0.9688天，这比我们给闰年增加的一天还少0.0312天，所以每四年就会多出0.0312天。这样400年后，就会比实际天数多出3.12天。所以我们必须在这400年中少设3个闰年。这样公历年的平均长度与回归年就近似了。</p>
</blockquote>
<p>那这3个闰年怎么少呢？</p>
<p>很简单，给百年除以400即可，比如2000-2400这400年：</p>
<ul>
<li>2000/400=5</li>
<li>2100/400=5.25</li>
<li>2200/400=5.5</li>
<li>2300/400=5.75</li>
<li>2400/400=6</li>
</ul>
<p>可以发现，正好有3个不能整除的整百年。所以规定年份是整百数的必须是400的倍数才是闰年。这就是百年不闰，四百年才闰的规定。</p>
<p>你明白了吗？</p>
<hr>
<p>当然，根据规则，我们就可以编写代码判断了：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> year;</span><br><span class="line">	cin &gt;&gt; year;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (year % <span class="number">4</span> == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (year % <span class="number">100</span> != <span class="number">0</span>)<span class="comment">//1. 能整除4，不能整除100</span></span><br><span class="line">		&#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot;是闰年\n&quot;</span> &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ((year % <span class="number">100</span>==<span class="number">0</span>) &amp;&amp; (year % <span class="number">400</span>==<span class="number">0</span>))<span class="comment">//2. 能整除100， 又能整除400</span></span><br><span class="line">		&#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot;是闰年\n&quot;</span> &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span><span class="comment">//其它情况不是闰年</span></span><br><span class="line">		&#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot;不是闰年\n&quot;</span> &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span><span class="comment">//不能整除4就不是闰年</span></span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;不是闰年\n&quot;</span> &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Share</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>浏览器实现静默打印</title>
    <url>/2021/09/25/browser-silent-printing/</url>
    <content><![CDATA[<h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>最近有一个需求涉及到<code>静默打印</code>,也就是打印时不需要弹出打印配置框，而是直接调用打印机</p>
<img data-src="https://cdn.jonty.top/img/image-20210925223925277.png">

<h4 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h4><p>经过讨论大概是以下几种方案：</p>
<ul>
<li>把打印配置弹窗干掉、模拟点击打印事件</li>
<li>浏览器实现静默打印</li>
<li>本地运行一个服务，客户端返回请求状态后请求本地接口调用打印</li>
</ul>
<h5 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h5><p>第一种没有去尝试，所以先讲讲第二种解决方案，通过前端控制浏览器打印，但是百度一圈下来的解决方案都是通过设置浏览器参数，然后创建一个快捷程序并设置启动参数，操作很简单，但实在不符合需求，总不能给每个客户也这样配置一边吧，所以第二种也<code>pass</code>。</p>
<p>操作如下：</p>
<img data-src="https://cdn.jonty.top/img/image-20210925225136606.png">

<h5 id="方案3"><a href="#方案3" class="headerlink" title="方案3"></a>方案3</h5><p>重点讲一下方案，也是目前在探索中，后续有更好的方法会发出来，也欢迎各位提出更好的解决方案。</p>
<p>目前仅支持windows环境，<code>winform</code>最终是<code>.exe</code>程序</p>
<h4 id="新建Winform程序"><a href="#新建Winform程序" class="headerlink" title="新建Winform程序"></a>新建Winform程序</h4><h5 id="使用VS2019创建"><a href="#使用VS2019创建" class="headerlink" title="使用VS2019创建"></a>使用<code>VS2019</code>创建</h5><img data-src="https://cdn.jonty.top/img/image-20210925225722885.png">

<h5 id="拖入ComboBox控件，用来选择本地打印机"><a href="#拖入ComboBox控件，用来选择本地打印机" class="headerlink" title="拖入ComboBox控件，用来选择本地打印机"></a>拖入<code>ComboBox</code>控件，用来选择本地打印机</h5><img data-src="https://cdn.jonty.top/img/image-20210925225843764.png">

<h5 id="获取打印机列表填充下拉"><a href="#获取打印机列表填充下拉" class="headerlink" title="获取打印机列表填充下拉"></a>获取打印机列表填充下拉</h5><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 加载打印机列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitPrinterList</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> print = <span class="keyword">new</span> PrintDocument();</span><br><span class="line">    <span class="keyword">var</span> defaultPrinter = print.PrinterSettings.PrinterName;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; PrinterSettings.InstalledPrinters.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> tmp = PrinterSettings.InstalledPrinters[i];</span><br><span class="line">        <span class="keyword">if</span> (tmp == defaultPrinter)</span><br><span class="line">        &#123;</span><br><span class="line">            tmp += <span class="string">&quot;(默认)&quot;</span>; <span class="comment">// 标记默认的打印机</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.comboBox1.Items.Add(tmp);  <span class="comment">// 下拉项新增</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Form1_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    InitPrinterList(); <span class="comment">// 窗体加载事件中调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ctrl-f5运行窗体查看效果"><a href="#ctrl-f5运行窗体查看效果" class="headerlink" title="ctrl+f5运行窗体查看效果"></a><code>ctrl+f5</code>运行窗体查看效果</h5><img data-src="https://cdn.jonty.top/img/image-20210925230348173.png">

<h4 id="创建服务"><a href="#创建服务" class="headerlink" title="创建服务"></a>创建服务</h4><p>没有使用<code>socket</code>,而是在<code>winform</code>中创建了一个<code>http</code>服务，并开放端口供浏览器本地请求</p>
<p>先新增两个依赖：</p>
<ol>
<li>BeetleX 1.5.1.7 </li>
<li>BeetleX.FastHttpApi 1.8.2.61</li>
</ol>
<p>这两个版本是支持<code>.net framework</code>的，<a href="https://github.com/IKende/BeetleX/">BeetleX</a>是一个基于.Net Core开发的一个开源跨平台TCP通讯框架，它提供了完整的会话服务管理，协议分析扩展，TLS支持和缓冲区管理等完全服务基础功能。有兴趣的可以去Github参观一下。</p>
<h5 id="初始化Http服务"><a href="#初始化Http服务" class="headerlink" title="初始化Http服务"></a>初始化Http服务</h5><p>在Load方法中调用<code>InitHttpServer()</code></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 初始化网关服务</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">InitHttpServer</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _httpApiServer = <span class="keyword">new</span> HttpApiServer(<span class="keyword">new</span> HttpOptions()</span><br><span class="line">    &#123;</span><br><span class="line">        Port = <span class="number">9000</span>, <span class="comment">// 本地开放的端口 要注意不要被占用</span></span><br><span class="line">        LogToConsole = <span class="literal">true</span>,</span><br><span class="line">        LogLevel = BeetleX.EventArgs.LogType.Debug</span><br><span class="line">     &#125;);</span><br><span class="line">    _httpApiServer.IPv4Tables.AddWhite(<span class="string">&quot;127.0.0.1/24&quot;</span>);</span><br><span class="line">    _httpApiServer.Options.CrossDomain = <span class="keyword">new</span> OptionsAttribute() &#123; AllowOrigin = <span class="string">&quot;*&quot;</span>, AllowMethods = <span class="string">&quot;*&quot;</span>, AllowHeaders = <span class="string">&quot;*&quot;</span> &#125;; <span class="comment">// 跨域配置，这个很重要</span></span><br><span class="line">    _httpApiServer.Register(<span class="keyword">typeof</span>(Home).Assembly);</span><br><span class="line">    _httpApiServer.Open();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册的程序就是<code>Controller</code></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">Controller(BaseUrl = <span class="meta-string">&quot;/home&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Home</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Hello Word</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>string:  you name<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>string<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Hello</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> &#123; Hello = <span class="string">&quot;hello &quot;</span> + name, Time = DateTime.Now &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制下服务的生命周期</p>
<img data-src="https://cdn.jonty.top/img/image-20210925231850394.png">

<p>使用<code>Postman</code>请求一下</p>
<p><code>http://localhost:9000/home/Hello?name=test</code> 返回成功</p>
<img data-src="https://cdn.jonty.top/img/image-20210925232302311.png">

<h4 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h4><p>客户端向本地请求打印接口，传入参数</p>
<p>这里传入了pdf文件地址，通过请求文件并打印</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 打印接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;url&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;printCount&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Print</span>(<span class="params"><span class="built_in">string</span> url, <span class="built_in">int</span> printCount</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    url = url.Replace(<span class="string">&quot;\n &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!(WebRequest.Create(url) <span class="keyword">is</span> HttpWebRequest request)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (!(request.GetResponse() <span class="keyword">is</span> HttpWebResponse response)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">var</span> stream = response.GetResponseStream();</span><br><span class="line">    <span class="comment">// 创建打印机</span></span><br><span class="line">    <span class="keyword">var</span> pdf = <span class="keyword">new</span> InputPdf(ReadFully(stream));</span><br><span class="line">    <span class="keyword">var</span> printJob = <span class="keyword">new</span> PrintJob(Printer.Default, pdf); <span class="comment">// 默认打印机</span></span><br><span class="line">    printJob.PrintOptions.Copies = printCount; <span class="comment">//打印数量</span></span><br><span class="line">    printJob.Print();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 读取字节流</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;input&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] <span class="title">ReadFully</span>(<span class="params">Stream input</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> ms = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">    &#123;</span><br><span class="line">        input.CopyTo(ms);</span><br><span class="line">        <span class="keyword">return</span> ms.ToArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>打印插件调用的<code>DynamicPdf</code></p>
<p>打印插件文档：<a href="https://www.dynamicpdf.com/docs/dotnet/print-manager-print-options">https://www.dynamicpdf.com/docs/dotnet/print-manager-print-options</a> </p>
</blockquote>
<h4 id="优化建议："><a href="#优化建议：" class="headerlink" title="优化建议："></a>优化建议：</h4><p>可以通过下拉框选择的打印机打印,需要记录选择的打印机</p>
<p>通过读取和设置<code>config</code>值实现,引入<code>System.Configuration</code></p>
<p>ConfigHelper类：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">ConfigHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;summary&gt;</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span>返回*.exe.config文件中appSettings配置节的value项  </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;param name=&quot;strKey&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span> </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetAppConfig</span>(<span class="params"><span class="built_in">string</span> strKey</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> file = System.Windows.Forms.Application.ExecutablePath;</span><br><span class="line">        <span class="keyword">var</span> config = ConfigurationManager.OpenExeConfiguration(file);</span><br><span class="line">        <span class="keyword">return</span> config.AppSettings.Settings.AllKeys.Any(key =&gt; key == strKey) ? config.AppSettings.Settings[strKey].Value.ToString() : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;summary&gt;</span>  </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span>在*.exe.config文件中appSettings配置节增加一对键值对  </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;/summary&gt;</span>  </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;param name=&quot;newKey&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span>  </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span><span class="doctag">&lt;param name=&quot;newValue&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span>  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UpdateAppConfig</span>(<span class="params"><span class="built_in">string</span> newKey, <span class="built_in">string</span> newValue</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> file = System.Windows.Forms.Application.ExecutablePath;</span><br><span class="line">        <span class="keyword">var</span> config = ConfigurationManager.OpenExeConfiguration(file);</span><br><span class="line">        <span class="keyword">var</span> exist = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> key <span class="keyword">in</span> config.AppSettings.Settings.AllKeys)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (key == newKey)</span><br><span class="line">            &#123;</span><br><span class="line">                exist = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (exist)</span><br><span class="line">        &#123;</span><br><span class="line">            config.AppSettings.Settings.Remove(newKey);</span><br><span class="line">        &#125;</span><br><span class="line">        config.AppSettings.Settings.Add(newKey, newValue);</span><br><span class="line">        config.Save(ConfigurationSaveMode.Modified);</span><br><span class="line">        ConfigurationManager.RefreshSection(<span class="string">&quot;appSettings&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="设置下拉选择事件"><a href="#设置下拉选择事件" class="headerlink" title="设置下拉选择事件"></a>设置下拉选择事件</h5><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">comboBox1_SelectedIndexChanged</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 更新setting设置</span></span><br><span class="line">    <span class="keyword">var</span> selectedPrint = <span class="keyword">this</span>.comboBox1.SelectedItem.ToString();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(selectedPrint))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 移除掉初始化打印机列表添加的默认文本</span></span><br><span class="line">    <span class="keyword">if</span> (selectedPrint.Contains(<span class="string">&quot;默认&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        selectedPrint = selectedPrint.Replace(<span class="string">&quot;(默认)&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ConfigHelper.UpdateAppConfig(<span class="string">&quot;defaultPrint&quot;</span>, selectedPrint);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="优化后的打印接口"><a href="#优化后的打印接口" class="headerlink" title="优化后的打印接口"></a>优化后的打印接口</h5><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 获取设置的打印机 （读取配置）</span></span><br><span class="line"><span class="keyword">var</span> defaultPrinter = ConfigHelper.GetAppConfig(<span class="string">&quot;defaultPrint&quot;</span>);</span><br><span class="line"><span class="comment">// 创建打印机</span></span><br><span class="line"><span class="keyword">var</span> printer = <span class="keyword">new</span> Printer(defaultPrinter);</span><br><span class="line"><span class="keyword">var</span> pdf = <span class="keyword">new</span> InputPdf(ReadFully(stream));</span><br><span class="line"><span class="keyword">var</span> printJob = <span class="keyword">new</span> PrintJob(printer, pdf);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>这样就能实现简单的静默打印，当然还有很多欠缺之处，后续优化，不当之处请指出</p>
]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>Winform</tag>
        <tag>Print</tag>
      </tags>
  </entry>
  <entry>
    <title>温故而知新-C#泛型</title>
    <url>/2021/10/04/csharp-generic-review-01/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在开发中，经常会遇到功能相同的模块，但是参数类型不同，这时候只能分别写不同的方法处理不同的数据类型。那么有没有一种办法，只用同一个方法来处理不同类型参数的方法</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowTypeName</span>(<span class="params"><span class="built_in">int</span> i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(i.GetType().Name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowTypeName</span>(<span class="params"><span class="built_in">string</span> i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(i.GetType().Name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowTypeName</span>(<span class="params">DateTime i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(i.GetType().Name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面几个方法分别获取<code>int、string、DateTime</code>类型的名称，可以看到对应写了三种类型的<code>重载</code>方法。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// int</span></span><br><span class="line">CommonMethod.ShowTypeName(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// string</span></span><br><span class="line">CommonMethod.ShowTypeName(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="comment">// datetime</span></span><br><span class="line">CommonMethod.ShowTypeName(DateTime.Now);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211004162840338.png"></p>
<p>这个时候我们就会想<strong>面向对象的继承</strong>，我们知道在<code>C#</code>语言中，所有的类型都继承自基类<code>object</code></p>
<p>优化：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowObjectName</span>(<span class="params"><span class="built_in">object</span> i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(i.GetType().Name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211004163223821.png" alt="image-20211004163223821"></p>
<p>可以看到，使用<code>object</code>类型作为参数传入达到了我们预期的效果，解决了代码的<strong>复用性</strong>。</p>
<p>但是这里又会引发另一个问题：装箱和拆箱带来的性能损耗问题。</p>
<blockquote>
<p>装箱和拆箱：在把值类型转换为引用类型或把引用类型转换成值类型时，需要进行装箱和拆箱的操作。</p>
<p>值类型存储在栈上，引用类型存储在堆上。</p>
<p>值类型  ==&gt; 引用类型  装箱    隐式转换(自动转换)  </p>
<p>引用类型 ==&gt; 值类型   拆箱    显示转换（强制转换）需要类型转换运算符</p>
</blockquote>
<h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><p>泛型就是为了解决这个问题而产生的，在<code>.NET2.0</code>推出泛型</p>
<blockquote>
<p>泛型是<code>C#</code>和<code>.NET</code>的一个重要概念，不仅是<code>C#</code>语言的一部分而且和<code>IL</code>中间语言紧密结合。</p>
<p>在泛型类型或方法定义中，类型参数是在其实例化泛型类型的一个变量时，客户端指定的特定类型的占位符。</p>
<p>泛型类( <code>GenericList&lt;T&gt;</code>)无法按原样使用，因为它不是真正的类型；它更像是类型的蓝图。 若要使用 <code>GenericList&lt;T&gt;</code>，客户端代码必须通过指定尖括号内的类型参数来声明并实例化构造类型。 此特定类的类型参数可以是编译器可识别的任何类型。 可创建任意数量的构造类型实例，其中每个使用不同的类型参数。</p>
</blockquote>
<h4 id="定义泛型参数"><a href="#定义泛型参数" class="headerlink" title="定义泛型参数"></a>定义泛型参数</h4><p>优化：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowName</span>&lt;<span class="title">T</span>&gt;(<span class="params">T i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(i?.GetType().Name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">var</span> s = <span class="string">&quot;Jonty&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> d = DateTime.Now;</span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">&quot;***************CommonMethod*************&quot;</span>);</span><br><span class="line"><span class="comment">// int</span></span><br><span class="line">CommonMethod.ShowTypeName(i);</span><br><span class="line"><span class="comment">// string</span></span><br><span class="line">CommonMethod.ShowTypeName(s);</span><br><span class="line"><span class="comment">// datetime</span></span><br><span class="line">CommonMethod.ShowTypeName(d);</span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">&quot;***************ObjectMethod*************&quot;</span>);</span><br><span class="line"><span class="comment">// int</span></span><br><span class="line">CommonMethod.ShowObjectName(i);</span><br><span class="line"><span class="comment">// string</span></span><br><span class="line">CommonMethod.ShowObjectName(s);</span><br><span class="line"><span class="comment">// datetime</span></span><br><span class="line">CommonMethod.ShowObjectName(d);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">&quot;***************GenericMethod*************&quot;</span>);</span><br><span class="line"><span class="comment">// int</span></span><br><span class="line">CommonMethod.ShowName(i);</span><br><span class="line"><span class="comment">// string</span></span><br><span class="line">CommonMethod.ShowName(s);</span><br><span class="line"><span class="comment">// datetime</span></span><br><span class="line">CommonMethod.ShowName(d);</span><br><span class="line"></span><br><span class="line">Console.ReadKey();</span><br></pre></td></tr></table></figure>

<p>可以看到，效果是一摸一样的：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211004170341353.png" alt="image-20211004170341353"></p>
<p><strong>为什么泛型可以解决这个问题呢？</strong></p>
<p>泛型是延迟声明的：即定义的时候没有指定具体的参数类型，把参数类型的声明推迟到了调用的时候才指定参数类型</p>
<p><strong>泛型是如何工作的呢？</strong></p>
<p>控制台程序最终会编译成一个exe程序，exe被点击的时候，会经过JIT(即时编译器)的编译，最终生成二进制代码，才能被计算机执行。泛型加入到语法以后，<code>visual studio</code>自带的编译器又做了升级，升级之后编译时遇到泛型，会做特殊的处理：生成占位符。再次经过JIT编译的时候，会把上面编译生成的占位符替换成具体的数据类型。</p>
<p>示例:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">Console.WriteLine(<span class="keyword">typeof</span>(List&lt;&gt;));</span><br><span class="line">Console.WriteLine(<span class="keyword">typeof</span>(Dictionary&lt;,&gt;));</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p>可以看到，泛型在编译后会生成占位符</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211004171349172.png" alt="image-20211004171349172"></p>
<p><strong>性能对比：</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Show</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">11932</span></span><br><span class="line">    <span class="built_in">long</span> commonSecond = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">long</span> objectSecond = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">long</span> genericSecond = <span class="number">0</span></span><br><span class="line">    &#123;</span><br><span class="line">        Stopwatch stopwatch = <span class="keyword">new</span>();</span><br><span class="line">        stopwatch.Start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">1000000000</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            ShowInt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        stopwatch.Stop();</span><br><span class="line">        commonSecond = stopwatch.ElapsedMilliseconds;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        Stopwatch stopwatch = <span class="keyword">new</span>();</span><br><span class="line">        stopwatch.Start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">1000000000</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            ShowObject(i);</span><br><span class="line">        &#125;</span><br><span class="line">        stopwatch.Stop();</span><br><span class="line">        objectSecond = stopwatch.ElapsedMilliseconds;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        Stopwatch stopwatch = <span class="keyword">new</span>();</span><br><span class="line">        stopwatch.Start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">1000000000</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            Show(i);</span><br><span class="line">        &#125;</span><br><span class="line">        stopwatch.Stop();</span><br><span class="line">        genericSecond = stopwatch.ElapsedMilliseconds;</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine(</span><br><span class="line">        <span class="string">$&quot;commonMethod:<span class="subst">&#123;commonSecond&#125;</span>\nobjectMethod:<span class="subst">&#123;objectSecond&#125;</span>\ngenericMethod:<span class="subst">&#123;genericSecond&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">region</span> Private Metho</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowInt</span>(<span class="params"><span class="built_in">int</span> i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowObject</span>(<span class="params"><span class="built_in">object</span> i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Show</span>&lt;<span class="title">T</span>&gt;(<span class="params">T i</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endregion</span></span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p>泛型方法&lt;普通方法&lt;Object方法 </p>
<p><img data-src="https://cdn.jonty.top/img/image-20211004172530409.png" alt="image-20211004172530409"></p>
<h3 id="类型安全"><a href="#类型安全" class="headerlink" title="类型安全"></a>类型安全</h3><p>泛型的另一个特性就是<strong>类型安全</strong></p>
<p>示例：</p>
<p><code>ArrayList</code>可以添加任意类型的参数</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">ArrayList arrayList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">arrayList.Add(<span class="number">123</span>);</span><br><span class="line">arrayList.Add(<span class="string">&quot;jonty&quot;</span>);</span><br><span class="line">arrayList.Add(DateTime.Now);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> arrayList)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用泛型可以进行类型约束：</p>
<p>如果我们添加其他类型的参数则会编译报错，<strong>参数无效</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">List&lt;<span class="built_in">int</span>&gt; arrInts = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">arrInts.Add(<span class="number">1</span>);</span><br><span class="line">arrInts.Add(<span class="number">2</span>);</span><br><span class="line">arrInts.Add(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="命名约定"><a href="#命名约定" class="headerlink" title="命名约定"></a>命名约定</h3><ul>
<li><p>泛型类型的名称首字母用<code>T</code></p>
</li>
<li><p>如果没有特殊要求，泛型类型允许用任何类代替；且只使用了一个泛型类型时，可以直接使用<code>T</code>作为泛型类型的名称</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">List</span>&lt;<span class="title">T</span>&gt;&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>如果泛型的类型有特殊的要求，或者使用了两个或多个泛型类型，那么泛型类应该使用描述性名称</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">Eventhandler</span>&lt;<span class="title">TEventArgs</span>&gt;(<span class="params">Object sender,TEventargs e</span>)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SortedList</span>&lt;<span class="title">Tkey</span>,<span class="title">TValue</span>&gt;&#123;&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>CSharp</category>
      </categories>
      <tags>
        <tag>Generic</tag>
      </tags>
  </entry>
  <entry>
    <title>温故而知新-C#泛型</title>
    <url>/2021/10/08/csharp-generic-review-02/</url>
    <content><![CDATA[<h3 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h3><p>除了有<strong>泛型方法</strong>，还有<strong>泛型类</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DocumentManager</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">readonly</span>  <span class="title">Queue</span>&lt;<span class="title">T</span>&gt; _documentQueue</span>= <span class="keyword">new</span> Queue&lt;T&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _lock = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsAvailable =&gt;_documentQueue.Count &gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddDocument</span>(<span class="params">T doc</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">lock</span> (_lock)</span><br><span class="line">        &#123;</span><br><span class="line">            _documentQueue.Enqueue(doc);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">GetDocument</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        T doc = <span class="literal">default</span>;</span><br><span class="line">        <span class="keyword">lock</span> (_lock)</span><br><span class="line">        &#123;</span><br><span class="line">            doc=_documentQueue.Dequeue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> doc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h4><p>可以看到在<code>GetDocument</code>这个方法中初始化<code>doc</code>变量时，我们使用了<code>default</code>关键字</p>
<blockquote>
<p>default关键字根据上下文可以有多种含义，switch语句中使用default定义默认情况。在泛型中取决于泛型类型是值类型还是引用类型，泛型default关键字将泛型类型初始化为null或0</p>
</blockquote>
<h3 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h3><p><strong>泛型类</strong>都有了，<strong>泛型接口</strong>也可以有</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDocumentManager</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">AddDocument</span>(<span class="params">T doc</span>)</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="function">T <span class="title">GetDocument</span>(<span class="params"></span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>还有<strong>泛型委托</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">Hello</span>&lt;<span class="title">T</span>&gt;(<span class="params">T t</span>)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<p>1、泛型在声明的时候可以不指定具体的类型，在使用时需要指定具体类型</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AClass</span>:<span class="title">BClass</span>&lt;<span class="title">int</span>&gt;&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>2、如果子类也是泛型的，那么继承的时候可以不指定具体类型</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AClass</span>&lt;<span class="title">T</span>&gt;:<span class="title">BClass</span>&lt;<span class="title">T</span>&gt;&#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="逆变和协变"><a href="#逆变和协变" class="headerlink" title="逆变和协变"></a>逆变和协变</h4><p>在<code>.NET4.0</code>之前，泛型接口是不变的。</p>
<p><strong>协变</strong>和<strong>逆变</strong>指对参数和返回值的类型进行转换。只能放在接口或委托的泛型参数前面</p>
<p><code>out</code>协变 covariant 用来修饰返回值；</p>
<p><code>in</code>逆变 contravariant 用来修饰传入参数；</p>
<p>示例：</p>
<p>定义一个<code>Animal</code>类，再定义一个<code>Cat</code>类继承<code>Animal</code></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Animal</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Cat</span> : <span class="title">Animal</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">Animal animal = <span class="keyword">new</span> Animal();</span><br><span class="line">Cat cat = <span class="keyword">new</span> Cat();</span><br><span class="line"></span><br><span class="line">Animal animal1 = <span class="keyword">new</span> Cat();</span><br><span class="line"></span><br><span class="line">List&lt;Animal&gt; animals = <span class="keyword">new</span> List&lt;Animal&gt;();</span><br><span class="line"></span><br><span class="line">List&lt;Cat&gt;cats= <span class="keyword">new</span> List&lt;Cat&gt;();</span><br><span class="line"></span><br><span class="line">List&lt;Animal&gt; list = <span class="keyword">new</span> List&lt;Cat&gt;(); <span class="comment">// 报错 没有父子级关系</span></span><br></pre></td></tr></table></figure>

<p>这个时候可以使用<strong>协变</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">IEnumerable list = <span class="keyword">new</span> List&lt;Cat&gt;();</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211008001058082.png" alt="image-20211008001058082"></p>
<p>可以看到，泛型接口使用了<code>out</code>参数修饰，<code>T</code>只能是返回值类型，不能作为参数类型。使用<strong>协变</strong>后，左边声明的是基类，右边可以声明子类或基类。</p>
<p>协变也可用于委托：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">Func&lt;Animal&gt;func = <span class="keyword">new</span> Func&lt;Cat&gt;(()=&gt;<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h4 id="自定义协变"><a href="#自定义协变" class="headerlink" title="自定义协变"></a>自定义协变</h4><p><strong>out</strong>协变，只能是返回结果</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICustomerListOut</span>&lt;<span class="keyword">out</span> <span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">T <span class="title">Get</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomerListOut</span>&lt;<span class="title">T</span>&gt; : <span class="title">ICustomerListOut</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">Get</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">default</span>(T);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">ICustomerListOut&lt;Animal&gt; list1 = <span class="keyword">new</span> CustomerListOut&lt;Cat&gt;();</span><br></pre></td></tr></table></figure>

<h4 id="自定义逆变"><a href="#自定义逆变" class="headerlink" title="自定义逆变"></a>自定义逆变</h4><p><strong>in</strong>逆变，只能作为方法参数，不能作为返回值。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICustomerListIn</span>&lt;<span class="keyword">in</span> <span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Show</span>(<span class="params">T t</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomerListIn</span>&lt;<span class="title">T</span>&gt; : <span class="title">ICustomerListIn</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>(<span class="params">T t</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">ICustomerListIn&lt;Cat&gt; list2 = <span class="keyword">new</span> CustomerListIn&lt;Animal&gt;();</span><br></pre></td></tr></table></figure>

<h3 id="泛型约束"><a href="#泛型约束" class="headerlink" title="泛型约束"></a>泛型约束</h3><p>如果泛型类需要调用泛型类型中的方法，则需要添加约束。</p>
<p>定义一个<code>IDocument</code>接口，定义两个<strong>只读属性</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDocument</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">string</span> Title &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="built_in">string</span> Content &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Document</span>:<span class="title">IDocument</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Document</span>(<span class="params"><span class="built_in">string</span> title,<span class="built_in">string</span> content</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.Title = title;</span><br><span class="line">        <span class="keyword">this</span>.Content = content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Title &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Content &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要显示<strong>Document</strong>的标题，我们可以这样写:</p>
<p>将<code>T</code>强制转换为<code>IDocument</code>接口</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DisplayAllDocuments</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> doc <span class="keyword">in</span> _documentQueue)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(((IDocument)doc).Title);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是如果我们实现的不是<code>IDocument</code>呢？而是其他的，并没有<code>Title</code>，这个时候就会报错。</p>
<p>这个时候我们可以给<code>DocumentManager</code>一个约束：<strong>T</strong>类型必须实现<strong>IDocument</strong>接口，使用<code>Where</code>关键字</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">DocumentManager&lt;T&gt;:IDocumentManager&lt;T&gt; <span class="keyword">where</span> T : <span class="function">IDocument</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DisplayAllDocuments</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">foreach</span> (<span class="keyword">var</span> doc <span class="keyword">in</span> _documentQueue)</span><br><span class="line">   &#123;</span><br><span class="line">       Console.WriteLine(doc.Title);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img data-src="https://cdn.jonty.top/img/image-20211007223036959.png" alt="image-20211007223036959" style="zoom:80%;" />

<h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><table>
<thead>
<tr>
<th align="center">约束</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">where T:struct</td>
<td align="center">T类型必须是值类型</td>
</tr>
<tr>
<td align="center">where T:class</td>
<td align="center">T类型必须是引用类型（类、接口、委托、数组等）</td>
</tr>
<tr>
<td align="center">where T:IFoo</td>
<td align="center">指定类型必须实现接口IFoo</td>
</tr>
<tr>
<td align="center">where T:Foo</td>
<td align="center">指定类型T必须派生自基类Foo</td>
</tr>
<tr>
<td align="center">where T:new()</td>
<td align="center">构造函数约束，指定类型T必须有一个默认构造函数，需最后指定</td>
</tr>
<tr>
<td align="center">where T1:T2</td>
<td align="center">T1派生自泛型类型T2</td>
</tr>
</tbody></table>
<blockquote>
<p>new()只能为默认构造函数定义构造函数约束，不能为其他构造函数定义构造函数约束</p>
<p>基类约束时，基类不能是密封类（即sealed类），sealed类不能被继承，则此约束无意义。</p>
</blockquote>
<p>泛型约束可以多个约束：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>&lt;<span class="title">T</span>&gt;(<span class="params">T t</span>) <span class="keyword">where</span> T:Document,<span class="keyword">new</span>(<span class="params"></span>)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型继承"><a href="#泛型继承" class="headerlink" title="泛型继承"></a>泛型继承</h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">DocumentManager</span>&lt;<span class="symbol">T</span>&gt; : <span class="symbol">IDocumentManager</span>&lt;<span class="symbol">T</span>&gt; <span class="symbol">where</span> <span class="symbol">T</span> : <span class="symbol">IDocument</span></span><br></pre></td></tr></table></figure>

<p>泛型类型可以实现泛型接口，也可以派生自一个类。泛型类可以派生自泛型基类：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Base</span>&lt;<span class="title">T</span>&gt;&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Derived</span>&lt;<span class="title">T</span>&gt;:<span class="title">Base</span>&lt;<span class="title">T</span>&gt;&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>必须重复实现接口的泛型类型，或者必须执行基类的类型</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Base</span>&lt;<span class="title">T</span>&gt;&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Derived</span>&lt;<span class="title">T</span>&gt;:<span class="title">Base</span>&lt;<span class="title">string</span>&gt;&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>派生类可以是<strong>泛型类</strong>或<strong>非泛型类</strong></p>
<p>例子：定义一个抽象的泛型类,在派生类中用另一种实现</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Calc</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> T <span class="title">Add</span>(<span class="params">T x, T y</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IntCalc</span> : <span class="title">Calc</span>&lt;<span class="title">int</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">Add</span>(<span class="params"><span class="built_in">int</span> x, <span class="built_in">int</span> y</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="静态成员"><a href="#静态成员" class="headerlink" title="静态成员"></a>静态成员</h3><p>泛型类的静态成员只能在类的一个实例中共享</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StaticDemo</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">StaticDemo&lt;<span class="built_in">string</span>&gt;.x = <span class="number">4</span>;</span><br><span class="line">StaticDemo&lt;<span class="built_in">int</span>&gt;.x = <span class="number">5</span>;</span><br><span class="line">Console.WriteLine(StaticDemo&lt;<span class="built_in">string</span>&gt;.x);</span><br></pre></td></tr></table></figure>

<p>结果： </p>
<p><img data-src="https://cdn.jonty.top/img/image-20211007233059047.png" alt="image-20211007233059047"></p>
<h3 id="泛型缓存"><a href="#泛型缓存" class="headerlink" title="泛型缓存"></a>泛型缓存</h3><p>我们知道，类的静态构造函数只会执行一次，所以不管无论实例化多少次，在内存中只会有一个。</p>
<p>在泛型中，<code>T</code>类型不同，每个不同的<code>T</code>类型都会生成一个不同的副本，会产生不同的静态属性、静态构造函数。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(GenericCache&lt;<span class="built_in">int</span>&gt;.GetCache());</span><br><span class="line">    Thread.Sleep(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(GenericCache&lt;<span class="built_in">long</span>&gt;.GetCache());</span><br><span class="line">    Thread.Sleep(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(GenericCache&lt;<span class="built_in">string</span>&gt;.GetCache());</span><br><span class="line">    Thread.Sleep(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(GenericCache&lt;DateTime&gt;.GetCache());</span><br><span class="line">    Thread.Sleep(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GenericCache</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _typeTime;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">GenericCache</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;static&quot;</span>);</span><br><span class="line"></span><br><span class="line">        _typeTime = <span class="string">$&quot;<span class="subst">&#123;<span class="keyword">typeof</span>(T).FullName&#125;</span>_<span class="subst">&#123;DateTime.Now:yyyyMMddHHmmss.fff&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetCache</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _typeTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img data-src="https://cdn.jonty.top/img/image-20211008003511609.png" alt="image-20211008003511609" style="zoom:80%;" />

<p>泛型会为不同类型都创建一个副本，构造函数执行5次，后面获取的缓存都是相同的。</p>
<p>注意：只能为不同的类型缓存一次。泛型缓存比字典缓存效率高，但是不能主动释放。</p>
<h3 id="泛型结构"><a href="#泛型结构" class="headerlink" title="泛型结构"></a>泛型结构</h3><p>与类一样，结构也可以是泛型的。但是不同于类，不能继承。</p>
<p>以<code>Nullable&lt;T&gt;</code>为例：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> Nullable&lt;T&gt; <span class="keyword">where</span> T: <span class="keyword">struct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> _hasValue;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> HasValue =&gt; _hasValue;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Nullable</span>(<span class="params">T <span class="keyword">value</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _hasValue = <span class="literal">true</span>;</span><br><span class="line">        _value = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T _value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T Value</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!_hasValue)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">&quot;no value&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">T</span>(<span class="params">Nullable&lt;T&gt; <span class="keyword">value</span></span>)</span> =&gt; <span class="keyword">value</span>.Value;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">implicit</span> <span class="keyword">operator</span> <span class="title">Nullable</span>&lt;<span class="title">T</span>&gt;(<span class="params">T <span class="keyword">value</span></span>)</span> =&gt; <span class="keyword">new</span> Nullable&lt;T&gt;(<span class="keyword">value</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span>? ToString()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> !HasValue ? <span class="built_in">string</span>.Empty : _value.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">Nullable&lt;<span class="built_in">int</span>&gt; x;</span><br><span class="line">x = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">if</span> (x.HasValue)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(x.Value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="可空类型"><a href="#可空类型" class="headerlink" title="可空类型"></a>可空类型</h4><p>在<code>c#</code>中，使用<code>?</code>定义可空类型</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span>? i = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>可空类型可以与<code>null</code>或数字比较</li>
<li>可空类型可以与算数运算符使用</li>
</ul>
<p>非可空类型可以转换成可空类型，隐式转换</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> x = <span class="number">4</span>;</span><br><span class="line"><span class="built_in">int</span>? y = x;</span><br></pre></td></tr></table></figure>

<p>可空类型转为非可空类型可能会失败，如果可空类型<code>null</code>赋值给非可空类型则会抛出<code>InvalidOperationException</code>异常，需要强制类型转换</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span>? x = GetNullableType(); <span class="comment">// 可能返回null</span></span><br><span class="line"><span class="built_in">int</span> y = (<span class="built_in">int</span>)x;</span><br></pre></td></tr></table></figure>

<p>如果不进行显示转换，则可以使用合并运算符从可空类型转换成非可空类型，关键词<code>??</code>，为转换定义一个默认值，以防可控类型的值为<code>null</code>。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span>? x = GetNullableType();</span><br><span class="line"><span class="built_in">int</span> y = x ?? <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CSharp</category>
      </categories>
      <tags>
        <tag>Generic</tag>
      </tags>
  </entry>
  <entry>
    <title>Git基本操作</title>
    <url>/2021/12/05/getting-started-with-git/</url>
    <content><![CDATA[<h1 id="干货"><a href="#干货" class="headerlink" title="干货"></a>干货</h1><p>下面对工作中涉及到的git命令做分类总结，都是最常用的。</p>
<h2 id="git本地管理"><a href="#git本地管理" class="headerlink" title="git本地管理"></a>git本地管理</h2><blockquote>
<p>git最基本的一些操作</p>
</blockquote>
<p>git init：将某目录变成git可以管理的仓库（添加.git目录）</p>
<p>git commit -m “…”:一次性提交多个文件（add进来的文件）</p>
<p>git add xxx.md:可以多次添加多个不同文件</p>
<p>git status:可以时刻掌握仓库当前的状态</p>
<p>git diff:显示具体修改的内容（与提交进去的文件相比）</p>
<p>git log：显示从最近到最远的提交日志，加上–pretty=oneline参数可以将每次提交信息压缩成一行,最前边的数字加字母是指每次commit的commit-id,是16进制的表示形式</p>
<p>.gitignore文件：包括git需要忽略提交的文件名，此文件也需要提交到git</p>
<h2 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h2><blockquote>
<p>世界上是有后悔药的</p>
</blockquote>
<p>git reset –hard HEAD^:回退到上个版本（上上个版本HEAD^^,上100个版本是HEAD~100。HEAD是指向当前版本的指针，因此可以通过调整HEAD来在历史版本间穿梭）</p>
<p>git reset –hard commmitid：在没有关闭上次回退时的命令窗口时，可以取消回退。commitid没必要写全，git可以自己去找</p>
<p>git reflog:可以显示每一次commit和回退的id号，如果命令窗口关闭，可以用此命令先找到commitid，然后用上个命令取消回退</p>
<p>git checkout – file：撤销在工作区对file做的修改，包括撤销对file文件的删除</p>
<p>git reset HEAD file &amp; git checkout – file：对file的修改已被add到stage，用前者删除add到stage的修改，再用后者撤销工作区的修改</p>
<p>git reset –hard HEAD^ :已经将想撤销的修改添加到了版本库，但还未提交到远程库。用版本回退撤销修改</p>
<p>git rm file&amp;git commit -m “delete file”：删除已添加到版本库的文件</p>
<p>git checkout:用版本库里的文件版本替换工作区的文件版本（一键还原）</p>
<h2 id="远程库连接"><a href="#远程库连接" class="headerlink" title="远程库连接"></a>远程库连接</h2><blockquote>
<p>连接远程库，进一步实现团队协作。</p>
</blockquote>
<p>git remote:查看远程库信息，详细信息加上-v选项</p>
<p>git remote add origin <a href="mailto:&#103;&#105;&#x74;&#64;&#103;&#105;&#x74;&#104;&#117;&#x62;&#x2e;&#99;&#111;&#109;">&#103;&#105;&#x74;&#64;&#103;&#105;&#x74;&#104;&#117;&#x62;&#x2e;&#99;&#111;&#109;</a>:Summyj/xxx.git：将本地git仓库与github远程库想关联,也可以是其它库，远程库默认名字是origin，也可以设为其它，比如github</p>
<p>git push -u origin xxx:把本地仓库指定分支·内容推送到远程，下次推送可以不用-u参数<br>因为第一次推送master分支时如果加上-u参数，Git不但会把本地的master分支内容推送的远程新的master分支，还会把本地的master分支和远程的master分支关联起来，所以在以后的推送或者拉取时就可以简化命令。</p>
<p>git clone <a href="mailto:&#103;&#x69;&#x74;&#64;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#99;&#111;&#x6d;">&#103;&#x69;&#x74;&#64;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#99;&#111;&#x6d;</a>:xxx/xxx.git:从远程仓库克隆到本地，后边是地址</p>
<p>git remotr rm origin:删除本地库关联的origin远程库</p>
<h2 id="分支创建管理"><a href="#分支创建管理" class="headerlink" title="分支创建管理"></a>分支创建管理</h2><blockquote>
<p>实现更安全便捷的版本控制。</p>
</blockquote>
<p>git checkout -b xxx:git check命令加上-b参数表示创建并切换到xxx分支，此命令相当于两条命令：</p>
<ul>
<li>git branch xxx</li>
<li>git checkout xxx</li>
</ul>
<p>git branch:查看当前分支（列出所有分支，当前分支前边会标有*号）</p>
<p>git merge xxx:将指定分支xxx合并到当前分支,首先要切换到当前分支（不一定是master分支）</p>
<p>git branch -d xxx:删除某分支（合并后再删除）</p>
<p>git branch -D xxx:强行删除某个没有被合并的分支</p>
<p>git log –graph –pretty=oneline –abbrev-commit：用分支图展示各分支合并情况（或者直接git log –graph，但这将会显示所有历史合并图）</p>
<p>git merge –no-ff -m “…” xxx:禁用git合并时默认的fast-forward模式，生成新的commit加入分支信息。-m后的内容就是合并信息</p>
<h2 id="工作现场存储"><a href="#工作现场存储" class="headerlink" title="工作现场存储"></a>工作现场存储</h2><blockquote>
<p>版本控制的freestyle.</p>
</blockquote>
<p>git stash:将当前工作现场储藏起来，等以后恢复现场后继续工作</p>
<p>git stash list:查看储藏的工作现场</p>
<p>git stash apply:回复储藏的工作现场</p>
<p>git stash apply stash@{x}有多个stash时恢复指定的stash</p>
<p>git stash drop:恢复现场并删除stash list的内容，如果有多个stash,默认恢复的是最新的stash.</p>
<h2 id="多人协作"><a href="#多人协作" class="headerlink" title="多人协作"></a>多人协作</h2><blockquote>
<p>小伙伴们的友情</p>
</blockquote>
<p>git checkout -b xxx origin/xxx:刚从远程库克隆到本地时只有master分支，用此命令创建和远程分支对应的分支</p>
<p>git pull:多人协作时，远程分支比本地分支更新导致推送失败，用此命令从远程库抓取该分支最新的提交并和本地分支进行合并，合并有冲突需要手动解决</p>
<p>git branch –set-upstream xxx origin/xxx:git pull失败时需要创建本地分支和远程分支的关联</p>
<h2 id="标签管理"><a href="#标签管理" class="headerlink" title="标签管理"></a>标签管理</h2><blockquote>
<p>更方便进行版本控制，与commit id相比更好记。相当于版本库的一个快照。</p>
</blockquote>
<p>Git的标签虽然是版本库的快照，但其实它就是指向某个commit的指针。与HEAD指针相比，后者可以移动，但标签不能移动），所以，创建和删除标签都是瞬间完成的。</p>
<p>git tag xxx:打标签</p>
<p>git tag v0.3 646123:将commit id为646123的提交打上v0.3标签。这样可以解决忘记打标签的问题</p>
<p>git tag:查看所有标签（按字母排序，而并非时间）</p>
<p>git show tagname:查看标签信息（包括说明文字）</p>
<p>git tag -a v0.x -m “…” 615465:创建带有说明的标签，用-a指定标签名，-m指定说明文字</p>
<p>git tag -d xxx:删除指定标签（因为创建的标签都只存储在本地，不会自动推送到远程。所以，打错的标签可以在本地安全删除。）</p>
<p>git push origin tagname:推送标签到远程</p>
<p>git push origin –tags:一次性推送全部尚未推送到远程的本地标签</p>
<p>git tag -d tagname &amp; git push origin :refs/tags/tagname:删除已推送到远程库的标签，先从本地删除，再从远程删除</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker基础入门-01</title>
    <url>/2021/11/28/getting-started-with-docker-01/</url>
    <content><![CDATA[<p><img data-src="https://cdn.jonty.top/img/docker01.png" alt="Docker"></p>
<p>Docker 是一个开源的应用容器引擎，基于 <a href="https://www.runoob.com/go/go-tutorial.html">Go 语言</a> 并遵从 Apache2.0 协议开源。</p>
<p>可以让开发者打包应用以及依赖包到一个轻量级、可移植的容器中，然后发布到其他<strong>Linux</strong>系统上，以实现虚拟化。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>快速、一致地交付应用（避免在我的电脑上能运行，你那怎么就报错的情况发生）</li>
<li>响应式部署和扩展</li>
<li>在同一硬件上运行更多工作负载</li>
</ul>
<p>Docker 官网：<a href="https://www.docker.com/">https://www.docker.com</a></p>
<p>GitHub Docker 源码：<a href="https://github.com/docker/docker-ce">https://github.com/docker/docker-ce</a></p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p><code>Docker</code>包括三个基本概念：</p>
<ul>
<li><p><strong>镜像</strong>（Image）: Docker镜像（Image）相当于一个<strong>root</strong>文件系统</p>
</li>
<li><p><strong>容器</strong>（Container）: 容器相当于镜像的一个实例，类比面向对象程序中的类和对象一样，镜像是静态的定义，容器是镜像的一个实例。实例（容器）可以被创建、启动、停止、删除。</p>
</li>
<li><p><strong>仓库</strong>（Repository）: 类似于代码仓库git，用于保存镜像</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Docker</th>
<th>OOP</th>
</tr>
</thead>
<tbody><tr>
<td>Container</td>
<td>Object</td>
</tr>
<tr>
<td>Images</td>
<td>Class</td>
</tr>
</tbody></table>
<h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><p><img data-src="https://cdn.jonty.top/img/576507-docker1.png" alt="img"></p>
<table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Images</td>
<td>Docker Images是创建容器的模板</td>
</tr>
<tr>
<td>Container</td>
<td>容器是镜像运行的一个实体。</td>
</tr>
<tr>
<td>Client</td>
<td>客户端通过命令行工具或Desktop等与Docker通信</td>
</tr>
<tr>
<td>Host</td>
<td>宿主（服务器），用于执行Docker守护进程和容器</td>
</tr>
<tr>
<td>Registry</td>
<td>镜像仓库，public/private 仓库</td>
</tr>
<tr>
<td>Machine</td>
<td>命令行工具</td>
</tr>
</tbody></table>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>环境：<code>Centos7.9 </code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211128124726295.png" alt="cpu-memery"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uname -a	# 查看机器信息 3.8以上</span><br><span class="line">cat /etc/redhat-release # Linux版本</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128125004040.png" alt="image-20211128125004040"></p>
<h4 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h4><p>可以先检查是否安装过旧版本的<code>Docker</code>，如果安装过则需要先卸载依赖项。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<h4 id="配置仓库"><a href="#配置仓库" class="headerlink" title="配置仓库"></a>配置仓库</h4><p>安装<code>yum-utils</code>包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>

<p>设置仓库：</p>
<ul>
<li><p>官方源：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li>
<li><p>阿里云：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li>
</ul>
<p>这里我们使用阿里云的仓库，国内访问比较快。</p>
<h4 id="Docker引擎"><a href="#Docker引擎" class="headerlink" title="Docker引擎"></a>Docker引擎</h4><p>安装<code>Docker Engine</code>:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<p>启动<code>Docker</code>:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker	# 启动</span><br><span class="line">systemctl stop docker	# 停止</span><br><span class="line">systemctl restart docker	# 重启</span><br></pre></td></tr></table></figure>

<p>配置自启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable docker.service</span><br><span class="line">sudo systemctl enable containerd.service</span><br></pre></td></tr></table></figure>

<p>禁用则使用<code>disable</code></p>
<p>检查是否安装成功：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@local yum.repos.d]# docker -v</span><br><span class="line">Docker version 20.10.8, build 3967b7d</span><br><span class="line">[root@local yum.repos.d]# </span><br></pre></td></tr></table></figure>

<h4 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h4><ul>
<li><p>卸载Docker Engine、CLI和Containerd包：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li>
<li><p>删除所有镜像、容器和卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>参考：官方文档<a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos</a></p>
</blockquote>
<h3 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h3><p>国内从<code>Docker Hub</code>拉取镜像可能会比较慢，推荐配置国内的镜像加速器</p>
<ul>
<li>科大镜像：<a href="https://docker.mirrors.ustc.edu.cn/">https://docker.mirrors.ustc.edu.cn/</a></li>
<li>网易镜像：<a href="https://hub-mirror.c.163.com/">https://hub-mirror.c.163.com/</a></li>
</ul>
<p>获取个人阿里镜像加速器：</p>
<p>找到<strong>容器镜像服务</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211128131145813.png" alt="image-20211128131145813"></p>
<p>镜像工具 =&gt; 镜像加速器</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211128131239013.png" alt="image-20211128131239013"></p>
<h4 id="配置镜像加速器"><a href="#配置镜像加速器" class="headerlink" title="配置镜像加速器"></a>配置镜像加速器</h4><p>修改daemon配置文件<code>/etc/docker/daemon.json</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加镜像地址</span></span><br><span class="line"> &quot;registry-mirrors&quot;: [&quot;https://yoursId.mirror.aliyuncs.com&quot;]</span><br><span class="line"> </span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128131513972.png" alt="image-20211128131513972"></p>
<h4 id="检查是否生效"><a href="#检查是否生效" class="headerlink" title="检查是否生效"></a>检查是否生效</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128133728211.png" alt="image-20211128133728211"></p>
<h3 id="Docker容器使用"><a href="#Docker容器使用" class="headerlink" title="Docker容器使用"></a>Docker容器使用</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@local ~]# docker</span><br></pre></td></tr></table></figure>

<img data-src="https://cdn.jonty.top/img/image-20211128134120395.png" alt="image-20211128134120395" style="zoom:80%;" />

<p>使用 <code>docker [cammand] --help</code>查看命令使用方法</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --help</span><br></pre></td></tr></table></figure>

<img data-src="https://cdn.jonty.top/img/image-20211128134321971.png" alt="image-20211128134321971" style="zoom:80%;" />

<h4 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h4><p>从镜像仓库拉取镜像</p>
<p>命令：<code>docker pull [OPTIONS] NAME[:TAG|@DIGEST]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull  -q nginx  # -q 不输出 </span><br><span class="line">docker images # 查看镜像列表</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128134754794.png" alt="image-20211128134754794"></p>
<h4 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h4><p>启动一个新的容器实例</p>
<p>命令：<code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name my_nginx -p 80:80 -d nginx</span><br><span class="line"></span><br><span class="line">[root@local ~]# docker run --name my_nginx -p 80:80 -d nginx</span><br><span class="line">2fc689cc169c994ffec7aeadacbedfc13ff4de540fb3e5e7c85520f2d4da5fde</span><br><span class="line">[root@local ~]#</span><br></pre></td></tr></table></figure>

<ul>
<li>–name：指定容器的名称</li>
<li>-p：映射的端口</li>
<li>-d : 后台运行</li>
</ul>
<p>浏览器访问我们的容器，可以看到<code>nginx</code>已经启动。</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211128135337874.png" alt="image-20211128135337874"></p>
<h4 id="查看所有容器"><a href="#查看所有容器" class="headerlink" title="查看所有容器"></a>查看所有容器</h4><p>命令：<code>docker ps [OPTIONS]</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211128135638225.png" alt="image-20211128135638225"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">[root@local ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                               NAMES</span><br><span class="line">2fc689cc169c   nginx     &quot;/docker-entrypoint.…&quot;   6 minutes ago   Up 6 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   my_nginx</span><br><span class="line">[root@local ~]#</span><br></pre></td></tr></table></figure>

<h4 id="启动容器-1"><a href="#启动容器-1" class="headerlink" title="启动容器"></a>启动容器</h4><p>命令：<code>docker start [OPTIONS] CONTAINER [CONTAINER...]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker start my_nginx</span><br><span class="line">docker restart my_nginx # 重启容器</span><br></pre></td></tr></table></figure>

<h4 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker stop my_nginx # 停止名称为my_nginx的容器</span><br><span class="line">docker stop 2fc689cc169c # container Id</span><br><span class="line"></span><br><span class="line">[root@local ~]# docker stop my_nginx</span><br><span class="line">my_nginx</span><br><span class="line">[root@local ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@local ~]# docker stop --help</span><br><span class="line"></span><br><span class="line">Usage:  docker stop [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Stop one or more running containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -t, --time int   Seconds to wait for stop before killing it (default 10)</span><br></pre></td></tr></table></figure>

<h4 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h4><p>在正在运行的容器中运行命令</p>
<p>命令：<code>docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it my_nginx /bin/bash</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128141608965.png" alt="image-20211128141608965"></p>
<p>相当于进入容器内部，一个隔离的<code>Linux</code>系统，使用<code>exit</code>退出</p>
<h4 id="导入导出"><a href="#导入导出" class="headerlink" title="导入导出"></a>导入导出</h4><h4 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h4><p>导出容器镜像文件</p>
<p>命令:<code>docker export [OPTIONS] CONTAINER</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker export my_nginx &gt; my_nginx.tar</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128142032945.png" alt="image-20211128142032945"></p>
<h5 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h5><p>导入镜像</p>
<p>命令：<code>docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]</code></p>
<p>这里我将导出的镜像文件放到<code>win</code>系统中，使用<code>Docker Desktop</code>导入</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker import .\my_nginx.tar my_nginx</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128142745839.png" alt="image-20211128142745839"></p>
<h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><p>命令:<code>docker rm [OPTIONS] CONTAINER [CONTAINER...]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docekr rm my_nginx</span><br></pre></td></tr></table></figure>

<p>可选参数：</p>
<ul>
<li>-f : 强制删除正在运行的容器（不加这个参数则需要先<code>docker stop containerId</code>）</li>
<li>-v : 移除与容器相关的数据卷</li>
</ul>
<p><img data-src="https://cdn.jonty.top/img/image-20211128144931845.png" alt="image-20211128144931845"></p>
<h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><p>命令：<code> docker logs [OPTIONS] CONTAINER</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker logs -f -n 100 my_nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>-f : 跟踪日志输出</li>
<li>-n : 从日志末尾显示的行数（默认：全部）</li>
</ul>
<img data-src="https://cdn.jonty.top/img/image-20211128144724047.png" alt="image-20211128144724047" style="zoom:80%;" />



<h4 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a>查看端口</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@local ~]# docker port  my_nginx</span><br><span class="line">80/tcp -&gt; 0.0.0.0:80</span><br><span class="line">80/tcp -&gt; :::80</span><br><span class="line">[root@local ~]#</span><br></pre></td></tr></table></figure>

<h3 id="Docker-镜像使用"><a href="#Docker-镜像使用" class="headerlink" title="Docker 镜像使用"></a>Docker 镜像使用</h3><p>使用<code>docker run </code>运行容器时，如果在本地没有找到镜像则会自动从<code>Docker Hub</code>拉取镜像。</p>
<img data-src="https://cdn.jonty.top/img/image-20211128145350390.png" alt="image-20211128145350390" style="zoom:80%;" />



<h4 id="查看镜像列表"><a href="#查看镜像列表" class="headerlink" title="查看镜像列表"></a>查看镜像列表</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@local ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx         latest    ea335eea17ab   10 days ago    141MB</span><br><span class="line">hello-world   latest    feb5d9fea6a5   2 months ago   13.3kB</span><br></pre></td></tr></table></figure>

<ul>
<li>REPOSITORY : 镜像仓库源（默认：Docker Hub）</li>
<li>TAG ：镜像标签 默认拉取<strong>latest</strong>,可指定版本 <code>docker pull nginx:xxx</code></li>
<li>IMAGE ID : 镜像ID</li>
<li>CREATED : 创建时间</li>
<li>SIZE : 镜像大小</li>
</ul>
<h4 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h4><p>命令：<code> docker search [OPTIONS] TERM</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker search --limit 10 nginx # 返回10条结果</span><br></pre></td></tr></table></figure>

<img data-src="https://cdn.jonty.top/img/image-20211128150050740.png" alt="image-20211128150050740" style="zoom:80%;" />

<ul>
<li>NAME ： 镜像仓库源名称</li>
<li>DESCRIPTION : 描述</li>
<li>STARS : 点赞数</li>
<li>OFFICIAL : 是否官方发布</li>
<li>AUTOMATED : 自动构建</li>
</ul>
<h4 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h4><p>命令：<code>docker pull [OPTIONS] NAME[:TAG|@DIGEST]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull nginx # 拉取默认版本</span><br><span class="line">docker pull nginx:xxx # 拉取指定版本</span><br><span class="line">docker pull -q nginx # 无输出</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@local ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">eff15d958d66: Pull complete</span><br><span class="line">1e5351450a59: Pull complete</span><br><span class="line">2df63e6ce2be: Pull complete</span><br><span class="line">9171c7ae368c: Pull complete</span><br><span class="line">020f975acd28: Pull complete</span><br><span class="line">266f639b35ad: Pull complete</span><br><span class="line">Digest: sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128150647218.png" alt="image-20211128150647218"></p>
<h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><p>命令：<code> docker rmi [OPTIONS] IMAGE [IMAGE...]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rmi hello-world:latest</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128183009721.png" alt="image-20211128183009721"></p>
<h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><p>命令：<code>docker build [OPTIONS] PATH | URL | -</code></p>
<img data-src="https://cdn.jonty.top/img/image-20211128191400815.png" alt="image-20211128191400815" style="zoom: 67%;" />



<h4 id="设置镜像标签"><a href="#设置镜像标签" class="headerlink" title="设置镜像标签"></a>设置镜像标签</h4><p>命令：<code> docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker tag nginx:latest jontymin/my_nginx</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128192133803.png" alt="image-20211128192133803"></p>
<h3 id="镜像仓库"><a href="#镜像仓库" class="headerlink" title="镜像仓库"></a>镜像仓库</h3><p>仓库（Repository）是集中存放镜像的地方（类比git仓库）</p>
<p><code>Docker</code>官方维护了一个公共仓库，需要注册账号以推送镜像 <a href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<img data-src="https://cdn.jonty.top/img/1578550749282.png" alt="1578550749282" style="zoom:80%;" />

<blockquote>
<p>上图为Docker容器和本地仓库、远程仓库的关系</p>
</blockquote>
<h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker login </span><br></pre></td></tr></table></figure>

<ul>
<li>-p : 密码</li>
<li>-u ： 用户名</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@local ~]# docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don&#x27;t have a Docker ID, head over to https://hub.docker.com to create one.</span><br><span class="line">Username: jontymax</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<h4 id="推送镜像"><a href="#推送镜像" class="headerlink" title="推送镜像"></a>推送镜像</h4><p>命令 : <code>docker push [OPTIONS] NAME[:TAG]</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker push jontymax/my_nginx</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211128215642468.png" alt="image-20211128215642468"></p>
<blockquote>
<p>参考： <a href="https://docs.docker.com/engine/reference/run/">https://docs.docker.com/engine/reference/run/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2021/09/08/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hello World</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker中安装jira</title>
    <url>/2021/09/23/install-jira-in-docker/</url>
    <content><![CDATA[<h2 id="数据库准备"><a href="#数据库准备" class="headerlink" title="数据库准备"></a>数据库准备</h2><p>其他数据库请参考文档</p>
<p><a href="https://confluence.atlassian.com/adminjiraserver/connecting-jira-applications-to-a-database-938846850.html">Connecting Jira applications to a database</a></p>
<p>这里使用的是PostgreSql</p>
<ol>
<li><p>创建空数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE jiradb <span class="keyword">WITH</span> ENCODING <span class="string">&#x27;UNICODE&#x27;</span> LC_COLLATE <span class="string">&#x27;C&#x27;</span> LC_CTYPE <span class="string">&#x27;C&#x27;</span> TEMPLATE template0;</span><br></pre></td></tr></table></figure></li>
<li><p>创建用户(也可以使用默认用户)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> jira <span class="keyword">WITH</span> PASSWORD <span class="string">&#x27;bb123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 给权限</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> DATABASE jiradb <span class="keyword">TO</span> jira</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img data-src="https://cdn.jonty.top/img/20210711235815.png" alt="image-20210708171601263"></p>
<h3 id="Jira安装"><a href="#Jira安装" class="headerlink" title="Jira安装"></a>Jira安装</h3><p><a href="https://confluence.atlassian.com/adminjiraserver071/jira-applications-installation-requirements-802592164.html">需要保证服务器有<code>4GB</code>以上内存</a></p>
<p>我在安装的时候1核2G跑不动换成了4核8G👀</p>
<p><img data-src="https://cdn.jonty.top/img/20210711235851.png" alt="image-20210708164819758"></p>
<h4 id="拉镜像"><a href="#拉镜像" class="headerlink" title="拉镜像"></a>拉镜像</h4><p>查看docker文档</p>
<p><img data-src="https://cdn.jonty.top/img/20210712000508.png"></p>
<ol>
<li>创建卷</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume create --name jiraVolume</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>拉取镜像并运行</li>
</ol>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> run -v jiraVolume:/var/atlassian/application-data/jira --name=<span class="string">&quot;jira&quot;</span> -d -p <span class="number">8080</span>:<span class="number">8080</span> atlassian/jira-software:<span class="number">8</span>.<span class="number">1</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps：注意：我们破解的版本的为8.1.0，拉镜像需要指定版本</p>
</blockquote>
<p><img data-src="https://cdn.jonty.top/img/20210712001529.png" alt="image-20210708170606734"></p>
<ol start="4">
<li>浏览器打开<code>IP:8080</code>端口</li>
</ol>
<h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>初次打开为英文，可在右上角设置为中文。选择第二个，自定义配置</p>
<p><img data-src="https://cdn.jonty.top/img/20210712001604.png" alt="image-20210708170935567"></p>
<p>点击下一步</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102437.png" alt="image-20210708171706660"></p>
<p><img data-src="https://cdn.jonty.top/img/20210721102449.png" alt="image-20210708171725265"></p>
<p>点击下一步，等待几分钟，正在创建数据库表</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102444.png" alt="image-20210708171808729"></p>
<p>数据库创建完成之后</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102454.png" alt="image-20210708172102316"></p>
<p>点击下一步，获取授权码，可以有30天试用</p>
<p>需要先按照提示去官方获取试用授权码，这样才可以进入系统，然后进行破解包的替换，重启服务即可。</p>
<p>点击连接去官网生成许可证</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102458.png" alt="image-20210708172300316"></p>
<p>我这里是直接用微软账号登录申请的，点击生成按钮后自动跳转回来并自动填入授权码</p>
<p><img data-src="https://cdn.jonty.top/img/20210712001647.png" alt="image-20210708172452780"></p>
<p>配置管理员账号</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102555.png" alt="image-20210708172617985"></p>
<p>邮件服务器，以后再说</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102602.png" alt="image-20210708172653783"></p>
<p>设置默认语言</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102726.png" alt="image-20210708172918673"></p>
<p>选择头像</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102743.png" alt="image-20210708172949746"></p>
<p>这里可以选择创建示例项目</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102835.png" alt="image-20210708173027592"></p>
<p><img data-src="https://cdn.jonty.top/img/20210721102859.png" alt="image-20210708173118682"></p>
<p>进入首页面板</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102910.png" alt="image-20210708173327874"></p>
<p>点击右上角的管理&gt;应用程序</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102535.png" alt="image-20210708173606783"></p>
<h3 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h3><ol>
<li>下载破解包</li>
</ol>
<p><a href="https://cloud.189.cn/t/2MFZFvriQ7fe">atlassian-extras-3.2</a></p>
<ol start="2">
<li>使用ftp工具上传到服务器</li>
</ol>
<p><img data-src="https://cdn.jonty.top/img/20210721102527.png" alt="image-20210708174235612"></p>
<ol start="3">
<li><p>替换</p>
<p>通过docker ps 获取jira容器id，然后把破解包上传至宿主机通过docker cp 命令复制到容器中，重启jira容器　</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps</span><br><span class="line"></span><br><span class="line">docker cp atlassian-extras-3.2.jar  06849baab1a6:/opt/atlassian/jira/atlassian-jira/WEB-INF/lib</span><br><span class="line"></span><br><span class="line">docker restart 06849baab1a6</span><br></pre></td></tr></table></figure>



<p><img data-src="https://cdn.jonty.top/img/20210721091151.png" alt="image-20210708174512592"></p>
</li>
</ol>
<p>破解成功</p>
<p><img data-src="https://cdn.jonty.top/img/20210721102816.png" alt="image-20210708174733130"></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Jira</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL Server故障转移集群 - 01</title>
    <url>/2021/12/02/sqlserver-ha-01/</url>
    <content><![CDATA[<h2 id="安装服务器"><a href="#安装服务器" class="headerlink" title="安装服务器"></a>安装服务器</h2><p>电脑安装<strong>VMware</strong>虚拟机，<a href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">下载地址</a></p>
<h3 id="新建虚拟机"><a href="#新建虚拟机" class="headerlink" title="新建虚拟机"></a>新建虚拟机</h3><h4 id="选择自定义"><a href="#选择自定义" class="headerlink" title="选择自定义"></a>选择自定义</h4><p>选择自定义安装向导，点击下一步。</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130093614132.png" alt="image-20211130093614132"></p>
<h4 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h4><p>默认兼容性（或者选择VMware对应版本），点击下一步继续。</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130093715657.png" alt="image-20211130093715657"></p>
<h4 id="系统镜像"><a href="#系统镜像" class="headerlink" title="系统镜像"></a>系统镜像</h4><p>这里选择<strong>稍后</strong>安装操作系统，我们配置完成之后再手动选择<code>系统镜像文件</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130093835618.png" alt="image-20211130093835618"></p>
<h4 id="系统类型"><a href="#系统类型" class="headerlink" title="系统类型"></a>系统类型</h4><p>我们安装<code>Windows Server 2019</code>版本的服务器。</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130093953176.png" alt="image-20211130093953176"></p>
<h4 id="命名虚拟机"><a href="#命名虚拟机" class="headerlink" title="命名虚拟机"></a>命名虚拟机</h4><p>填写虚拟机名称，建议以<code>主机名+IP</code>，方便区分。选择虚拟机存放路径</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094211240.png" alt="image-20211130094211240"></p>
<h4 id="固件类型"><a href="#固件类型" class="headerlink" title="固件类型"></a>固件类型</h4><p>选择使用<strong>BIOS</strong>启动</p>
<blockquote>
<p>使用UEFI 可能会出现 Time Out …这种情况</p>
</blockquote>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094235421.png" alt="image-20211130094235421"></p>
<h4 id="处理器配置"><a href="#处理器配置" class="headerlink" title="处理器配置"></a>处理器配置</h4><p>处理我们选择1个CPU 2个处理核心</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094440354.png" alt="image-20211130094440354"></p>
<h4 id="内存配置"><a href="#内存配置" class="headerlink" title="内存配置"></a>内存配置</h4><p>内存配置为<code>4G</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094508709.png" alt="image-20211130094508709"></p>
<h4 id="网络类型"><a href="#网络类型" class="headerlink" title="网络类型"></a>网络类型</h4><p>网络类型根据实际情况来，我这里选择桥接网络，后续需要添加一个网卡。</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094611392.png" alt="image-20211130094611392"></p>
<h4 id="I-O控制器类型"><a href="#I-O控制器类型" class="headerlink" title="I/O控制器类型"></a>I/O控制器类型</h4><p>默认</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094641514.png" alt="image-20211130094641514"></p>
<h4 id="磁盘类型"><a href="#磁盘类型" class="headerlink" title="磁盘类型"></a>磁盘类型</h4><p>默认</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094700337.png" alt="image-20211130094700337"></p>
<h4 id="磁盘选择"><a href="#磁盘选择" class="headerlink" title="磁盘选择"></a>磁盘选择</h4><p>选择创建新的虚拟磁盘</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094732722.png" alt="image-20211130094732722"></p>
<h4 id="指定磁盘容量"><a href="#指定磁盘容量" class="headerlink" title="指定磁盘容量"></a>指定磁盘容量</h4><p>磁盘大小配置为：100G</p>
<p>将磁盘存储为单个文件</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094803559.png" alt="image-20211130094803559"></p>
<h4 id="指定磁盘文件"><a href="#指定磁盘文件" class="headerlink" title="指定磁盘文件"></a>指定磁盘文件</h4><p>默认，下一步</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094902452.png" alt="image-20211130094902452"></p>
<h4 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h4><p>点击完成</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130094932549.png" alt="image-20211130094932549"></p>
<h3 id="虚拟机配置"><a href="#虚拟机配置" class="headerlink" title="虚拟机配置"></a>虚拟机配置</h3><h4 id="系统镜像-1"><a href="#系统镜像-1" class="headerlink" title="系统镜像"></a>系统镜像</h4><p><img data-src="https://cdn.jonty.top/img/image-20211130095602092.png" alt="image-20211130095602092"></p>
<h4 id="添加网卡"><a href="#添加网卡" class="headerlink" title="添加网卡"></a>添加网卡</h4><p><img data-src="https://cdn.jonty.top/img/image-20211130095229246.png" alt="image-20211130095229246"></p>
<p>配置第二块网卡的网络连接</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130095303266.png" alt="image-20211130095303266"></p>
<h4 id="共享文件夹"><a href="#共享文件夹" class="headerlink" title="共享文件夹"></a>共享文件夹</h4><p><img data-src="https://cdn.jonty.top/img/image-20211130095407929.png" alt="image-20211130095407929"></p>
<h3 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h3><p><img data-src="https://cdn.jonty.top/img/image-20211130100913192.png" alt="image-20211130100913192"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130100928792.png" alt="image-20211130100928792"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130100943388.png" alt="image-20211130100943388"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130100953011.png" alt="image-20211130100953011"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130101029992.png" alt="image-20211130101029992"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130101122829.png" alt="image-20211130101122829"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130101144922.png" alt="image-20211130101144922"></p>
<h3 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h3><p><img data-src="https://cdn.jonty.top/img/image-20211130101330030.png" alt="image-20211130101330030"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130101611447.png" alt="image-20211130101611447"></p>
<ul>
<li>配置IP</li>
<li>更改主机名</li>
<li>关闭防火墙</li>
</ul>
<h2 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h2><p>下载安装包到共享文件夹下，在虚拟机中打开安装程序，可以在官网下载适用版本</p>
<p>光盘映像文件需要先解压，解压完后进入目录：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130151655185.png" alt="image-20211130151655185"></p>
<p>运行安装程序：</p>
<p>选择左侧安装，选择全新安装</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130151740122.png" alt="image-20211130151740122"></p>
<h4 id="产品密钥"><a href="#产品密钥" class="headerlink" title="产品密钥"></a>产品密钥</h4><p><img data-src="https://cdn.jonty.top/img/image-20211130152002424.png" alt="image-20211130152002424"></p>
<h4 id="功能选择"><a href="#功能选择" class="headerlink" title="功能选择"></a>功能选择</h4><p>可以选择安装到D盘</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130144535838.png" alt="image-20211130144535838"></p>
<ul>
<li>数据库引擎服务</li>
<li>SQL Server 复制</li>
<li>全文和语义提取搜索</li>
<li>Data Quality Services</li>
<li>Analysis Services</li>
<li>客户端工具连接</li>
<li>客户端工具向后兼容性</li>
<li>客户端工具SDK</li>
<li>SQL 客户端连接SDK</li>
<li>Master Data Services</li>
</ul>
<h4 id="实例安装"><a href="#实例安装" class="headerlink" title="实例安装"></a>实例安装</h4><p><img data-src="https://cdn.jonty.top/img/image-20211130145023223.png" alt="image-20211130145023223"></p>
<h4 id="服务器配置-1"><a href="#服务器配置-1" class="headerlink" title="服务器配置"></a>服务器配置</h4><p>更改SQL Server代理 自动启动</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130145044256.png" alt="image-20211130145044256"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130145110590.png" alt="image-20211130145110590"></p>
<h4 id="数据库引擎配置"><a href="#数据库引擎配置" class="headerlink" title="数据库引擎配置"></a>数据库引擎配置</h4><p>设置密码</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130145258502.png" alt="image-20211130145258502"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130145607022.png" alt="image-20211130145607022"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211130152522168.png" alt="image-20211130152522168"></p>
]]></content>
      <categories>
        <category>SQL Server</category>
      </categories>
      <tags>
        <tag>SQL Server 2019</tag>
        <tag>DB Cluster</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL Server故障转移集群 - 02</title>
    <url>/2021/12/02/sqlserver-ha-02/</url>
    <content><![CDATA[<h3 id="集群规划"><a href="#集群规划" class="headerlink" title="集群规划"></a>集群规划</h3><table>
<thead>
<tr>
<th>节点</th>
<th>public ip</th>
<th>private ip</th>
<th>域名</th>
<th>配置</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>ws21</td>
<td>192.168.1.21</td>
<td>10.10.10.21</td>
<td>ws21.gctsql.com</td>
<td>4G 2C 100G</td>
<td></td>
</tr>
<tr>
<td>ws22</td>
<td>192.168.1.22</td>
<td>10.10.10.22</td>
<td>ws22.gctsql.com</td>
<td>4G 2C 100G</td>
<td></td>
</tr>
<tr>
<td>ws30</td>
<td>192.168.1.30</td>
<td>10.10.10.30</td>
<td>ws30.gctsql.com</td>
<td>4G 2C 100G + 200G(数据盘)</td>
<td></td>
</tr>
<tr>
<td>集群IP</td>
<td>192.168.1.25</td>
<td></td>
<td>gctcluster</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DTC</td>
<td>192.168.1.26</td>
<td></td>
<td></td>
<td></td>
<td>分布式事务协调器</td>
</tr>
<tr>
<td>VIP</td>
<td>192.168.1.27</td>
<td></td>
<td>gctvip</td>
<td></td>
<td>访问IP</td>
</tr>
</tbody></table>
<h3 id="配置共享存储"><a href="#配置共享存储" class="headerlink" title="配置共享存储"></a>配置共享存储</h3><p>共享磁盘</p>
<table>
<thead>
<tr>
<th>磁盘</th>
<th>盘符</th>
<th>大小</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>data1</td>
<td>S</td>
<td>50G</td>
<td></td>
</tr>
<tr>
<td>data2</td>
<td>T</td>
<td>50G</td>
<td></td>
</tr>
<tr>
<td>log</td>
<td>L</td>
<td>10G</td>
<td>分布式事务协调器使用</td>
</tr>
<tr>
<td>qdisk</td>
<td>Q</td>
<td>5G</td>
<td>仲裁盘</td>
</tr>
</tbody></table>
<h4 id="添加硬盘"><a href="#添加硬盘" class="headerlink" title="添加硬盘"></a>添加硬盘</h4><p><code>ws30</code>节点添加一块<strong>200G</strong>的磁盘用作共享存储</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201185835015.png" alt="image-20211201185835015"></p>
<h4 id="更改虚拟机文件"><a href="#更改虚拟机文件" class="headerlink" title="更改虚拟机文件"></a>更改虚拟机文件</h4><p>在<strong>每个节点</strong>的虚拟机文件下添加</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">disk.locking = <span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>



<img data-src="https://cdn.jonty.top/img/image-20211201190155960.png" alt="image-20211201190155960" style="zoom:80%;" />



<h4 id="磁盘挂载"><a href="#磁盘挂载" class="headerlink" title="磁盘挂载"></a>磁盘挂载</h4><p><code>ws30</code>节点</p>
<p>将磁盘初始化</p>
<img data-src="https://cdn.jonty.top/img/image-20211201190818354.png" alt="image-20211201190818354" style="zoom:80%;" />

<p>新建简单卷</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201191011475.png" alt="image-20211201191011475"></p>
<h4 id="添加ISCSI"><a href="#添加ISCSI" class="headerlink" title="添加ISCSI"></a>添加ISCSI</h4><p>打开服务器管理器 选择添加角色和功能</p>
<img data-src="https://cdn.jonty.top/img/image-20211201192103693.png" alt="image-20211201192103693" style="zoom:67%;" />



<p>服务器角色之前一直默认下一步，选择添加<code>ISCSI</code>功能，下一步到<strong>安装</strong></p>
<img data-src="https://cdn.jonty.top/img/image-20211201192249064.png" alt="image-20211201192249064" style="zoom:80%;" />

<img data-src="https://cdn.jonty.top/img/image-20211201192625843.png" alt="image-20211201192625843" style="zoom:80%;" />



<p>点击<strong>文件和存储服务</strong></p>
<img data-src="https://cdn.jonty.top/img/image-20211201192744209.png" alt="image-20211201192744209" style="zoom:80%;" />



<h4 id="创建虚拟磁盘"><a href="#创建虚拟磁盘" class="headerlink" title="创建虚拟磁盘"></a>创建虚拟磁盘</h4><p>选择<strong>ISCSI</strong>,点击添加</p>
<img data-src="https://cdn.jonty.top/img/image-20211201192819064.png" alt="image-20211201192819064" style="zoom:80%;" />

<h5 id="step1-存储位置"><a href="#step1-存储位置" class="headerlink" title="step1 存储位置"></a>step1 存储位置</h5><p>选择存储位置为添加的共享存储<code>F:</code>盘，下一步</p>
<img data-src="https://cdn.jonty.top/img/image-20211201192910694.png" alt="image-20211201192910694" style="zoom:80%;" />

<h5 id="step2-磁盘名称"><a href="#step2-磁盘名称" class="headerlink" title="step2 磁盘名称"></a>step2 磁盘名称</h5><img data-src="https://cdn.jonty.top/img/image-20211201193035095.png" alt="image-20211201193035095" style="zoom:80%;" />



<h5 id="step2-磁盘大小"><a href="#step2-磁盘大小" class="headerlink" title="step2 磁盘大小"></a>step2 磁盘大小</h5><p>新建数据盘1，大小50G,选择动态扩展</p>
<img data-src="https://cdn.jonty.top/img/image-20211201193155029.png" alt="image-20211201193155029" style="zoom:80%;" />



<h5 id="step3-新建目标"><a href="#step3-新建目标" class="headerlink" title="step3 新建目标"></a>step3 新建目标</h5><img data-src="https://cdn.jonty.top/img/image-20211201193321361.png" alt="image-20211201193321361" style="zoom:80%;" />



<img data-src="https://cdn.jonty.top/img/image-20211201193348497.png" alt="image-20211201193348497" style="zoom:80%;" />



<h5 id="step4-添加访问服务器"><a href="#step4-添加访问服务器" class="headerlink" title="step4 添加访问服务器"></a>step4 添加访问服务器</h5><img data-src="https://cdn.jonty.top/img/image-20211201193518559.png" alt="image-20211201193518559" style="zoom:80%;" />

<h5 id="step5-验证服务"><a href="#step5-验证服务" class="headerlink" title="step5 验证服务"></a>step5 验证服务</h5><p><strong>不启用</strong></p>
<img data-src="https://cdn.jonty.top/img/image-20211201193600540.png" alt="image-20211201193600540" style="zoom:80%;" />



<h5 id="step6-创建"><a href="#step6-创建" class="headerlink" title="step6 创建"></a>step6 创建</h5><img data-src="https://cdn.jonty.top/img/image-20211201193618040.png" alt="image-20211201193618040" style="zoom:80%;" />



<img data-src="https://cdn.jonty.top/img/image-20211201193625413.png" alt="image-20211201193625413" style="zoom:80%;" />



<p>按照step1 - step6 依次创建：data02|logdisk|qdisk</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201193937062.png" alt="image-20211201193937062"></p>
<h4 id="连接ISCSI"><a href="#连接ISCSI" class="headerlink" title="连接ISCSI"></a>连接ISCSI</h4><p><code>ws21</code>、<code>ws22</code>节点连接共享存储，在管理工具打开<code>ISCSI发起程序</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201194248998.png" alt="image-20211201194248998"></p>
<p>系统启动的<code>ISCSI</code>服务</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201194354735.png" alt="image-20211201194354735"></p>
<p>目标为<code>ws30</code>节点的<code>private ip</code> ，参考上一篇配置<strong>网卡属性</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201194554980.png" alt="image-20211201194554980"></p>
<p>选择卷和设备，点击自动配置</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201194628569.png" alt="image-20211201194628569"></p>
<p>计算机管理 -&gt; 磁盘管理，可以看到共享磁盘已经挂载</p>
<img data-src="https://cdn.jonty.top/img/image-20211201194955729.png" alt="image-20211201194955729" style="zoom:80%;" />



<p>这时候可以看到<code>ws30</code>节点<code>ISCSI</code>已连接</p>
<img data-src="https://cdn.jonty.top/img/image-20211201195058797.png" alt="image-20211201195058797" style="zoom: 67%;" />

<p><img data-src="https://cdn.jonty.top/img/image-20211201195659064.png" alt="image-20211201195659064"></p>
<h4 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h4><p>在<code>ws21</code>节点操作，先将<code>ws22</code>挂起</p>
<p>磁盘管理</p>
<h5 id="联机"><a href="#联机" class="headerlink" title="联机"></a>联机</h5><p>右键共享的磁盘，点击<strong>联机</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201200524618.png" alt="image-20211201200524618"></p>
<h5 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h5><p><img data-src="https://cdn.jonty.top/img/image-20211201200623970.png" alt="image-20211201200623970"></p>
<h5 id="新建卷"><a href="#新建卷" class="headerlink" title="新建卷"></a>新建卷</h5><img data-src="https://cdn.jonty.top/img/image-20211201201324395.png" alt="image-20211201201324395" style="zoom:80%;" />

<p><img data-src="https://cdn.jonty.top/img/image-20211201201341777.png" alt="image-20211201201341777"></p>
<p>将<code>ws22</code>节点重启，然后将盘符修改与<code>ws21</code>节点一致</p>
<img data-src="https://cdn.jonty.top/img/image-20211201201927696.png" alt="image-20211201201927696" style="zoom:80%;" />

<p>将两台节点机器重启</p>
<p>查看<code>ws30</code>节点</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201202418405.png" alt="image-20211201202418405"></p>
<h3 id="配置域环境"><a href="#配置域环境" class="headerlink" title="配置域环境"></a>配置域环境</h3><h4 id="设置网卡DNS"><a href="#设置网卡DNS" class="headerlink" title="设置网卡DNS"></a>设置网卡DNS</h4><p>将<code>ws30</code>节点设为<strong>DNS</strong>服务器，更改为本机IP</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201202650666.png" alt="image-20211201202650666"></p>
<h4 id="添加域服务"><a href="#添加域服务" class="headerlink" title="添加域服务"></a>添加域服务</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>添加角色和功能向导，选择添加<code>Active Directory域服务</code>和<code>DNS</code>服务器</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201202841391.png" alt="image-20211201202841391"></p>
<p>安装完成后点击<code>将此服务器提升为域服务器</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201203328080.png" alt="image-20211201203328080"></p>
<h5 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h5><p>选择添加<code>新林</code>,自定义一个<code>根域名</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201203602401.png" alt="image-20211201203602401"></p>
<p>设置DNS密码</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201210755796.png" alt="image-20211201210755796"></p>
<p>下一步</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201210837952.png" alt="image-20211201210837952"></p>
<p>下一步 <code>Net BIOS</code>域名会自动配置</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201211035339.png" alt="image-20211201211035339"></p>
<p>路径默认 ， 下一步</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201211100277.png" alt="image-20211201211100277"></p>
<p>检查，警告可忽略，点击安装</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211201211327973.png" alt="image-20211201211327973"></p>
<p>安装完成后会自动重启，并使用域用户登录</p>
<img data-src="https://cdn.jonty.top/img/image-20211202092241661.png" style="zoom:80%;" />

<p>禁用windows更新服务</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202092911752.png" alt="image-20211202092911752"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202093234791.png" alt="image-20211202093234791"></p>
<h4 id="加入域"><a href="#加入域" class="headerlink" title="加入域"></a>加入域</h4><p><code>ws21</code>、<code>ws22</code>节点更改DNS</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202095606856.png" alt="image-20211202095606856"></p>
<p>高级系统设置，更改<strong>计算机域</strong>，需要输入<strong>域服务器</strong><code>ws30</code>服务器的<strong>账号密码</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202095208317.png" alt="image-20211202095208317"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202100254263.png" alt="image-20211202100254263"></p>
<p>两个节点加入域完成后重启，查看是否配置成功：</p>
<p>node<code>ws21</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202100717557.png" alt="image-20211202100717557"></p>
<p>node<code>ws22</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202100757069.png" alt="image-20211202100757069"></p>
<h3 id="安装故障转移集群"><a href="#安装故障转移集群" class="headerlink" title="安装故障转移集群"></a>安装故障转移集群</h3><h4 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h4><p>节点<code>ws21</code>、节点<code>ws22</code>均配置</p>
<p>重命名网卡</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202101040029.png" alt="image-20211202101040029"></p>
<h5 id="配置public网卡"><a href="#配置public网卡" class="headerlink" title="配置public网卡"></a>配置<code>public</code>网卡</h5><p>跃点配置为5</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202101150519.png" alt="image-20211202101150519"></p>
<h5 id="配置private网卡"><a href="#配置private网卡" class="headerlink" title="配置private网卡"></a>配置<code>private</code>网卡</h5><p>跃点配置为75</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202101314516.png" alt="image-20211202101314516"></p>
<p>取消<code>DNS</code>注册</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202101436509.png" alt="image-20211202101436509"></p>
<p>禁用<code>NET BIOS</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202101526718.png" alt="image-20211202101526718"></p>
<p>查看</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202101716057.png" alt="image-20211202101716057"></p>
<h4 id="配置故障转移集群"><a href="#配置故障转移集群" class="headerlink" title="配置故障转移集群"></a>配置故障转移集群</h4><h5 id="安装管理工具"><a href="#安装管理工具" class="headerlink" title="安装管理工具"></a>安装管理工具</h5><p>功能，选择故障转移集群</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202102733214.png" alt="image-20211202102733214"></p>
<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><p>打开故障转移集群管理器</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202103144127.png" alt="image-20211202103144127"></p>
<p>选择验证配置</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202103337978.png" alt="image-20211202103337978"></p>
<p>加入<code>ws21</code>、<code>ws22</code>节点</p>
<p>运行测试：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202103502122.png" alt="image-20211202103502122"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202104126258.png" alt="image-20211202104126258"></p>
<p>配置集群地址</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202104427813.png" alt="image-20211202104427813"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202104545164.png" alt="image-20211202104545164"></p>
<p>查看集群状态</p>
<img data-src="https://cdn.jonty.top/img/image-20211202104602813.png" alt="image-20211202104602813" style="zoom:80%;" />



<p><img data-src="https://cdn.jonty.top/img/image-20211202104618644.png" alt="image-20211202104618644"></p>
<p>查看DNS</p>
<img data-src="https://cdn.jonty.top/img/image-20211202104828009.png" alt="image-20211202104828009" style="zoom:67%;" />



<h4 id="配置仲裁"><a href="#配置仲裁" class="headerlink" title="配置仲裁"></a>配置仲裁</h4><p><img data-src="https://cdn.jonty.top/img/image-20211202105123405.png" alt="image-20211202105123405"></p>
<h5 id="配置仲裁选项"><a href="#配置仲裁选项" class="headerlink" title="配置仲裁选项"></a>配置仲裁选项</h5><p><img data-src="https://cdn.jonty.top/img/image-20211202105231712.png" alt="image-20211202105231712"></p>
<h5 id="配置仲裁鉴证"><a href="#配置仲裁鉴证" class="headerlink" title="配置仲裁鉴证"></a>配置仲裁鉴证</h5><p><img data-src="https://cdn.jonty.top/img/image-20211202105316643.png" alt="image-20211202105316643"></p>
<h5 id="选择存储"><a href="#选择存储" class="headerlink" title="选择存储"></a>选择存储</h5><p><img data-src="https://cdn.jonty.top/img/image-20211202105357931.png" alt="image-20211202105357931"></p>
<h4 id="DTC"><a href="#DTC" class="headerlink" title="DTC"></a>DTC</h4><p>分布式事务协调器</p>
<p>右键角色</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202105532266.png" alt="image-20211202105532266"></p>
<p>配置访问点</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202105610048.png" alt="image-20211202105610048"></p>
<p>选择磁盘</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202105640231.png" alt="image-20211202105640231"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202105743893.png" alt="image-20211202105743893"></p>
<h4 id="连接集群"><a href="#连接集群" class="headerlink" title="连接集群"></a>连接集群</h4><p><code>ws22</code>节点连接到集群</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202110245478.png" alt="image-20211202110245478"></p>
<h3 id="安装SQL-Server集群"><a href="#安装SQL-Server集群" class="headerlink" title="安装SQL Server集群"></a>安装SQL Server集群</h3><h4 id="创建域用户"><a href="#创建域用户" class="headerlink" title="创建域用户"></a>创建域用户</h4><p>节点<code>ws21</code>、<code>ws22</code>均添加</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202110727927.png" alt="image-20211202110727927"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202110800147.png" alt="image-20211202110800147"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202110832905.png" alt="image-20211202110832905"></p>
<p>节点添加用户</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202111030952.png" alt="image-20211202111030952"></p>
<h4 id="安装SQL-Server故障转移集群"><a href="#安装SQL-Server故障转移集群" class="headerlink" title="安装SQL Server故障转移集群"></a>安装SQL Server故障转移集群</h4><p>安装 选择新的SQL Server 故障转移集群</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202152449061.png" alt="image-20211202152449061"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202152922581.png" alt="image-20211202152922581"></p>
<h5 id="功能选择"><a href="#功能选择" class="headerlink" title="功能选择"></a>功能选择</h5><ul>
<li>数据库引擎服务</li>
<li>SQL Server复制</li>
<li>全文和语义提取搜索</li>
<li>Data Quality  Services</li>
<li>Analysis Services</li>
<li>客户端工具连接</li>
<li>客户端工具向后兼容性</li>
<li>客户端工具SDK</li>
<li>SQL 客户端连接SDK</li>
<li>Master Data Services</li>
</ul>
<p><img data-src="https://cdn.jonty.top/img/image-20211202153040769.png" alt="image-20211202153040769"></p>
<h5 id="实例配置"><a href="#实例配置" class="headerlink" title="实例配置"></a>实例配置</h5><p><img data-src="https://cdn.jonty.top/img/image-20211202153359073.png" alt="image-20211202153359073"></p>
<p>默认 下一步</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202153438066.png" alt="image-20211202153438066"></p>
<h5 id="磁盘配置"><a href="#磁盘配置" class="headerlink" title="磁盘配置"></a>磁盘配置</h5><p><img data-src="https://cdn.jonty.top/img/image-20211202153530002.png" alt="image-20211202153530002"></p>
<h5 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h5><p>数据库访问地址：<code>192.168.1.27</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202153604512.png" alt="image-20211202153604512"></p>
<h5 id="服务账号"><a href="#服务账号" class="headerlink" title="服务账号"></a>服务账号</h5><p>使用<strong>域账号</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202153802375.png" alt="image-20211202153802375"></p>
<h5 id="SQL-引擎"><a href="#SQL-引擎" class="headerlink" title="SQL 引擎"></a>SQL 引擎</h5><p>添加当前账号和<strong>域账号</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202153925390.png" alt="image-20211202153925390"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202154129079.png" alt="image-20211202154129079"></p>
<p>开始安装</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202154152284.png" alt="image-20211202154152284"></p>
<p>安装完成</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202155144057.png" alt="image-20211202155144057"></p>
<h4 id="添加节点"><a href="#添加节点" class="headerlink" title="添加节点"></a>添加节点</h4><p>在<code>ws22</code>节点运行SQL Server安装程序</p>
<p>安装 选择向<code>SQL Server</code>故障转移集群添加节点</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202161254273.png" alt="image-20211202161254273"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202161846649.png" alt="image-20211202161846649"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202161904992.png" alt="image-20211202161904992"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202161935343.png" alt="image-20211202161935343"></p>
<p>输入密码</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202162029727.png" alt="image-20211202162029727"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202164930282.png" alt="image-20211202164930282"></p>
<h3 id="集群测试"><a href="#集群测试" class="headerlink" title="集群测试"></a>集群测试</h3><p>使用<strong>SSMS</strong>工具连接到数据库</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202165230001.png" alt="image-20211202165230001"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (id <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>,name <span class="type">varchar</span>(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;Jonty&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;Juila&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>可以看到 DTC、集群、以及VIP 都在<code>ws21</code>节点，我们把<code>ws21</code>节点关闭,然后操作数据库，可以发现数据库已经故障转移到<code>ws22</code>节点</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211202165611603.png" alt="image-20211202165611603"></p>
]]></content>
      <categories>
        <category>SQL Server</category>
      </categories>
      <tags>
        <tag>SQL Server 2019</tag>
        <tag>DB Cluster</tag>
      </tags>
  </entry>
  <entry>
    <title>知乎关于我国高等教育的看法</title>
    <url>/2021/09/27/the-systematic-failure-of-higher-education-in-china/</url>
    <content><![CDATA[<p>和老同学聊到在学校的生活，突然想到之前在知乎看到的这篇帖子，转载记录一下</p>
<p><a href="https://www.zhihu.com/people/517a82a684971b49348575efaa8f6fdd">@Youngster38324</a> 的回答透露出来了我国高等教育系统中的不少问题：</p>
<ol>
<li><strong>「进大学前唯分数和同质化教育」</strong>导致了太多人去大学后根本不知道自己要干嘛，很多人专业根本就不是自己选的更不要说知道自己有没有兴趣了，即便是很多高分考生也路径依赖地以为继续努力填鸭就能成功，没有意识到高考后的人生已经换赛道了。作为解决方案，可以引入类似美国 AP（Advanced Placement）的预科制度以及调整整个社会鼓励向自我发展看而不是向钱看的风气。</li>
<li><strong>「进大学后专业制度没有容错性」</strong>，即便已经发现自己不喜欢被录取专业了也没有办法，因为转专业制度不完善（通常要求你先要在你已经不喜欢了的本专业内卷到班级前多少名）。在不少西方学校，专业可以 undecided（先上课再决定专业，比如经典的哈佛 CS50，你上下来感兴趣了再去选 CS）；学位本身只是某个学科下课程学分累计的自然结果，因此可以灵活的转专业与多学位；班级这种促进内卷的概念也被弱化，强调跟自己比关注个人的成长，学生自己控制上几年课，念几个学位，中间休学一下都没关系。</li>
<li>前两步的结果就是导致大学为了毕业率把<strong>「评判标准搞成了平均主义」</strong>，为了能够每年顺利向社会输送一批（80% 将来都不会从事本专业）的人才，打分根据每年学生情况动态规划自适应，把大学搞成了「严进宽出」。其实大学教育更应该强调「宽进严出」，无论你底子如何，无论重修几次，你只要通过了某个（相对稳定的）客观标准就是合格，为了保证该制度的机械性运作，就要辅以严格的日常作业计分，对「作弊」零容忍（自动化判重，发现一次重修两次退学）。</li>
<li>平均主义进一步导致<strong>「课程设置没有灵活性无法自定义」</strong>，老师不但要照顾及格率还有一颗圣母心希望那些对专业没什么兴趣的人能好歹学到点东西，同时又真心欣赏且想要给予好学的尖子生资源，最后即便绞尽脑汁了也还是只能弄出个在差生里下限高在尖子生里上限低的课程安排两面不当人 —— 尖子生觉得课程要求太低不能激发自己的潜力喂不饱（常见于私下要求加难度或者去无学分旁听），摸鱼的觉得老师影响了我的快乐学习（常见于课堂上一布置作业下面就叫苦连天）该挂还是挂或者 60 分万岁。在不少西方学校学生，课程表可以自行安排，一个课可以开多个班次照顾灵活性，学霸可以比别人多上任意节课，也可以跨专业选课或者减少课程增加实习或研究，而且难度自选只要你点过前置技能就行。</li>
</ol>
<p>有类似迟先生这样诉求的人很多，可是一个系统很难由系统内的个体改变，所以很多个体选择了做局部优化趋利避害陪玩成为既得利益者，或者全局优化更换自己所处的系统。</p>
<p>只要所处系统里的大部分个体都已经默许了这个游戏规则，无论迟先生是「凡尔赛」还是「理想主义」，改变赛道规则就会被其他个体认为侵害到利益。小孩才分对错，成年人的屁股都是歪得，都是各取所需。</p>
<blockquote>
<p>作者：黄玄<br>链接：<a href="https://www.zhihu.com/question/439622084/answer/1685314467">https://www.zhihu.com/question/439622084/answer/1685314467</a><br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
</blockquote>
]]></content>
      <categories>
        <category>Share</category>
      </categories>
      <tags>
        <tag>Zhihu</tag>
      </tags>
  </entry>
  <entry>
    <title>VMware桥接模式连接失败</title>
    <url>/2021/10/27/vmware-bridge-ping-nowhere/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在学习<code>Linux</code>以及<code>Oracle</code>数据库，为出差<code>AMD</code>做准备。（未知）顺便顺点CPU回来😂</p>
<p>🐂*吹过头了，话不多说，上图：</p>
<img data-src="https://cdn.jonty.top/img/image-20211027204530933.png" alt="image-20211027204530933" style="zoom:67%;" />

<p>使用<strong>VMware</strong>安装<strong>Oracle Linux</strong>,使用<u>桥接模式(Bridge)</u>连接网络。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ping 192.168.2.1</span><br></pre></td></tr></table></figure>

<p>在<code>ping</code>本机时发现无法连接。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><h3 id="检查网络设置"><a href="#检查网络设置" class="headerlink" title="检查网络设置"></a>检查网络设置</h3><p>查看<strong>Linux</strong>中<strong>IPv4</strong>设置，</p>
<p>这里使用的手动模式获取，</p>
<ul>
<li>地址：192.168.2.51</li>
<li>掩码：255.255.255.0</li>
<li>网关：192.168.2.1</li>
</ul>
<img data-src="https://cdn.jonty.top/img/image-20211027204554710.png" alt="image-20211027204554710" style="zoom:67%;" />

<p>与本机地址对比，检查是否配置错误</p>
<p>使用以下命令查看<code>win</code>的网络配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：linux中为：ifconfig</p>
</blockquote>
<img data-src="https://cdn.jonty.top/img/image-20211027200202788.png" style="zoom:67%;" />

<p>对比发现：掩码和网关一致，IP也未冲突。所以Linux中配置无误。</p>
<h3 id="检查虚拟网络编辑器"><a href="#检查虚拟网络编辑器" class="headerlink" title="检查虚拟网络编辑器"></a>检查虚拟网络编辑器</h3><p>查看一下<strong>VMware</strong>网络编辑器中<strong>桥接模式</strong>的配置</p>
<img data-src="https://cdn.jonty.top/img/image-20211027204653746.png" alt="image-20211027204653746" style="zoom:67%;" />

<p>点击更改设置，一般桥接模式<strong>桥接地址</strong>为<strong>自动</strong>选择，建议配置为电脑网络连接使用的网卡地址。</p>
<img data-src="https://cdn.jonty.top/img/image-20211027204735327.png" alt="image-20211027204735327" style="zoom:67%;" />

<h3 id="检查本机网卡"><a href="#检查本机网卡" class="headerlink" title="检查本机网卡"></a>检查本机网卡</h3><p>打开<strong>控制面板</strong>，找到当前连接网络</p>
<img data-src="https://cdn.jonty.top/img/image-20211027204905408.png" alt="image-20211027204905408" style="zoom:67%;" />

<p>查看连接网络属性</p>
<img data-src="https://cdn.jonty.top/img/image-20211027204929950.png" alt="image-20211027204929950" style="zoom:67%;" />

<p>可以看到，当前连接网络使用的网卡为：<code>Realtek PCIe GbE Family Controller</code>,我们将VMware虚拟网络编辑器中桥接模式的网卡设置为本机当前网络使用的网卡。</p>
<p>选择后点击<strong>应用</strong></p>
<img data-src="https://cdn.jonty.top/img/image-20211027205006171.png" alt="image-20211027205006171" style="zoom:67%;" />

<h3 id="检查连接状态"><a href="#检查连接状态" class="headerlink" title="检查连接状态"></a>检查连接状态</h3><p>回到<strong>Linux</strong>中，再次<code>ping</code>连接成功。</p>
<img data-src="https://cdn.jonty.top/img/image-20211027205030251.png" alt="image-20211027205030251" style="zoom:67%;" />

<p>这是一个很小的问题，记录一下。</p>
<blockquote>
<p>有时候问题很复杂，答案却很简单</p>
</blockquote>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p><strong>VMware桥接模式</strong>：</p>
<p>VMware桥接模式，也就是将虚拟机的虚拟网络适配器与主机的物理网络适配器进行交接，虚拟机中的虚拟网络适配器可通过主机中的物理网络适配器直接访问到外部网络。</p>
<p>简而言之，这就好像在上图所示的局域网中添加了一台新的、独立的计算机一样。因此，虚拟机也会占用局域网中的一个IP地址，并且可以和其他终端进行相互访问。</p>
<p>桥接模式网络连接支持有线和无线主机网络适配器。如果你想把虚拟机当做一台完全独立的计算机看待，并且允许它和其他终端一样的进行网络通信，那么桥接模式通常是虚拟机访问网络的最简单途径。因为”桥接模式”下虚拟机相当于局域网中的一台电脑，所以IP同主机的IP在同一网段</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>VMware</tag>
      </tags>
  </entry>
  <entry>
    <title>VMware安装Linux</title>
    <url>/2021/10/27/vmware-install-linux/</url>
    <content><![CDATA[<h3 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h3><p>虚拟机(Virtual Machine）指通过软件模拟的具有完整硬件系统功能的、运行在一个完全隔离环境中的完整计算机系统。<br>虚拟系统通过生成现有操作系统的全新虚拟镜像，它具有真实windows系统完全一样的功能，进入虚拟系统后，所有操作都是在这个全新的独立的虚拟系统里面进行，可以独立安装运行软件，保存数据，拥有自己的独立桌面，不会对真正的系统产生任何影响，而且具有能够在现有系统与虚拟镜像之间灵活切换的一类操作系统。<br>流行的虚拟机厂家有VMware、 loracle Virtual Bo、微软Virtua PC，它们都能在Windows系统上虚拟出多个计算机(Win/Linux)</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>使用VMware安装Oracle Linux 7.6</p>
<p>需要安装好<a href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">VMware Workstation</a></p>
<h4 id="虚拟机设置"><a href="#虚拟机设置" class="headerlink" title="虚拟机设置"></a>虚拟机设置</h4><h5 id="新建向导"><a href="#新建向导" class="headerlink" title="新建向导"></a>新建向导</h5><img data-src="https://cdn.jonty.top/img/image-20211027184244784.png" alt="image-20211027184244784"  />

<h5 id="选择兼容版本"><a href="#选择兼容版本" class="headerlink" title="选择兼容版本"></a>选择兼容版本</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027184306364.png" alt="image-20211027184306364"></p>
<h5 id="稍后安装操作系统"><a href="#稍后安装操作系统" class="headerlink" title="稍后安装操作系统"></a>稍后安装操作系统</h5><p>方便后续自定义配置</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027184359980.png" alt="image-20211027184359980"></p>
<h5 id="选择Linux"><a href="#选择Linux" class="headerlink" title="选择Linux"></a>选择Linux</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027191801120.png" alt="image-20211027191801120"></p>
<h5 id="名称和存储位置"><a href="#名称和存储位置" class="headerlink" title="名称和存储位置"></a>名称和存储位置</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027192047604.png" alt="image-20211027192047604"></p>
<h5 id="处理器配置"><a href="#处理器配置" class="headerlink" title="处理器配置"></a>处理器配置</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027192100304.png" alt="image-20211027192100304"></p>
<h5 id="内存配置"><a href="#内存配置" class="headerlink" title="内存配置"></a>内存配置</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027192129135.png" alt="image-20211027192129135"></p>
<h5 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027192149657.png" alt="image-20211027192149657"></p>
<h5 id="存储配置"><a href="#存储配置" class="headerlink" title="存储配置"></a>存储配置</h5><p>控制器类型</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027192206105.png" alt="image-20211027192206105"></p>
<p>磁盘类型</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027192223604.png" alt="image-20211027192223604"></p>
<p>创建磁盘</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027192248532.png" alt="image-20211027192248532"></p>
<p>指定磁盘容量，存储为单个文件</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027192321137.png" alt="image-20211027192321137"></p>
<p>指定磁盘文件</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027192421162.png" alt="image-20211027192421162"></p>
<h5 id="配置完成"><a href="#配置完成" class="headerlink" title="配置完成"></a>配置完成</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027192428709.png" alt="image-20211027192428709"></p>
<h4 id="镜像设置"><a href="#镜像设置" class="headerlink" title="镜像设置"></a>镜像设置</h4><img data-src="https://cdn.jonty.top/img/image-20211027192737113.png" alt="image-20211027192737113" style="zoom:67%;" />

<h4 id="高级设置"><a href="#高级设置" class="headerlink" title="高级设置"></a>高级设置</h4><h5 id="禁用内存页面休整"><a href="#禁用内存页面休整" class="headerlink" title="禁用内存页面休整"></a>禁用内存页面休整</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027192833894.png" alt="image-20211027192833894"></p>
<h5 id="添加共享文件夹"><a href="#添加共享文件夹" class="headerlink" title="添加共享文件夹"></a>添加共享文件夹</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027192934066.png" alt="image-20211027192934066"></p>
<h4 id="Linux系统设置"><a href="#Linux系统设置" class="headerlink" title="Linux系统设置"></a>Linux系统设置</h4><h5 id="启动虚拟机"><a href="#启动虚拟机" class="headerlink" title="启动虚拟机"></a>启动虚拟机</h5><p>点击启动虚拟机，选择安装Oracle,按<code>Enter</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027193123710.png" alt="image-20211027193123710"></p>
<h5 id="选择语言"><a href="#选择语言" class="headerlink" title="选择语言"></a>选择语言</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027193415173.png" alt="image-20211027193415173"></p>
<h5 id="软件选择"><a href="#软件选择" class="headerlink" title="软件选择"></a>软件选择</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027194247111.png" alt="image-20211027194247111"></p>
<p>可按照自己的需求配置，这里选择了带有操作界面的服务器选项</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027194812583.png" alt="image-20211027194812583"></p>
<p>添加附加选项，按实际需求选择</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027194850975.png" alt="image-20211027194850975"></p>
<h5 id="安装目标位置"><a href="#安装目标位置" class="headerlink" title="安装目标位置"></a>安装目标位置</h5><p>自定义分区，选择<code>我要配置分区</code>后点击完成</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027195039952.png" alt="image-20211027195039952"></p>
<p>选择标准分区 自动创建</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027195251934.png" alt="image-20211027195251934"></p>
<p>将/home的挂载点更改为/opt/oracle,点击完成</p>
<p>方便后续安装<code>Oracle</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027195443704.png" alt="image-20211027195443704"></p>
<p>接受更改</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027195634673.png" alt="image-20211027195634673"></p>
<h5 id="更改网络配置"><a href="#更改网络配置" class="headerlink" title="更改网络配置"></a>更改网络配置</h5><p>打开网卡，点击配置</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027200029445.png" alt="image-20211027200029445"></p>
<p>选择IPV4地址</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027200121652.png" alt="image-20211027200121652"></p>
<p>需要对应本机电脑的网络配置，下面是我的，仅供参考</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027200202788.png" alt="image-20211027200202788"></p>
<h5 id="关闭安全策略"><a href="#关闭安全策略" class="headerlink" title="关闭安全策略"></a>关闭安全策略</h5><p><img data-src="https://cdn.jonty.top/img/image-20211027200302409.png" alt="image-20211027200302409"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027200314652.png" alt="image-20211027200314652"></p>
<h5 id="用户设置"><a href="#用户设置" class="headerlink" title="用户设置"></a>用户设置</h5><p>点击开始安装后，配置<strong>root</strong>用户密码</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027200422604.png" alt="image-20211027200422604"></p>
<p>可以顺便创建一个普通用户</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027200540510.png" alt="image-20211027200540510"></p>
<h5 id="安装完成"><a href="#安装完成" class="headerlink" title="安装完成"></a>安装完成</h5><p>安装完成后重启进入系统</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027202258848.png" alt="image-20211027202258848"></p>
<p>记得接受许可证</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211027202457891.png" alt="image-20211027202457891"></p>
<p>至此就安装完成。不当之处欢迎指正</p>
<blockquote>
<p>种一棵树最好的时间是十年前,其次是现在</p>
</blockquote>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>VMware</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows Terminal 美化</title>
    <url>/2021/10/03/windows-terminal-beautify/</url>
    <content><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>用了很久的<code>Terminal+PowerShell</code>,加上装了<code>oh-my-posh</code>这个插件，不管用起来还是看起来都很舒服。</p>
<img data-src="https://cdn.jonty.top/img/image-20211003000724702.png" alt="image-20211003000724702" style="zoom: 80%;" />

<p>由于电脑恢复了，重新配置一下，记录以供参考。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>1、下载<code>Terminal</code></p>
<p>可以直接在微软商店下载，我这里已经安装过了。</p>
<img data-src="https://cdn.jonty.top/img/image-20211003001214531.png" alt="image-20211003001214531" style="zoom:80%;" />

<p>2、安装<code>PowerShell</code></p>
<blockquote>
<p>这里的PowerShell并非<code>win</code>系统自带的<code>PowerShell</code>,而是它的一个跨平台版本，类似于<code>.NET</code>与<code>.NET Core</code>的关系。</p>
</blockquote>
<p><a href="https://github.com/PowerShell/PowerShell/releases">下载地址</a>，找到系统对应的版本下载安装，我这里下载的是这个版本</p>
<img data-src="https://cdn.jonty.top/img/image-20211003001938075.png" alt="image-20211003001938075" style="zoom:80%;" />

<p>3、安装插件</p>
<ul>
<li><code>PSReadLine</code>:提供自动补全等功能，GitHub地址：<a href="https://github.com/PowerShell/PSReadLine">https://github.com/PowerShell/PSReadLine</a></li>
<li><code>posh-git</code>:提供git的状态显示和命令补全。</li>
<li><code>oh-my-posh</code>:提供自定义主题和配色等,官网：<a href="https://ohmyposh.dev/">https://ohmyposh.dev/</a></li>
</ul>
<p>使用管理员打开新安装的<code>PowerShell</code>,执行下列命令</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Install-Module PSReadline</span><br><span class="line">Install-Module posh-git</span><br><span class="line">Install-Module oh-my-posh</span><br></pre></td></tr></table></figure>

<p>安装时提示则直接输入<code>y</code>信任即可。</p>
<p>4、安装字体</p>
<p><a href="https://www.nerdfonts.com/font-downloads">下载字体</a> 选择合适的字体，我这里使用的是<code>FiraCode</code></p>
<blockquote>
<p>顺便推荐一下使用<code>FiraCode</code>码代码也挺爽的</p>
<p>使用Nerd Font不会导致乱码，特殊的一些符号会乱码，如图</p>
</blockquote>
<img data-src="https://cdn.jonty.top/img/image-20211003003954813.png" alt="image-20211003003954813" style="zoom:80%;" />

<p>将下载下来的字体文件全选，拖入安装</p>
<img data-src="https://cdn.jonty.top/img/image-20211003004813071.png" alt="image-20211003004813071" style="zoom:80%;" />

<p>5、编辑<code>$Profile</code>文件</p>
<p>Windows:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">notepad<span class="selector-class">.exe</span> <span class="variable">$Profile</span></span><br></pre></td></tr></table></figure>

<p>没有文件则创建，配置一下内容</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 引入 posh-git</span></span><br><span class="line">Import-Module posh-git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入 oh-my-posh</span></span><br><span class="line">Import-Module oh-my-posh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 PowerShell 主题</span></span><br><span class="line">Set-PoshPrompt paradox </span><br></pre></td></tr></table></figure>

<p>主题可以通过<code>Get-PoshThemes</code>命令查看，选择喜欢的然后将主题名称替换即可。</p>
<p>6、配置<code>Terminal</code></p>
<p>打开配置文件<img data-src="https://cdn.jonty.top/img/image-20211003005518036.png" alt="image-20211003005518036" style="zoom:80%;" /></p>
<p>加入以下配置：</p>
<p>视各自的情况配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;defaultProfile&quot;: &quot;&#123;574e775e-4f2a-5b96-ac1e-a2962a402336&#125;&quot;, # 设置默认</span><br><span class="line">&quot;profiles&quot;: </span><br><span class="line">    &#123;</span><br><span class="line">        &quot;defaults&quot;: &#123;&#125;,</span><br><span class="line">        &quot;list&quot;: </span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;acrylicOpacity&quot;: 0.5,</span><br><span class="line">                &quot;backgroundImage&quot;: null,</span><br><span class="line">                &quot;commandline&quot;: &quot;C:/Program Files/PowerShell/7/pwsh.exe -nologo&quot;,</span><br><span class="line">                &quot;fontSize&quot;: 11,</span><br><span class="line">                &quot;fontFace&quot;: &quot;FiraCode Nerd Font&quot;,</span><br><span class="line">                &quot;guid&quot;: &quot;&#123;574e775e-4f2a-5b96-ac1e-a2962a402336&#125;&quot;,</span><br><span class="line">                &quot;hidden&quot;: false,</span><br><span class="line">                &quot;historySize&quot;: 9001,</span><br><span class="line">                &quot;name&quot;: &quot;pwsh&quot;,</span><br><span class="line">                &quot;padding&quot;: &quot;5, 5, 20, 25&quot;,</span><br><span class="line">                &quot;snapOnInput&quot;: true,</span><br><span class="line">                &quot;source&quot;: &quot;Windows.Terminal.PowershellCore&quot;,</span><br><span class="line">                &quot;startingDirectory&quot;: &quot;.&quot;,</span><br><span class="line">                &quot;useAcrylic&quot;: true</span><br><span class="line">            &#125;</span><br><span class="line">         ]</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>7、<code>VsCode</code>配置</p>
<img data-src="https://cdn.jonty.top/img/image-20211003005954791.png" alt="image-20211003005954791" style="zoom:80%;" />

<p>至此大功告成，这下是不是卷的更有动力了。</p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Terminal</tag>
        <tag>Tools</tag>
      </tags>
  </entry>
  <entry>
    <title>52ABP开发MVC项目</title>
    <url>/2021/11/07/introduction-with-aspNet-core-and-entity-framework-core/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>本文介绍使用ASP.NET Core、Entity FrameWork Core和<a href="https://www.52abp.com/">52ABP</a>创建WEB.MVC项目。</p>
<p>在本文中将使用以下技术创建一个简单的跨平台<strong>分层</strong>Web应用程序：</p>
<ul>
<li>.NET Core作为基础跨平台应用程序开发框架</li>
<li><a href="https://www.52abp.com/">52ABP</a>作为启动模板和应用程序框架</li>
<li>ASP.NET Core 作为Web框架</li>
<li>Entity FrameWork Core 作为ORM框架</li>
<li>Bootstrap作为HHML和CSS框架</li>
<li>JQuery作为客户端Ajax和DOM库</li>
</ul>
<p>还包括52ABP启动模板中包含的：</p>
<ul>
<li>AutoMapper</li>
<li>分层架构</li>
<li>领域驱动设计(DDD)</li>
<li>依赖注入(DI)</li>
</ul>
<h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><ul>
<li><p>.NET SDK 5.0</p>
</li>
<li><p>Visual Studio 2019</p>
</li>
<li><p>SQL Server</p>
</li>
</ul>
<h2 id="创建应用程序"><a href="#创建应用程序" class="headerlink" title="创建应用程序"></a>创建应用程序</h2><p>使用52abp启动模板(<a href="https://www.52abp.com/Download)%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BA%E2%80%9C**MyPortal**%E2%80%9D%E7%9A%84">https://www.52abp.com/Download)创建一个名为“**MyPortal**”的</a> Web应用程序。</p>
<p><img data-src="https://cdn.jonty.top/img/create-template-program.png"></p>
<p>创建了一个多层架构的解决方案</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211106145537934.png" alt="image-20211106145537934"></p>
<p>包括7个以<code>MyPortal</code>开头的项目</p>
<ul>
<li>.Core项目针对领域/业务层（实体、领域服务）</li>
<li>.Application项目是针对应用层的（DTO、应用服务）</li>
<li>.EntityFramework项目用于EFCore集成</li>
<li>.Migrator项目用于迁移数据库</li>
<li>.WebCore用于Web服务公共层</li>
<li>.Web.MVC用于ASP.NET MVC层</li>
<li>.Tests项目用于测试</li>
</ul>
<p>创建数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Add-Migration &#x27;InitialDb&#x27;</span><br><span class="line">Update-Database</span><br></pre></td></tr></table></figure>

<p>运行应用程序</p>
<p>默认账号：admin</p>
<p>密码：bb123456</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211106231550438.png" alt="image-20211106231550438"></p>
<p>首页</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211106161022373.png" alt="image-20211106161022373"></p>
<h2 id="开发应用程序"><a href="#开发应用程序" class="headerlink" title="开发应用程序"></a>开发应用程序</h2><h3 id="创建实体"><a href="#创建实体" class="headerlink" title="创建实体"></a>创建实体</h3><p>我们在<strong>Core</strong>层创建一个Task实体</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations;</span><br><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations.Schema;</span><br><span class="line"><span class="keyword">using</span> Abp.Domain.Entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 学生表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Table(<span class="meta-string">&quot;Abp_Student&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span> : <span class="title">Entity</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 名称最大长度</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> MaxNameLength = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 地址最大长度</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> MaxAddressLength = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 名称</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        [<span class="meta">StringLength(MaxNameLength)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 年龄</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 地址</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">StringLength(MaxAddressLength)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Address &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>Task</code>派生自<code>AuditedEntity</code>,默认情况下包含<code>Id</code>属性为<code>int</code>,也可以指定<code>Entity&lt;TPrimaryKey&gt;</code>来选择不同的<strong>PK</strong>类型</li>
</ul>
<h3 id="将实体添加到DbContext"><a href="#将实体添加到DbContext" class="headerlink" title="将实体添加到DbContext"></a>将实体添加到DbContext</h3><p><code>.EntityFrameWorkCore</code>项目包含一个预定义的<code>DbContext</code>,注册<code>Task</code>实体</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Abp.Zero.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Authorization.Roles;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Authorization.Users;</span><br><span class="line"><span class="keyword">using</span> MyPortal.MultiTenancy;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Students;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.EntityFrameworkCore</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyPortalDbContext</span> : <span class="title">AbpZeroDbContext</span>&lt;<span class="title">Tenant</span>, <span class="title">Role</span>, <span class="title">User</span>, <span class="title">MyPortalDbContext</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Define a DbSet for each entity of the application */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Student&gt; Students &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyPortalDbContext</span>(<span class="params">DbContextOptions&lt;MyPortalDbContext&gt; options</span>)</span></span><br><span class="line"><span class="function">            : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建数据库迁移"><a href="#创建数据库迁移" class="headerlink" title="创建数据库迁移"></a>创建数据库迁移</h3><p>创建数据库迁移<code>Abp_Tasks</code>表，选择默认项目<code>.EntityFrameWorkCore</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Add-Migration &#x27;Create_Abp_Tasks&#x27;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211106210823677.png" alt="image-20211106210823677"></p>
<p>生成的迁移类：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211106210905907.png" alt="image-20211106210905907"></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Migrations;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Migrations</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">CreateStudentTable</span> : <span class="title">Migration</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Up</span>(<span class="params">MigrationBuilder migrationBuilder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            migrationBuilder.CreateTable(</span><br><span class="line">                name: <span class="string">&quot;Abp_Student&quot;</span>,</span><br><span class="line">                columns: table =&gt; <span class="keyword">new</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Id = table.Column&lt;<span class="built_in">int</span>&gt;(type: <span class="string">&quot;uniqueidentifier&quot;</span>, nullable: <span class="literal">false</span>),</span><br><span class="line">                    Name = table.Column&lt;<span class="built_in">string</span>&gt;(type: <span class="string">&quot;nvarchar(50)&quot;</span>, maxLength: <span class="number">50</span>, nullable: <span class="literal">false</span>),</span><br><span class="line">                    Age = table.Column&lt;<span class="built_in">int</span>&gt;(type: <span class="string">&quot;int&quot;</span>, nullable: <span class="literal">false</span>),</span><br><span class="line">                    Address = table.Column&lt;<span class="built_in">string</span>&gt;(type: <span class="string">&quot;nvarchar(200)&quot;</span>, maxLength: <span class="number">200</span>, nullable: <span class="literal">true</span>),</span><br><span class="line">                   </span><br><span class="line">                &#125;,</span><br><span class="line">                constraints: table =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    table.PrimaryKey(<span class="string">&quot;PK_Abp_Student&quot;</span>, x =&gt; x.Id);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Down</span>(<span class="params">MigrationBuilder migrationBuilder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            migrationBuilder.DropTable(</span><br><span class="line">                name: <span class="string">&quot;Abp_Student&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>程序包管理控制台</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Update-Database</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211106210959548.png" alt="image-20211106210959548"></p>
<p>执行命令后会在<code>SQL Server</code>中创建一个名为<code>52AbpFree_db</code>的数据库，包含定义的实体表和迁移记录</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211106211155510.png" alt="image-20211106211155510"></p>
<p>注意：数据库连接字符串在<code>.Web.Mvc</code>项目中的<code>appsettings.json</code>中配置</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;ConnectionStrings&quot;</span>: &#123;</span><br><span class="line">   <span class="attr">&quot;Default&quot;</span>: <span class="string">&quot;Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=52AbpFree_db;Integrated Security=True;Connect Timeout=30;Encrypt=False;TrustServerCertificate=False;ApplicationIntent=ReadWrite;MultiSubnetFailover=False&quot;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建服务"><a href="#创建服务" class="headerlink" title="创建服务"></a>创建服务</h3><p>应用服务层用于向表示层提供逻辑处理，表示层调用应用服务层，并以数据传输对象<code>DTO</code>作为参数，使用领域对象执行业务逻辑，并将<code>DTO</code>返回表示层。</p>
<p>我们在<code>.Application</code> 创建一个<code>StudentAppService</code>和对应的<code>IStudentAppService</code>,以执行相关的应用程序逻辑。</p>
<p>首先定义一个服务接口：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Abp.Application.Services;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Students.Dtos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 学生应用服务接口</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IStudentAppService</span> : <span class="title">IAsyncCrudAppService</span>&lt;<span class="title">StudentDto</span>, <span class="title">int</span>, <span class="title">PagedStudentResultRequestDto</span>,</span><br><span class="line">        <span class="title">CreateStudentDto</span>, <span class="title">StudentDto</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>定义服务接口不是固定的，但是按照约定，所有的应用服务都应该实现<code>IApplicationService</code>。</p>
<p>并为此定义了以下<code>DTO</code>对象：</p>
<ul>
<li><strong>StudentDto</strong>:用于返回查询</li>
<li><strong>PagedStudentResultRequestDto</strong>：用于分页和搜索过滤</li>
<li><strong>CreateStudentDto</strong>：用于新增或修改</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations;</span><br><span class="line"><span class="keyword">using</span> Abp.Application.Services.Dto;</span><br><span class="line"><span class="keyword">using</span> Abp.AutoMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Students.Dtos</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">AutoMap(typeof(Student))</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentDto</span>:<span class="title">EntityDto</span></span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 名称</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        [<span class="meta">StringLength(Student.MaxNameLength)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 年龄</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 地址</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">StringLength(Student.MaxAddressLength)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Address &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations;</span><br><span class="line"><span class="keyword">using</span> Abp.Application.Services.Dto;</span><br><span class="line"><span class="keyword">using</span> Abp.AutoMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Students.Dtos</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">AutoMapTo(typeof(Student))</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CreateStudentDto</span>:<span class="title">EntityDto</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 名称</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        [<span class="meta">StringLength(Student.MaxNameLength)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 年龄</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 地址</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">StringLength(Student.MaxAddressLength)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Address &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Abp.Application.Services.Dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Students.Dtos</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PagedStudentResultRequestDto</span> : <span class="title">PagedResultRequestDto</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Keyword &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：[AutoMapFrom]属性用来创建<code>Student</code>=&gt;<code>Dto</code>的<strong>AutoMapper</strong>映射</p>
<p>现在我们可以实现<code>IStudentAppService</code>:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Abp.Application.Services;</span><br><span class="line"><span class="keyword">using</span> Abp.Domain.Repositories;</span><br><span class="line"><span class="keyword">using</span> Abp.Extensions;</span><br><span class="line"><span class="keyword">using</span> Abp.Linq.Extensions;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Students.Dtos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentAppService</span> : <span class="title">AsyncCrudAppService</span>&lt;<span class="title">Student</span>, <span class="title">StudentDto</span>, <span class="title">int</span>, <span class="title">PagedStudentResultRequestDto</span>, <span class="title">CreateStudentDto</span>, <span class="title">StudentDto</span>&gt;, <span class="title">IStudentAppService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StudentAppService</span>(<span class="params">IRepository&lt;Student, <span class="built_in">int</span>&gt; repository</span>) : <span class="title">base</span>(<span class="params">repository</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IQueryable&lt;Student&gt; <span class="title">CreateFilteredQuery</span>(<span class="params">PagedStudentResultRequestDto input</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Repository.GetAll()</span><br><span class="line">                .WhereIf(!input.Keyword.IsNullOrWhiteSpace(), x =&gt; x.Name.Contains(input.Keyword));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>StudentAppService</strong>继承自<strong>AsyncCrudAppService</strong></li>
<li>使用构造函数注入<strong>IRepository</strong></li>
</ul>
<p><strong>AsyncCrudAppService</strong>帮我们实现了基本的增删改查操作：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107101650994.png" alt="image-20211107101650994"></p>
<p>目录结构：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107101751193.png" alt="image-20211107101751193"></p>
<h3 id="学生列表视图"><a href="#学生列表视图" class="headerlink" title="学生列表视图"></a>学生列表视图</h3><h4 id="添加新的菜单项"><a href="#添加新的菜单项" class="headerlink" title="添加新的菜单项"></a>添加新的菜单项</h4><p>在<strong>MyPortal.Web</strong>项目中<code>Startup -&gt; MyPortalNavigationProvider</code>中添加新的菜单项</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Abp.Application.Navigation;</span><br><span class="line"><span class="keyword">using</span> Abp.Authorization;</span><br><span class="line"><span class="keyword">using</span> Abp.Localization;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Authorization;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Web.Startup</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> This class defines menus for the application.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyPortalNavigationProvider</span> : <span class="title">NavigationProvider</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">SetNavigation</span>(<span class="params">INavigationProviderContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            context.Manager.MainMenu</span><br><span class="line">                .AddItem(</span><br><span class="line">                    <span class="keyword">new</span> MenuItemDefinition(</span><br><span class="line">                        PageNames.About,</span><br><span class="line">                        L(<span class="string">&quot;About&quot;</span>),</span><br><span class="line">                        url: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">                        icon: <span class="string">&quot;fas fa-info-circle&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                .AddItem(</span><br><span class="line">                    <span class="keyword">new</span> MenuItemDefinition(</span><br><span class="line">                        PageNames.Home,</span><br><span class="line">                        L(<span class="string">&quot;HomePage&quot;</span>),</span><br><span class="line">                        url: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        icon: <span class="string">&quot;fas fa-home&quot;</span>,</span><br><span class="line">                        requiresAuthentication: <span class="literal">true</span></span><br><span class="line">                    )</span><br><span class="line">                ).AddItem(</span><br><span class="line">                    <span class="keyword">new</span> MenuItemDefinition(</span><br><span class="line">                        PageNames.Tenants,</span><br><span class="line">                        L(<span class="string">&quot;Tenants&quot;</span>),</span><br><span class="line">                        url: <span class="string">&quot;Tenants&quot;</span>,</span><br><span class="line">                        icon: <span class="string">&quot;fas fa-building&quot;</span>,</span><br><span class="line">                        permissionDependency: <span class="keyword">new</span> SimplePermissionDependency(PermissionNames.Pages_Tenants)</span><br><span class="line">                    )</span><br><span class="line">                ).AddItem(</span><br><span class="line">                    <span class="keyword">new</span> MenuItemDefinition(</span><br><span class="line">                        PageNames.Users,</span><br><span class="line">                        L(<span class="string">&quot;Users&quot;</span>),</span><br><span class="line">                        url: <span class="string">&quot;Users&quot;</span>,</span><br><span class="line">                        icon: <span class="string">&quot;fas fa-users&quot;</span>,</span><br><span class="line">                        permissionDependency: <span class="keyword">new</span> SimplePermissionDependency(PermissionNames.Pages_Users)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                .AddItem(</span><br><span class="line">                    <span class="keyword">new</span> MenuItemDefinition(</span><br><span class="line">                        PageNames.Roles,</span><br><span class="line">                        L(<span class="string">&quot;Roles&quot;</span>),</span><br><span class="line">                        url: <span class="string">&quot;Roles&quot;</span>,</span><br><span class="line">                        icon: <span class="string">&quot;fas fa-theater-masks&quot;</span>,</span><br><span class="line">                        permissionDependency: <span class="keyword">new</span> SimplePermissionDependency(PermissionNames.Pages_Roles)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 学生列表菜单</span></span><br><span class="line">                .AddItem(</span><br><span class="line">                    <span class="keyword">new</span> MenuItemDefinition(</span><br><span class="line">                        PageNames.Students, <span class="comment">// 菜单名称</span></span><br><span class="line">                        L(<span class="string">&quot;Students&quot;</span>), <span class="comment">// 显示名称</span></span><br><span class="line">                        url: <span class="string">&quot;Students&quot;</span>, <span class="comment">// Url地址 对应Controller名称</span></span><br><span class="line">                        icon: <span class="string">&quot;fa fa-tasks&quot;</span> <span class="comment">// 图标</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                .AddItem(</span><br><span class="line">                    <span class="keyword">new</span> MenuItemDefinition(</span><br><span class="line">                        <span class="string">&quot;MultiLevelMenu&quot;</span>,</span><br><span class="line">                        L(<span class="string">&quot;MultiLevelMenu&quot;</span>),</span><br><span class="line">                        icon: <span class="string">&quot;fas fa-circle&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ILocalizableString <span class="title">L</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LocalizableString(name, MyPortalConsts.LocalizationSourceName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="创建Controller和View"><a href="#创建Controller和View" class="headerlink" title="创建Controller和View"></a>创建Controller和View</h4><p>在<strong>Web.MVC</strong>项目下新建新的控制器类<strong>StudentsController</strong>:</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211106222518121.png" alt="image-20211106222518121"></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> Abp.Application.Services.Dto;</span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Controllers;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Students;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Web.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentsController</span>: <span class="title">MyPortalControllerBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IStudentAppService _studentAppService;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StudentsController</span>(<span class="params">IStudentAppService studentAppService</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _studentAppService = studentAppService;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Index</span>(<span class="params"></span>)</span> =&gt; View();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&gt; <span class="title">EditModal</span>(<span class="params"><span class="built_in">int</span> studentId</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> tenantDto = <span class="keyword">await</span> _studentAppService.GetAsync(<span class="keyword">new</span> EntityDto(studentId));</span><br><span class="line">            <span class="keyword">return</span> PartialView(<span class="string">&quot;_EditModal&quot;</span>, tenantDto);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>StudentsController</strong>继承自<strong>MyPortalControllerBase</strong></li>
<li>**Index()**返回一个视图</li>
</ul>
<p><img data-src="https://cdn.jonty.top/img/image-20211106222653044.png" alt="image-20211106222653044"></p>
<ul>
<li>使用构造函数注入<strong>IStudentAppService</strong></li>
</ul>
<h4 id="学生列表视图-1"><a href="#学生列表视图-1" class="headerlink" title="学生列表视图"></a>学生列表视图</h4><p>学生展示列表如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@using MyPortal.Web.Startup</span><br><span class="line">@&#123;</span><br><span class="line">    ViewBag.Title = L(&quot;Students&quot;);</span><br><span class="line">    ViewBag.CurrentPageName = PageNames.Students;</span><br><span class="line">&#125;</span><br><span class="line">@section scripts</span><br><span class="line">&#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">names</span>=<span class="string">&quot;Development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;~/view-resources/Views/Students/Index.js&quot;</span> <span class="attr">asp-append-version</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">names</span>=<span class="string">&quot;Staging,Production&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;~/view-resources/Views/Students/Index.min.js&quot;</span> <span class="attr">asp-append-version</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;content-header&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-fluid&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-6&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>@L(&quot;Students&quot;)<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-6&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#StudentCreateModal&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn bg-blue float-sm-right&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-plus-square&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    @L(&quot;CreateNewStudent&quot;)</span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-fluid&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!--Use for bulk actions--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span><br><span class="line">                                @await Html.PartialAsync(&quot;~/Views/Students/Index.AdvancedSearch.cshtml&quot;)</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-responsive&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;StudentsTable&quot;</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-bordered&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>@L(&quot;Name&quot;)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>@L(&quot;Age&quot;)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>@L(&quot;Address&quot;)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 150px&quot;</span>&gt;</span>@L(&quot;Actions&quot;)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@await Html.PartialAsync(&quot;~/Views/Students/_CreateModal.cshtml&quot;)</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal fade&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentEditModal&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">role</span>=<span class="string">&quot;dialog&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;StudentEditModalLabel&quot;</span> <span class="attr">data-backdrop</span>=<span class="string">&quot;static&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-dialog modal-lg&quot;</span> <span class="attr">role</span>=<span class="string">&quot;document&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们加入了<strong>新增</strong>、<strong>编辑</strong>、<strong>删除</strong>以及<strong>搜索</strong>的按钮，将在后续补充完整</p>
<p>可以看到，我们为此视图引入了对应的<code>js</code>文件，并放在<strong>wwwroot</strong>静态资源目录下</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107104617786.png" alt="image-20211107104617786"></p>
<p>并使用<code>Jquery</code>来渲染我们的表格：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _studentService = abp.services.app.student,</span><br><span class="line">        l = abp.localization.getSource(<span class="string">&#x27;MyPortal&#x27;</span>),</span><br><span class="line">        _$modal = $(<span class="string">&#x27;#StudentCreateModal&#x27;</span>),</span><br><span class="line">        _$form = _$modal.find(<span class="string">&#x27;form&#x27;</span>),</span><br><span class="line">        _$table = $(<span class="string">&#x27;#StudentsTable&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> _$studentsTable = _$table.DataTable(&#123;</span><br><span class="line">        <span class="attr">paging</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">serverSide</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">ajax</span>: <span class="function"><span class="keyword">function</span> (<span class="params">data, callback, settings</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> filter = $(<span class="string">&#x27;#StudentSearchForm&#x27;</span>).serializeFormToObject(<span class="literal">true</span>);</span><br><span class="line">            filter.maxResultCount = data.length;</span><br><span class="line">            filter.skipCount = data.start;</span><br><span class="line"></span><br><span class="line">            abp.ui.setBusy(_$table);</span><br><span class="line">            _studentService.getAll(filter).done(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                callback(&#123;</span><br><span class="line">                    <span class="attr">recordsTotal</span>: result.totalCount,</span><br><span class="line">                    <span class="attr">recordsFiltered</span>: result.totalCount,</span><br><span class="line">                    <span class="attr">data</span>: result.items</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;).always(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                abp.ui.clearBusy(_$table);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">buttons</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;refresh&#x27;</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;&lt;i class=&quot;fas fa-redo-alt&quot;&gt;&lt;/i&gt;&#x27;</span>,</span><br><span class="line">                <span class="attr">action</span>: <span class="function">() =&gt;</span> _$studentsTable.draw(<span class="literal">false</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">responsive</span>: &#123;</span><br><span class="line">            <span class="attr">details</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;column&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">columnDefs</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">targets</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">className</span>: <span class="string">&#x27;control&#x27;</span>,</span><br><span class="line">                <span class="attr">defaultContent</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">targets</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">data</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">                <span class="attr">sortable</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">targets</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">data</span>: <span class="string">&#x27;age&#x27;</span>,</span><br><span class="line">                <span class="attr">sortable</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">targets</span>: <span class="number">3</span>,</span><br><span class="line">                <span class="attr">data</span>: <span class="string">&#x27;address&#x27;</span>,</span><br><span class="line">                <span class="attr">sortable</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">targets</span>: <span class="number">4</span>,</span><br><span class="line">                <span class="attr">data</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="attr">sortable</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">autoWidth</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">defaultContent</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">render</span>: <span class="function">(<span class="params">data, type, row, meta</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> [</span><br><span class="line">                        <span class="string">`   &lt;button type=&quot;button&quot; class=&quot;btn btn-sm bg-secondary edit-student&quot; data-student-id=&quot;<span class="subst">$&#123;row.id&#125;</span>&quot; data-toggle=&quot;modal&quot; data-target=&quot;#StudentEditModal&quot;&gt;`</span>,</span><br><span class="line">                        <span class="string">`       &lt;i class=&quot;fas fa-pencil-alt&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;l(<span class="string">&#x27;Edit&#x27;</span>)&#125;</span>`</span>,</span><br><span class="line">                        <span class="string">&#x27;   &lt;/button&gt;&#x27;</span>,</span><br><span class="line">                        <span class="string">`   &lt;button type=&quot;button&quot; class=&quot;btn btn-sm bg-danger delete-student&quot; data-student-id=&quot;<span class="subst">$&#123;row.id&#125;</span>&quot; data-student-name=&quot;<span class="subst">$&#123;row.name&#125;</span>&quot;&gt;`</span>,</span><br><span class="line">                        <span class="string">`       &lt;i class=&quot;fas fa-trash&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;l(<span class="string">&#x27;Delete&#x27;</span>)&#125;</span>`</span>,</span><br><span class="line">                        <span class="string">&#x27;   &lt;/button&gt;&#x27;</span></span><br><span class="line">                    ].join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)(jQuery);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>abp.services.app.student</strong>用来获取<code>StudentAppService</code></p>
</li>
<li><p><code>l = abp.localization.getSource(&#39;MyPortal&#39;)</code>获取本地化资源</p>
</li>
<li><p><strong>columnDefs</strong>中定义表格字段</p>
</li>
</ul>
<p>页面效果如下：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107104031390.png" alt="image-20211107104031390"></p>
<h4 id="本地化"><a href="#本地化" class="headerlink" title="本地化"></a>本地化</h4><p>我们在视图中使用了<strong>L</strong>方法，它用于<strong>本地化</strong>字符串。可以在<code>.Core</code>项目下的本地资源中找到它并配置：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107105529411.png" alt="image-20211107105529411"></p>
<p>我们将页面需要的字符串添加到对应语言的<strong>XML</strong>文件下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">name</span>=<span class="string">&quot;Students&quot;</span> <span class="attr">value</span>=<span class="string">&quot;学生列表&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">name</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;地址&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">name</span>=<span class="string">&quot;Age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;年龄&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">name</span>=<span class="string">&quot;EditStudent&quot;</span> <span class="attr">value</span>=<span class="string">&quot;编辑学生&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">name</span>=<span class="string">&quot;CreateNewStudent&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加学生&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="过滤学生视图"><a href="#过滤学生视图" class="headerlink" title="过滤学生视图"></a>过滤学生视图</h4><p>我们新建一个视图文件<code>Index.AdvancedSearch.cshtml</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;abp-advanced-search&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;StudentSearchForm&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-horizontal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-prepend&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn bg-blue btn-search&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-search&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Keyword&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control txt-search&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>导入并使用：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">@await Html.PartialAsync(<span class="string">&quot;~/Views/Students/Index.AdvancedSearch.cshtml&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>对应的，在<code>index.js</code>文件中加入<strong>搜索触发事件</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&#x27;.btn-search&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">     _$studentsTable.ajax.reload();</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> $(<span class="string">&#x27;.txt-search&#x27;</span>).on(<span class="string">&#x27;keypress&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (e.which == <span class="number">13</span>) &#123;</span><br><span class="line">         _$studentsTable.ajax.reload();</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p>在<code>StudentAppService</code>中重写过滤查询方法：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IQueryable&lt;Student&gt; <span class="title">CreateFilteredQuery</span>(<span class="params">PagedStudentResultRequestDto input</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Repository.GetAll()</span><br><span class="line">                .WhereIf(!input.Keyword.IsNullOrWhiteSpace(), x =&gt; x.Name.Contains(input.Keyword));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>查看效果：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107110550326.png" alt="image-20211107110550326"></p>
<h3 id="新增学生视图"><a href="#新增学生视图" class="headerlink" title="新增学生视图"></a>新增学生视图</h3><p>首先创建一个<strong>新增学生</strong>的模态框视图：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@using MyPortal.Web.Models.Common.Modals</span><br><span class="line">@model MyPortal.Web.Models.Students.StudentListViewModel</span><br><span class="line">@&#123;</span><br><span class="line">    Layout = null;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal fade&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentCreateModal&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">role</span>=<span class="string">&quot;dialog&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;StudentCreateModalLabel&quot;</span> <span class="attr">data-backdrop</span>=<span class="string">&quot;static&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-dialog modal-lg&quot;</span> <span class="attr">role</span>=<span class="string">&quot;document&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="line">            @await Html.PartialAsync(&quot;~/Views/Shared/Modals/_ModalHeader.cshtml&quot;, new ModalHeaderViewModel(L(&quot;CreateNewStudent&quot;)))</span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;roleCreateForm&quot;</span> <span class="attr">role</span>=<span class="string">&quot;form&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-horizontal&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row required&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3 col-form-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>@L(&quot;Name&quot;)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">required</span> <span class="attr">maxlength</span>=<span class="string">&quot;50&quot;</span> <span class="attr">minlength</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row required&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3 col-form-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;age&quot;</span>&gt;</span>@L(&quot;Age&quot;)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Age&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">required</span> <span class="attr">max</span>=<span class="string">&quot;130&quot;</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3 col-form-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;address&quot;</span>&gt;</span>@L(&quot;Address&quot;)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;address&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                @await Html.PartialAsync(&quot;~/Views/Shared/Modals/_ModalFooterWithSaveAndCancel.cshtml&quot;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为此，我们需要新建一个<strong>视图模型类</strong>:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> MyPortal.Students.Dtos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyPortal.Web.Models.Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentListViewModel</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> IReadOnlyList&lt;StudentDto&gt; Students &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211107112541841.png" alt="image-20211107112541841"></p>
<p>最后我们在<code>index.js</code>中加入<strong>创建学生</strong>的请求方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">_$form.find(<span class="string">&#x27;.save-button&#x27;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!_$form.valid()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> student = _$form.serializeFormToObject();</span><br><span class="line"></span><br><span class="line">    abp.ui.setBusy(_$modal);</span><br><span class="line"></span><br><span class="line">    _studentService</span><br><span class="line">        .create(student)</span><br><span class="line">        .done(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            _$modal.modal(<span class="string">&#x27;hide&#x27;</span>);</span><br><span class="line">            _$form[<span class="number">0</span>].reset();</span><br><span class="line">            abp.notify.info(l(<span class="string">&#x27;SavedSuccessfully&#x27;</span>));</span><br><span class="line">            _$studentsTable.ajax.reload();</span><br><span class="line">        &#125;)</span><br><span class="line">        .always(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            abp.ui.clearBusy(_$modal);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>查看效果：</p>
<p>点击<strong>添加学生</strong>按钮，弹出<strong>模态框</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107113021877.png" alt="image-20211107113021877"></p>
<p>我们输入数据，并点击保存：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107113201560.png" alt="image-20211107113201560"></p>
<p>可以看，表格中已经将我们刚刚新增的数据展示出来了</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107113240720.png" alt="image-20211107113240720"></p>
<h3 id="编辑学生视图"><a href="#编辑学生视图" class="headerlink" title="编辑学生视图"></a>编辑学生视图</h3><p>我们先创建一个<strong>编辑页面</strong>视图：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@using MyPortal.Web.Models.Common.Modals</span><br><span class="line">@model MyPortal.Students.Dtos.StudentDto</span><br><span class="line">@&#123;</span><br><span class="line">    Layout = null;</span><br><span class="line">&#125;</span><br><span class="line">@await Html.PartialAsync(&quot;~/Views/Shared/Modals/_ModalHeader.cshtml&quot;, new ModalHeaderViewModel(L(&quot;EditStudent&quot;)))</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;StudentEditForm&quot;</span> <span class="attr">role</span>=<span class="string">&quot;form&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-horizontal&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;@Model.Id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row required&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3 col-form-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>@L(&quot;Name&quot;)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;@Model.Name&quot;</span> <span class="attr">required</span> <span class="attr">maxlength</span>=<span class="string">&quot;50&quot;</span> <span class="attr">minlength</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row required&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3 col-form-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;age&quot;</span>&gt;</span>@L(&quot;Age&quot;)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;@Model.Age&quot;</span> <span class="attr">required</span> <span class="attr">maxlength</span>=<span class="string">&quot;128&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3 col-form-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;address&quot;</span>&gt;</span>@L(&quot;Address&quot;)<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;address&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;@Model.Address&quot;</span> <span class="attr">required</span> <span class="attr">maxlength</span>=<span class="string">&quot;200&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    @await Html.PartialAsync(&quot;~/Views/Shared/Modals/_ModalFooterWithSaveAndCancel.cshtml&quot;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;~/view-resources/Views/Students/_EditModal.js&quot;</span> <span class="attr">asp-append-version</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>并创建一个<strong>编辑视图</strong>的<code>_EditModal.js</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _studentService = abp.services.app.student,</span><br><span class="line">        l = abp.localization.getSource(<span class="string">&#x27;MyPortal&#x27;</span>),</span><br><span class="line">        _$modal = $(<span class="string">&#x27;#StudentEditModal&#x27;</span>),</span><br><span class="line">        _$form = _$modal.find(<span class="string">&#x27;form&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!_$form.valid()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> student = _$form.serializeFormToObject();</span><br><span class="line"></span><br><span class="line">        abp.ui.setBusy(_$form);</span><br><span class="line">        _studentService.update(student).done(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            _$modal.modal(<span class="string">&#x27;hide&#x27;</span>);</span><br><span class="line">            abp.notify.info(l(<span class="string">&#x27;SavedSuccessfully&#x27;</span>));</span><br><span class="line">            abp.event.trigger(<span class="string">&#x27;student.edited&#x27;</span>, student);</span><br><span class="line">        &#125;).always(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            abp.ui.clearBusy(_$form);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _$form.closest(<span class="string">&#x27;div.modal-content&#x27;</span>).find(<span class="string">&quot;.save-button&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        save();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    _$form.find(<span class="string">&#x27;input&#x27;</span>).on(<span class="string">&#x27;keypress&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.which === <span class="number">13</span>) &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    _$modal.on(<span class="string">&#x27;shown.bs.modal&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        _$form.find(<span class="string">&#x27;input[type=text]:first&#x27;</span>).focus();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>

<p>在<code>Index</code>页面，当我们点击编辑时，需要先查询当前实体，然后填充到编辑视图中去：</p>
<p>在<code>index.js</code>中加入以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).on(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;.edit-student&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> studentId = $(<span class="built_in">this</span>).attr(<span class="string">&#x27;data-student-id&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    abp.ajax(&#123;</span><br><span class="line">        <span class="attr">url</span>: abp.appPath + <span class="string">&#x27;Students/EditModal?studentId=&#x27;</span> + studentId,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">content</span>) </span>&#123;</span><br><span class="line">            $(<span class="string">&#x27;#StudentEditModal div.modal-content&#x27;</span>).html(content);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>对应的，在<strong>StudentController</strong>中需要添加<strong>EditModal</strong>方法，并接收一个<strong>studentId</strong>参数，如下：</p>
<p>根据学生Id查询当前编辑的学生，并将值返回给编辑的模态框</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&gt; <span class="title">EditModal</span>(<span class="params"><span class="built_in">int</span> studentId</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">var</span> tenantDto = <span class="keyword">await</span> _studentAppService.GetAsync(<span class="keyword">new</span> EntityDto(studentId));</span><br><span class="line">          <span class="keyword">return</span> PartialView(<span class="string">&quot;_EditModal&quot;</span>, tenantDto);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p>我们将前面新增的数据<code>jiejie</code>的年龄更改为<code>202</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107115502392.png" alt="image-20211107115502392"></p>
<p>保存后刷新列表并且右下角弹出<strong>保存成功</strong>，编辑功能就完成了</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107115543250.png" alt="image-20211107115543250"></p>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>删除需要我们传入要删除的学生Id,我们只需要在<code>index.js</code>中加入以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteStudent</span>(<span class="params">studentId, studentName</span>) </span>&#123;</span><br><span class="line">    abp.message.confirm(</span><br><span class="line">        abp.utils.formatString(</span><br><span class="line">            l(<span class="string">&#x27;AreYouSureWantToDelete&#x27;</span>),</span><br><span class="line">            studentName</span><br><span class="line">        ),</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        <span class="function">(<span class="params">isConfirmed</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isConfirmed) &#123;</span><br><span class="line">                _studentService</span><br><span class="line">                    .delete(&#123;</span><br><span class="line">                        <span class="attr">id</span>: studentId</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .done(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        abp.notify.info(l(<span class="string">&#x27;SuccessfullyDeleted&#x27;</span>));</span><br><span class="line">                        _$studentsTable.ajax.reload();</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击删除，弹出提示框：</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107115722754.png" alt="image-20211107115722754"></p>
<p>点击确定，刷新列表并弹出删除成功提示</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211107115801144.png" alt="image-20211107115801144"></p>
<h3 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h3><p>你可以从以下仓库地址获取源码：</p>
<p><a href="https://github.com/JontyMin/52abp_examples/tree/main/src/MyPortal/src/myportal-aspnet-core">https://github.com/JontyMin/52abp_examples/tree/main/src/MyPortal/src/myportal-aspnet-core</a></p>
<blockquote>
<p>版权声明：本人为52abp社区成员，与52abp社区wiki内容一致，不存在内容侵权。</p>
<p>本文PR:<a href="https://github.com/52ABP/Documents/pull/109">https://github.com/52ABP/Documents/pull/109</a></p>
</blockquote>
]]></content>
      <categories>
        <category>.Net</category>
      </categories>
      <tags>
        <tag>MVC</tag>
        <tag>EF Core</tag>
        <tag>52ABP</tag>
      </tags>
  </entry>
  <entry>
    <title>RedHat安装Oracle数据库</title>
    <url>/2021/11/09/rhel-install-oracle-11g-r2/</url>
    <content><![CDATA[<p>📢：本文为实操记录，练习环境为RHEL7.6(本地虚拟机)，腾讯云Centos7.6实操安装成功。不正之处望指出。</p>
<p>关于虚拟机安装Linux操作系统,<a href="https://jonty.top/2021/10/27/vmware-install-linux/">点击查看</a></p>
<h2 id="Linux主机配置"><a href="#Linux主机配置" class="headerlink" title="Linux主机配置"></a>Linux主机配置</h2><h3 id="主机名和网络配置"><a href="#主机名和网络配置" class="headerlink" title="主机名和网络配置"></a>主机名和网络配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/hosts</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#OracleBegin##</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#Public IP</span></span></span><br><span class="line">192.168.1.79   orcl79</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#OracleEnd##</span></span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<p><img data-src="https://cdn.jonty.top/img/image-20211104095943481.png" alt="image-20211104095943481"></p>
<h3 id="hosts文件配置"><a href="#hosts文件配置" class="headerlink" title="hosts文件配置"></a>hosts文件配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104100304275.png" alt="image-20211104100304275"></p>
<h3 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104100742682.png" alt="image-20211104100742682"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104100906781.png" alt="image-20211104100906781"></p>
<h3 id="SELINUX配置"><a href="#SELINUX配置" class="headerlink" title="SELINUX配置"></a>SELINUX配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure>



<p><img data-src="https://cdn.jonty.top/img/image-20211104101228439.png" alt="image-20211104101228439"></p>
<h3 id="挂载镜像"><a href="#挂载镜像" class="headerlink" title="挂载镜像"></a>挂载镜像</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount /dev/cdrom /mnt</span><br><span class="line">cat &lt;&lt;EOF&gt;/etc/yum.repos.d/local.repo</span><br><span class="line">[local]</span><br><span class="line">name=local</span><br><span class="line">baseurl=file:///mnt</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104101459247.png" alt="image-20211104101459247"></p>
<h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y bc \</span><br><span class="line">binutils \</span><br><span class="line">compat-libcap1 \</span><br><span class="line">compat-libstdc++-33 \</span><br><span class="line">gcc \</span><br><span class="line">gcc-c++ \</span><br><span class="line">elfutils-libelf \</span><br><span class="line">elfutils-libelf-devel \</span><br><span class="line">glibc \</span><br><span class="line">glibc-devel \</span><br><span class="line">ksh \</span><br><span class="line">libaio \</span><br><span class="line">libaio-devel \</span><br><span class="line">libgcc \</span><br><span class="line">libstdc++ \</span><br><span class="line">libstdc++-devel \</span><br><span class="line">libxcb \</span><br><span class="line">libX11 \</span><br><span class="line">libXau \</span><br><span class="line">libXi \</span><br><span class="line">libXtst \</span><br><span class="line">libXrender \</span><br><span class="line">libXrender-devel \</span><br><span class="line">make \</span><br><span class="line">net-tools \</span><br><span class="line">nfs-utils \</span><br><span class="line">smartmontools \</span><br><span class="line">sysstat \</span><br><span class="line">e2fsprogs \</span><br><span class="line">e2fsprogs-libs \</span><br><span class="line">fontconfig-devel \</span><br><span class="line">expect \</span><br><span class="line">unzip \</span><br><span class="line">openssh-clients \</span><br><span class="line">readline* \</span><br><span class="line">psmisc --skip-broken</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104102036281.png" alt="image-20211104102036281"></p>
<p>安装缺少的compat-libstdc++包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -ivh compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -q bc binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ elfutils-libelf elfutils-libelf-devel glibc glibc-devel ksh libaio libaio-devel libgcc libstdc++ libstdc++-devel libxcb libX11 libXau libXi libXtst libXrender libXrender-devel make net-tools nfs-utils smartmontools sysstat e2fsprogs e2fsprogs-libs fontconfig-devel expect unzip openssh-clients readline</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104102049805.png" alt="image-20211104102049805"></p>
<h3 id="配置ZeroConf"><a href="#配置ZeroConf" class="headerlink" title="配置ZeroConf"></a>配置ZeroConf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#关闭Zeroconf service的服务守护进程</span></span></span><br><span class="line">systemctl stop avahi-daemon.socket</span><br><span class="line">systemctl stop avahi-daemon.service</span><br><span class="line">systemctl disable avahi-daemon.service</span><br><span class="line">systemctl disable avahi-daemon.socket</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#关闭NOZEROCONF</span></span></span><br><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/sysconfig/network</span><br><span class="line"><span class="meta">#</span><span class="bash">OracleBegin</span></span><br><span class="line">NOZEROCONF=yes</span><br><span class="line"><span class="meta">#</span><span class="bash">OracleEnd</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104103506861.png" alt="image-20211104103506861"></p>
<h3 id="关闭透明大页和numa"><a href="#关闭透明大页和numa" class="headerlink" title="关闭透明大页和numa"></a>关闭透明大页和numa</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s/quiet/quiet transparent_hugepage=never numa=off/&#x27; /etc/default/grub</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104103747755.png" alt="image-20211104103747755"></p>
<h3 id="配置系统参数文件"><a href="#配置系统参数文件" class="headerlink" title="配置系统参数文件"></a>配置系统参数文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#计算shmall和shmmax值</span></span></span><br><span class="line">memTotal=$(grep MemTotal /proc/meminfo | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">totalMemory=$((memTotal / 2048))</span><br><span class="line">shmall=$((memTotal / 4))</span><br><span class="line">if [ $shmall -lt 2097152 ]; then</span><br><span class="line">  shmall=2097152</span><br><span class="line">fi</span><br><span class="line">shmmax=$((memTotal * 1024 - 1))</span><br><span class="line">if [ &quot;$shmmax&quot; -lt 4294967295 ]; then</span><br><span class="line">  shmmax=4294967295</span><br><span class="line">fi</span><br><span class="line">echo $shmall</span><br><span class="line">echo $shmmax</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#配置系统参数</span></span></span><br><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/sysctl.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">OracleBegin</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#shmmal&#x27;s Calculation formula: physical memory 8G：(8*1024*1024*1024)/4096=2097152</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#shmmax&#x27;s Calculation formula: physical memory 8G：(8/2)*1024*1024*1024 -1=4294967295</span></span></span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">kernel.shmall = $shmall  # 单个共享内存段最大值</span><br><span class="line">kernel.shmmax = $shmmax  # 共享内存页数</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">net.core.rmem_default = 262144</span><br><span class="line">net.core.rmem_max = 4194304</span><br><span class="line">net.core.wmem_default = 262144</span><br><span class="line">net.core.wmem_max = 1048576</span><br><span class="line">EOF</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#系统参数生效</span></span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/sysctl.conf</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">kernel.shmall = 2097152</span><br><span class="line">kernel.shmmax = 4294967295</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">net.core.rmem_default = 262144</span><br><span class="line">net.core.rmem_max = 4194304</span><br><span class="line">net.core.wmem_default = 262144</span><br><span class="line">net.core.wmem_max = 1048576</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kernel.shmall = $shmall  # 单个共享内存段最大值</span><br><span class="line">kernel.shmmax = $shmmax  # 共享内存页数</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211115173131542.png" alt="image-20211115173131542"></p>
<h3 id="配置系统资源限制"><a href="#配置系统资源限制" class="headerlink" title="配置系统资源限制"></a>配置系统资源限制</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/security/limits.conf</span><br><span class="line">oracle soft nofile 16384</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240</span><br><span class="line">oracle hard stack 32768</span><br><span class="line">oracle soft nproc 16384 </span><br><span class="line">oracle hard nproc 16384 </span><br><span class="line">oracle hard memlock 8000000</span><br><span class="line">oracle soft memlock 8000000</span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> 单位kb 略低于内存</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/security/limits.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">OracleBegin</span></span><br><span class="line">oracle soft nofile 1024</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240</span><br><span class="line">oracle hard stack 32768</span><br><span class="line">oracle soft nproc 2047 </span><br><span class="line">oracle hard nproc 16384 </span><br><span class="line">oracle hard memlock 8000000</span><br><span class="line">oracle soft memlock 8000000</span><br><span class="line"><span class="meta">#</span><span class="bash">OracleEnd</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/pam.d/login</span><br><span class="line"><span class="meta">#</span><span class="bash">OracleBegin</span></span><br><span class="line">session required pam_limits.so </span><br><span class="line">session required /lib64/security/pam_limits.so</span><br><span class="line"><span class="meta">#</span><span class="bash">OracleEnd</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="创建用户和组"><a href="#创建用户和组" class="headerlink" title="创建用户和组"></a>创建用户和组</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/sbin/groupadd -g 54321 oinstall</span><br><span class="line">/usr/sbin/groupadd -g 54322 dba</span><br><span class="line">/usr/sbin/groupadd -g 54323 oper</span><br><span class="line"></span><br><span class="line">/usr/sbin/useradd -u 54321 -g oinstall -G dba,oper oracle</span><br><span class="line">echo oracle | passwd --stdin oracle</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建Oracle安装目录"><a href="#创建Oracle安装目录" class="headerlink" title="创建Oracle安装目录"></a>创建Oracle安装目录</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /u01/app/oracle/product/11.2.0/db</span><br><span class="line">mkdir -p /u01/app/oraInventory</span><br><span class="line">mkdir -p /oradata</span><br><span class="line">chown -R oracle:oinstall /oradata</span><br><span class="line">chown -R oracle:oinstall /u01/app</span><br><span class="line">chmod -R 775 /u01/app</span><br></pre></td></tr></table></figure>

<h3 id="用户环境变量配置"><a href="#用户环境变量配置" class="headerlink" title="用户环境变量配置"></a>用户环境变量配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt;/home/oracle/.bash_profile</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###############OracleBegin#########################</span></span></span><br><span class="line">umask 022</span><br><span class="line">export TMP=/tmp</span><br><span class="line">export TMPDIR=\$TMP</span><br><span class="line">export NLS_LANG=AMERICAN_AMERICA.AL32UTF8</span><br><span class="line">export ORACLE_BASE=/u01/app/oracle</span><br><span class="line">export ORACLE_HOME=/u01/app/oracle/product/11.2.0/db</span><br><span class="line">export ORACLE_HOSTNAME=orcl79</span><br><span class="line">export ORACLE_TERM=xterm</span><br><span class="line">export TNS_ADMIN=\$ORACLE_HOME/network/admin</span><br><span class="line">export LD_LIBRARY_PATH=\$ORACLE_HOME/lib:/lib:/usr/lib</span><br><span class="line">export ORACLE_SID=orcl</span><br><span class="line">export PATH=/usr/sbin:\$PATH</span><br><span class="line">export PATH=\$ORACLE_HOME/bin:\$ORACLE_HOME/OPatch:\$PATH</span><br><span class="line">alias sas=&#x27;sqlplus / as sysdba&#x27;</span><br><span class="line">export PS1=&quot;[\`whoami\`@\`hostname\`:&quot;&#x27;\$PWD]\$ &#x27;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="Oracle软件安装"><a href="#Oracle软件安装" class="headerlink" title="Oracle软件安装"></a>Oracle软件安装</h2><p><a href="https://luciferliu.blog.csdn.net/article/details/118529918">https://luciferliu.blog.csdn.net/article/details/118529918</a></p>
<h3 id="软件包上传"><a href="#软件包上传" class="headerlink" title="软件包上传"></a>软件包上传</h3><p><img data-src="https://cdn.jonty.top/img/image-20211104171706862.png" alt="image-20211104171706862"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104171845746.png" alt="image-20211104171845746"></p>
<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><p>按顺序解压1、2软件包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unzip -q p13390677_112040_Linux-x86-64_1of7.zip</span><br><span class="line">unzip -q p13390677_112040_Linux-x86-64_2of7.zip</span><br><span class="line"></span><br><span class="line">// 授权soft  to oracle</span><br><span class="line">chown -R oracle:oinstall /soft</span><br></pre></td></tr></table></figure>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="VNC配置"><a href="#VNC配置" class="headerlink" title="VNC配置"></a>VNC配置</h4><h5 id="安装GNOME桌面"><a href="#安装GNOME桌面" class="headerlink" title="安装GNOME桌面"></a>安装GNOME桌面</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出的组列表里有GNOME Desktop。</span></span><br><span class="line">yum grouplist  </span><br><span class="line"><span class="meta">#</span><span class="bash">安装之</span></span><br><span class="line">yum groupinstall -y &quot;GNOME Desktop&quot; </span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装完成后，修改默认启动方式为图形化界面</span></span><br><span class="line">systemctl set-default graphical.target  //设置成图形模式 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果要换回来</span> </span><br><span class="line">systemctl set-default multi-user.target  //设置成命令模式 </span><br><span class="line"><span class="meta">#</span><span class="bash">然后重启系统即可</span></span><br></pre></td></tr></table></figure>

<h5 id="安装VNC服务"><a href="#安装VNC服务" class="headerlink" title="安装VNC服务"></a>安装VNC服务</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install tigervnc-server -y</span><br><span class="line"></span><br><span class="line">rpm -qa|grep tigervnc-server -- 验证是否安装成功</span><br></pre></td></tr></table></figure>

<h5 id="打开VNC服务"><a href="#打开VNC服务" class="headerlink" title="打开VNC服务"></a>打开VNC服务</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vncserver :1  # 5901</span><br><span class="line"></span><br><span class="line">vncserver -kill :1  # 关闭</span><br><span class="line"></span><br><span class="line">vncpasswd # 重置密码</span><br></pre></td></tr></table></figure>

<p>然后配置好密码使用<code>VNC Viewer</code>连接远程桌面</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211108134312717.png" alt="image-20211108134312717"></p>
<blockquote>
<p>教程 ： <a href="https://blog.csdn.net/nahancy/article/details/86316971">https://blog.csdn.net/nahancy/article/details/86316971</a></p>
<p>VNC下载：链接：<a href="https://pan.baidu.com/s/1fEf87xSB09gWxwswNXFeYw">https://pan.baidu.com/s/1fEf87xSB09gWxwswNXFeYw</a><br>提取码：3w9b </p>
</blockquote>
<h4 id="执行Oracle安装脚本"><a href="#执行Oracle安装脚本" class="headerlink" title="执行Oracle安装脚本"></a>执行Oracle安装脚本</h4><p>进入<code>/soft/database</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./runInstaller -jreLoc /etc/alternatives/jre_1.8.0</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104172834599.png" alt="image-20211104172834599"></p>
<p><strong>安装检查的问题</strong>：</p>
<p>1、must be configured to display at least 256 colors</p>
<p>解决方法：使用oracle用户打开vnserver</p>
<p>2、交换空间需要大于150MB</p>
<p>结局方法：</p>
<p>增加<code>swap</code>分区</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dd if=/dev/zero of=/home/swapfile bs=1M count=512</span><br><span class="line">mkswap /home/swapfile</span><br><span class="line">swapon /home/swapfile</span><br></pre></td></tr></table></figure>

<p>然后修改 /etc/fstab，加上：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> vim /etc/fstab</span><br><span class="line">/home/swapfile swap swap defaults 0 0</span><br></pre></td></tr></table></figure>



<h4 id="配置安全更新"><a href="#配置安全更新" class="headerlink" title="配置安全更新"></a>配置安全更新</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104172939686.png" alt="image-20211104172939686"></p>
<h4 id="下载软件更新"><a href="#下载软件更新" class="headerlink" title="下载软件更新"></a>下载软件更新</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104173006944.png" alt="image-20211104173006944"></p>
<h4 id="安装选项"><a href="#安装选项" class="headerlink" title="安装选项"></a>安装选项</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104173036634.png" alt="image-20211104173036634"></p>
<h4 id="安装选项-1"><a href="#安装选项-1" class="headerlink" title="安装选项"></a>安装选项</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104173111607.png" alt="image-20211104173111607"></p>
<h4 id="数据库版本"><a href="#数据库版本" class="headerlink" title="数据库版本"></a>数据库版本</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104173154202.png" alt="image-20211104173154202"></p>
<h4 id="安装位置"><a href="#安装位置" class="headerlink" title="安装位置"></a>安装位置</h4><p>默认</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104173224434.png" alt="image-20211104173224434"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104173247574.png" alt="image-20211104173247574"></p>
<h4 id="操作系统组"><a href="#操作系统组" class="headerlink" title="操作系统组"></a>操作系统组</h4><p>默认</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104173318474.png" alt="image-20211104173318474"></p>
<h4 id="安装前检查"><a href="#安装前检查" class="headerlink" title="安装前检查"></a>安装前检查</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104173400667.png" alt="image-20211104173400667"></p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -ivh pdksh-5.2.14-37.el5.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104173503682.png" alt="image-20211104173503682"></p>
<p>重新检查</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104173621400.png" alt="image-20211104173621400"></p>
<p>等待安装</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104173754434.png" alt="image-20211104173754434"></p>
<p><strong>错误解决</strong></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104173840559.png" alt="image-20211104173840559"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su - oracle</span><br><span class="line">sed -i &#x27;s/^\(\s*\$(MK_EMAGENT_NMECTL)\)\s*$/\1 -lnnz11/g&#x27; $ORACLE_HOME/sysman/lib/ins_emagent.mk</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104174044437.png" alt="image-20211104174044437"></p>
<h4 id="执行配置脚本"><a href="#执行配置脚本" class="headerlink" title="执行配置脚本"></a>执行配置脚本</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su - root</span><br><span class="line">/u01/app/oraInventory/orainstRoot.sh</span><br><span class="line">/u01/app/oraInventory/orainstRoot.sh</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104174220290.png" alt="image-20211104174220290"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104174230792.png" alt="image-20211104174230792"></p>
<h4 id="安装完成"><a href="#安装完成" class="headerlink" title="安装完成"></a>安装完成</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104174313280.png" alt="image-20211104174313280"></p>
<p>安装完成后重启主机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>



<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><h4 id="打开监听"><a href="#打开监听" class="headerlink" title="打开监听"></a>打开监听</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su - oracle</span><br><span class="line">lsnrctl start</span><br><span class="line">lsnrctl status</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104175006137.png" alt="image-20211104175006137"></p>
<h4 id="打开配置工具"><a href="#打开配置工具" class="headerlink" title="打开配置工具"></a>打开配置工具</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export LANG=en_US</span><br><span class="line">dbca</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211104175143670.png" alt="image-20211104175143670"></p>
<h4 id="创建数据库-1"><a href="#创建数据库-1" class="headerlink" title="创建数据库"></a>创建数据库</h4><p><img data-src="https://cdn.jonty.top/img/image-20211104175219629.png" alt="image-20211104175219629"></p>
<p>自定义模式</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175242442.png" alt="image-20211104175242442"></p>
<p>实例名</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175309394.png" alt="image-20211104175309394"></p>
<p>EM</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175402390.png" alt="image-20211104175402390"></p>
<p>使用统一密码</p>
<p><code>P@ssw0rd</code></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175458122.png" alt="image-20211104175458122"></p>
<p>使用建好的数据文件保存地址</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175606842.png" alt="image-20211104175606842"></p>
<p>关闭闪回和归档</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175643304.png" alt="image-20211104175643304"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175710858.png" alt="image-20211104175710858"></p>
<p>内存分配</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175742728.png" alt="image-20211104175742728"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175807092.png" alt="image-20211104175807092"></p>
<p>字符集配置</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104175832188.png" alt="image-20211104175832188"></p>
<p>下一步</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104190456300.png" alt="image-20211104190456300"></p>
<p>下一步</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104190517979.png" alt="image-20211104190517979"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104190603367.png" alt="image-20211104190603367"></p>
<p>等待创建完成</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104190644897.png" alt="image-20211104190644897"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211104194542389.png" alt="image-20211104194542389"></p>
<h4 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">su <span class="operator">-</span> oracle</span><br><span class="line">sqlplus <span class="operator">/</span> <span class="keyword">as</span> sysdba</span><br><span class="line"></span><br><span class="line">## 重启后启动数据库</span><br><span class="line">startup</span><br><span class="line"></span><br><span class="line">shutdown immediate; # 关闭数据库</span><br><span class="line"></span><br><span class="line">$ echo $ORACLE_SID  <span class="comment">-- 实例ID</span></span><br><span class="line">....                    <span class="comment">--&gt;&gt; Look what you get</span></span><br><span class="line">$ echo $ORACLE_HOME <span class="comment">-- 安装目录</span></span><br><span class="line">....                  </span><br><span class="line">$ ps <span class="operator">-</span>ef <span class="operator">|</span> grep smon    <span class="comment">--&gt;&gt; Look for smon background process which</span></span><br><span class="line">ora_smon_InfraDB        <span class="comment">--&gt;&gt; should include ORACLE_SID in it.</span></span><br><span class="line"></span><br><span class="line">$ ORACLE_SID<span class="operator">=</span>InfraDB    <span class="comment">--&gt;&gt; set to a valid value like these ones.</span></span><br><span class="line">$ ORACLE_HOME<span class="operator">=</span><span class="operator">/</span>u01<span class="operator">/</span>app<span class="operator">/</span>oracle<span class="operator">/</span>product<span class="operator">/</span><span class="number">12.2</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span>dbhome_1</span><br><span class="line"></span><br><span class="line">$ lsnrctl status        <span class="comment">--&gt;&gt; Look whether listener is ON</span></span><br><span class="line">$ lsnrctl <span class="keyword">start</span>         <span class="comment">--&gt;&gt; If not, then start the listener.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$database;</span><br><span class="line"></span><br><span class="line">##创建数据库用户</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> test identified <span class="keyword">by</span> test;</span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> test; # RESOURCE</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span> session <span class="keyword">to</span> test</span><br><span class="line">conn test<span class="operator">/</span>test</span><br><span class="line"></span><br><span class="line">##创建表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (id number <span class="keyword">not</span> <span class="keyword">null</span>,name varchar2(<span class="number">100</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;jonty&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>



<p><img data-src="https://cdn.jonty.top/img/image-20211104194801063.png" alt="image-20211104194801063"></p>
<p><strong>注意</strong>：如果执行SQL命令<a href="https://stackoverflow.com/questions/50219312/ora-01034-oracle-not-available">ORA-01034: ORACLE not available</a>，可能是实例ID对不上</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $ORACLE_SID   -- 查看当前实例</span><br><span class="line"></span><br><span class="line">echo $ORACLE_HOME -- 安装目录</span><br><span class="line"></span><br><span class="line">ORACLE_SID=medprodb  -- 设置</span><br></pre></td></tr></table></figure>



<p><img data-src="https://cdn.jonty.top/img/image-20211108134715074.png" alt="image-20211108134715074"></p>
<h2 id="数据库补丁安装"><a href="#数据库补丁安装" class="headerlink" title="数据库补丁安装"></a>数据库补丁安装</h2><h3 id="上传补丁"><a href="#上传补丁" class="headerlink" title="上传补丁"></a>上传补丁</h3><p>上传PSU文件夹到<code>/soft</code>目录下并解压</p>
<p> p6880880_112000_Linux-x86-64.zip</p>
<p><img data-src="https://cdn.jonty.top/img/image-20211118190817028.png" alt="image-20211118190817028"></p>
<h3 id="关闭数据库服务"><a href="#关闭数据库服务" class="headerlink" title="关闭数据库服务"></a>关闭数据库服务</h3><p>停掉所有数据库服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lsnrctl stop # 关闭监听</span><br><span class="line"></span><br><span class="line">emctl stop dbconsole; # 关闭EM</span><br><span class="line"></span><br><span class="line">shutdown immediate; # 关闭数据库</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="替换OPatch"><a href="#替换OPatch" class="headerlink" title="替换OPatch"></a>替换OPatch</h3><p>替换<strong>OPatch</strong>工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd $ORACLE_HOME</span><br><span class="line">cd /OPatch</span><br><span class="line">./opatch version</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211118192559635.png" alt="image-20211118192559635"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mv Opatch OPatch_old # 备份</span><br><span class="line">cp -r /soft/Opatch . # 复制</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211118193207365.png" alt="image-20211118193207365"></p>
<h3 id="执行补丁脚本"><a href="#执行补丁脚本" class="headerlink" title="执行补丁脚本"></a>执行补丁脚本</h3><p>进入补丁目录</p>
<p>查看<code>README.html</code>文档</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">opatch prereq CheckConflictAgainstOHWithDetail -ph ./</span><br><span class="line">opatch apply</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果OPatch failed with error code 73</span></span><br><span class="line">ps -ef|grep smon</span><br><span class="line">kill -9 进程id</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211118194022739.png" alt="image-20211118194022739"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">opatch lsinventory # 查看</span><br><span class="line"></span><br><span class="line">cd $ORACLE_HOME/rdbms/admin</span><br><span class="line">sqlplus / as sysdba</span><br><span class="line">startup # 启动</span><br><span class="line">@catbundle.sql psu apply # 执行脚本</span><br><span class="line">@utlrp.sql</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211118194940622.png" alt="image-20211118194940622"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211118195242997.png" alt="image-20211118195242997"></p>
<p>重启数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shutdown immediate;</span><br><span class="line">startup;</span><br></pre></td></tr></table></figure>



<h2 id="基础维护"><a href="#基础维护" class="headerlink" title="基础维护"></a>基础维护</h2><h3 id="关闭密码过期"><a href="#关闭密码过期" class="headerlink" title="关闭密码过期"></a>关闭密码过期</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_profiles <span class="keyword">where</span> profile <span class="operator">=</span> <span class="string">&#x27;DEFAULT&#x27;</span>; # 查看</span><br><span class="line"><span class="keyword">alter</span> profile <span class="keyword">default</span> limit PASSWORD_LIFE_TIME UNLIMITED;</span><br></pre></td></tr></table></figure>

<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> audit; # 审计</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> audit_trail <span class="operator">=</span> <span class="keyword">none</span> <span class="keyword">scope</span> <span class="operator">=</span> spfile;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> v$datafile; # 查看数据文件</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> sga; # 查看sga</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> pga; # 查看pga</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> proc; # 进程数</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> <span class="keyword">open</span>; # 游标</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> open_cursors <span class="operator">=</span> <span class="number">2000</span> <span class="keyword">scope</span> <span class="operator">=</span> spfile;</span><br></pre></td></tr></table></figure>



<h3 id="警告日志"><a href="#警告日志" class="headerlink" title="警告日志"></a>警告日志</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> dump</span><br><span class="line">cd <span class="operator">/</span>u01<span class="operator">/</span>app<span class="operator">/</span>oracle<span class="operator">/</span>diag<span class="operator">/</span>rdbms<span class="operator">/</span>orcl<span class="operator">/</span>orcl<span class="operator">/</span>trace</span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jonty.top/img/image-20211118201536713.png" alt="image-20211118201536713"></p>
<p><img data-src="https://cdn.jonty.top/img/image-20211118201633885.png" alt="image-20211118201633885"></p>
<h3 id="归档日志"><a href="#归档日志" class="headerlink" title="归档日志"></a>归档日志</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">archive log list;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> recover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> db_recovery_file_dest_size<span class="operator">=</span><span class="number">5</span>g;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> db_recovery_file_dest <span class="operator">=</span> <span class="string">&#x27;/archive&#x27;</span>;</span><br><span class="line">shutdown immediate;</span><br><span class="line">startup mount;</span><br><span class="line"><span class="keyword">alter</span> database archivelog;</span><br><span class="line">archive log list;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br></pre></td></tr></table></figure>

<p>配置完成后关闭，迁移数据后生产再打开</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">shutdown immediate;</span><br><span class="line">startup mount;</span><br><span class="line"><span class="keyword">alter</span> database noarchivelog;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br></pre></td></tr></table></figure>



<p>备份一下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> root用户</span></span><br><span class="line">tar zcvf oracle.tar.gz /u01/app/oracle</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>RedHat</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
</search>
