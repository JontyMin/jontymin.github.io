<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jonty Blog</title>
  
  <subtitle>è®°å½•æ¬ç –ç”Ÿæ´»</subtitle>
  <link href="https://jonty.top/atom.xml" rel="self"/>
  
  <link href="https://jonty.top/"/>
  <updated>2023-05-11T03:22:16.862Z</updated>
  <id>https://jonty.top/</id>
  
  <author>
    <name>JontyWang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>docker-keeplived-vip-ip</title>
    <link href="https://jonty.top/2023/05/11/docker-keeplived-vip-ip/"/>
    <id>https://jonty.top/2023/05/11/docker-keeplived-vip-ip/</id>
    <published>2023-05-11T03:22:13.000Z</published>
    <updated>2023-05-11T03:22:16.862Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>Dockeræ³¨å†ŒGitlab Runner</title>
    <link href="https://jonty.top/2023/05/11/use-docker-register-gitlab-runner/"/>
    <id>https://jonty.top/2023/05/11/use-docker-register-gitlab-runner/</id>
    <published>2023-05-11T03:16:41.000Z</published>
    <updated>2023-05-11T03:18:17.514Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åˆ›å»ºå˜é‡"><a href="#åˆ›å»ºå˜é‡" class="headerlink" title="åˆ›å»ºå˜é‡"></a>åˆ›å»ºå˜é‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GitLabServer=&#x27;https://git.xxx.com/&#x27; # gitlabæœåŠ¡å™¨åœ°å€</span><br><span class="line">GitLabToken=&#x27;xxxxx&#x27; # gitlab ä»“åº“token</span><br><span class="line">GitLabRunnerNamePrefix=&#x27;xxxx&#x27; # gitlab runner å‰ç¼€</span><br><span class="line">GitLabRunnerTags=&#x27;xxx&#x27; # gitlab runner tags</span><br><span class="line">GitLabRunnerDesc=&#x27;xxx&#x27; # gitlab runner desc</span><br><span class="line">GitLabRunnerImg=&#x27;gitlab/gitlab-runner:v14.10.1&#x27; # gitlab runner img</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºé…ç½®æ•°æ®å·"><a href="#åˆ›å»ºé…ç½®æ•°æ®å·" class="headerlink" title="åˆ›å»ºé…ç½®æ•°æ®å·"></a>åˆ›å»ºé…ç½®æ•°æ®å·</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºrunner"><a href="#åˆ›å»ºrunner" class="headerlink" title="åˆ›å»ºrunner"></a>åˆ›å»ºrunner</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --network host -d --restart always \</span><br><span class="line">-e TZ=Asia/Beijing \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;:/etc/gitlab-runner \</span><br><span class="line">--name &quot;$GitLabRunnerNamePrefix-gitlab-runner&quot; $GitLabRunnerImg</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œrunner"><a href="#æ³¨å†Œrunner" class="headerlink" title="æ³¨å†Œrunner"></a>æ³¨å†Œrunner</h3><blockquote><p><a href="https://docs.gitlab.com/runner/examples/gitlab.html">https://docs.gitlab.com/runner/examples/gitlab.html</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm \</span><br><span class="line">-v &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;:/etc/gitlab-runner \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">--name &quot;$GitLabRunnerNamePrefix-gitlab-runner-register&quot; $GitLabRunnerImg register \</span><br><span class="line">--url &quot;$GitLabServer&quot; \</span><br><span class="line">--registration-token &quot;$GitLabToken&quot; \</span><br><span class="line">--description &quot;$GitLabRunnerDesc&quot; \</span><br><span class="line">--tag-list &quot;$GitLabRunnerTags&quot; \</span><br><span class="line">--non-interactive \</span><br><span class="line">--executor &quot;docker&quot; \</span><br><span class="line">--docker-image docker:23.0.2 \</span><br><span class="line">--docker-privileged=&quot;true&quot; \</span><br><span class="line">--docker-volumes &quot;/certs/client&quot; \</span><br><span class="line">--run-untagged=&quot;true&quot; \</span><br><span class="line">--locked=&quot;false&quot; \</span><br><span class="line">--access-level=&quot;not_protected&quot; \</span><br><span class="line">--docker-volumes /var/run/docker.sock:/var/run/docker.sock </span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤runner"><a href="#åˆ é™¤runner" class="headerlink" title="åˆ é™¤runner"></a>åˆ é™¤runner</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop &quot;$GitLabRunnerNamePrefix-gitlab-runner&quot;</span><br><span class="line">docker rm &quot;$GitLabRunnerNamePrefix-gitlab-runner&quot;</span><br><span class="line">docker volume rm &quot;$GitLabRunnerNamePrefix-gitlab-runner-conf&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Dockeræ³¨å†ŒGitlab Runner</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Runner" scheme="https://jonty.top/tags/Runner/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab Runner å®ç°å†…ç½‘è‡ªåŠ¨éƒ¨ç½²</title>
    <link href="https://jonty.top/2023/05/11/gitlab-runner-intranet-job/"/>
    <id>https://jonty.top/2023/05/11/gitlab-runner-intranet-job/</id>
    <published>2023-05-11T03:02:58.000Z</published>
    <updated>2023-05-11T03:13:29.764Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>æœ€è¿‘å‡ºå·®æ”¯æŒé¡¹ç›®ä¸Šçº¿ï¼Œæˆ‘ä»¬çš„éƒ¨ç½²æµç¨‹æ˜¯Gitlab CIæ‰“åŒ…<code>Docker</code>é•œåƒä¸Šä¼ åˆ°äº‘é•œåƒæœåŠ¡ï¼Œç°åœºéƒ¨ç½²ç”±äºå†…ç½‘æ— æ³•è®¿é—®å…¬ç½‘ï¼Œæ²¡åŠæ³•ç›´æ¥ä½¿ç”¨è„šæœ¬å®ç°è‡ªåŠ¨éƒ¨ç½²(Runneræ²¡åŠæ³•è¿æ¥~)ã€‚ç›®å‰çš„æƒ…å†µæ˜¯ï¼Œå®¢æˆ·æä¾›äº†ä¸€å°å¯è®¿é—®å¤–ç½‘çš„æœºå™¨ï¼ˆä¸æä¾›ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬æœºï¼‰ï¼Œå¹¶ä¸”åœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œä¹Ÿç®—æ˜¯æ”¾å¼€ä¸€ä¸ªå£å­ï¼Œå¯ä»¥åŸºäºè¿™ä¸€å°æœºå™¨å»å®ç°ä¸åŒæ“ä½œï¼Œä»¥ä¸‹ä¾¿æ˜¯æä¾›çš„ä¸€ç§è§£å†³æ€è·¯ï¼Œå‡å°‘å·¥ä½œé‡ã€‚</p></div><h2 id="Ubuntuå®‰è£…Gitlab-Runner"><a href="#Ubuntuå®‰è£…Gitlab-Runner" class="headerlink" title="Ubuntuå®‰è£…Gitlab Runner"></a>Ubuntuå®‰è£…Gitlab Runner</h2><h3 id="æ·»åŠ Gitlab-Runnerä»“åº“"><a href="#æ·»åŠ Gitlab-Runnerä»“åº“" class="headerlink" title="æ·»åŠ Gitlab Runnerä»“åº“"></a>æ·»åŠ Gitlab Runnerä»“åº“</h3><p>é¦–å…ˆï¼Œæ·»åŠ Gitlab Runnerçš„å®˜æ–¹ä»“åº“ï¼Œè¿è¡Œä¸€ä¸‹å‘½ä»¤æ·»åŠ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103118473.png" alt="image-20230511103118473"></p><h3 id="å®‰è£…Gitlab-Runner"><a href="#å®‰è£…Gitlab-Runner" class="headerlink" title="å®‰è£…Gitlab Runner"></a>å®‰è£…Gitlab Runner</h3><p>ä½¿ç”¨<code>apt</code>åŒ…ç®¡ç†å™¨å®‰è£…<code>Gitlab Runner</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gitlab-runner</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103303074.png" alt="image-20230511103303074"></p><h3 id="æ£€æŸ¥Gitlab-RunnerçŠ¶æ€"><a href="#æ£€æŸ¥Gitlab-RunnerçŠ¶æ€" class="headerlink" title="æ£€æŸ¥Gitlab RunnerçŠ¶æ€"></a>æ£€æŸ¥Gitlab RunnerçŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner status</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹Runnerè¿è¡ŒçŠ¶æ€</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@runner:/home/jonty<span class="params">#</span> sudo gitlab-runner status</span><br><span class="line">Runtime platform                                    arch=amd64 os=linux pid=2966404 revision=436955cb version=15.11.0</span><br><span class="line">gitlab-runner: Service is running</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103329891.png" alt="image-20230511103329891"></p><p>æˆåŠŸåœ¨Ubuntuå®‰è£…Gitlab Runner</p><h3 id="å¸è½½Gitlab-Runner"><a href="#å¸è½½Gitlab-Runner" class="headerlink" title="å¸è½½Gitlab Runner"></a>å¸è½½Gitlab Runner</h3><p>åœæ­¢æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner stop</span><br></pre></td></tr></table></figure><p>å¸è½½æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner uninstall</span><br></pre></td></tr></table></figure><h2 id="æ³¨å†ŒGitlab-Runner"><a href="#æ³¨å†ŒGitlab-Runner" class="headerlink" title="æ³¨å†ŒGitlab Runner"></a>æ³¨å†ŒGitlab Runner</h2><p>å°†Runneræ³¨å†Œåˆ°Gitlabé¡¹ç›®ä¸­</p><p>1ã€è·å–Gitlabé¡¹ç›®æ³¨å†Œä»¤ç‰Œï¼š</p><ul><li>ä»“åº“RULåœ°å€</li><li>ä»“åº“æ³¨å†Œä»¤ç‰Œ</li></ul><p><img data-src="https://cdn.jonty.top/img/image-20230511102811943.png" alt="image-20230511102811943"></p><p>2ã€ æ³¨å†ŒGitlab Runner</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner register</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æç¤ºè¾“å…¥Gitlab ç¤ºä¾‹çš„URLã€é¡¹ç›®çš„æ³¨å†Œä»¤ç‰Œä»¥åŠRunneræè¿°ä¿¡æ¯ã€Tag</p><p>è¿™é‡Œ<code>executor</code>é€‰æ‹©<code>shell</code></p><p><img data-src="https://cdn.jonty.top/img/image-20230511103545979.png" alt="image-20230511103545979"></p><p>3ã€æ¿€æ´»Gitlab Runner</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner verify</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230511103918535.png" alt="image-20230511103918535"></p><p>åœ¨é¡¹ç›®Runnerä¸­å¯ä»¥çœ‹åˆ°å·²ç»æ³¨å†Œå®Œæˆï¼š</p><p><img data-src="https://cdn.jonty.top/img/image-20230511103934445.png" alt="image-20230511103934445"></p><p>4ã€Gitlab Runneråå°è¿è¡Œ</p><p>ä½¿ç”¨â€œ&amp;â€å°†åœ¨åå°å¯åŠ¨ï¼Œå³ä½¿å…³é—­ SSH ä¼šè¯ï¼Œå®ƒä»ç„¶å­˜åœ¨ï¼Œåªæœ‰åœ¨æœåŠ¡å™¨é‡æ–°å¯åŠ¨æˆ–å…³é—­æ—¶æ‰ä¼šåœæ­¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner run&amp;</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰Job"><a href="#å®šä¹‰Job" class="headerlink" title="å®šä¹‰Job"></a>å®šä¹‰Job</h2><p>åœ¨<code>.gitlab-ci.yml</code>ä¸­å®šä¹‰Job</p><p><code>script</code>æ‰§è¡Œ<code>runner</code>å®¿ä¸»æœº<code>/bin/bash /images_194/deploy_194.sh</code>è„šæœ¬ï¼Œå®ç°<code>æ›²çº¿æ•‘å›½</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy_dev:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">dependencies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">build_host_dev</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="attr">refs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dev-1.5</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">retry:</span></span><br><span class="line">    <span class="attr">max:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">/bin/bash</span> <span class="string">/images_194/deploy_194.sh</span></span><br></pre></td></tr></table></figure><p>æœ€åè´´å‡ºè¿æ¥å±€åŸŸç½‘å¦ä¸€å°æœºå™¨éƒ¨ç½²çš„è„šæœ¬:</p><ul><li>æ‹‰å–å…¬ç½‘é•œåƒï¼Œé‡æ–°æ‰“Tagï¼Œæ¨é€åˆ°å†…ç½‘<code>Registry</code></li><li>sshè¿æ¥åˆ°å†…ç½‘æœºå™¨ï¼Œæ‰§è¡Œéƒ¨ç½²è„šæœ¬</li><li>å®Œæˆéƒ¨ç½²</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">imgAppNames=(<span class="string">&#x27;server&#x27;</span> <span class="string">&#x27;vue&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">AppFile</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">  WMS_VERSION=dev</span><br><span class="line">  REGISTRY_URL=ccr.ccs.tencentyun.com/xxx</span><br><span class="line">  LocalRegistryUrl=192.168.2.89:8232</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$WMS_VERSION</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$REGISTRY_URL</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$LocalRegistryUrl</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨å¤„ç†åº”ç”¨é•œåƒ&quot;</span></span><br><span class="line">  PullImage</span><br><span class="line">  TagImage</span><br><span class="line">  PushImage</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">PullImage</span></span>()&#123;</span><br><span class="line">  <span class="keyword">for</span> imgName <span class="keyword">in</span> <span class="variable">$&#123;imgAppNames[@]&#125;</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  targetImgName=<span class="string">&quot;<span class="variable">$REGISTRY_URL</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨æ‹‰å–: <span class="variable">$targetImgName</span>&quot;</span></span><br><span class="line">  docker pull <span class="variable">$targetImgName</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æ‹‰å–å®Œæˆ&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">TagImage</span></span>()&#123;</span><br><span class="line">  <span class="keyword">for</span> imgName <span class="keyword">in</span> <span class="variable">$&#123;imgAppNames[@]&#125;</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  targetImgName=<span class="string">&quot;<span class="variable">$REGISTRY_URL</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line">  localImgName=<span class="string">&quot;<span class="variable">$LocalRegistryUrl</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨æ‰“æ ‡ç­¾: <span class="variable">$targetImgName</span>&quot;</span></span><br><span class="line">  docker tag <span class="variable">$targetImgName</span> <span class="variable">$localImgName</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æ‰“æ ‡ç­¾å®Œæˆ&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">PushImage</span></span>()&#123;</span><br><span class="line">  <span class="keyword">for</span> imgName <span class="keyword">in</span> <span class="variable">$&#123;imgAppNames[@]&#125;</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  localImgName=<span class="string">&quot;<span class="variable">$LocalRegistryUrl</span>/<span class="variable">$&#123;imgName&#125;</span>:<span class="variable">$WMS_VERSION</span>&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨æ¨é€: <span class="variable">$localImgName</span>&quot;</span></span><br><span class="line">  docker push <span class="variable">$localImgName</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æ¨é€å®Œæˆ&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AppFile</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å‚æ•°</span></span><br><span class="line">REMOTE_IP=<span class="string">&quot;192.168.2.194&quot;</span></span><br><span class="line">REMOTE_USER=<span class="string">&quot;wms&quot;</span></span><br><span class="line">REMOTE_PASS=<span class="string">&quot;wmstest@123&quot;</span></span><br><span class="line">ROOT_PASS=<span class="string">&quot;wmstest@123&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨</span></span><br><span class="line">sshpass -p <span class="string">&quot;<span class="variable">$&#123;REMOTE_PASS&#125;</span>&quot;</span> ssh -o StrictHostKeyChecking=no -l <span class="string">&quot;<span class="variable">$&#123;REMOTE_USER&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;REMOTE_IP&#125;</span>&quot;</span> &lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># åˆ‡æ¢åˆ° root ç”¨æˆ·</span></span><br><span class="line"><span class="string">echo &quot;$&#123;ROOT_PASS&#125;&quot; | sudo -S su</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># åˆ‡æ¢åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line"><span class="string">cd /home/wms/wms_app/07_app</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;ç§»é™¤å½“å‰æœåŠ¡ï¼štest_app&quot;</span></span><br><span class="line"><span class="string">sudo docker stack rm test_app</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sleep 20s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;å¯åŠ¨æœåŠ¡ä¸­...&quot;</span></span><br><span class="line"><span class="string"># æ‰§è¡Œ run.sh</span></span><br><span class="line"><span class="string">sudo /bin/bash ./run.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;æœåŠ¡å¯åŠ¨å®Œæˆ...&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sudo docker service ls -f name=test_app</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># é€€å‡º root ç”¨æˆ·</span></span><br><span class="line"><span class="string">exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># é€€å‡ºè¿œç¨‹æœåŠ¡å™¨</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Gitlab CI æ›²çº¿æ•‘å›½ å®ç°å†…ç½‘è‡ªåŠ¨éƒ¨ç½²</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Gitlab" scheme="https://jonty.top/tags/Gitlab/"/>
    
    <category term="Runner" scheme="https://jonty.top/tags/Runner/"/>
    
  </entry>
  
  <entry>
    <title>Git çš„å¥‡æŠ€æ·«å·§</title>
    <link href="https://jonty.top/2023/05/04/git-tips/"/>
    <id>https://jonty.top/2023/05/04/git-tips/</id>
    <published>2023-05-04T07:59:04.000Z</published>
    <updated>2023-05-04T08:02:07.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Git å¸¸ç”¨å‘½ä»¤é›†åˆï¼ŒFork è‡ª <a href="https://github.com/git-tips/tips">tips</a> é¡¹ç›®</p><p>åˆ†äº«è‡ªï¼š<a href="https://github.com/521xueweihan/git-tips">521xueweihan/git-tips: Gitçš„å¥‡æŠ€æ·«å·§ (github.com)</a></p></blockquote><p>Git æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œç‰ˆæœ¬ç®¡ç†å·¥å…·å°±æ˜¯å¤§å®¶åœ¨å†™ä¸œè¥¿çš„æ—¶å€™éƒ½ç”¨è¿‡ <strong>å›æ’¤</strong>è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯å›æ’¤åªèƒ½å›æ’¤å‡ æ­¥ï¼Œå‡å¦‚æƒ³è¦æ‰¾å›æˆ‘ä¸‰å¤©ä¹‹å‰çš„ä¿®æ”¹ï¼Œå…‰ç”¨å›æ’¤æ˜¯æ‰¾ä¸å›æ¥çš„ã€‚è€Œ<strong>ç‰ˆæœ¬ç®¡ç†å·¥å…·èƒ½è®°å½•æ¯æ¬¡çš„ä¿®æ”¹</strong>ï¼Œåªè¦æäº¤åˆ°ç‰ˆæœ¬ä»“åº“ï¼Œå°±å¯ä»¥æ‰¾åˆ°ä¹‹å‰ä»»ä½•æ—¶åˆ»çš„çŠ¶æ€ï¼ˆæ–‡æœ¬çŠ¶æ€ï¼‰ã€‚</p><p>ä¸‹é¢çš„å†…å®¹å°±æ˜¯åˆ—ä¸¾äº†å¸¸ç”¨çš„ Git å‘½ä»¤å’Œä¸€äº›å°æŠ€å·§ï¼Œå¯ä»¥é€šè¿‡é¡µé¢å†…æŸ¥æ‰¾çš„æ–¹å¼ <code>Ctrl/Command+f</code> è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ã€‚</p><h2 id="å¼€å·å¿…è¯»"><a href="#å¼€å·å¿…è¯»" class="headerlink" title="å¼€å·å¿…è¯»"></a>å¼€å·å¿…è¯»</h2><p><em>å¦‚æœä¹‹å‰æœªä½¿ç”¨è¿‡ Gitï¼Œå¯ä»¥å­¦ä¹  <a href="https://rogerdudler.github.io/git-guide/index.zh.html">Git å°ç™½æ•™ç¨‹</a>å…¥é—¨</em></p><ol><li><strong>ä¸€å®šè¦å…ˆæµ‹è¯•å‘½ä»¤çš„æ•ˆæœå</strong>ï¼Œå†ç”¨äºå·¥ä½œç¯å¢ƒä¸­ï¼Œä»¥é˜²é€ æˆä¸èƒ½å¼¥è¡¥çš„åæœï¼<strong>åˆ°æ—¶å€™åˆ«æ‹¿ç€ç åˆ€æ¥æ‰¾æˆ‘</strong></li><li>æ‰€æœ‰çš„å‘½ä»¤éƒ½åœ¨ <code>git version 2.7.4 (Apple Git-66)</code> ä¸‹æµ‹è¯•é€šè¿‡</li><li>ç»Ÿä¸€æ¦‚å¿µï¼š<ul><li>å·¥ä½œåŒºï¼šæ”¹åŠ¨ï¼ˆå¢åˆ æ–‡ä»¶å’Œå†…å®¹ï¼‰</li><li>æš‚å­˜åŒºï¼šè¾“å…¥å‘½ä»¤ï¼š<code>git add æ”¹åŠ¨çš„æ–‡ä»¶å</code>ï¼Œæ­¤æ¬¡æ”¹åŠ¨å°±æ”¾åˆ°äº† â€˜æš‚å­˜åŒºâ€™</li><li>æœ¬åœ°ä»“åº“(ç®€ç§°ï¼šæœ¬åœ°)ï¼šè¾“å…¥å‘½ä»¤ï¼š<code>git commit æ­¤æ¬¡ä¿®æ”¹çš„æè¿°</code>ï¼Œæ­¤æ¬¡æ”¹åŠ¨å°±æ”¾åˆ°äº†æœ¬åœ°ä»“åº“ï¼Œæ¯ä¸ª commitï¼Œæˆ‘å«å®ƒä¸ºä¸€ä¸ªç‰ˆæœ¬ã€‚</li><li>è¿œç¨‹ä»“åº“(ç®€ç§°ï¼šè¿œç¨‹)ï¼šè¾“å…¥å‘½ä»¤ï¼š<code>git push è¿œç¨‹ä»“åº“</code>ï¼Œæ­¤æ¬¡æ”¹åŠ¨å°±æ”¾åˆ°äº†è¿œç¨‹ä»“åº“ï¼ˆGitHub ç­‰)</li><li>commit-idï¼šè¾“å‡ºå‘½ä»¤ï¼š<code>git log</code>ï¼Œæœ€ä¸Šé¢é‚£è¡Œ <code>commit xxxxxx</code>ï¼Œåé¢çš„å­—ç¬¦ä¸²å°±æ˜¯ commit-id</li></ul></li><li>å¦‚æœå–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæ¬¢è¿ Starã€æäº¤ Prã€<a href="https://github.com/521xueweihan/git-tips/issues">åé¦ˆé—®é¢˜</a>ğŸ˜Š</li></ol><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li><a href="#%E8%84%91%E5%9B%BE">è„‘å›¾</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E5%B8%AE%E5%8A%A9%E4%BF%A1%E6%81%AF">å±•ç¤ºå¸®åŠ©ä¿¡æ¯</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E7%8A%B6%E6%80%81">å›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€</a></li><li><a href="#%E9%87%8D%E8%AE%BE%E7%AC%AC%E4%B8%80%E4%B8%AA-commit">é‡è®¾ç¬¬ä¸€ä¸ªcommit</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E5%86%B2%E7%AA%81%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8">æŸ¥çœ‹å†²çªæ–‡ä»¶åˆ—è¡¨</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%92%8C%E6%9A%82%E5%AD%98%E5%8C%BA%E7%9A%84%E4%B8%8D%E5%90%8C">å±•ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¸åŒ</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%9A%82%E5%AD%98%E5%8C%BA%E5%92%8C%E6%9C%80%E8%BF%91%E7%89%88%E6%9C%AC%E7%9A%84%E4%B8%8D%E5%90%8C">å±•ç¤ºæš‚å­˜åŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%9A%82%E5%AD%98%E5%8C%BA%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%92%8C%E6%9C%80%E8%BF%91%E7%89%88%E6%9C%AC%E7%9A%84%E4%B8%8D%E5%90%8C">å±•ç¤ºæš‚å­˜åŒºã€å·¥ä½œåŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ</a></li><li><a href="#%E5%BF%AB%E9%80%9F%E5%88%87%E6%8D%A2%E5%88%B0%E4%B8%8A%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF">å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯</a></li><li><a href="#%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E5%90%88%E5%B9%B6%E5%88%B0-master-%E7%9A%84%E5%88%86%E6%94%AF">åˆ é™¤å·²ç»åˆå¹¶åˆ° master çš„åˆ†æ”¯</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E5%85%B3%E8%81%94%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E6%83%85%E5%86%B5">å±•ç¤ºæœ¬åœ°åˆ†æ”¯å…³è”è¿œç¨‹ä»“åº“çš„æƒ…å†µ</a></li><li><a href="#%E5%85%B3%E8%81%94%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">å…³è”è¿œç¨‹åˆ†æ”¯</a></li><li><a href="#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯</a></li><li><a href="#%E5%88%97%E5%87%BA%E6%9C%AC%E5%9C%B0%E5%92%8C%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">åˆ—å‡ºæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF%E5%92%8C%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB">æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å¯¹åº”å…³ç³»</a></li><li><a href="#%E8%BF%9C%E7%A8%8B%E5%88%A0%E9%99%A4%E4%BA%86%E5%88%86%E6%94%AF%E6%9C%AC%E5%9C%B0%E4%B9%9F%E6%83%B3%E5%88%A0%E9%99%A4">è¿œç¨‹åˆ é™¤äº†åˆ†æ”¯æœ¬åœ°ä¹Ÿæƒ³åˆ é™¤</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%88%87%E6%8D%A2%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯</a></li><li><a href="#%E4%BB%8E%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%88%87%E6%8D%A2%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">ä»è¿œç¨‹åˆ†æ”¯ä¸­åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯</a></li><li><a href="#%E5%88%A0%E9%99%A4%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">åˆ é™¤æœ¬åœ°åˆ†æ”¯</a></li><li><a href="#%E5%88%A0%E9%99%A4%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF">åˆ é™¤è¿œç¨‹åˆ†æ”¯</a></li><li><a href="#%E9%87%8D%E5%91%BD%E5%90%8D%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">é‡å‘½åæœ¬åœ°åˆ†æ”¯</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E6%A0%87%E7%AD%BE">æŸ¥çœ‹æ ‡ç­¾</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E6%A0%87%E7%AD%BE%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF">æŸ¥çœ‹æ ‡ç­¾è¯¦ç»†ä¿¡æ¯</a></li><li><a href="#%E6%9C%AC%E5%9C%B0%E5%88%9B%E5%BB%BA%E6%A0%87%E7%AD%BE">æœ¬åœ°åˆ›å»ºæ ‡ç­¾</a></li><li><a href="#%E6%8E%A8%E9%80%81%E6%A0%87%E7%AD%BE%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“</a></li><li><a href="#%E5%88%A0%E9%99%A4%E6%9C%AC%E5%9C%B0%E6%A0%87%E7%AD%BE">åˆ é™¤æœ¬åœ°æ ‡ç­¾</a></li><li><a href="#%E5%88%A0%E9%99%A4%E8%BF%9C%E7%A8%8B%E6%A0%87%E7%AD%BE">åˆ é™¤è¿œç¨‹æ ‡ç­¾</a></li><li><a href="#%E5%88%87%E5%9B%9E%E5%88%B0%E6%9F%90%E4%B8%AA%E6%A0%87%E7%AD%BE">åˆ‡å›åˆ°æŸä¸ªæ ‡ç­¾</a></li><li><a href="#%E6%94%BE%E5%BC%83%E5%B7%A5%E4%BD%9C%E5%8C%BA%E7%9A%84%E4%BF%AE%E6%94%B9">æ”¾å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹</a></li><li><a href="#%E6%81%A2%E5%A4%8D%E5%88%A0%E9%99%A4%E7%9A%84%E6%96%87%E4%BB%B6">æ¢å¤åˆ é™¤çš„æ–‡ä»¶</a></li><li><a href="#%E4%BB%A5%E6%96%B0%E5%A2%9E%E4%B8%80%E4%B8%AA-commit-%E7%9A%84%E6%96%B9%E5%BC%8F%E8%BF%98%E5%8E%9F%E6%9F%90%E4%B8%80%E4%B8%AA-commit-%E7%9A%84%E4%BF%AE%E6%94%B9">ä»¥æ–°å¢ä¸€ä¸ª commit çš„æ–¹å¼è¿˜åŸæŸä¸€ä¸ª commit çš„ä¿®æ”¹</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E6%9F%90%E4%B8%AA-commit-%E7%9A%84%E7%8A%B6%E6%80%81%E5%B9%B6%E5%88%A0%E9%99%A4%E5%90%8E%E9%9D%A2%E7%9A%84-commit">å›åˆ°æŸä¸ª commit çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤åé¢çš„ commit</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E4%B8%8A%E4%B8%80%E4%B8%AA-commit-%E7%9A%84%E6%8F%8F%E8%BF%B0">ä¿®æ”¹ä¸Šä¸€ä¸ª commit çš„æè¿°</a></li><li><a href="#%E6%9F%A5%E7%9C%8B-commit-%E5%8E%86%E5%8F%B2">æŸ¥çœ‹ commit å†å²</a></li><li><a href="#%E6%98%BE%E7%A4%BA%E6%9C%AC%E5%9C%B0%E6%9B%B4%E6%96%B0%E8%BF%87-head-%E7%9A%84-git-%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95">æ˜¾ç¤ºæœ¬åœ°æ›´æ–°è¿‡ HEAD çš„ git å‘½ä»¤è®°å½•</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E4%BD%9C%E8%80%85%E5%90%8D">ä¿®æ”¹ä½œè€…å</a></li><li><a href="#%E4%BF%AE%E6%94%B9%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84-url">ä¿®æ”¹è¿œç¨‹ä»“åº“çš„ url</a></li><li><a href="#%E5%A2%9E%E5%8A%A0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">å¢åŠ è¿œç¨‹ä»“åº“</a></li><li><a href="#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ä»“åº“</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E4%B8%A4%E4%B8%AA%E6%98%9F%E6%9C%9F%E5%86%85%E7%9A%84%E6%94%B9%E5%8A%A8">æŸ¥çœ‹ä¸¤ä¸ªæ˜ŸæœŸå†…çš„æ”¹åŠ¨</a></li><li><a href="#%E6%8A%8A-A-%E5%88%86%E6%94%AF%E7%9A%84%E6%9F%90%E4%B8%80%E4%B8%AA-commit%E6%94%BE%E5%88%B0-B-%E5%88%86%E6%94%AF%E4%B8%8A">æŠŠ A åˆ†æ”¯çš„æŸä¸€ä¸ª commitï¼Œæ”¾åˆ° B åˆ†æ”¯ä¸Š</a></li><li><a href="#%E7%BB%99-git-%E5%91%BD%E4%BB%A4%E8%B5%B7%E5%88%AB%E5%90%8D">ç»™ git å‘½ä»¤èµ·åˆ«å</a></li><li><a href="#%E5%AD%98%E5%82%A8%E5%BD%93%E5%89%8D%E7%9A%84%E4%BF%AE%E6%94%B9%E4%BD%86%E4%B8%8D%E7%94%A8%E6%8F%90%E4%BA%A4-commit">å­˜å‚¨å½“å‰çš„ä¿®æ”¹ï¼Œä½†ä¸ç”¨æäº¤ commit</a></li><li><a href="#%E4%BF%9D%E5%AD%98%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81%E5%8C%85%E6%8B%AC-untracked-%E7%9A%84%E6%96%87%E4%BB%B6">ä¿å­˜å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬ untracked çš„æ–‡ä»¶</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-stashes">å±•ç¤ºæ‰€æœ‰ stashes</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E6%9F%90%E4%B8%AA-stash-%E7%9A%84%E7%8A%B6%E6%80%81">å›åˆ°æŸä¸ª stash çš„çŠ¶æ€</a></li><li><a href="#%E5%9B%9E%E5%88%B0%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA-stash-%E7%9A%84%E7%8A%B6%E6%80%81%E5%B9%B6%E5%88%A0%E9%99%A4%E8%BF%99%E4%B8%AA-stash">å›åˆ°æœ€åä¸€ä¸ª stash çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤è¿™ä¸ª stash</a></li><li><a href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E7%9A%84-stash">åˆ é™¤æ‰€æœ‰çš„ stash</a></li><li><a href="#%E4%BB%8E-stash-%E4%B8%AD%E6%8B%BF%E5%87%BA%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%AE%E6%94%B9">ä» stash ä¸­æ‹¿å‡ºæŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-tracked-%E7%9A%84%E6%96%87%E4%BB%B6">å±•ç¤ºæ‰€æœ‰ tracked çš„æ–‡ä»¶</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-untracked-%E7%9A%84%E6%96%87%E4%BB%B6">å±•ç¤ºæ‰€æœ‰ untracked çš„æ–‡ä»¶</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89%E5%BF%BD%E7%95%A5%E7%9A%84%E6%96%87%E4%BB%B6">å±•ç¤ºæ‰€æœ‰å¿½ç•¥çš„æ–‡ä»¶</a></li><li><a href="#%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4-untracked-%E7%9A%84%E6%96%87%E4%BB%B6">å¼ºåˆ¶åˆ é™¤ untracked çš„æ–‡ä»¶</a></li><li><a href="#%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4-untracked-%E7%9A%84%E7%9B%AE%E5%BD%95">å¼ºåˆ¶åˆ é™¤ untracked çš„ç›®å½•</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E7%AE%80%E5%8C%96%E7%9A%84-commit-%E5%8E%86%E5%8F%B2">å±•ç¤ºç®€åŒ–çš„ commit å†å²</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E6%AE%B5%E4%BB%A3%E7%A0%81%E6%98%AF%E8%B0%81%E5%86%99%E7%9A%84">æŸ¥çœ‹æŸæ®µä»£ç æ˜¯è°å†™çš„</a></li><li><a href="#%E6%8A%8A%E6%9F%90%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF%E5%AF%BC%E5%87%BA%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6">æŠŠæŸä¸€ä¸ªåˆ†æ”¯å¯¼å‡ºæˆä¸€ä¸ªæ–‡ä»¶</a></li><li><a href="#%E4%BB%8E%E5%8C%85%E4%B8%AD%E5%AF%BC%E5%85%A5%E5%88%86%E6%94%AF">ä»åŒ…ä¸­å¯¼å…¥åˆ†æ”¯</a></li><li><a href="#%E6%89%A7%E8%A1%8C-rebase-%E4%B9%8B%E5%89%8D%E8%87%AA%E5%8A%A8-stash">æ‰§è¡Œ rebase ä¹‹å‰è‡ªåŠ¨ stash</a></li><li><a href="#%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E6%A0%B9%E6%8D%AE-ID-%E6%8B%89%E4%B8%8B%E6%9F%90%E4%B8%80%E7%8A%B6%E6%80%81-%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF">ä»è¿œç¨‹ä»“åº“æ ¹æ® IDï¼Œæ‹‰ä¸‹æŸä¸€çŠ¶æ€ï¼Œåˆ°æœ¬åœ°åˆ†æ”¯</a></li><li><a href="#%E8%AF%A6%E7%BB%86%E5%B1%95%E7%A4%BA%E4%B8%80%E8%A1%8C%E4%B8%AD%E7%9A%84%E4%BF%AE%E6%94%B9">è¯¦ç»†å±•ç¤ºä¸€è¡Œä¸­çš„ä¿®æ”¹</a></li><li><a href="#%E6%B8%85%E9%99%A4-gitignore-%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AE%B0%E5%BD%95%E7%9A%84%E6%96%87%E4%BB%B6">æ¸…é™¤ <code>.gitignore</code> æ–‡ä»¶ä¸­è®°å½•çš„æ–‡ä»¶</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E6%89%80%E6%9C%89-alias-%E5%92%8C-configs">å±•ç¤ºæ‰€æœ‰ alias å’Œ configs</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E5%BF%BD%E7%95%A5%E7%9A%84%E6%96%87%E4%BB%B6">å±•ç¤ºå¿½ç•¥çš„æ–‡ä»¶</a></li><li><a href="#commit-%E5%8E%86%E5%8F%B2%E4%B8%AD%E6%98%BE%E7%A4%BA-Branch1-%E6%9C%89%E7%9A%84%E4%BD%86%E6%98%AF-Branch2-%E6%B2%A1%E6%9C%89-commit">commit å†å²ä¸­æ˜¾ç¤º Branch1 æœ‰çš„ï¼Œä½†æ˜¯ Branch2 æ²¡æœ‰ commit</a></li><li><a href="#%E5%9C%A8-commit-log-%E4%B8%AD%E6%98%BE%E7%A4%BA-GPG-%E7%AD%BE%E5%90%8D">åœ¨ commit log ä¸­æ˜¾ç¤º GPG ç­¾å</a></li><li><a href="#%E5%88%A0%E9%99%A4%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE">åˆ é™¤å…¨å±€è®¾ç½®</a></li><li><a href="#%E6%96%B0%E5%BB%BA%E5%B9%B6%E5%88%87%E6%8D%A2%E5%88%B0%E6%96%B0%E5%88%86%E6%94%AF%E4%B8%8A%E5%90%8C%E6%97%B6%E8%BF%99%E4%B8%AA%E5%88%86%E6%94%AF%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95-commit">æ–°å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ä¸Šï¼ŒåŒæ—¶è¿™ä¸ªåˆ†æ”¯æ²¡æœ‰ä»»ä½• commit</a></li><li><a href="#%E5%B1%95%E7%A4%BA%E4%BB%BB%E6%84%8F%E5%88%86%E6%94%AF%E6%9F%90%E4%B8%80%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9">å±•ç¤ºä»»æ„åˆ†æ”¯æŸä¸€æ–‡ä»¶çš„å†…å®¹</a></li><li><a href="#clone-%E4%B8%8B%E6%9D%A5%E6%8C%87%E5%AE%9A%E7%9A%84%E5%8D%95%E4%B8%80%E5%88%86%E6%94%AF">clone ä¸‹æ¥æŒ‡å®šçš„å•ä¸€åˆ†æ”¯</a></li><li><a href="#clone-%E6%9C%80%E6%96%B0%E4%B8%80%E6%AC%A1%E6%8F%90%E4%BA%A4">clone æœ€æ–°ä¸€æ¬¡æäº¤</a></li><li><a href="#%E5%BF%BD%E7%95%A5%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E6%94%B9%E5%8A%A8">å¿½ç•¥æŸä¸ªæ–‡ä»¶çš„æ”¹åŠ¨</a></li><li><a href="#%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90%E5%8F%98%E5%8C%96">å¿½ç•¥æ–‡ä»¶çš„æƒé™å˜åŒ–</a></li><li><a href="#%E4%BB%A5%E6%9C%80%E5%90%8E%E6%8F%90%E4%BA%A4%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89-Git-%E5%88%86%E6%94%AF">ä»¥æœ€åæäº¤çš„é¡ºåºåˆ—å‡ºæ‰€æœ‰ Git åˆ†æ”¯</a></li><li><a href="#%E5%9C%A8-commit-log-%E4%B8%AD%E6%9F%A5%E6%89%BE%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9">åœ¨ commit log ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹</a></li><li><a href="#%E6%8A%8A%E6%9A%82%E5%AD%98%E5%8C%BA%E7%9A%84%E6%8C%87%E5%AE%9A-file-%E6%94%BE%E5%88%B0%E5%B7%A5%E4%BD%9C%E5%8C%BA%E4%B8%AD">æŠŠæš‚å­˜åŒºçš„æŒ‡å®š file æ”¾åˆ°å·¥ä½œåŒºä¸­</a></li><li><a href="#%E5%BC%BA%E5%88%B6%E6%8E%A8%E9%80%81">å¼ºåˆ¶æ¨é€</a></li><li><a href="#git-%E9%85%8D%E7%BD%AE-http-%E5%92%8C-socks-%E4%BB%A3%E7%90%86">git é…ç½® http å’Œ socks ä»£ç†</a></li><li><a href="#git-%E9%85%8D%E7%BD%AE-ssh-%E4%BB%A3%E7%90%86">git é…ç½® ssh ä»£ç†</a></li><li><a href="#%E4%BC%98%E9%9B%85%E7%9A%84Commit%E4%BF%A1%E6%81%AF">ä¼˜é›…çš„Commitä¿¡æ¯</a></li><li><a href="#commit%E5%B7%A5%E5%85%B7">commitå·¥å…·</a></li><li><a href="#%E5%A3%B0%E6%98%8E">å£°æ˜</a></li></ul><h2 id="å±•ç¤ºå¸®åŠ©ä¿¡æ¯"><a href="#å±•ç¤ºå¸®åŠ©ä¿¡æ¯" class="headerlink" title="å±•ç¤ºå¸®åŠ©ä¿¡æ¯"></a>å±•ç¤ºå¸®åŠ©ä¿¡æ¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">help</span> -g</span><br></pre></td></tr></table></figure><p>The command output as below:</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">The common Git guides are:</span><br><span class="line">   attributes          Defining attributes per path</span><br><span class="line">   <span class="keyword">cli</span>                 Git command-<span class="keyword">line</span> interface and conventions</span><br><span class="line">   core-<span class="keyword">tutorial</span>       A Git core <span class="keyword">tutorial</span> <span class="keyword">for</span> developers</span><br><span class="line">   cvs-migration       Git <span class="keyword">for</span> CVS users</span><br><span class="line">   diffcore            Tweaking diff output</span><br><span class="line">   everyday            A useful minimum <span class="keyword">set</span> of commands <span class="keyword">for</span> Everyday Git</span><br><span class="line">   glossary            A Git Glossary</span><br><span class="line">   hooks               Hooks used <span class="keyword">by</span> Git</span><br><span class="line">   ignore              Specifies intentionally untracked files to ignore</span><br><span class="line">   modules             Defining submodule properties</span><br><span class="line">   namespaces          Git namespaces</span><br><span class="line">   repository-layout    Git Repository Layout</span><br><span class="line">   revisions           Specifying revisions and ranges <span class="keyword">for</span> Git</span><br><span class="line">   <span class="keyword">tutorial</span>            A <span class="keyword">tutorial</span> introduction to Git</span><br><span class="line">   <span class="keyword">tutorial</span>-2          A <span class="keyword">tutorial</span> introduction to Git: part <span class="keyword">two</span></span><br><span class="line">   workflows           <span class="keyword">An</span> overview of recommended workflows with Git</span><br><span class="line"></span><br><span class="line">&#x27;git <span class="keyword">help</span> -a&#x27; and &#x27;git <span class="keyword">help</span> -<span class="keyword">g</span>&#x27; <span class="keyword">list</span> available subcommands and some concept guides. See &#x27;git <span class="keyword">help</span> &lt;command&gt;&#x27; or &#x27;git <span class="keyword">help</span> &lt;concept&gt;&#x27; to <span class="keyword">read</span> <span class="keyword">about</span> a specific subcommand or concept.</span><br></pre></td></tr></table></figure><h2 id="å›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€"><a href="#å›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€" class="headerlink" title="å›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€"></a>å›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€</h2><p>æŠ›å¼ƒæœ¬åœ°æ‰€æœ‰çš„ä¿®æ”¹ï¼Œå›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch --all &amp;&amp; git reset --hard origin/master</span><br></pre></td></tr></table></figure><h2 id="é‡è®¾ç¬¬ä¸€ä¸ª-commit"><a href="#é‡è®¾ç¬¬ä¸€ä¸ª-commit" class="headerlink" title="é‡è®¾ç¬¬ä¸€ä¸ª commit"></a>é‡è®¾ç¬¬ä¸€ä¸ª commit</h2><p>ä¹Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„æ”¹åŠ¨éƒ½é‡æ–°æ”¾å›å·¥ä½œåŒºï¼Œå¹¶<strong>æ¸…ç©ºæ‰€æœ‰çš„ commit</strong>ï¼Œè¿™æ ·å°±å¯ä»¥é‡æ–°æäº¤ç¬¬ä¸€ä¸ª commit äº†</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-ref -d HEAD</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å†²çªæ–‡ä»¶åˆ—è¡¨"><a href="#æŸ¥çœ‹å†²çªæ–‡ä»¶åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹å†²çªæ–‡ä»¶åˆ—è¡¨"></a>æŸ¥çœ‹å†²çªæ–‡ä»¶åˆ—è¡¨</h2><p>å±•ç¤ºå·¥ä½œåŒºçš„å†²çªæ–‡ä»¶åˆ—è¡¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --name-only --diff-filter=U</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¸åŒ"><a href="#å±•ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¸åŒ" class="headerlink" title="å±•ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¸åŒ"></a>å±•ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¸åŒ</h2><p>è¾“å‡º<strong>å·¥ä½œåŒº</strong>å’Œ<strong>æš‚å­˜åŒº</strong>çš„ different (ä¸åŒ)ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥å±•ç¤ºæœ¬åœ°ä»“åº“ä¸­ä»»æ„ä¸¤ä¸ª commit ä¹‹é—´çš„æ–‡ä»¶å˜åŠ¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff &lt;commit-id&gt; &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæš‚å­˜åŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ"><a href="#å±•ç¤ºæš‚å­˜åŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ" class="headerlink" title="å±•ç¤ºæš‚å­˜åŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ"></a>å±•ç¤ºæš‚å­˜åŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ</h2><p>è¾“å‡º<strong>æš‚å­˜åŒº</strong>å’Œæœ¬åœ°æœ€è¿‘çš„ç‰ˆæœ¬ (commit) çš„ different (ä¸åŒ)ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæš‚å­˜åŒºã€å·¥ä½œåŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ"><a href="#å±•ç¤ºæš‚å­˜åŒºã€å·¥ä½œåŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ" class="headerlink" title="å±•ç¤ºæš‚å­˜åŒºã€å·¥ä½œåŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ"></a>å±•ç¤ºæš‚å­˜åŒºã€å·¥ä½œåŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ</h2><p>è¾“å‡º<strong>å·¥ä½œåŒº</strong>ã€<strong>æš‚å­˜åŒº</strong> å’Œæœ¬åœ°æœ€è¿‘çš„ç‰ˆæœ¬ (commit) çš„ different (ä¸åŒ)ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD</span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯"><a href="#å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯" class="headerlink" title="å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯"></a>å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤å·²ç»åˆå¹¶åˆ°-master-çš„åˆ†æ”¯"><a href="#åˆ é™¤å·²ç»åˆå¹¶åˆ°-master-çš„åˆ†æ”¯" class="headerlink" title="åˆ é™¤å·²ç»åˆå¹¶åˆ° master çš„åˆ†æ”¯"></a>åˆ é™¤å·²ç»åˆå¹¶åˆ° master çš„åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --merged master | grep -v <span class="string">&#x27;^\*\|  master&#x27;</span> | xargs -n 1 git branch -d</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæœ¬åœ°åˆ†æ”¯å…³è”è¿œç¨‹ä»“åº“çš„æƒ…å†µ"><a href="#å±•ç¤ºæœ¬åœ°åˆ†æ”¯å…³è”è¿œç¨‹ä»“åº“çš„æƒ…å†µ" class="headerlink" title="å±•ç¤ºæœ¬åœ°åˆ†æ”¯å…³è”è¿œç¨‹ä»“åº“çš„æƒ…å†µ"></a>å±•ç¤ºæœ¬åœ°åˆ†æ”¯å…³è”è¿œç¨‹ä»“åº“çš„æƒ…å†µ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -vv</span><br></pre></td></tr></table></figure><h2 id="å…³è”è¿œç¨‹åˆ†æ”¯"><a href="#å…³è”è¿œç¨‹åˆ†æ”¯" class="headerlink" title="å…³è”è¿œç¨‹åˆ†æ”¯"></a>å…³è”è¿œç¨‹åˆ†æ”¯</h2><p>å…³è”ä¹‹åï¼Œ<code>git branch -vv</code> å°±å¯ä»¥å±•ç¤ºå…³è”çš„è¿œç¨‹åˆ†æ”¯åäº†ï¼ŒåŒæ—¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ç›´æ¥ï¼š<code>git push</code>ï¼Œä¸éœ€è¦æŒ‡å®šè¿œç¨‹ä»“åº“äº†ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -u origin/mybranch</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ push æ—¶åŠ ä¸Š <code>-u</code> å‚æ•°</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin/mybranch -u</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯"><a href="#åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯"></a>åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯</h2><p>-r å‚æ•°ç›¸å½“äºï¼šremote</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -r</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡ºæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯"><a href="#åˆ—å‡ºæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯" class="headerlink" title="åˆ—å‡ºæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯"></a>åˆ—å‡ºæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯</h2><p>-a å‚æ•°ç›¸å½“äºï¼šall</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å¯¹åº”å…³ç³»"><a href="#æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å¯¹åº”å…³ç³»" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å¯¹åº”å…³ç³»"></a>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å¯¹åº”å…³ç³»</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote show origin</span><br></pre></td></tr></table></figure><h2 id="è¿œç¨‹åˆ é™¤äº†åˆ†æ”¯æœ¬åœ°ä¹Ÿæƒ³åˆ é™¤"><a href="#è¿œç¨‹åˆ é™¤äº†åˆ†æ”¯æœ¬åœ°ä¹Ÿæƒ³åˆ é™¤" class="headerlink" title="è¿œç¨‹åˆ é™¤äº†åˆ†æ”¯æœ¬åœ°ä¹Ÿæƒ³åˆ é™¤"></a>è¿œç¨‹åˆ é™¤äº†åˆ†æ”¯æœ¬åœ°ä¹Ÿæƒ³åˆ é™¤</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote prune origin</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯"><a href="#åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯" class="headerlink" title="åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯"></a>åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="ä»è¿œç¨‹åˆ†æ”¯ä¸­åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯"><a href="#ä»è¿œç¨‹åˆ†æ”¯ä¸­åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯" class="headerlink" title="ä»è¿œç¨‹åˆ†æ”¯ä¸­åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯"></a>ä»è¿œç¨‹åˆ†æ”¯ä¸­åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branch-name&gt; origin/&lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æœ¬åœ°åˆ†æ”¯"><a href="#åˆ é™¤æœ¬åœ°åˆ†æ”¯" class="headerlink" title="åˆ é™¤æœ¬åœ°åˆ†æ”¯"></a>åˆ é™¤æœ¬åœ°åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;local-branchname&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤è¿œç¨‹åˆ†æ”¯"><a href="#åˆ é™¤è¿œç¨‹åˆ†æ”¯" class="headerlink" title="åˆ é™¤è¿œç¨‹åˆ†æ”¯"></a>åˆ é™¤è¿œç¨‹åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete &lt;remote-branchname&gt;</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :&lt;remote-branchname&gt;</span><br></pre></td></tr></table></figure><h2 id="é‡å‘½åæœ¬åœ°åˆ†æ”¯"><a href="#é‡å‘½åæœ¬åœ°åˆ†æ”¯" class="headerlink" title="é‡å‘½åæœ¬åœ°åˆ†æ”¯"></a>é‡å‘½åæœ¬åœ°åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m &lt;new-branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ ‡ç­¾"><a href="#æŸ¥çœ‹æ ‡ç­¾" class="headerlink" title="æŸ¥çœ‹æ ‡ç­¾"></a>æŸ¥çœ‹æ ‡ç­¾</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure><p>å±•ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘çš„ tag</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git describe --tags --abbrev=0</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ ‡ç­¾è¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹æ ‡ç­¾è¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ ‡ç­¾è¯¦ç»†ä¿¡æ¯"></a>æŸ¥çœ‹æ ‡ç­¾è¯¦ç»†ä¿¡æ¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -ln</span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°åˆ›å»ºæ ‡ç­¾"><a href="#æœ¬åœ°åˆ›å»ºæ ‡ç­¾" class="headerlink" title="æœ¬åœ°åˆ›å»ºæ ‡ç­¾"></a>æœ¬åœ°åˆ›å»ºæ ‡ç­¾</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag &lt;version-number&gt;</span><br></pre></td></tr></table></figure><p>é»˜è®¤ tag æ˜¯æ‰“åœ¨æœ€è¿‘çš„ä¸€æ¬¡ commit ä¸Šï¼Œå¦‚æœéœ€è¦æŒ‡å®š commit æ‰“ tagï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a &lt;version-number&gt; -m <span class="string">&quot;v1.0 å‘å¸ƒ(æè¿°)&quot;</span> &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“"><a href="#æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“"></a>æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“</h2><p>é¦–å…ˆè¦ä¿è¯æœ¬åœ°åˆ›å»ºå¥½äº†æ ‡ç­¾æ‰å¯ä»¥æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;local-version-number&gt;</span><br></pre></td></tr></table></figure><p>ä¸€æ¬¡æ€§æ¨é€æ‰€æœ‰æ ‡ç­¾ï¼ŒåŒæ­¥åˆ°è¿œç¨‹ä»“åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æœ¬åœ°æ ‡ç­¾"><a href="#åˆ é™¤æœ¬åœ°æ ‡ç­¾" class="headerlink" title="åˆ é™¤æœ¬åœ°æ ‡ç­¾"></a>åˆ é™¤æœ¬åœ°æ ‡ç­¾</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -d &lt;tag-name&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤è¿œç¨‹æ ‡ç­¾"><a href="#åˆ é™¤è¿œç¨‹æ ‡ç­¾" class="headerlink" title="åˆ é™¤è¿œç¨‹æ ‡ç­¾"></a>åˆ é™¤è¿œç¨‹æ ‡ç­¾</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete tag &lt;tagname&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ‡å›åˆ°æŸä¸ªæ ‡ç­¾"><a href="#åˆ‡å›åˆ°æŸä¸ªæ ‡ç­¾" class="headerlink" title="åˆ‡å›åˆ°æŸä¸ªæ ‡ç­¾"></a>åˆ‡å›åˆ°æŸä¸ªæ ‡ç­¾</h2><p>ä¸€èˆ¬ä¸Šçº¿ä¹‹å‰éƒ½ä¼šæ‰“ tagï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢ä¸Šçº¿åå‡ºç°é—®é¢˜ï¼Œæ–¹ä¾¿å¿«é€Ÿå›é€€åˆ°ä¸Šä¸€ç‰ˆæœ¬ã€‚ä¸‹é¢çš„å‘½ä»¤æ˜¯å›åˆ°æŸä¸€æ ‡ç­¾ä¸‹çš„çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b branch_name tag_name</span><br></pre></td></tr></table></figure><h2 id="æ”¾å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹"><a href="#æ”¾å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹" class="headerlink" title="æ”¾å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹"></a>æ”¾å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;file-name&gt;</span><br></pre></td></tr></table></figure><p>æ”¾å¼ƒæ‰€æœ‰ä¿®æ”¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout .</span><br></pre></td></tr></table></figure><h2 id="æ¢å¤åˆ é™¤çš„æ–‡ä»¶"><a href="#æ¢å¤åˆ é™¤çš„æ–‡ä»¶" class="headerlink" title="æ¢å¤åˆ é™¤çš„æ–‡ä»¶"></a>æ¢å¤åˆ é™¤çš„æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rev-list -n 1 HEAD -- &lt;file_path&gt; <span class="comment">#å¾—åˆ° deleting_commit</span></span><br><span class="line"></span><br><span class="line">git checkout &lt;deleting_commit&gt;^ -- &lt;file_path&gt; <span class="comment">#å›åˆ°åˆ é™¤æ–‡ä»¶ deleting_commit ä¹‹å‰çš„çŠ¶æ€</span></span><br></pre></td></tr></table></figure><h2 id="ä»¥æ–°å¢ä¸€ä¸ª-commit-çš„æ–¹å¼è¿˜åŸæŸä¸€ä¸ª-commit-çš„ä¿®æ”¹"><a href="#ä»¥æ–°å¢ä¸€ä¸ª-commit-çš„æ–¹å¼è¿˜åŸæŸä¸€ä¸ª-commit-çš„ä¿®æ”¹" class="headerlink" title="ä»¥æ–°å¢ä¸€ä¸ª commit çš„æ–¹å¼è¿˜åŸæŸä¸€ä¸ª commit çš„ä¿®æ”¹"></a>ä»¥æ–°å¢ä¸€ä¸ª commit çš„æ–¹å¼è¿˜åŸæŸä¸€ä¸ª commit çš„ä¿®æ”¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="å›åˆ°æŸä¸ª-commit-çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤åé¢çš„-commit"><a href="#å›åˆ°æŸä¸ª-commit-çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤åé¢çš„-commit" class="headerlink" title="å›åˆ°æŸä¸ª commit çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤åé¢çš„ commit"></a>å›åˆ°æŸä¸ª commit çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤åé¢çš„ commit</h2><p>å’Œ revert çš„åŒºåˆ«ï¼šreset å‘½ä»¤ä¼šæŠ¹å»æŸä¸ª commit id ä¹‹åçš„æ‰€æœ‰ commit</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git reset &lt;commit-id&gt;  <span class="comment">#é»˜è®¤å°±æ˜¯-mixedå‚æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line">git reset --mixed HEAD^  <span class="comment">#å›é€€è‡³ä¸Šä¸ªç‰ˆæœ¬ï¼Œå®ƒå°†é‡ç½®HEADåˆ°å¦å¤–ä¸€ä¸ªcommit,å¹¶ä¸”é‡ç½®æš‚å­˜åŒºä»¥ä¾¿å’ŒHEADç›¸åŒ¹é…ï¼Œä½†æ˜¯ä¹Ÿåˆ°æ­¤ä¸ºæ­¢ã€‚å·¥ä½œåŒºä¸ä¼šè¢«æ›´æ”¹ã€‚</span></span><br><span class="line"></span><br><span class="line">git reset --soft HEAD~3  <span class="comment">#å›é€€è‡³ä¸‰ä¸ªç‰ˆæœ¬ä¹‹å‰ï¼Œåªå›é€€äº†commitçš„ä¿¡æ¯ï¼Œæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸å›é€€ä¹‹å‰ä¿æŒä¸€è‡´ã€‚å¦‚æœè¿˜è¦æäº¤ï¼Œç›´æ¥commitå³å¯ Â </span></span><br><span class="line"></span><br><span class="line">git reset --hard &lt;commit-id&gt;  <span class="comment">#å½»åº•å›é€€åˆ°æŒ‡å®šcommit-idçš„çŠ¶æ€ï¼Œæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¹Ÿä¼šå˜ä¸ºæŒ‡å®šcommit-idç‰ˆæœ¬çš„å†…å®¹</span></span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ä¸Šä¸€ä¸ª-commit-çš„æè¿°"><a href="#ä¿®æ”¹ä¸Šä¸€ä¸ª-commit-çš„æè¿°" class="headerlink" title="ä¿®æ”¹ä¸Šä¸€ä¸ª commit çš„æè¿°"></a>ä¿®æ”¹ä¸Šä¸€ä¸ª commit çš„æè¿°</h2><p>å¦‚æœæš‚å­˜åŒºæœ‰æ”¹åŠ¨ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†æš‚å­˜åŒºçš„æ”¹åŠ¨æäº¤åˆ°ä¸Šä¸€ä¸ª commit</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹-commit-å†å²"><a href="#æŸ¥çœ‹-commit-å†å²" class="headerlink" title="æŸ¥çœ‹ commit å†å²"></a>æŸ¥çœ‹ commit å†å²</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æŸæ®µä»£ç æ˜¯è°å†™çš„"><a href="#æŸ¥çœ‹æŸæ®µä»£ç æ˜¯è°å†™çš„" class="headerlink" title="æŸ¥çœ‹æŸæ®µä»£ç æ˜¯è°å†™çš„"></a>æŸ¥çœ‹æŸæ®µä»£ç æ˜¯è°å†™çš„</h2><p>blame çš„æ„æ€ä¸ºâ€˜è´£æ€ªâ€™ï¼Œä½ æ‡‚çš„ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git blame &lt;file-name&gt;</span><br></pre></td></tr></table></figure><h2 id="æ˜¾ç¤ºæœ¬åœ°æ›´æ–°è¿‡-HEAD-çš„-git-å‘½ä»¤è®°å½•"><a href="#æ˜¾ç¤ºæœ¬åœ°æ›´æ–°è¿‡-HEAD-çš„-git-å‘½ä»¤è®°å½•" class="headerlink" title="æ˜¾ç¤ºæœ¬åœ°æ›´æ–°è¿‡ HEAD çš„ git å‘½ä»¤è®°å½•"></a>æ˜¾ç¤ºæœ¬åœ°æ›´æ–°è¿‡ HEAD çš„ git å‘½ä»¤è®°å½•</h2><p>æ¯æ¬¡æ›´æ–°äº† HEAD çš„ git å‘½ä»¤æ¯”å¦‚ commitã€amendã€cherry-pickã€resetã€revert ç­‰éƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼ˆä¸é™åˆ†æ”¯ï¼‰ï¼Œå°±åƒ shell çš„ history ä¸€æ ·ã€‚<br>è¿™æ ·ä½ å¯ä»¥ reset åˆ°ä»»ä½•ä¸€æ¬¡æ›´æ–°äº† HEAD çš„æ“ä½œä¹‹åï¼Œè€Œä¸ä»…ä»…æ˜¯å›åˆ°å½“å‰åˆ†æ”¯ä¸‹çš„æŸä¸ª commit ä¹‹åçš„çŠ¶æ€ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ä½œè€…å"><a href="#ä¿®æ”¹ä½œè€…å" class="headerlink" title="ä¿®æ”¹ä½œè€…å"></a>ä¿®æ”¹ä½œè€…å</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend --author=<span class="string">&#x27;Author Name &lt;email@address.com&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹è¿œç¨‹ä»“åº“çš„-url"><a href="#ä¿®æ”¹è¿œç¨‹ä»“åº“çš„-url" class="headerlink" title="ä¿®æ”¹è¿œç¨‹ä»“åº“çš„ url"></a>ä¿®æ”¹è¿œç¨‹ä»“åº“çš„ url</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url origin &lt;URL&gt;</span><br></pre></td></tr></table></figure><h2 id="å¢åŠ è¿œç¨‹ä»“åº“"><a href="#å¢åŠ è¿œç¨‹ä»“åº“" class="headerlink" title="å¢åŠ è¿œç¨‹ä»“åº“"></a>å¢åŠ è¿œç¨‹ä»“åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &lt;remote-url&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ä»“åº“"><a href="#åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ä»“åº“" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ä»“åº“"></a>åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ä»“åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ä¸¤ä¸ªæ˜ŸæœŸå†…çš„æ”¹åŠ¨"><a href="#æŸ¥çœ‹ä¸¤ä¸ªæ˜ŸæœŸå†…çš„æ”¹åŠ¨" class="headerlink" title="æŸ¥çœ‹ä¸¤ä¸ªæ˜ŸæœŸå†…çš„æ”¹åŠ¨"></a>æŸ¥çœ‹ä¸¤ä¸ªæ˜ŸæœŸå†…çš„æ”¹åŠ¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git whatchanged --since=<span class="string">&#x27;2 weeks ago&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æŠŠ-A-åˆ†æ”¯çš„æŸä¸€ä¸ª-commitï¼Œæ”¾åˆ°-B-åˆ†æ”¯ä¸Š"><a href="#æŠŠ-A-åˆ†æ”¯çš„æŸä¸€ä¸ª-commitï¼Œæ”¾åˆ°-B-åˆ†æ”¯ä¸Š" class="headerlink" title="æŠŠ A åˆ†æ”¯çš„æŸä¸€ä¸ª commitï¼Œæ”¾åˆ° B åˆ†æ”¯ä¸Š"></a>æŠŠ A åˆ†æ”¯çš„æŸä¸€ä¸ª commitï¼Œæ”¾åˆ° B åˆ†æ”¯ä¸Š</h2><p>è¿™ä¸ªè¿‡ç¨‹éœ€è¦ <code>cherry-pick</code> å‘½ä»¤ï¼Œ<a href="http://sg552.iteye.com/blog/1300713#bc2367928">å‚è€ƒ</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;branch-name&gt; &amp;&amp; git cherry-pick &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h2 id="ç»™-git-å‘½ä»¤èµ·åˆ«å"><a href="#ç»™-git-å‘½ä»¤èµ·åˆ«å" class="headerlink" title="ç»™ git å‘½ä»¤èµ·åˆ«å"></a>ç»™ git å‘½ä»¤èµ·åˆ«å</h2><p>ç®€åŒ–å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git config --global <span class="built_in">alias</span>.&lt;handle&gt; &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚ï¼šgit status æ”¹æˆ git stï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–å‘½ä»¤</span><br><span class="line"></span><br><span class="line">git config --global alias.st status</span><br></pre></td></tr></table></figure><h2 id="å­˜å‚¨å½“å‰çš„ä¿®æ”¹ï¼Œä½†ä¸ç”¨æäº¤-commit"><a href="#å­˜å‚¨å½“å‰çš„ä¿®æ”¹ï¼Œä½†ä¸ç”¨æäº¤-commit" class="headerlink" title="å­˜å‚¨å½“å‰çš„ä¿®æ”¹ï¼Œä½†ä¸ç”¨æäº¤ commit"></a>å­˜å‚¨å½“å‰çš„ä¿®æ”¹ï¼Œä½†ä¸ç”¨æäº¤ commit</h2><p>è¯¦è§£å¯ä»¥å‚è€ƒ<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137602359178794d966923e5c4134bc8bf98dfb03aea3000">å»–é›ªå³°è€å¸ˆçš„ git æ•™ç¨‹</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure><h2 id="ä¿å­˜å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬-untracked-çš„æ–‡ä»¶"><a href="#ä¿å­˜å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬-untracked-çš„æ–‡ä»¶" class="headerlink" title="ä¿å­˜å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬ untracked çš„æ–‡ä»¶"></a>ä¿å­˜å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬ untracked çš„æ–‡ä»¶</h2><p>untracked æ–‡ä»¶ï¼šæ–°å»ºçš„æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash -u</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæ‰€æœ‰-stashes"><a href="#å±•ç¤ºæ‰€æœ‰-stashes" class="headerlink" title="å±•ç¤ºæ‰€æœ‰ stashes"></a>å±•ç¤ºæ‰€æœ‰ stashes</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure><h2 id="å›åˆ°æŸä¸ª-stash-çš„çŠ¶æ€"><a href="#å›åˆ°æŸä¸ª-stash-çš„çŠ¶æ€" class="headerlink" title="å›åˆ°æŸä¸ª stash çš„çŠ¶æ€"></a>å›åˆ°æŸä¸ª stash çš„çŠ¶æ€</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash apply &lt;stash@&#123;n&#125;&gt;</span><br></pre></td></tr></table></figure><h2 id="å›åˆ°æœ€åä¸€ä¸ª-stash-çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤è¿™ä¸ª-stash"><a href="#å›åˆ°æœ€åä¸€ä¸ª-stash-çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤è¿™ä¸ª-stash" class="headerlink" title="å›åˆ°æœ€åä¸€ä¸ª stash çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤è¿™ä¸ª stash"></a>å›åˆ°æœ€åä¸€ä¸ª stash çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤è¿™ä¸ª stash</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ‰€æœ‰çš„-stash"><a href="#åˆ é™¤æ‰€æœ‰çš„-stash" class="headerlink" title="åˆ é™¤æ‰€æœ‰çš„ stash"></a>åˆ é™¤æ‰€æœ‰çš„ stash</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash clear</span><br></pre></td></tr></table></figure><h2 id="ä»-stash-ä¸­æ‹¿å‡ºæŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹"><a href="#ä»-stash-ä¸­æ‹¿å‡ºæŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹" class="headerlink" title="ä» stash ä¸­æ‹¿å‡ºæŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹"></a>ä» stash ä¸­æ‹¿å‡ºæŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;stash@&#123;n&#125;&gt; -- &lt;file-path&gt;</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæ‰€æœ‰-tracked-çš„æ–‡ä»¶"><a href="#å±•ç¤ºæ‰€æœ‰-tracked-çš„æ–‡ä»¶" class="headerlink" title="å±•ç¤ºæ‰€æœ‰ tracked çš„æ–‡ä»¶"></a>å±•ç¤ºæ‰€æœ‰ tracked çš„æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files -t</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæ‰€æœ‰-untracked-çš„æ–‡ä»¶"><a href="#å±•ç¤ºæ‰€æœ‰-untracked-çš„æ–‡ä»¶" class="headerlink" title="å±•ç¤ºæ‰€æœ‰ untracked çš„æ–‡ä»¶"></a>å±•ç¤ºæ‰€æœ‰ untracked çš„æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files --others</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæ‰€æœ‰å¿½ç•¥çš„æ–‡ä»¶"><a href="#å±•ç¤ºæ‰€æœ‰å¿½ç•¥çš„æ–‡ä»¶" class="headerlink" title="å±•ç¤ºæ‰€æœ‰å¿½ç•¥çš„æ–‡ä»¶"></a>å±•ç¤ºæ‰€æœ‰å¿½ç•¥çš„æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files --others -i --exclude-standard</span><br></pre></td></tr></table></figure><h2 id="å¼ºåˆ¶åˆ é™¤-untracked-çš„æ–‡ä»¶"><a href="#å¼ºåˆ¶åˆ é™¤-untracked-çš„æ–‡ä»¶" class="headerlink" title="å¼ºåˆ¶åˆ é™¤ untracked çš„æ–‡ä»¶"></a>å¼ºåˆ¶åˆ é™¤ untracked çš„æ–‡ä»¶</h2><p>å¯ä»¥ç”¨æ¥åˆ é™¤æ–°å»ºçš„æ–‡ä»¶ã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶æ–‡ä»¶åï¼Œåˆ™æ¸…ç©ºæ‰€æœ‰å·¥ä½œçš„ untracked æ–‡ä»¶ã€‚<code>clean</code> å‘½ä»¤ï¼Œ<strong>æ³¨æ„ä¸¤ç‚¹</strong>ï¼š</p><ol><li>clean åï¼Œåˆ é™¤çš„æ–‡ä»¶æ— æ³•æ‰¾å›</li><li>ä¸ä¼šå½±å“ tracked çš„æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œåªä¼šåˆ é™¤ untracked çš„æ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clean &lt;file-name&gt; -f</span><br></pre></td></tr></table></figure><h2 id="å¼ºåˆ¶åˆ é™¤-untracked-çš„ç›®å½•"><a href="#å¼ºåˆ¶åˆ é™¤-untracked-çš„ç›®å½•" class="headerlink" title="å¼ºåˆ¶åˆ é™¤ untracked çš„ç›®å½•"></a>å¼ºåˆ¶åˆ é™¤ untracked çš„ç›®å½•</h2><p>å¯ä»¥ç”¨æ¥åˆ é™¤æ–°å»ºçš„ç›®å½•ï¼Œ<strong>æ³¨æ„</strong>:è¿™ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥ç”¨æ¥åˆ é™¤ untracked çš„æ–‡ä»¶ã€‚è¯¦æƒ…è§ä¸Šä¸€æ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clean &lt;directory-name&gt; -df</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºç®€åŒ–çš„-commit-å†å²"><a href="#å±•ç¤ºç®€åŒ–çš„-commit-å†å²" class="headerlink" title="å±•ç¤ºç®€åŒ–çš„ commit å†å²"></a>å±•ç¤ºç®€åŒ–çš„ commit å†å²</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=oneline --graph --decorate --all</span><br></pre></td></tr></table></figure><h2 id="æŠŠæŸä¸€ä¸ªåˆ†æ”¯å¯¼å‡ºæˆä¸€ä¸ªæ–‡ä»¶"><a href="#æŠŠæŸä¸€ä¸ªåˆ†æ”¯å¯¼å‡ºæˆä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="æŠŠæŸä¸€ä¸ªåˆ†æ”¯å¯¼å‡ºæˆä¸€ä¸ªæ–‡ä»¶"></a>æŠŠæŸä¸€ä¸ªåˆ†æ”¯å¯¼å‡ºæˆä¸€ä¸ªæ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git bundle create &lt;file&gt; &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="ä»åŒ…ä¸­å¯¼å…¥åˆ†æ”¯"><a href="#ä»åŒ…ä¸­å¯¼å…¥åˆ†æ”¯" class="headerlink" title="ä»åŒ…ä¸­å¯¼å…¥åˆ†æ”¯"></a>ä»åŒ…ä¸­å¯¼å…¥åˆ†æ”¯</h2><p>æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåˆ†æ”¯å†…å®¹å°±æ˜¯ä¸Šé¢ <code>git bundle create</code> å‘½ä»¤å¯¼å‡ºçš„å†…å®¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> repo.bundle &lt;repo-dir&gt; -b &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="æ‰§è¡Œ-rebase-ä¹‹å‰è‡ªåŠ¨-stash"><a href="#æ‰§è¡Œ-rebase-ä¹‹å‰è‡ªåŠ¨-stash" class="headerlink" title="æ‰§è¡Œ rebase ä¹‹å‰è‡ªåŠ¨ stash"></a>æ‰§è¡Œ rebase ä¹‹å‰è‡ªåŠ¨ stash</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --autostash</span><br></pre></td></tr></table></figure><h2 id="ä»è¿œç¨‹ä»“åº“æ ¹æ®-IDï¼Œæ‹‰ä¸‹æŸä¸€çŠ¶æ€ï¼Œåˆ°æœ¬åœ°åˆ†æ”¯"><a href="#ä»è¿œç¨‹ä»“åº“æ ¹æ®-IDï¼Œæ‹‰ä¸‹æŸä¸€çŠ¶æ€ï¼Œåˆ°æœ¬åœ°åˆ†æ”¯" class="headerlink" title="ä»è¿œç¨‹ä»“åº“æ ¹æ® IDï¼Œæ‹‰ä¸‹æŸä¸€çŠ¶æ€ï¼Œåˆ°æœ¬åœ°åˆ†æ”¯"></a>ä»è¿œç¨‹ä»“åº“æ ¹æ® IDï¼Œæ‹‰ä¸‹æŸä¸€çŠ¶æ€ï¼Œåˆ°æœ¬åœ°åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin pull/&lt;id&gt;/head:&lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="è¯¦ç»†å±•ç¤ºä¸€è¡Œä¸­çš„ä¿®æ”¹"><a href="#è¯¦ç»†å±•ç¤ºä¸€è¡Œä¸­çš„ä¿®æ”¹" class="headerlink" title="è¯¦ç»†å±•ç¤ºä¸€è¡Œä¸­çš„ä¿®æ”¹"></a>è¯¦ç»†å±•ç¤ºä¸€è¡Œä¸­çš„ä¿®æ”¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --word-diff</span><br></pre></td></tr></table></figure><h2 id="æ¸…é™¤-gitignore-æ–‡ä»¶ä¸­è®°å½•çš„æ–‡ä»¶"><a href="#æ¸…é™¤-gitignore-æ–‡ä»¶ä¸­è®°å½•çš„æ–‡ä»¶" class="headerlink" title="æ¸…é™¤ gitignore æ–‡ä»¶ä¸­è®°å½•çš„æ–‡ä»¶"></a>æ¸…é™¤ gitignore æ–‡ä»¶ä¸­è®°å½•çš„æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clean -X -f</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºæ‰€æœ‰-alias-å’Œ-configs"><a href="#å±•ç¤ºæ‰€æœ‰-alias-å’Œ-configs" class="headerlink" title="å±•ç¤ºæ‰€æœ‰ alias å’Œ configs"></a>å±•ç¤ºæ‰€æœ‰ alias å’Œ configs</h2><p><strong>æ³¨æ„ï¼š</strong> config åˆ†ä¸ºï¼šå½“å‰ç›®å½•ï¼ˆlocalï¼‰å’Œå…¨å±€ï¼ˆgolbalï¼‰çš„ configï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•çš„ config</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --<span class="built_in">local</span> --list (å½“å‰ç›®å½•)</span><br><span class="line">git config --global --list (å…¨å±€)</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºå¿½ç•¥çš„æ–‡ä»¶"><a href="#å±•ç¤ºå¿½ç•¥çš„æ–‡ä»¶" class="headerlink" title="å±•ç¤ºå¿½ç•¥çš„æ–‡ä»¶"></a>å±•ç¤ºå¿½ç•¥çš„æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status --ignored</span><br></pre></td></tr></table></figure><h2 id="commit-å†å²ä¸­æ˜¾ç¤º-Branch1-æœ‰çš„ï¼Œä½†æ˜¯-Branch2-æ²¡æœ‰-commit"><a href="#commit-å†å²ä¸­æ˜¾ç¤º-Branch1-æœ‰çš„ï¼Œä½†æ˜¯-Branch2-æ²¡æœ‰-commit" class="headerlink" title="commit å†å²ä¸­æ˜¾ç¤º Branch1 æœ‰çš„ï¼Œä½†æ˜¯ Branch2 æ²¡æœ‰ commit"></a>commit å†å²ä¸­æ˜¾ç¤º Branch1 æœ‰çš„ï¼Œä½†æ˜¯ Branch2 æ²¡æœ‰ commit</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> Branch1 ^Branch2</span><br></pre></td></tr></table></figure><h2 id="åœ¨-commit-log-ä¸­æ˜¾ç¤º-GPG-ç­¾å"><a href="#åœ¨-commit-log-ä¸­æ˜¾ç¤º-GPG-ç­¾å" class="headerlink" title="åœ¨ commit log ä¸­æ˜¾ç¤º GPG ç­¾å"></a>åœ¨ commit log ä¸­æ˜¾ç¤º GPG ç­¾å</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --show-signature</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤å…¨å±€è®¾ç½®"><a href="#åˆ é™¤å…¨å±€è®¾ç½®" class="headerlink" title="åˆ é™¤å…¨å±€è®¾ç½®"></a>åˆ é™¤å…¨å±€è®¾ç½®</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> &lt;entry-name&gt;</span><br></pre></td></tr></table></figure><h2 id="æ–°å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ä¸Šï¼ŒåŒæ—¶è¿™ä¸ªåˆ†æ”¯æ²¡æœ‰ä»»ä½•-commit"><a href="#æ–°å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ä¸Šï¼ŒåŒæ—¶è¿™ä¸ªåˆ†æ”¯æ²¡æœ‰ä»»ä½•-commit" class="headerlink" title="æ–°å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ä¸Šï¼ŒåŒæ—¶è¿™ä¸ªåˆ†æ”¯æ²¡æœ‰ä»»ä½• commit"></a>æ–°å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ä¸Šï¼ŒåŒæ—¶è¿™ä¸ªåˆ†æ”¯æ²¡æœ‰ä»»ä½• commit</h2><p>ç›¸å½“äºä¿å­˜ä¿®æ”¹ï¼Œä½†æ˜¯é‡å†™ commit å†å²</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --orphan &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤ºä»»æ„åˆ†æ”¯æŸä¸€æ–‡ä»¶çš„å†…å®¹"><a href="#å±•ç¤ºä»»æ„åˆ†æ”¯æŸä¸€æ–‡ä»¶çš„å†…å®¹" class="headerlink" title="å±•ç¤ºä»»æ„åˆ†æ”¯æŸä¸€æ–‡ä»¶çš„å†…å®¹"></a>å±•ç¤ºä»»æ„åˆ†æ”¯æŸä¸€æ–‡ä»¶çš„å†…å®¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git show &lt;branch-name&gt;:&lt;file-name&gt;</span><br></pre></td></tr></table></figure><h2 id="clone-ä¸‹æ¥æŒ‡å®šçš„å•ä¸€åˆ†æ”¯"><a href="#clone-ä¸‹æ¥æŒ‡å®šçš„å•ä¸€åˆ†æ”¯" class="headerlink" title="clone ä¸‹æ¥æŒ‡å®šçš„å•ä¸€åˆ†æ”¯"></a>clone ä¸‹æ¥æŒ‡å®šçš„å•ä¸€åˆ†æ”¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b &lt;branch-name&gt; --single-branch https://github.com/user/repo.git</span><br></pre></td></tr></table></figure><h2 id="clone-æœ€æ–°ä¸€æ¬¡æäº¤"><a href="#clone-æœ€æ–°ä¸€æ¬¡æäº¤" class="headerlink" title="clone æœ€æ–°ä¸€æ¬¡æäº¤"></a>clone æœ€æ–°ä¸€æ¬¡æäº¤</h2><p>åªä¼š clone æœ€è¿‘ä¸€æ¬¡æäº¤ï¼Œå°†å‡å°‘ clone æ—¶é—´</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/user/repo.git</span><br></pre></td></tr></table></figure><h2 id="å¿½ç•¥æŸä¸ªæ–‡ä»¶çš„æ”¹åŠ¨"><a href="#å¿½ç•¥æŸä¸ªæ–‡ä»¶çš„æ”¹åŠ¨" class="headerlink" title="å¿½ç•¥æŸä¸ªæ–‡ä»¶çš„æ”¹åŠ¨"></a>å¿½ç•¥æŸä¸ªæ–‡ä»¶çš„æ”¹åŠ¨</h2><p>å…³é—­ track æŒ‡å®šæ–‡ä»¶çš„æ”¹åŠ¨ï¼Œä¹Ÿå°±æ˜¯ Git å°†ä¸ä¼šåœ¨è®°å½•è¿™ä¸ªæ–‡ä»¶çš„æ”¹åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-index --assume-unchanged path/to/file</span><br></pre></td></tr></table></figure><p>æ¢å¤ track æŒ‡å®šæ–‡ä»¶çš„æ”¹åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-index --no-assume-unchanged path/to/file</span><br></pre></td></tr></table></figure><h2 id="å¿½ç•¥æ–‡ä»¶çš„æƒé™å˜åŒ–"><a href="#å¿½ç•¥æ–‡ä»¶çš„æƒé™å˜åŒ–" class="headerlink" title="å¿½ç•¥æ–‡ä»¶çš„æƒé™å˜åŒ–"></a>å¿½ç•¥æ–‡ä»¶çš„æƒé™å˜åŒ–</h2><p>ä¸å†å°†æ–‡ä»¶çš„æƒé™å˜åŒ–è§†ä½œæ”¹åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config core.fileMode <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="ä»¥æœ€åæäº¤çš„é¡ºåºåˆ—å‡ºæ‰€æœ‰-Git-åˆ†æ”¯"><a href="#ä»¥æœ€åæäº¤çš„é¡ºåºåˆ—å‡ºæ‰€æœ‰-Git-åˆ†æ”¯" class="headerlink" title="ä»¥æœ€åæäº¤çš„é¡ºåºåˆ—å‡ºæ‰€æœ‰ Git åˆ†æ”¯"></a>ä»¥æœ€åæäº¤çš„é¡ºåºåˆ—å‡ºæ‰€æœ‰ Git åˆ†æ”¯</h2><p>æœ€æ–°çš„æ”¾åœ¨æœ€ä¸Šé¢</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git for-each-ref --sort=-committerdate --format=<span class="string">&#x27;%(refname:short)&#x27;</span> refs/heads/</span><br></pre></td></tr></table></figure><h2 id="åœ¨-commit-log-ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹"><a href="#åœ¨-commit-log-ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹" class="headerlink" title="åœ¨ commit log ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹"></a>åœ¨ commit log ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹</h2><p>é€šè¿‡ grep æŸ¥æ‰¾ï¼Œgiven-textï¼šæ‰€éœ€è¦æŸ¥æ‰¾çš„å­—æ®µ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --all --grep=<span class="string">&#x27;&lt;given-text&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æŠŠæš‚å­˜åŒºçš„æŒ‡å®š-file-æ”¾åˆ°å·¥ä½œåŒºä¸­"><a href="#æŠŠæš‚å­˜åŒºçš„æŒ‡å®š-file-æ”¾åˆ°å·¥ä½œåŒºä¸­" class="headerlink" title="æŠŠæš‚å­˜åŒºçš„æŒ‡å®š file æ”¾åˆ°å·¥ä½œåŒºä¸­"></a>æŠŠæš‚å­˜åŒºçš„æŒ‡å®š file æ”¾åˆ°å·¥ä½œåŒºä¸­</h2><p>ä¸æ·»åŠ å‚æ•°ï¼Œé»˜è®¤æ˜¯ <code>-mixed</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset &lt;file-name&gt;</span><br></pre></td></tr></table></figure><h2 id="å¼ºåˆ¶æ¨é€"><a href="#å¼ºåˆ¶æ¨é€" class="headerlink" title="å¼ºåˆ¶æ¨é€"></a>å¼ºåˆ¶æ¨é€</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f &lt;remote-name&gt; &lt;branch-name&gt;</span><br></pre></td></tr></table></figure><h2 id="git-é…ç½®-http-å’Œ-socks-ä»£ç†"><a href="#git-é…ç½®-http-å’Œ-socks-ä»£ç†" class="headerlink" title="git é…ç½® http å’Œ socks ä»£ç†"></a>git é…ç½® http å’Œ socks ä»£ç†</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global https.proxy <span class="string">&#x27;http://127.0.0.1:8001&#x27;</span>   <span class="comment"># é€‚ç”¨äº privoxy å°† socks åè®®è½¬ä¸º http åè®®çš„ http ç«¯å£</span></span><br><span class="line">git config --global http.proxy <span class="string">&#x27;http://127.0.0.1:8001&#x27;</span></span><br><span class="line">git config --global socks.proxy <span class="string">&quot;127.0.0.1:1080&quot;</span></span><br></pre></td></tr></table></figure><h2 id="git-é…ç½®-ssh-ä»£ç†"><a href="#git-é…ç½®-ssh-ä»£ç†" class="headerlink" title="git é…ç½® ssh ä»£ç†"></a>git é…ç½® ssh ä»£ç†</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.ssh/config</span><br><span class="line">Host gitlab.com</span><br><span class="line">ProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p    <span class="comment"># ç›´æ¥ä½¿ç”¨ shadowsocks æä¾›çš„ socks5 ä»£ç†ç«¯å£</span></span><br><span class="line"></span><br><span class="line">Host github.com</span><br><span class="line">ProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p    </span><br></pre></td></tr></table></figure><h2 id="è„‘å›¾"><a href="#è„‘å›¾" class="headerlink" title="è„‘å›¾"></a>è„‘å›¾</h2><p><img data-src="https://cdn.jonty.top/img/git.png"></p><h2 id="ä¼˜é›…çš„Commitä¿¡æ¯"><a href="#ä¼˜é›…çš„Commitä¿¡æ¯" class="headerlink" title="ä¼˜é›…çš„Commitä¿¡æ¯"></a>ä¼˜é›…çš„Commitä¿¡æ¯</h2><p>ä½¿ç”¨<a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines">Angularå›¢é˜Ÿæäº¤è§„èŒƒ</a></p><p>ä¸»è¦æœ‰ä»¥ä¸‹ç»„æˆ</p><ul><li>æ ‡é¢˜è¡Œ: å¿…å¡«, æè¿°ä¸»è¦ä¿®æ”¹ç±»å‹å’Œå†…å®¹</li><li>ä¸»é¢˜å†…å®¹: æè¿°ä¸ºä»€ä¹ˆä¿®æ”¹, åšäº†ä»€ä¹ˆæ ·çš„ä¿®æ”¹, ä»¥åŠå¼€å‘çš„æ€è·¯ç­‰ç­‰</li><li>é¡µè„šæ³¨é‡Š: æ”¾ Breaking Changes æˆ– Closed Issues</li></ul><p>å¸¸ç”¨çš„ä¿®æ”¹é¡¹</p><ul><li>type: commit çš„ç±»å‹</li><li>feat: æ–°ç‰¹æ€§</li><li>fix: ä¿®æ”¹é—®é¢˜</li><li>refactor: ä»£ç é‡æ„</li><li>docs: æ–‡æ¡£ä¿®æ”¹</li><li>style: ä»£ç æ ¼å¼ä¿®æ”¹, æ³¨æ„ä¸æ˜¯ css ä¿®æ”¹</li><li>test: æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹</li><li>chore: å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ„å»ºæµç¨‹, ä¾èµ–ç®¡ç†.</li><li>scope: commit å½±å“çš„èŒƒå›´, æ¯”å¦‚: route, component, utils, buildâ€¦</li><li>subject: commit çš„æ¦‚è¿°</li><li>body: commit å…·ä½“ä¿®æ”¹å†…å®¹, å¯ä»¥åˆ†ä¸ºå¤šè¡Œ</li><li>footer: ä¸€äº›å¤‡æ³¨, é€šå¸¸æ˜¯ BREAKING CHANGE æˆ–ä¿®å¤çš„ bug çš„é“¾æ¥.</li></ul><h2 id="commitå·¥å…·"><a href="#commitå·¥å…·" class="headerlink" title="commitå·¥å…·"></a>commitå·¥å…·</h2><p>å¯ä»¥ä½¿ç”¨<a href="https://github.com/commitizen/cz-cli">cz-cli</a>å·¥å…·ä»£æ›¿ <code>git commit</code></p><p>å…¨å±€å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g commitizen cz-conventional-changelog</span><br><span class="line"></span><br><span class="line">echo &#x27;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&#x27; &gt; ~/.czrc</span><br></pre></td></tr></table></figure><p>å…¨å±€å®‰è£…åä½¿ç”¨ <code>git cz</code> ä»£æ›¿ <code>git commit</code>å°±å¯ä»¥äº†,å¦‚ä¸‹å›¾</p><p><img data-src="https://cdn.jonty.top/img/gitcz.png"></p><h2 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h2><p><a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width: 0" data-src="https://licensebuttons.net/l/by-nc-nd/4.0/88x31.png"></a><br>æœ¬ä½œå“é‡‡ç”¨ <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è¿›è¡Œè®¸å¯ã€‚</p><p><strong><a href="#%E7%9B%AE%E5%BD%95">â¬† è¿”å›é¡¶éƒ¨</a></strong></p>]]></content>
    
    
    <summary type="html">å¸¸ç”¨çš„ Git å‘½ä»¤å’Œä¸€äº›å°æŠ€å·§</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="Share" scheme="https://jonty.top/tags/Share/"/>
    
    <category term="Git" scheme="https://jonty.top/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>ã€Blazor-07ã€‘- Blazorå­¦ç”Ÿåˆ—è¡¨ç»„ä»¶</title>
    <link href="https://jonty.top/2023/04/26/blazor-component/"/>
    <id>https://jonty.top/2023/04/26/blazor-component/</id>
    <published>2023-04-26T02:59:52.000Z</published>
    <updated>2023-04-26T03:10:32.130Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ­¤èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªBlazorç»„ä»¶â€”<strong>StudentList</strong>ç»„ä»¶ã€‚</p><p>ç»„ä»¶ç”¨äºå±•ç¤ºå­¦ç”Ÿåˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://cdn.jonty.top/img/202204241334464.png" alt="image-20220424133441270"></p><h2 id="StudentList-razor"><a href="#StudentList-razor" class="headerlink" title="StudentList.razor"></a>StudentList.razor</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/students&quot;</span><br><span class="line">@inherits StudentListListBase</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>StudentList<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    @foreach (var student in Students)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card m-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>@student.FirstName @student.LastName<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;card-img-top imageThumbnail&quot;</span> <span class="attr">src</span>=<span class="string">&quot;@student.PhotoPath&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-footer text-center&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>æŸ¥çœ‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-danger m-1&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ä»£ç è¯´æ˜"><a href="#ä»£ç è¯´æ˜" class="headerlink" title="ä»£ç è¯´æ˜"></a>ä»£ç è¯´æ˜</h2><h3 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># æŒ‡å®šå½“æˆ‘ä»¬å¯¼èˆªåˆ°æ­¤è·¯å¾„æ—¶æ˜¾ç¤ºæ­¤ç»„ä»¶</span></span><br><span class="line">@page <span class="string">&quot;/&quot;</span> </span><br><span class="line">    </span><br><span class="line"><span class="meta"># å®šä¹‰æ­¤ç»„ä»¶çš„åŸºç±»</span></span><br><span class="line">@inherits SutdentListBase </span><br></pre></td></tr></table></figure><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><p>ä½¿ç”¨ Bootstrap Card æ˜¾ç¤ºï¼Œ ä¸ºäº†éå†å­¦ç”Ÿåˆ—è¡¨ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code> foreach</code> å¾ªç¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    @foreach (var student in Students)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card m-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>@student.FirstName @student.LastName<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;card-img-top imageThumbnail&quot;</span> <span class="attr">src</span>=<span class="string">&quot;@student.PhotoPath&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-footer text-center&quot;</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>æŸ¥çœ‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary m-1&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-danger m-1&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="StudentListBase"><a href="#StudentListBase" class="headerlink" title="StudentListBase"></a>StudentListBase</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Components;</span><br><span class="line"><span class="keyword">using</span> StudentManagement.Models;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">StudentManagement.Web.Pages</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentListListBase</span>: <span class="title">ComponentBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> IEnumerable&lt;Student&gt; Students &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">OnInitializedAsync</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadStudents();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">base</span>.OnInitializedAsync();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadStudents</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> s1 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">1</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;John&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Hastings&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;David@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1980</span>, <span class="number">10</span>, <span class="number">5</span>),</span><br><span class="line">            Gender = Gender.Male,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123;ClassId = <span class="number">1</span>, ClassName = <span class="string">&quot;è®¡ç®—æœºç§‘å­¦&quot;</span>&#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/john.png&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> s2 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">2</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;Sam&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Galloway&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;Sam@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1981</span>, <span class="number">12</span>, <span class="number">22</span>),</span><br><span class="line">            Gender = Gender.Male,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123; ClassId = <span class="number">2</span>, ClassName = <span class="string">&quot;è½¯ä»¶å·¥ç¨‹&quot;</span> &#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/sam.jpg&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> s3 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">3</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;Mary&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;mary@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1979</span>, <span class="number">11</span>, <span class="number">11</span>),</span><br><span class="line">            Gender = Gender.Female,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123; ClassId = <span class="number">3</span>, ClassName = <span class="string">&quot;é€šä¿¡å·¥ç¨‹&quot;</span> &#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/mary.png&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> s4 = <span class="keyword">new</span> Student()</span><br><span class="line">        &#123;</span><br><span class="line">            StudentId = <span class="number">4</span>,</span><br><span class="line">            FirstName = <span class="string">&quot;Sara&quot;</span>,</span><br><span class="line">            LastName = <span class="string">&quot;Longway&quot;</span>,</span><br><span class="line">            Email = <span class="string">&quot;sara@qq.com&quot;</span>,</span><br><span class="line">            DateOfBrith = <span class="keyword">new</span> DateTime(<span class="number">1982</span>, <span class="number">9</span>, <span class="number">23</span>),</span><br><span class="line">            Gender = Gender.Female,</span><br><span class="line">            StudentClass = <span class="keyword">new</span> StudentClass &#123; ClassId = <span class="number">3</span>, ClassName = <span class="string">&quot;ç§»åŠ¨äº’è”ç½‘&quot;</span> &#125;,</span><br><span class="line">            PhotoPath = <span class="string">&quot;images/sara.png&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Students = <span class="keyword">new</span> List&lt;Student&gt; &#123;s1, s2, s3, s4&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Blazor ç»„ä»¶æœ‰å¤šç§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚<strong>OnInitializedAsync</strong>æ˜¯è¾ƒå¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚æˆ‘ä»¬é‡å†™æ­¤æ–¹æ³•ç”¨æ¥åŠ è½½å­¦ç”Ÿæ•°æ®ã€‚ </p><p>ç›®å‰ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶ä¸­<strong>ç¡¬ç¼–ç </strong>äº†å­¦ç”Ÿæ•°æ®ã€‚éšç€æˆ‘ä»¬è¯¾ç¨‹çš„æ·±å…¥ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•é€šè¿‡è°ƒç”¨ RESTful APIä»æ•°æ®åº“ä¸­åŠ è½½è¿™äº›æ•°æ®ã€‚</p><p><strong>MainLayout.razor</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@inherits LayoutComponentBase</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>S<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">NavMenu</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">&quot;content px-4&quot;</span>&gt;</span></span><br><span class="line">            @Body</span><br><span class="line">        <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¹¶åœ¨<code>Site.css</code>ä¸­æ·»åŠ å¤´åƒçš„æ ·å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Site<span class="selector-class">.css</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.imageThumbnail</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—ç¿»è¯‘07- Blazorå­¦ç”Ÿåˆ—è¡¨ç»„ä»¶</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>ã€Blazor-06ã€‘- Blazoræ¨¡å‹ç±»</title>
    <link href="https://jonty.top/2023/04/26/blazor-model-classes/"/>
    <id>https://jonty.top/2023/04/26/blazor-model-classes/</id>
    <published>2023-04-26T02:49:16.000Z</published>
    <updated>2023-04-26T02:52:22.636Z</updated>
    
    <content type="html"><![CDATA[<p>æŒ‰ç…§æ•™ç¨‹è¿›åº¦ï¼Œæˆ‘ä»¬ä¼šå¼€å‘ä¸€ä¸ªå‘˜å·¥ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥å®ç°åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤å‘˜å·¥ç­‰æ“ä½œã€‚</p><p>ä»¥ä¸‹æ˜¯éœ€è¦çš„æ¨¡å‹ç±»ï¼š</p><ol><li>Student</li><li>ClassName</li><li>Gender</li></ol><h2 id="åˆ›å»ºæ¨¡å‹ç±»"><a href="#åˆ›å»ºæ¨¡å‹ç±»" class="headerlink" title="åˆ›å»ºæ¨¡å‹ç±»"></a>åˆ›å»ºæ¨¡å‹ç±»</h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„.NETç±»åº“é¡¹ç›®ï¼Œå°†é¡¹ç›®å‘½åä¸ºStudentManagement.Modelsã€‚å°†è§£å†³æ–¹æ¡ˆå‘½åä¸ºBlazorTutorialã€‚</p><p><img data-src="https://cdn.jonty.top/img/202204191015829.png" alt="image-20220419101511752"></p><p>å¹¶åˆ›å»ºå¯¹åº”çš„æ¨¡å‹ç±»</p><p><strong>Student.cs</strong>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> å­¦ç”Ÿ</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> å­¦ç”ŸId</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> StudentId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> å§“</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> FirstName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> å</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> LastName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> é‚®ç®±</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Email &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ç”Ÿæ—¥</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> DateTime DateOfBrith &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> æ€§åˆ«</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> Gender Gender &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ç­çº§</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> StudentClass StudentClass &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> å¤´åƒåœ°å€</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> PhotoPath &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>StudentName.cs</strong>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> ç­çº§</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ç­çº§Id</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> ClassId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ç­çº§åç§°</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ClassName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Gender.cs</strong>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> Gender</span><br><span class="line">&#123;</span><br><span class="line">    Male,</span><br><span class="line">    Female,</span><br><span class="line">    Other</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€‰æ‹©åˆ›å»ºç±»åº“é¡¹ç›®ï¼Œå¯ä»¥åœ¨ä¸åŒçš„é¡¹ç›®ä¸­<strong>é‡ç”¨</strong>è¿™äº›æ¨¡å‹</p><p><img data-src="https://cdn.jonty.top/img/202204191439071.png" alt="image-20220419143947010"></p><p>æˆ‘ä»¬ä¼šåœ¨<strong>Blazor Web</strong>åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›æ¨¡å‹ï¼Œéšç€è¯¾ç¨‹çš„æ¨è¿›ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºASP.NET Core RESTful APIï¼Œè¿™äº›æœåŠ¡ä¼šæä¾›<strong>Blazor</strong> é¡¹ç›®æ‰€éœ€è¦çš„æ•°æ®ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬çš„RESTful APIé¡¹ç›®ä¸­ä¹Ÿä¼šä½¿ç”¨è¿™äº›æ¨¡å‹ç±»ã€‚</p><h2 id="åˆ›å»ºBlazor-Webé¡¹ç›®"><a href="#åˆ›å»ºBlazor-Webé¡¹ç›®" class="headerlink" title="åˆ›å»ºBlazor Webé¡¹ç›®"></a>åˆ›å»ºBlazor Webé¡¹ç›®</h2><p>æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Blazor Server</code>é¡¹ç›®ï¼Œå°†å…¶å‘½åä¸º<code>StudentManagement.Web</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå…è®¸æˆ‘ä»¬å¯¹å‘˜å·¥ä¿¡æ¯è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œçš„Webåº”ç”¨ç¨‹åºã€‚</p><p><code>StudentManagement.Web</code>ä¾èµ–æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„æ¨¡å‹ç±»åº“ï¼Œæˆ‘ä»¬åœ¨<code>StudentManagement.Web</code>ä¸­æ·»åŠ å¯¹<code>StudentManagement.Models</code>é¡¹ç›®çš„å¼•ç”¨ï¼Œå¹¶å°†<code>StudentManagement.Web</code>è®¾ä¸º<strong>å¯åŠ¨é¡¹ç›®</strong></p><p><img data-src="https://cdn.jonty.top/img/202204191440212.png" alt="image-20220419144054166"></p><p>ä»<code>StudentManagement.Web</code>é¡¹ç›®ä¸­åˆ é™¤ä»¥ä¸‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</p><ul><li>Dataæ–‡ä»¶å¤¹</li><li>Pages/Counter.razor</li><li>Pages/FetchData.razor</li><li>Pages/index.razor</li><li>Shared/SurveyPrompt.razor</li></ul><p>æ›´æ”¹<strong>Program.cs</strong>ï¼š</p><p>åˆ é™¤ä»¥ä¸‹å¼•ç”¨</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StudentManagement.Web.Data;</span><br></pre></td></tr></table></figure><p>åˆ é™¤ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddSingleton&lt;WeatherForecastService&gt;();</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è·Ÿç€æ­¥éª¤æ“ä½œï¼Œç°åœ¨çš„é¡¹ç›®ç›®å½•åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><p><img data-src="https://cdn.jonty.top/img/202204191444223.png" alt="image-20220419144412162"></p><h2 id="åˆ›å»ºStudentListç»„ä»¶"><a href="#åˆ›å»ºStudentListç»„ä»¶" class="headerlink" title="åˆ›å»ºStudentListç»„ä»¶"></a>åˆ›å»ºStudentListç»„ä»¶</h2><p>åœ¨<code>StudentManagement.Web</code>é¡¹ç›®ä¸­ï¼Œå³é”®å•å‡»<code>Pages</code>æ–‡ä»¶å¤¹æ·»åŠ ä¸€ä¸ªæ–°çš„<strong>razor</strong>ç»„ä»¶ã€‚å‘½åä¸º<code>StudentList.razor</code>ç»„ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ˜¾ç¤ºå‘˜å·¥åˆ—è¡¨ã€‚</p><p>åœ¨<code>StudentList.razor</code>ç»„ä»¶ä¸­åŒ…å«ä»¥ä¸‹<code>@page</code>æŒ‡ä»¤ï¼Œç”¨æ¥å‘Šè¯‰Blazoråœ¨æˆ‘ä»¬å¯¼èˆªåˆ°<code>/student</code>è·¯å¾„æ—¶å±•ç¤ºæ­¤ç»„ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/student&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>StudentList<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹NvaMenu-razorç»„ä»¶"><a href="#æ›´æ”¹NvaMenu-razorç»„ä»¶" class="headerlink" title="æ›´æ”¹NvaMenu.razorç»„ä»¶"></a>æ›´æ”¹NvaMenu.razorç»„ä»¶</h2><p><strong>åˆ é™¤</strong>ä»¥ä¸‹2ä¸ªå¯¼èˆªæ èœå•é¡¹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item px-3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;oi oi-plus&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> Counter</span><br><span class="line">    <span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item px-3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;fetchdata&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;oi oi-list-rich&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> Fetch data</span><br><span class="line">    <span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—ç¿»è¯‘06-Blazoræ¨¡å‹ç±»</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>ã€Blazor-05ã€‘-æ‹†åˆ†Razorç»„ä»¶</title>
    <link href="https://jonty.top/2023/04/26/split-razor-component/"/>
    <id>https://jonty.top/2023/04/26/split-razor-component/</id>
    <published>2023-04-26T02:44:25.000Z</published>
    <updated>2023-04-26T02:45:54.298Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰2ç§æ–¹æ³•å¯ä»¥å°†Razorç»„ä»¶HTMLå’ŒC#ä»£ç æ‹†åˆ†ä¸ºå„è‡ªç‹¬ç«‹çš„æ–‡ä»¶ã€‚</p><ol><li>éƒ¨åˆ†ç±»æ–¹æ³•ï¼ˆpartial classï¼‰</li><li>åŸºç±»æ–¹æ³•ï¼ˆbase classï¼‰</li></ol><h2 id="å•æ–‡ä»¶"><a href="#å•æ–‡ä»¶" class="headerlink" title="å•æ–‡ä»¶"></a>å•æ–‡ä»¶</h2><p>HTMLå’ŒC#ä»£ç éƒ½åœ¨<strong>ä¸€ä¸ªæ–‡ä»¶</strong>ä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// Counter.razor</span><br><span class="line"></span><br><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private int currentCount = 0;</span><br><span class="line"></span><br><span class="line">    private void IncrementCount()</span><br><span class="line">    &#123;</span><br><span class="line">        currentCount++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éƒ¨åˆ†ç±»æ–‡ä»¶"><a href="#éƒ¨åˆ†ç±»æ–‡ä»¶" class="headerlink" title="éƒ¨åˆ†ç±»æ–‡ä»¶"></a>éƒ¨åˆ†ç±»æ–‡ä»¶</h2><p>HTMLä¿ç•™åœ¨<code>Counter.razor</code>æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Counter.razor</span><br><span class="line"></span><br><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘ç»„ä»¶æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªä¸ç»„ä»¶æ–‡ä»¶åŒåçš„ç±»ã€‚æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª<code>Counter.razor.cs</code>çš„ç±»æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«<code>@code</code>ä¸­çš„ä»£ç </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Counter.razor.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Counter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> currentCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">IncrementCount</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        currentCount++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸºç±»æ–¹æ³•"><a href="#åŸºç±»æ–¹æ³•" class="headerlink" title="åŸºç±»æ–¹æ³•"></a>åŸºç±»æ–¹æ³•</h2><p>å’Œéƒ¨åˆ†ç±»ä¸€æ ·ï¼Œä½¿ç”¨åŸºç±»æ–¹æ³•HTMLä¾æ—§ä¿ç•™åœ¨<code>Counter.razor</code>æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Counter.razor</span><br><span class="line"></span><br><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æŠŠC#ä»£ç ç§»åŠ¨åˆ°å•ç‹¬çš„ç±»<code>CounterBase</code>ä¸­ï¼Œä½ å¯ä»¥å°†ç±»åå‘½åä¸ºä»»ä½•åç§°ï¼ŒæŒ‰ç…§çº¦å®šåº”è¯¥æ˜¯ç»„ä»¶åç§°+Baseåç¼€</p><p>åœ¨ç¤ºä¾‹ä¸­ï¼Œç»„ä»¶åç§°ä¸º<code>Counter</code>ï¼Œæ‰€ä»¥åŸºç±»å‘½åä¸º<code>CounterBase</code>ï¼Œç»§æ‰¿è‡ªå†…ç½®çš„<code>ComponentBase</code>ç±»ã€‚æ­¤ç±»ä½äºMicrosoft.AspNetCore.Componentså‘½åç©ºé—´ä¸­ã€‚</p><p>æœ€åï¼Œåœ¨Counter.razoræ–‡ä»¶ä¸­ä¸è¦å¿˜è®°åŒ…å«ä»¥ä¸‹ç»§æ‰¿æŒ‡ä»¤ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@inherits CounterBase</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line">@inherits CounterBase</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">role</span>=<span class="string">&quot;status&quot;</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—ç¿»è¯‘05-æ‹†åˆ†Razorç»„ä»¶</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>Abpé›†æˆShardingCoreåˆ†è¡¨</title>
    <link href="https://jonty.top/2023/04/21/aspnetboilerplate-shardingcore/"/>
    <id>https://jonty.top/2023/04/21/aspnetboilerplate-shardingcore/</id>
    <published>2023-04-21T05:58:04.000Z</published>
    <updated>2023-04-21T06:01:27.521Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ShardingCoreå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://xuejmnet.github.io/sharding-core-doc/">ShardingCoreæ–‡æ¡£ (xuejmnet.github.io)</a></p></blockquote><h2 id="è°ƒæ•´EFCore-ShardingCore"><a href="#è°ƒæ•´EFCore-ShardingCore" class="headerlink" title="è°ƒæ•´EFCore-ShardingCore"></a>è°ƒæ•´EFCore-ShardingCore</h2><p>ä»¥ä¸‹æ“ä½œæ­¥éª¤å‡ä»¥<code>FoundationTemplate</code>æ¨¡æ¿é¡¹ç›®åšæ¼”ç¤ºï¼Œå®é™…æ“ä½œè¯·æ ¹æ®é¡¹ç›®è°ƒæ•´</p><h3 id="Step1ï¼šè°ƒæ•´DbContext"><a href="#Step1ï¼šè°ƒæ•´DbContext" class="headerlink" title="Step1ï¼šè°ƒæ•´DbContext"></a>Step1ï¼šè°ƒæ•´DbContext</h3><p>å°†DbContexté›†æˆçš„åŸºç±»ç”±<code>GCTSharedDbContext</code>è°ƒæ•´ä¸º<code>GCTSharedShardingCoreDbContext</code></p><p><strong>GCTSharedShardingCoreDbContext</strong>ï¼šå®ç°ShardingCoreåˆ†åº“åˆ†è¡¨æ“ä½œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FoundationTemplateDbContext</span> : <span class="title">GCTSharedShardingCoreDbContext</span>&lt;<span class="title">FoundationTemplateDbContext</span>&gt;&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="Step2ï¼šè°ƒæ•´æ¨¡å—ç±»"><a href="#Step2ï¼šè°ƒæ•´æ¨¡å—ç±»" class="headerlink" title="Step2ï¼šè°ƒæ•´æ¨¡å—ç±»"></a>Step2ï¼šè°ƒæ•´æ¨¡å—ç±»</h3><p>è°ƒæ•´<code>EntityFrameworkCoreModule</code>æ¨¡å—ç±»æ³¨å†Œï¼Œ<strong>å–æ¶ˆ</strong>é»˜è®¤çš„<code>DbContext</code>æ³¨å†Œï¼Œå¦‚ä¸‹</p><blockquote><p>å–æ¶ˆé»˜è®¤çš„DbContextæ³¨å†Œï¼Œå°†ä»¥ä¸‹ä»£ç æ³¨é‡Š</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PreInitialize</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="comment">// æ³¨å†Œdbcontext</span></span><br><span class="line">    <span class="comment">/*if (!FoundationTemplateConfigs.Database.SkipDbContextRegistration)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        Configuration.Modules.AbpEfCore()</span></span><br><span class="line"><span class="comment">            // Configuration.Modules.L52AbpEfCore()</span></span><br><span class="line"><span class="comment">            .AddDbContext&lt;FoundationTemplateDbContext&gt;(options =&gt;</span></span><br><span class="line"><span class="comment">            &#123;</span></span><br><span class="line"><span class="comment">                if (options.ExistingConnection != null)</span></span><br><span class="line"><span class="comment">                &#123;</span></span><br><span class="line"><span class="comment">                    FoundationTemplateDbContextConfigurer.Configure(</span></span><br><span class="line"><span class="comment">                        options.DbContextOptions,</span></span><br><span class="line"><span class="comment">                        options.ExistingConnection</span></span><br><span class="line"><span class="comment">                    );</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                else</span></span><br><span class="line"><span class="comment">                &#123;</span></span><br><span class="line"><span class="comment">                    FoundationTemplateDbContextConfigurer.Configure(</span></span><br><span class="line"><span class="comment">                        options.DbContextOptions,</span></span><br><span class="line"><span class="comment">                        options.ConnectionString</span></span><br><span class="line"><span class="comment">                    );</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Step3ï¼šæ–‡ä»¶è°ƒæ•´"><a href="#Step3ï¼šæ–‡ä»¶è°ƒæ•´" class="headerlink" title="Step3ï¼šæ–‡ä»¶è°ƒæ•´"></a>Step3ï¼šæ–‡ä»¶è°ƒæ•´</h3><p>åœ¨<code>EntityFrameworkCore</code>é¡¹ç›® â€“&gt; åˆ›å»º<code>ShardingCore</code>æ–‡ä»¶å¤¹</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--- ShardingCore</span><br><span class="line">  --- Routes  <span class="meta"># ç”¨äºå­˜æ”¾è·¯ç”±é…ç½®ç±» ï¼ˆæˆ–è€…å­˜æ”¾åˆ°Coreå±‚ï¼Œä¹Ÿå°±æ˜¯å„è‡ªæ¨¡å—ç›®å½•ï¼‰</span></span><br></pre></td></tr></table></figure><h4 id="ShardingCoreExtensions"><a href="#ShardingCoreExtensions" class="headerlink" title="ShardingCoreExtensions"></a>ShardingCoreExtensions</h4><p>åˆ›å»ºæ³¨å†ŒShardingCoreæœåŠ¡æ‰©å±•æ–¹æ³•</p><p>æ›´å¤šé…ç½®è¯·å‚è€ƒï¼š</p><p><a href="https://xuejm.gitee.io/sharding-core-doc/guide-upgrade-5-6/#%E7%8E%B0%E5%9C%A8%E7%9A%84startup">https://xuejm.gitee.io/sharding-core-doc/guide-upgrade-5-6/#%E7%8E%B0%E5%9C%A8%E7%9A%84startup</a></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCore;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCore.Routes;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Migrations;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> ShardingCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCore</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FoundationTemplateShardingCoreExtensions</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ³¨å†ŒShardingCoreæœåŠ¡.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> é…ç½®è¯¦æƒ…è§ï¼š https://xuejm.gitee.io/sharding-core-doc/guide-upgrade-5-6/#%E7%8E%B0%E5%9C%A8%E7%9A%84startup</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;services&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;dataSourceName&quot;&gt;</span>æ•°æ®æºåç§°<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;connectionString&quot;&gt;</span>è¿æ¥å­—ç¬¦ä¸²<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IServiceCollection <span class="title">ConfigureShardingCore</span>(<span class="params"><span class="keyword">this</span> IServiceCollection services, <span class="built_in">string</span> dataSourceName,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="built_in">string</span> connectionString</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            services.AddShardingDbContext&lt;FoundationTemplateDbContext&gt;()</span><br><span class="line">                .UseRouteConfig((sp, op) =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// ========= æ³¨å†Œåˆ†è¡¨è·¯ç”± =========</span></span><br><span class="line">                    op.AddShardingTableRoute&lt;OrderVirtualTableRoute&gt;();</span><br><span class="line">                    op.AddShardingTableRoute&lt;SysUserVirtualTableRoute&gt;();</span><br><span class="line">                  </span><br><span class="line">                &#125;).UseConfig(op =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// å¦‚ä½•é€šè¿‡å­—ç¬¦ä¸²æŸ¥è¯¢åˆ›å»ºDbContext</span></span><br><span class="line">                    op.UseShardingQuery((connStr, build) =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        FoundationTemplateDbContextConfigurer.Configure(build, connStr);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">// å¦‚ä½•é€šè¿‡äº‹åŠ¡åˆ›å»ºDbContext</span></span><br><span class="line">                    op.UseShardingTransaction((conn, build) =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        FoundationTemplateDbContextConfigurer.Configure(build, conn);</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ·»åŠ é»˜è®¤æ•°æ®æº</span></span><br><span class="line">                    op.AddDefaultDataSource(dataSourceName, connectionString);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ===å¦‚æœéœ€è¦è¿ç§»code-firstå¿…é¡»è¦è‡ªè¡Œå¤„ç†==</span></span><br><span class="line">                    op.UseShardingMigrationConfigure(conf =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        conf.ReplaceService&lt;IMigrationsSqlGenerator,</span><br><span class="line">                            ShardingSqlServerMigrationsSqlGenerator&lt;FoundationTemplateDbContext&gt;&gt;();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;)</span><br><span class="line">                .AddShardingCore();</span><br><span class="line">            <span class="keyword">return</span> services;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MigrationsSqlGenerator"><a href="#MigrationsSqlGenerator" class="headerlink" title="MigrationsSqlGenerator"></a>MigrationsSqlGenerator</h4><p>åœ¨<strong>ShardingCore</strong>ç›®å½•ä¸‹åˆ›å»º<code>ShardingSqlServerMigrationsSqlGenerator.cs</code></p><p>ShardingCore - SqlServerçš„è¿ç§»Sqlç”Ÿæˆå·¥å…·ç±»ï¼Œé»˜è®¤ä½¿ç”¨SqlServer</p><blockquote><p>æ”¯æŒMySQLã€Oracleç­‰å…¶ä»–æ•°æ®åº“</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Metadata;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Migrations.Operations;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Migrations;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> ShardingCore.Core.RuntimeContexts;</span><br><span class="line"><span class="keyword">using</span> ShardingCore.Helpers;</span><br><span class="line"><span class="keyword">using</span> ShardingCore.Sharding.Abstractions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.EntityFrameworkCore</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ShardingSqlServerMigrationsSqlGenerator</span>&lt;<span class="title">TShardingDbContext</span>&gt; : <span class="title">SqlServerMigrationsSqlGenerator</span> <span class="keyword">where</span> <span class="title">TShardingDbContext</span> : <span class="title">GCTSharedShardingCoreDbContext</span>&lt;<span class="title">TShardingDbContext</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IShardingRuntimeContext _shardingRuntimeContext;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ShardingSqlServerMigrationsSqlGenerator</span>(<span class="params">MigrationsSqlGeneratorDependencies dependencies, IRelationalAnnotationProvider migrationsAnnotations, IShardingRuntimeContext shardingRuntimeContext</span>) : <span class="title">base</span>(<span class="params">dependencies, migrationsAnnotations</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _shardingRuntimeContext = shardingRuntimeContext;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Generate</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">            MigrationOperation operation,</span></span></span><br><span class="line"><span class="params"><span class="function">            IModel model,</span></span></span><br><span class="line"><span class="params"><span class="function">            MigrationCommandListBuilder builder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> oldCmds = builder.GetCommandList().ToList();</span><br><span class="line">            <span class="keyword">base</span>.Generate(operation, model, builder);</span><br><span class="line">            <span class="keyword">var</span> newCmds = builder.GetCommandList().ToList();</span><br><span class="line">            <span class="keyword">var</span> addCmds = newCmds.Where(x =&gt; !oldCmds.Contains(x)).ToList();</span><br><span class="line"></span><br><span class="line">            MigrationHelper.Generate(_shardingRuntimeContext, operation, builder, Dependencies.SqlGenerationHelper, addCmds);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DbContextConfigurer"><a href="#DbContextConfigurer" class="headerlink" title="DbContextConfigurer"></a>DbContextConfigurer</h4><p>è°ƒæ•´é»˜è®¤çš„DbContextæ³¨å†Œç±»ï¼Œç§»é™¤DbContexté™åˆ¶</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-- public static void Configure(DbContextOptionsBuilder builder, string connectionString)</span></span><br><span class="line"><span class="addition">++ public static void Configure(DbContextOptionsBuilder&lt;FoundationTemplateDbContext&gt; builder, string connectionString)</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´å¦‚ä¸‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FoundationTemplateDbContextConfigurer.cs</span></span><br><span class="line"><span class="keyword">using</span> System.Data.Common;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Logging;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.EntityFrameworkCore</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FoundationTemplateDbContextConfigurer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> ILoggerFactory MyLoggerFactory</span><br><span class="line">            = LoggerFactory.Create(builder =&gt; &#123; builder.AddConsole(); &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">DbContextOptionsBuilder builder, <span class="built_in">string</span> connectionString</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            builder.UseSqlServer(connectionString);</span><br><span class="line"></span><br><span class="line">            ConfigureLog(builder);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">DbContextOptionsBuilder builder, DbConnection connection</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            builder.UseSqlServer(connection);</span><br><span class="line"></span><br><span class="line">            ConfigureLog(builder);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> é…ç½®æ—¥å¿—,åªåœ¨Debugæ¨¡å¼ä¸‹ç”Ÿæ•ˆ</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;builder&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ConfigureLog</span>(<span class="params">DbContextOptionsBuilder builder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line">            builder.UseLoggerFactory(MyLoggerFactory);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DbContextFactory"><a href="#DbContextFactory" class="headerlink" title="DbContextFactory"></a>DbContextFactory</h4><p>è°ƒæ•´<code>DbContextFactory</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.Configuration;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.Helpers;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCore;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Design;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.EntityFrameworkCore</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* This class is needed to run &quot;dotnet ef ...&quot; commands from command line on development. Not used anywhere else */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FoundationTemplateDbContextFactory</span> : <span class="title">IDesignTimeDbContextFactory</span>&lt;<span class="title">FoundationTemplateDbContext</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> IServiceProvider _serviceProvider;</span><br><span class="line">        [<span class="meta">Obsolete(<span class="meta-string">&quot;Obsolete&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="title">FoundationTemplateDbContextFactory</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> basePath = FoundationTemplateWebContentDirectoryFinder.CalculateContentRootFolder();</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;å·¥ä½œç›®å½•ï¼š&quot;</span>);</span><br><span class="line">            Console.WriteLine(basePath);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> configuration = AppConfigurations.Get(basePath, <span class="string">&quot;Development&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> connectionString = configuration.ConnectionStringsDefault();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;è¿ç§»ä½¿ç”¨æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼š&quot;</span>);</span><br><span class="line">            Console.WriteLine(connectionString);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line">            services.ConfigureShardingCore(AppConsts.DefaultDataSourceName, connectionString);</span><br><span class="line">            _serviceProvider = services.BuildServiceProvider();</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="function"><span class="keyword">public</span> FoundationTemplateDbContext <span class="title">CreateDbContext</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _serviceProvider.GetService&lt;FoundationTemplateDbContext&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><p><img data-src="https://cdn.jonty.top/img/image-20221025143100094.png" alt="image-20221025143100094"></p><h2 id="æ³¨å†ŒShardingCore"><a href="#æ³¨å†ŒShardingCore" class="headerlink" title="æ³¨å†ŒShardingCore"></a>æ³¨å†ŒShardingCore</h2><h3 id="Step1ï¼šTemplate-Web-Host"><a href="#Step1ï¼šTemplate-Web-Host" class="headerlink" title="Step1ï¼šTemplate.Web.Host"></a>Step1ï¼šTemplate.Web.Host</h3><h4 id="æ³¨å†ŒShardingCoreæœåŠ¡"><a href="#æ³¨å†ŒShardingCoreæœåŠ¡" class="headerlink" title="æ³¨å†ŒShardingCoreæœåŠ¡"></a>æ³¨å†ŒShardingCoreæœåŠ¡</h4><h4 id="Startup-cs"><a href="#Startup-cs" class="headerlink" title="Startup.cs"></a>Startup.cs</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Startup.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCore;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IServiceProvider <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// health check ui</span></span><br><span class="line">    ConfigureHealthCheckService(services);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ShardingCore</span></span><br><span class="line">    services.ConfigureShardingCore(AppConsts.DefaultDataSourceName, Configuration.GetConnectionString(<span class="string">&quot;Default&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="comment">// åŸºæœ¬çš„ä¸­é—´ä»¶</span></span><br><span class="line">     UseBasic(app);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Hangfire</span></span><br><span class="line">     UseHangfire(app);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// ShardingCore</span></span><br><span class="line">     UseShardingCore(app);</span><br><span class="line">   </span><br><span class="line">     <span class="comment">// ... other code</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> å¯ç”¨ShardingCore</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;app&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UseShardingCore</span>(<span class="params">IApplicationBuilder app</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//å¯åŠ¨ShardingCoreåˆ›å»ºè¡¨ä»»åŠ¡(ä¸è°ƒç”¨ä¹Ÿå¯ä»¥ä½¿ç”¨ShardingCore)</span></span><br><span class="line">    <span class="comment">//ä¸è°ƒç”¨ä¼šå¯¼è‡´å®šæ—¶ä»»åŠ¡ä¸ä¼šå¼€å¯</span></span><br><span class="line">    app.ApplicationServices.UseAutoShardingCreate();</span><br><span class="line">    <span class="comment">//å¯åŠ¨è¿›è¡Œè¡¨è¡¥å¿(ä¸è°ƒç”¨ä¹Ÿå¯ä»¥ä½¿ç”¨ShardingCore) å¯åŠ¨åˆ›å»ºåˆ†è¡¨</span></span><br><span class="line">    <span class="comment">// app.ApplicationServices.UseAutoTryCompensateTable();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Step2ï¼šTemplate-Migrator"><a href="#Step2ï¼šTemplate-Migrator" class="headerlink" title="Step2ï¼šTemplate.Migrator"></a>Step2ï¼šTemplate.Migrator</h3><h4 id="æ³¨å†ŒShardingCoreæœåŠ¡-1"><a href="#æ³¨å†ŒShardingCoreæœåŠ¡-1" class="headerlink" title="æ³¨å†ŒShardingCoreæœåŠ¡"></a>æ³¨å†ŒShardingCoreæœåŠ¡</h4><h3 id="Startup-cs-1"><a href="#Startup-cs-1" class="headerlink" title="Startup.cs"></a>Startup.cs</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Startup.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCore;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigurationServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> basePath = AppContext.BaseDirectory;</span><br><span class="line">    <span class="keyword">var</span> configuration = AppConfigurations.Get(basePath, <span class="string">&quot;Development&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> connectionString = configuration.ConnectionStringsDefault();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// identity</span></span><br><span class="line">    services.AddAppIdentity();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ShardingCore</span></span><br><span class="line">    services.ConfigureShardingCore(AppConsts.DefaultDataSourceName, connectionString);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// type finder</span></span><br><span class="line">    services.Add52AbpTypeFinder((options) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// skip find</span></span><br><span class="line">        options.AddSkip&lt;FoundationDbContext&gt;();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†è¡¨ä½¿ç”¨æ¡ˆä¾‹"><a href="#åˆ†è¡¨ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="åˆ†è¡¨ä½¿ç”¨æ¡ˆä¾‹"></a>åˆ†è¡¨ä½¿ç”¨æ¡ˆä¾‹</h2><blockquote><p>å®˜æ–¹æ–‡æ¡£æ¡ˆä¾‹ï¼š<a href="https://xuejm.gitee.io/sharding-core-doc/sharding-table/init/#">åˆå§‹åŒ– | ShardingCoreæ–‡æ¡£ (gitee.io)</a></p></blockquote><p>åˆ›å»ºä¸€ä¸ªShardingCoreçš„Demoæ¼”ç¤ºåŠŸèƒ½ï¼Œé¦–å…ˆåœ¨<code>Template.Core</code>å±‚åˆ›å»º<code>ShardingCoreManagement</code>ç›®å½•</p><p>å…ˆæ‹Ÿå®šä¸€ä¸ªåœºæ™¯ç›®å‰æœ‰ç”¨æˆ·è¡¨<code>SysUser</code>å’Œè®¢å•è¡¨<code>Order</code>ï¼Œå†æ·»åŠ ä¸€ä¸ª<code>Setting</code>é…ç½®è¡¨</p><ul><li><p>SysUserç”¨æˆ·è¡¨æŒ‰ç”¨æˆ·Ageè¿›è¡Œå–æ¨¡åˆ†è¡¨</p></li><li><p>Orderè®¢å•è¡¨æŒ‰æ—¶é—´æœˆè¿›è¡Œåˆ†è¡¨</p></li><li><p>Settingé…ç½®è¡¨ä¸è¿›è¡Œåˆ†è¡¨</p></li></ul><h3 id="åˆ›å»ºå®ä½“"><a href="#åˆ›å»ºå®ä½“" class="headerlink" title="åˆ›å»ºå®ä½“"></a>åˆ›å»ºå®ä½“</h3><h4 id="Order-cs"><a href="#Order-cs" class="headerlink" title="Order.cs"></a>Order.cs</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Abp.Domain.Entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> è®¢å•è¡¨</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Order</span> : <span class="title">Entity</span>&lt;<span class="title">int</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Payer &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">long</span> Money &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Area &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> OrderStatusEnum OrderStatus &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DateTime CreationTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OrderStatusEnum-cs"><a href="#OrderStatusEnum-cs" class="headerlink" title="OrderStatusEnum.cs"></a>OrderStatusEnum.cs</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> OrderStatusEnum</span><br><span class="line">    &#123;</span><br><span class="line">        NoPay = <span class="number">1</span>,</span><br><span class="line">        Paying = <span class="number">2</span>,</span><br><span class="line">        Payed = <span class="number">3</span>,</span><br><span class="line">        PayFail = <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Setting-cs"><a href="#Setting-cs" class="headerlink" title="Setting.cs"></a>Setting.cs</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Abp.Domain.Entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> è®¾ç½®è¡¨</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Setting</span> : <span class="title">Entity</span>&lt;<span class="title">int</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Code &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="SysUser-cs"><a href="#SysUser-cs" class="headerlink" title="SysUser.cs"></a>SysUser.cs</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Abp.Domain.Entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ç”¨æˆ·è¡¨</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SysUser</span> : <span class="title">Entity</span>&lt;<span class="title">int</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> SettingCode &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Area &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºé¢†åŸŸæœåŠ¡"><a href="#åˆ›å»ºé¢†åŸŸæœåŠ¡" class="headerlink" title="åˆ›å»ºé¢†åŸŸæœåŠ¡"></a>åˆ›å»ºé¢†åŸŸæœåŠ¡</h3><p>åœ¨<code>ShardingCoreManagement</code>ç›®å½•ä¸‹åˆ›å»º<code>DomainService</code>ç›®å½•ç”¨äºå­˜æ”¾<strong>é¢†åŸŸæœåŠ¡ç±»</strong></p><h4 id="OrderManager"><a href="#OrderManager" class="headerlink" title="OrderManager"></a>OrderManager</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement.DomainService</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IOrderManager</span> : <span class="title">I52AbpDomainService</span>&lt;<span class="title">Order</span>, <span class="title">int</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement.DomainService</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrderManager</span> : <span class="title">AbpDomainService</span>&lt;<span class="title">Order</span>, <span class="title">int</span>&gt;, <span class="title">IOrderManager</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">OrderManager</span>(<span class="params">IServiceProvider serviceProvider</span>) : <span class="title">base</span>(<span class="params">serviceProvider</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SysUserManager"><a href="#SysUserManager" class="headerlink" title="SysUserManager"></a>SysUserManager</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement.DomainService</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISysUserManager</span> : <span class="title">I52AbpDomainService</span>&lt;<span class="title">SysUser</span>, <span class="title">int</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement.DomainService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SysUserManager</span> : <span class="title">AbpDomainService</span>&lt;<span class="title">SysUser</span>, <span class="title">int</span>&gt;, <span class="title">ISysUserManager</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SysUserManager</span>(<span class="params">IServiceProvider serviceProvider</span>) : <span class="title">base</span>(<span class="params">serviceProvider</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SettingManager"><a href="#SettingManager" class="headerlink" title="SettingManager"></a>SettingManager</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement.DomainService</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISettingManager</span> : <span class="title">I52AbpDomainService</span>&lt;<span class="title">Setting</span>, <span class="title">int</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreManagement.DomainService</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SettingManager</span> : <span class="title">AbpDomainService</span>&lt;<span class="title">Setting</span>, <span class="title">int</span>&gt;, <span class="title">ISettingManager</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SettingManager</span>(<span class="params">IServiceProvider serviceProvider</span>) : <span class="title">base</span>(<span class="params">serviceProvider</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œå®ä½“"><a href="#æ³¨å†Œå®ä½“" class="headerlink" title="æ³¨å†Œå®ä½“"></a>æ³¨å†Œå®ä½“</h3><p>å’Œä»¥å¾€ä¸€æ ·ï¼Œåœ¨<strong>DbContextç±»</strong>ä¸­åŠ å…¥å®ä½“æ³¨å†Œ</p><p>åœ¨<code>Template.EntityFrameworkCore</code>çš„<code>FoundationTemplateDbContext</code>ä¸­<strong>æ³¨å†Œå®ä½“</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> GCT.Foundation.Examples.Entity;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCoreManagement;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.EntityFrameworkCore</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FoundationTemplateDbContext</span> : <span class="title">GCTSharedDbContextShardingCore</span>&lt;<span class="title">FoundationTemplateDbContext</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FoundationTemplateDbContext</span>(<span class="params">DbContextOptions&lt;FoundationTemplateDbContext&gt; options</span>) : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.ModelCreating(modelBuilder);</span><br><span class="line">            </span><br><span class="line">            modelBuilder.ConfigureGCTShared();</span><br><span class="line"></span><br><span class="line">            modelBuilder.ConfigureFoundationTemplate();</span><br><span class="line">            <span class="comment">// å¯é€‰</span></span><br><span class="line">            modelBuilder.UseCollation(<span class="string">&quot;Chinese_PRC_CI_AS&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;BigData&gt; BigData &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Commodity&gt; Commodity &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å†Œæ–°å»ºçš„å®ä½“</span></span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Order&gt; Order &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Setting&gt; Setting &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;SysUser&gt; SysUser &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºè™šæ‹Ÿè·¯ç”±"><a href="#åˆ›å»ºè™šæ‹Ÿè·¯ç”±" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿè·¯ç”±"></a>åˆ›å»ºè™šæ‹Ÿè·¯ç”±</h3><blockquote><p>è·¯ç”±å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://xuejm.gitee.io/sharding-core-doc/sharding-route/default-route/">é»˜è®¤è·¯ç”± | ShardingCoreæ–‡æ¡£ (gitee.io)</a></p></blockquote><blockquote><p> ï¼ï¼ï¼æ³¨æ„ï¼šè·¯ç”±é…ç½®ç±»æŒ‰ç…§<strong>çº¦å®š</strong>ç»Ÿä¸€æ”¾åœ¨<code>Template.EntityFrameworkCore</code>å±‚<code>ShardingCore</code> -&gt; <code>Routes</code>ç›®å½•ä¸‹ï¼Œ</p></blockquote><p><img data-src="https://cdn.jonty.top/img/image-20221025150400595.png" alt="image-20221025150400595"></p><p>Orderè®¢å•è¡¨è·¯ç”±ï¼š<strong>OrderVirtualTableRoute.cs</strong></p><p>è¿™é‡Œå®ç°çš„åŸºç±»<code>AbstractSimpleShardingMonthKeyDateTimeVirtualTableRoute</code>æŒ‰æ—¶é—´åˆ†è¡¨</p><p>è¯¥è·¯ç”±ä¸ºç®€å•çš„<strong>æŒ‰æœˆåˆ†è¡¨è·¯ç”±</strong>,æ”¯æŒåˆ†è¡¨å­—æ®µæ˜¯<code>DateTime</code>,åˆ†è¡¨åçš„åç¼€ä¸º<code>yyyyMM</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCoreManagement;</span><br><span class="line"><span class="keyword">using</span> ShardingCore.Core.EntityMetadatas;</span><br><span class="line"><span class="keyword">using</span> ShardingCore.VirtualRoutes.Months;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCore.Routes</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrderVirtualTableRoute</span> : <span class="title">AbstractSimpleShardingMonthKeyDateTimeVirtualTableRoute</span>&lt;<span class="title">Order</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">EntityMetadataTableBuilder&lt;Order&gt; builder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        builder.ShardingProperty(o =&gt; o.CreationTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">AutoCreateTableByTime</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DateTime <span class="title">GetBeginTime</span>(<span class="params"></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DateTime(<span class="number">2021</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SysUserè¡¨è·¯ç”±ï¼š<strong>SysUserVirtualTableRoute.cs</strong></p><p>ç»§æ‰¿çš„æ˜¯<strong>Int</strong>ç±»å‹å–æ¨¡åˆ†è¡¨è·¯ç”±ï¼š<strong>AbstractSimpleShardingModKeyIntVirtualTableRoute</strong></p><p>è¯¥è·¯ç”±ä¸ºç®€å•çš„å–æ¨¡hashè·¯ç”±ï¼Œåˆ†è¡¨å­—æ®µæ˜¯<code>int</code>ç±»å‹ï¼Œæ¥å—3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºåç¼€çš„ä½æ•°,ç¬¬äºŒä½è¡¨ç¤ºå–æ¨¡çš„åŸºæ•°ï¼Œç¬¬ä¸‰ä½æ˜¯å–æ¨¡åç¼€ä¸è¶³çš„å·¦è¡¥å­—ç¬¦ã€‚</p><blockquote><p>å¯¹åº”çš„ï¼Œå¦‚æœå–æ¨¡åˆ†ç‰‡å­—æ®µä¸ºStringç±»å‹ï¼ŒAbstractSimpleShardingModKeyStringVirtualTableRoute</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCoreManagement;</span><br><span class="line"><span class="keyword">using</span> ShardingCore.Core.EntityMetadatas;</span><br><span class="line"><span class="keyword">using</span> ShardingCore.VirtualRoutes.Mods;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCore.Routes</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SysUserVirtualTableRoute</span> : <span class="title">AbstractSimpleShardingModKeyIntVirtualTableRoute</span>&lt;<span class="title">SysUser</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SysUserVirtualTableRoute</span>(<span class="params"></span>) : <span class="title">base</span>(<span class="params"><span class="number">2</span>, <span class="number">3</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">EntityMetadataTableBuilder&lt;SysUser&gt; builder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            builder.ShardingProperty(o =&gt; o.Age);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œåˆ†ç‰‡è·¯ç”±"><a href="#æ³¨å†Œåˆ†ç‰‡è·¯ç”±" class="headerlink" title="æ³¨å†Œåˆ†ç‰‡è·¯ç”±"></a>æ³¨å†Œåˆ†ç‰‡è·¯ç”±</h3><p>åœ¨<code>FoundationTemplateShardingCoreExtensions.ConfigureShardingCore</code>ä¸­åŠ å…¥<strong>è¡¨åˆ†ç‰‡è·¯ç”±é…ç½®</strong>ï¼Œå¦‚ä¸‹ï¼š</p><p><strong>FoundationTemplateShardingCoreExtensions.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> GCT.Foundation.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCore.Routes;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Migrations;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> ShardingCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCore</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FoundationTemplateShardingCoreExtensions</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ³¨å†ŒShardingCoreæœåŠ¡</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IServiceCollection <span class="title">ConfigureShardingCore</span>(<span class="params"><span class="keyword">this</span> IServiceCollection services, <span class="built_in">string</span> dataSourceName,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="built_in">string</span> connectionString</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            services.AddShardingDbContext&lt;FoundationTemplateDbContext&gt;()</span><br><span class="line">                .UseRouteConfig((sp, op) =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                   <span class="comment">// åœ¨è¿™æ·»åŠ æ³¨å†Œåˆ†è¡¨è·¯ç”±</span></span><br><span class="line">                    op.AddShardingTableRoute&lt;OrderVirtualTableRoute&gt;();</span><br><span class="line">                    op.AddShardingTableRoute&lt;SysUserVirtualTableRoute&gt;();</span><br><span class="line">                &#125;)</span><br><span class="line">              <span class="comment">// ..... other code</span></span><br><span class="line">            <span class="keyword">return</span> services;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ ç§å­æ•°æ®"><a href="#æ·»åŠ ç§å­æ•°æ®" class="headerlink" title="æ·»åŠ ç§å­æ•°æ®"></a>æ·»åŠ ç§å­æ•°æ®</h3><p>åœ¨Seed/Hostç›®å½•ä¸‹åˆ›å»º<code>DefaultOrderBuilder.cs</code>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCoreManagement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.Seed.Host</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DefaultOrderBuilder</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> FoundationTemplateDbContext _context;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DefaultOrderBuilder</span>(<span class="params">FoundationTemplateDbContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _context = context;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Create</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> settings = <span class="keyword">new</span> List&lt;Setting&gt;(<span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span>()</span><br><span class="line">                &#123;</span><br><span class="line">                    Code = <span class="string">&quot;Admin&quot;</span>,</span><br><span class="line">                    Name = <span class="string">&quot;AdminName&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="keyword">new</span>()</span><br><span class="line">                &#123;</span><br><span class="line">                    Code = <span class="string">&quot;User&quot;</span>,</span><br><span class="line">                    Name = <span class="string">&quot;UserName&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="keyword">new</span>()</span><br><span class="line">                &#123;</span><br><span class="line">                    Code = <span class="string">&quot;SuperAdmin&quot;</span>,</span><br><span class="line">                    Name = <span class="string">&quot;SuperAdminName&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">var</span> users = <span class="keyword">new</span> List&lt;SysUser&gt;(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> uer = <span class="keyword">new</span> SysUser()</span><br><span class="line">                &#123;</span><br><span class="line">                    Age = i,</span><br><span class="line">                    Name = <span class="string">$&quot;MyName<span class="subst">&#123;i&#125;</span>&quot;</span>,</span><br><span class="line">                    SettingCode = settings[i % <span class="number">3</span>].Code</span><br><span class="line">                &#125;;</span><br><span class="line">                users.Add(uer);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> orders = <span class="keyword">new</span> List&lt;Order&gt;(<span class="number">300</span>);</span><br><span class="line">            <span class="keyword">var</span> begin = <span class="keyword">new</span> DateTime(<span class="number">2021</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">300</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> order = <span class="keyword">new</span> Order()</span><br><span class="line">                &#123;</span><br><span class="line">                    Payer = i % <span class="number">10</span>,</span><br><span class="line">                    Money = <span class="number">100</span> + <span class="keyword">new</span> Random().Next(<span class="number">100</span>, <span class="number">3000</span>),</span><br><span class="line">                    OrderStatus = (OrderStatusEnum)(i % <span class="number">4</span> + <span class="number">1</span>),</span><br><span class="line">                    CreationTime = begin.AddDays(i)</span><br><span class="line">                &#125;;</span><br><span class="line">                orders.Add(order);</span><br><span class="line">            &#125;</span><br><span class="line">            _context.AddRange(settings);</span><br><span class="line">            _context.AddRange(users);</span><br><span class="line">            _context.AddRange(orders);</span><br><span class="line">            _context.SaveChanges();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>InitialHostDbBuilder.cs</code>æ·»åŠ è°ƒç”¨</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> GCT.Foundation.EntityFrameworkCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.Seed.Host</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InitialHostDbBuilder</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> FoundationTemplateDbContext _context;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InitialHostDbBuilder</span>(<span class="params">FoundationTemplateDbContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _context = context;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Create</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºæµ‹è¯•ç§å­æ•°æ®</span></span><br><span class="line">            <span class="keyword">new</span> DefaultOrderBuilder(_context).Create();</span><br><span class="line">            _context.SaveChanges();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºè¿ç§»"><a href="#åˆ›å»ºè¿ç§»" class="headerlink" title="åˆ›å»ºè¿ç§»"></a>åˆ›å»ºè¿ç§»</h3><p>æŒ‰æ­£å¸¸æ­¥éª¤æ‰§è¡Œè¿ç§»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Add-Migration Use-Sharding</span><br><span class="line">Update-Database</span><br></pre></td></tr></table></figure><p>åˆ†è¡¨åå¦‚ä¸‹ï¼š</p><p><img data-src="https://cdn.jonty.top/img/image-20221025155658434.png" alt="image-20221025155658434"></p><p><img data-src="https://cdn.jonty.top/img/sharding-table.png" alt="img"></p><h3 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h3><blockquote><p>å¢åˆ æ”¹æŸ¥é™¤äº†æŸ¥è¯¢ç¨å¾®åœ¨åˆ†è¡¨+æ’åºçš„æƒ…å†µä¸‹éœ€è¦æ³¨æ„å…¶å®å…¶ä»–æ“ä½œå’ŒefcoreåŸºæœ¬ä¸Šä¸€è‡´</p></blockquote><h4 id="æŸ¥è¯¢ç¤ºä¾‹"><a href="#æŸ¥è¯¢ç¤ºä¾‹" class="headerlink" title="æŸ¥è¯¢ç¤ºä¾‹"></a>æŸ¥è¯¢ç¤ºä¾‹</h4><p>åœ¨<code>Template.Application</code>å±‚åˆ›å»º<code>ShardingCoreTestAppService.cs</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> Abp.Domain.Repositories;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCoreManagement;</span><br><span class="line"><span class="keyword">using</span> GCT.Foundation.ShardingCoreManagement.DomainService;</span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GCT.Foundation.ShardingCoreTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ShardingCoreTestAppService</span> : <span class="title">FoundationTemplateAppServiceBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> OrderManager _orderManager;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> SysUserManager _sysUserManager;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> SettingManager _settingManager;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ShardingCoreTestAppService</span>(<span class="params">OrderManager orderManager,</span></span></span><br><span class="line"><span class="params"><span class="function">            SysUserManager sysUserManager,</span></span></span><br><span class="line"><span class="params"><span class="function">            SettingManager settingManager</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _orderManager = orderManager;</span><br><span class="line">            _sysUserManager = sysUserManager;</span><br><span class="line">            _settingManager = settingManager;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">/*private readonly IRepository&lt;Order, int&gt; _orderRepository;</span></span><br><span class="line"><span class="comment">        public ShardingCoreTestAppService(IRepository&lt;Order, int&gt; orderRepository)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            _orderRepository = orderRepository;</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å•å¯¹è±¡æŸ¥è¯¢"><a href="#å•å¯¹è±¡æŸ¥è¯¢" class="headerlink" title="å•å¯¹è±¡æŸ¥è¯¢"></a>å•å¯¹è±¡æŸ¥è¯¢</h5><p><a href="https://xuejm.gitee.io/sharding-core-doc/query/single-entity-query/">å®˜æ–¹æ–‡æ¡£å•å¯¹è±¡æŸ¥è¯¢ | ShardingCoreæ–‡æ¡£ (gitee.io)</a></p><p>å’ŒefcoreåŸç”ŸæŸ¥è¯¢æ²¡æœ‰ä»»ä½•åŒºåˆ«,æ”¯æŒæœªåˆ†è¡¨ä¸‹çš„æ‰€æœ‰æ“ä½œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> å•å¯¹è±¡ç®€å•æŸ¥è¯¢</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;Order&gt; <span class="title">GetOrder</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> order = <span class="keyword">await</span> _orderManager.QueryAsNoTracking.FirstOrDefaultAsync(o =&gt; o.Id == <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> å•å¯¹è±¡ç®€å•æŸ¥è¯¢</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;List&lt;Order&gt;&gt; GetOrderList()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dateTime = <span class="keyword">new</span> DateTime(<span class="number">2021</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">var</span> orders = <span class="keyword">await</span> _orderManager.QueryAsNoTracking.Where(x =&gt; x.CreationTime &gt;= dateTime).ToListAsync();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> orders;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20221025161642236.png" alt="image-20221025161642236"></p><h5 id="è¿è¡¨æŸ¥è¯¢"><a href="#è¿è¡¨æŸ¥è¯¢" class="headerlink" title="è¿è¡¨æŸ¥è¯¢"></a>è¿è¡¨æŸ¥è¯¢</h5><blockquote><p>é»˜è®¤ä¸æ¨è<code>include</code>ï¼Œåˆ†è¡¨å¯¹è±¡+åˆ†è¡¨ã€åˆ†è¡¨å¯¹è±¡+åˆ†è¡¨å¯¹è±¡éƒ½æ˜¯åœ¨ShardingCoreå†…è¢«æ”¯æŒçš„ï¼Œæ”¯æŒçš„å½¢å¼ä¸ºjoin, é»˜è®¤æ¨èjoinç»„åˆè€Œä¸æ˜¯include</p></blockquote><p><strong>åˆ†è¡¨joinä¸åˆ†è¡¨</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> åˆ†è¡¨Joinä¸åˆ†è¡¨</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">[<span class="meta">HttpGet</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">string</span>&gt; <span class="title">QueryJoin</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> query = <span class="keyword">from</span> user <span class="keyword">in</span> _sysUserManager.QueryAsNoTracking.Where(o =&gt; o.Id == <span class="number">1</span> || o.Id == <span class="number">6</span>)</span><br><span class="line">                <span class="keyword">join</span> setting <span class="keyword">in</span> _settingManager.QueryAsNoTracking <span class="keyword">on</span> user.SettingCode <span class="keyword">equals</span> setting.Code</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">new</span></span><br><span class="line">        &#123;</span><br><span class="line">            user.Id,</span><br><span class="line">            user.Name,</span><br><span class="line">            user.Area,</span><br><span class="line">            user.SettingCode,</span><br><span class="line">            SettingName = setting.Name,</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="keyword">await</span> query.ToListAsync();</span><br><span class="line">    <span class="keyword">return</span> JsonConvert.SerializeObject(query);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20221025162314303.png" alt="image-20221025162314303"></p><p><strong>åˆ†è¡¨joinåˆ†è¡¨</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> åˆ†è¡¨joinåˆ†è¡¨</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">[<span class="meta">HttpGet</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">string</span>&gt; <span class="title">QueryJoin2</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> begin = <span class="keyword">new</span> DateTime(<span class="number">2021</span>, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">var</span> end = <span class="keyword">new</span> DateTime(<span class="number">2021</span>, <span class="number">4</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">var</span> sql1 = <span class="keyword">from</span> user <span class="keyword">in</span>  _sysUserManager.QueryAsNoTracking.Where(o =&gt; o.Id == <span class="number">1</span> || o.Id == <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">join</span> order <span class="keyword">in</span> _orderManager.QueryAsNoTracking.Where(o =&gt; o.CreationTime &gt;= begin &amp;&amp; o.CreationTime &lt;= end)</span><br><span class="line">            <span class="keyword">on</span> user.Id <span class="keyword">equals</span> order.Payer</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">new</span></span><br><span class="line">        &#123;</span><br><span class="line">            user.Id,</span><br><span class="line">            user.Name,</span><br><span class="line">            user.Area,</span><br><span class="line">            user.SettingCode,</span><br><span class="line">            OrderId = order.Id,</span><br><span class="line">            order.Payer,</span><br><span class="line">            order.CreationTime</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="keyword">return</span> JsonConvert.SerializeObject(<span class="keyword">await</span> sql1.ToListAsync());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20221025162513321.png" alt="image-20221025162513321"></p><p><img data-src="https://cdn.jonty.top/img/image-20221025162715517.png" alt="image-20221025162715517"></p><h4 id="ä¿®æ”¹ç¤ºä¾‹"><a href="#ä¿®æ”¹ç¤ºä¾‹" class="headerlink" title="ä¿®æ”¹ç¤ºä¾‹"></a>ä¿®æ”¹ç¤ºä¾‹</h4><h5 id="è‡ªåŠ¨è¿½è¸ªä¿®æ”¹"><a href="#è‡ªåŠ¨è¿½è¸ªä¿®æ”¹" class="headerlink" title="è‡ªåŠ¨è¿½è¸ªä¿®æ”¹"></a>è‡ªåŠ¨è¿½è¸ªä¿®æ”¹</h5><p>è¿½è¸ªæƒ…å†µä¸‹sharding-coreä¾ç„¶å¯ä»¥å¯¹ç»“æœè¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹çš„å­—æ®µæ˜¯è¢«ä¿®æ”¹è¿‡åçš„å­—æ®µ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">UpdateUser</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> sysUser = <span class="keyword">await</span> _sysUserManager.Query.FirstOrDefaultAsync(x =&gt; x.Id == <span class="number">1</span>);</span><br><span class="line">    sysUser.Name = <span class="string">&quot;new Name&quot;</span>;</span><br><span class="line">    <span class="keyword">await</span> _sysUserManager.Update(sysUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="éè‡ªåŠ¨è¿½è¸ªä¿®æ”¹"><a href="#éè‡ªåŠ¨è¿½è¸ªä¿®æ”¹" class="headerlink" title="éè‡ªåŠ¨è¿½è¸ªä¿®æ”¹"></a>éè‡ªåŠ¨è¿½è¸ªä¿®æ”¹</h5><p>éè¿½è¸ªæƒ…å†µä¸‹sharding-croeä¹Ÿæ”¯æŒæŸ¥è¯¢ä¿®æ”¹ï¼Œä½†æ˜¯ä¿®æ”¹çš„å­—æ®µæ˜¯å…¨å­—æ®µ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">UpdateUserAsNoTracking</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> sysUser = <span class="keyword">await</span> _sysUserManager.QueryAsNoTracking.FirstOrDefaultAsync(x =&gt; x.Id == <span class="number">1</span>);</span><br><span class="line">    sysUser.Name = <span class="string">&quot;new Name&quot;</span>;</span><br><span class="line">    <span class="keyword">await</span> _sysUserManager.Update(sysUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤ç¤ºä¾‹"><a href="#åˆ é™¤ç¤ºä¾‹" class="headerlink" title="åˆ é™¤ç¤ºä¾‹"></a>åˆ é™¤ç¤ºä¾‹</h4><p>ä¸‹é¢æ“ä½œä¼šå°†æ‰€æœ‰åˆ†è¡¨ä¸­<code>id==7</code>çš„æ•°æ®åˆ é™¤</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeleteUser</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> _sysUserManager.Delete(x =&gt; x.Id == <span class="number">7</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><blockquote><p>sharding table key:Id is not ValueGenerated.Never</p></blockquote><p>åˆ†ç‰‡æ˜¯è·å–æ’å…¥æ•°æ®çš„åˆ†ç‰‡é”®ï¼Œç„¶åé€šè¿‡è·¯ç”±æ’å…¥åˆ°å…·ä½“çš„æ•°æ®åº“ï¼Œ<strong>åˆ†ç‰‡é”®ä¸å¯ä»¥ä¸ºè‡ªå¢idï¼Œå¿…é¡»æ˜¯æ²¡æœ‰ç”Ÿæˆç­–ç•¥çš„</strong></p><blockquote><p>ä½¿ç”¨å¤–é”®æŠ¥é”™</p></blockquote><p>å»ºè®®åœ¨ä½¿ç”¨å¤–é”®çš„æ—¶å€™å¦‚æœæ˜¯ä¸»è¡¨ä¹Ÿæ˜¯åˆ†è¡¨çš„æƒ…å†µä¸‹æœ€å¥½çš„æƒ…å†µå°±æ˜¯<strong>å–æ¶ˆå¤–é”®</strong></p><h2 id="ShardingCore-å¤šç§Ÿæˆ·"><a href="#ShardingCore-å¤šç§Ÿæˆ·" class="headerlink" title="ShardingCore å¤šç§Ÿæˆ·"></a>ShardingCore å¤šç§Ÿæˆ·</h2><p>å½“å‰åˆ†åº“åˆ†è¡¨æƒ…å†µï¼š</p><ul><li>éå¤šç§Ÿæˆ·æ¨¡å¼ï¼Œå…¨éƒ¨é€šé¡ºï¼ŒåŠŸèƒ½æ­£å¸¸</li><li>å¤šç§Ÿæˆ·æ¨¡å¼ï¼Œä¸æ”¯æŒï¼Œéœ€è¦ä¿®æ”¹å®ç°å®ŒæˆåŠŸèƒ½</li></ul><h3 id="ShardingCoreçš„è®¾è®¡æ—¶å¦‚ä½•æ”¯æŒå¤šç§Ÿæˆ·æ¨¡å¼"><a href="#ShardingCoreçš„è®¾è®¡æ—¶å¦‚ä½•æ”¯æŒå¤šç§Ÿæˆ·æ¨¡å¼" class="headerlink" title="ShardingCoreçš„è®¾è®¡æ—¶å¦‚ä½•æ”¯æŒå¤šç§Ÿæˆ·æ¨¡å¼"></a>ShardingCoreçš„è®¾è®¡æ—¶å¦‚ä½•æ”¯æŒå¤šç§Ÿæˆ·æ¨¡å¼</h3><ul><li>IVirtualDataSourceManager ,è™šæ‹Ÿæ•°æ®æºç®¡ç†ï¼Œå­˜å‚¨æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²é…ç½®<ul><li>æ·»åŠ æ•°æ®æºé…ç½®<ul><li> DynamicShardingHelper.DynamicAppendVirtualDataSourceConfig(new SqlShardingConfiguration(shardingTenantOptions));</li></ul></li><li>åˆ‡æ¢æ•°æ®æºé…ç½®<ul><li>virtualDataSourceManager.CreateScope(æ•°æ®æºæ ‡è¯†)</li></ul></li></ul></li></ul><h3 id="å¦‚ä½•ç»“åˆAbpå·¥ä½œå•å…ƒ"><a href="#å¦‚ä½•ç»“åˆAbpå·¥ä½œå•å…ƒ" class="headerlink" title="å¦‚ä½•ç»“åˆAbpå·¥ä½œå•å…ƒ"></a>å¦‚ä½•ç»“åˆAbpå·¥ä½œå•å…ƒ</h3><ul><li>åŠ è½½æŸ¥è¯¢å½“å‰æ•°æ®åº“ä¸­çš„ç§Ÿæˆ·æ•°æ®é…ç½®</li><li>åˆ›å»ºå·¥ä½œå•å…ƒæ—¶ï¼ŒæŒ‡å®šç§Ÿæˆ·idï¼ˆæ•°æ®æºæ ‡è¯†ï¼‰</li><li>å½“å‰å·¥ä½œå•å…ƒåˆ‡æ¢ç§Ÿæˆ·æ—¶ï¼ŒæŒ‡å®šç§Ÿæˆ·idï¼ˆæ•°æ®æºæ ‡è¯†ï¼‰</li></ul>]]></content>
    
    
    <summary type="html">AspNet Boilerplate é›†æˆShardingCoreåˆ†è¡¨</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Abp" scheme="https://jonty.top/tags/Abp/"/>
    
    <category term="ShardingCore" scheme="https://jonty.top/tags/ShardingCore/"/>
    
  </entry>
  
  <entry>
    <title>Docker-ä¿®æ”¹dockeræ•°æ®å­˜å‚¨ç›®å½•</title>
    <link href="https://jonty.top/2023/04/12/how-to-change-docker-data-folder-configuration/"/>
    <id>https://jonty.top/2023/04/12/how-to-change-docker-data-folder-configuration/</id>
    <published>2023-04-12T03:39:18.000Z</published>
    <updated>2023-04-12T03:43:26.756Z</updated>
    
    <content type="html"><![CDATA[<p>1ã€åœæ­¢æ­£åœ¨è¿è¡Œçš„dockerï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop docker</span><br></pre></td></tr></table></figure><p>2ã€åˆ›å»ºæ–‡ä»¶å¤¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/docker </span><br></pre></td></tr></table></figure><p>3ã€ç§»åŠ¨/var/lib/docker/ç›®å½•åˆ°æ–°ç›®å½•ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /var/lib/docker/* /data/docker</span><br></pre></td></tr></table></figure><p>4ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>å¢åŠ ä»¥ä¸‹é…ç½®å³å¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;data-root&quot;</span>: <span class="string">&quot;/data/docker&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>v17.05.0 ä¹‹åä½¿ç”¨ data-rootï¼Œæ—§ç‰ˆæœ¬è¯·ä½¿ç”¨ graph</p></blockquote><p>5ã€åˆ é™¤/var/lib/docker/ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure><p>6ã€å¯åŠ¨dockerï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œå‚è€ƒ <a href="https://medium.com/developer-space/how-to-change-docker-data-folder-configuration-33d372669056">How To Change Docker Data Folder Configuration</a> è¿›è¡Œæ›´æ”¹</p><h3 id="å…¶ä»–æ–¹å¼ï¼š"><a href="#å…¶ä»–æ–¹å¼ï¼š" class="headerlink" title="å…¶ä»–æ–¹å¼ï¼š"></a>å…¶ä»–æ–¹å¼ï¼š</h3><p>é€šè¿‡è½¯é“¾æ¥ä¿®æ”¹dockeræ•°æ®å­˜å‚¨ç›®å½•ï¼Œè½¯è¿æ¥/data/docker åˆ° /var/lib/é‡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /data/docker /var/lib/docker</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Dockerï¼šå¦‚ä½•ä¿®æ”¹dockeræ•°æ®å­˜å‚¨ç›®å½•</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Shell" scheme="https://jonty.top/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>ã€Blazor-04ã€‘- Razorç»„ä»¶</title>
    <link href="https://jonty.top/2023/03/23/razor-components/"/>
    <id>https://jonty.top/2023/03/23/razor-components/</id>
    <published>2023-03-23T02:08:52.000Z</published>
    <updated>2023-03-23T02:20:23.981Z</updated>
    
    <content type="html"><![CDATA[<ul><li>Blazoræ˜¯ä¸€ä¸ª<strong>ç»„ä»¶é©±åŠ¨</strong>çš„æ¡†æ¶ï¼Œè¿™æ„å‘³ç€ç»„ä»¶æ˜¯<strong>Blazor</strong>åº”ç”¨çš„<strong>åŸºæœ¬æ„å»ºå—</strong>ã€‚</li><li>å®ƒä»¬å¯ä»¥åµŒå¥—ã€å¤ç”¨ï¼Œç”šè‡³å¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´å…±äº«ã€‚</li><li>ç»„ä»¶æ–‡ä»¶çš„æ‰©å±•åä¸º <strong>.razor</strong></li></ul><p>ä¸‹é¢æ˜¯æˆ‘ä»¬æ–°å»ºé¡¹ç›®æ—¶åˆ›å»ºçš„<strong>Counter</strong>ç»„ä»¶</p><p><code>Counter.razor</code></p><hr><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/counter&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">PageTitle</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">PageTitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">role</span>=<span class="string">&quot;status&quot;</span>&gt;</span>Current count: @currentCount<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">onclick</span>=<span class="string">&quot;IncrementCount&quot;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    private int currentCount = 0;</span><br><span class="line"></span><br><span class="line">    private void IncrementCount()</span><br><span class="line">    &#123;</span><br><span class="line">        currentCount++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸¤ç§è¯­è¨€çš„ç»“åˆ</p><ul><li>HTMLæ ‡è®°å®šä¹‰äº†ç»„ä»¶çš„ç”¨æˆ·ç•Œé¢ï¼ˆå³å¤–è§‚ï¼‰ã€‚</li><li>å®šä¹‰å¤„ç†é€»è¾‘çš„C#ä»£ç </li></ul><p><img data-src="https://cdn.jonty.top/img/image-20220412230131617.png" alt="image-20220412230131617"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ol><li>æ¯æ¬¡å•å‡»æŒ‰é’®æ—¶ï¼ŒC#ä»£ç éƒ½ä¼šå°†<code>currentCount</code>å˜é‡çš„å€¼å¢åŠ <code>1</code></li><li>å•å‡»æŒ‰é’®æ—¶ï¼Œå¿…é¡»è°ƒç”¨<code>IncrementCount()</code>å‡½æ•°ï¼Œä½¿ç”¨<code>onclick</code>å±æ€§è°ƒç”¨çš„</li><li>åœ¨HTMLä¸­ï¼Œè¦è®¿é—®ç§æœ‰å˜é‡<code>currentCount</code>ï¼Œéœ€è¦ä½¿ç”¨<code>@</code>ç¬¦å·</li><li>C#ä»£ç æ”¾åœ¨<code>@code</code>å—ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ª<code>@code</code>å—</li></ol><p>ç¼–è¯‘åº”ç”¨ç¨‹åºæ—¶ï¼Œå°† HTML å’Œ C# ä»£ç è½¬æ¢ä¸ºç»„ä»¶ç±»ã€‚ç”Ÿæˆçš„ç±»çš„åç§°ä¸ç»„ä»¶æ–‡ä»¶çš„åç§°åŒ¹é…ã€‚ç»„ä»¶æ–‡ä»¶åå¿…é¡»<strong>ä»¥å¤§å†™å­—ç¬¦å¼€å¤´</strong>ã€‚å¦‚æœæ·»åŠ ä»¥å°å†™å­—ç¬¦å¼€å¤´çš„ç»„ä»¶æ–‡ä»¶ï¼Œåˆ™ä»£ç å°†æ— æ³•ç¼–è¯‘ï¼Œå¹¶ä¸”ä¼šå‡ºç°ä»¥ä¸‹ç¼–è¯‘å™¨é”™è¯¯ã€‚</p><blockquote><p><strong>ç»„ä»¶åç§°ä¸èƒ½ä»¥å°å†™å­—ç¬¦å¼€å¤´</strong></p></blockquote><p><img data-src="https://cdn.jonty.top/img/image-20220412225942530.png" alt="image-20220412225942530"></p><p>è¯·è®°ä½ï¼ŒBlazor Serveré¡¹ç›®åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚</p><ul><li>åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æµè§ˆå™¨ä¹‹é—´å»ºç«‹ SignalR è¿æ¥ã€‚åœ¨æœ€åˆå‘ˆç°è®¡æ•°å™¨ç»„ä»¶ä¹‹åå¹¶ä¸”å½“ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶ã€‚</li><li>æœ‰å…³å•å‡»äº‹ä»¶çš„ä¿¡æ¯é€šè¿‡ SignalR è¿æ¥å‘é€åˆ°æœåŠ¡å™¨ã€‚</li><li>ä½œä¸ºå¯¹è¯¥äº‹ä»¶çš„å“åº”ï¼Œç»„ä»¶ä¼šé‡æ–°ç”Ÿæˆï¼Œä½†ä¸ä¼šå°†æ•´ä¸ª HTML å‘é€å›å®¢æˆ·ç«¯ã€‚å®ƒåªæ˜¯å·®å¼‚ï¼Œå³æ¸²æŸ“æ ‘ä¸­çš„å·®å¼‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯å‘é€åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ–°è®¡æ•°å™¨å€¼ã€‚</li><li>ç”±äºä»…æ›´æ–°é¡µé¢çš„æ›´æ”¹éƒ¨åˆ†è€Œä¸æ˜¯é‡æ–°åŠ è½½å’Œæ›´æ–°æ•´ä¸ªé¡µé¢ï¼Œå› æ­¤åº”ç”¨ç¨‹åºæ„Ÿè§‰æ›´å¿«ï¼Œå¯¹ç”¨æˆ·çš„å“åº”æ›´å¿«ã€‚</li></ul><h2 id="åµŒå¥—Blazorç»„ä»¶"><a href="#åµŒå¥—Blazorç»„ä»¶" class="headerlink" title="åµŒå¥—Blazorç»„ä»¶"></a>åµŒå¥—Blazorç»„ä»¶</h2><p>å‘ˆç°Counterç»„ä»¶çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨æµè§ˆå™¨ä¸­å¯¼èˆªåˆ°<code>/counter</code>ã€‚æ­¤è·¯å¾„ç”±ç»„ä»¶é¡¶éƒ¨çš„<code>@page</code>æŒ‡ä»¤æŒ‡å®šã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/counter&quot;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªç»„ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ HTML è¯­æ³•åµŒå¥—åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨**&lt; Counter /&gt;<strong>å°†</strong>Counter**ç»„ä»¶åµŒå¥—åœ¨å…¶ä»–ç»„ä»¶ä¸­ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@page <span class="string">&quot;/test&quot;</span></span><br><span class="line">&lt;PageTitle&gt;test&lt;/PageTitle&gt;</span><br><span class="line">&lt;h3&gt;test&lt;/h3&gt;</span><br><span class="line">    </span><br><span class="line">@* åµŒå¥—ç»„ä»¶ *@</span><br><span class="line">&lt;Counter&gt;&lt;/Counter&gt;</span><br><span class="line">@code &#123;&#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20220412230557300.png" alt="image-20220412230557300"></p><h2 id="ç»„ä»¶å­˜æ”¾ä½ç½®"><a href="#ç»„ä»¶å­˜æ”¾ä½ç½®" class="headerlink" title="ç»„ä»¶å­˜æ”¾ä½ç½®"></a>ç»„ä»¶å­˜æ”¾ä½ç½®</h2><p>ç»„ä»¶å¯ä»¥æ”¾åœ¨Blazoré¡¹ç›®ä¸­ä»»ä½•ä½ç½®ã€‚å°†ç”Ÿæˆç½‘é¡µçš„ç»„ä»¶æ”¾ç½®åœ¨<strong>Pages</strong>æ–‡ä»¶å¤¹ä¸­å¹¶å°†å¯é‡ç”¨çš„éé¡µé¢ç»„ä»¶æ”¾ç½®åœ¨<strong>Shared</strong>æ–‡ä»¶å¤¹ä¸­æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ã€‚</p><p>å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨é¡¹ç›®ä¸­å®Œå…¨ä¸åŒçš„<strong>è‡ªå®šä¹‰æ–‡ä»¶å¤¹</strong>ä¸­ã€‚</p><h2 id="æ‹†åˆ†ç»„ä»¶HTMLå’ŒC-ä»£ç "><a href="#æ‹†åˆ†ç»„ä»¶HTMLå’ŒC-ä»£ç " class="headerlink" title="æ‹†åˆ†ç»„ä»¶HTMLå’ŒC#ä»£ç "></a>æ‹†åˆ†ç»„ä»¶HTMLå’ŒC#ä»£ç </h2><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒHTML å’Œ C# éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™å¯¹äºåƒè¿™ä¸ªè®¡æ•°å™¨è¿™æ ·çš„ç®€å•ç»„ä»¶æ¥è¯´å¾ˆå¥½ï¼Œä½†æ˜¯å°† HTML å’Œ C# ä»£ç åˆ†ç¦»åˆ°å®ƒä»¬è‡ªå·±çš„æ–‡ä»¶ä¸­é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚å®ƒä¸ä»…ä»ç»´æŠ¤çš„è§’åº¦æ¥çœ‹å¾ˆå¥½ï¼Œè€Œä¸”ä¹Ÿå¾ˆå®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p><p>æœ‰ 2 ç§æ–¹æ³•ï¼Œå°†ç»„ä»¶ HTML å’Œ C# ä»£ç æ‹†åˆ†ä¸ºå„è‡ªç‹¬ç«‹çš„æ–‡ä»¶ã€‚</p><ol><li>éƒ¨åˆ†æ–‡ä»¶æ–¹æ³•</li><li>åŸºç±»æ–¹æ³•</li></ol><p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®ºè¿™ä¸¤ç§æ–¹æ³•ã€‚</p>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—ç¿»è¯‘04-Razorç»„ä»¶</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>ã€Blazor-03ã€‘- Blazoré¡¹ç›®ç»“æ„</title>
    <link href="https://jonty.top/2023/03/23/blazor-project-structure/"/>
    <id>https://jonty.top/2023/03/23/blazor-project-structure/</id>
    <published>2023-03-23T02:07:10.000Z</published>
    <updated>2023-03-23T02:20:23.981Z</updated>
    
    <content type="html"><![CDATA[<p>äº†è§£ASP.NET Core Blazoré¡¹ç›®ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</p><p><img data-src="https://cdn.jonty.top/img/image-20220411230426968.png" alt="image-20220411230426968"></p><h2 id="Program-cs"><a href="#Program-cs" class="headerlink" title="Program.cs"></a>Program.cs</h2><p>åº”ç”¨ç¨‹åºå¯åŠ¨ä»£ç ï¼Œç”¨äºï¼š</p><ul><li>é…ç½®åº”ç”¨æ‰€éœ€æœåŠ¡</li><li>è¯·æ±‚ç®¡é“æ³¨å†Œä¸­é—´ä»¶</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> StudentManagement.Api.Models;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add services to the container.</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddControllers();</span><br><span class="line">builder.Services.AddEndpointsApiExplorer();</span><br><span class="line">builder.Services.AddSwaggerGen();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Configure the HTTP request pipeline.</span></span><br><span class="line"><span class="keyword">if</span> (app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseSwagger();</span><br><span class="line">    app.UseSwaggerUI();</span><br><span class="line">&#125;</span><br><span class="line">app.UseAuthorization();</span><br><span class="line"></span><br><span class="line">app.MapControllers();</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure><h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h3><p><code>builder</code> æ˜¯ä¸€ä¸ª <code>WebApplicationBuilder</code>ï¼Œç”¨äºå°†é…ç½®ã€æ—¥å¿—å’Œå…¶ä»–æœåŠ¡æ·»åŠ åˆ°<strong>DI</strong>å®¹å™¨ä¸­ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†ŒæœåŠ¡åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddControllers();</span><br><span class="line">builder.Services.AddEndpointsApiExplorer();</span><br><span class="line">builder.Services.AddSwaggerGen();</span><br></pre></td></tr></table></figure><h3 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h3><p>è¯·æ±‚å¤„ç†ç®¡é“ç”±ä¸€ç³»åˆ—ä¸­é—´ä»¶ç»„ä»¶ç»„æˆã€‚ æ¯ä¸ªç»„ä»¶åœ¨ <a href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/http-context?view=aspnetcore-6.0"><code>HttpContext</code></a> ä¸Šæ‰§è¡Œæ“ä½œï¼Œè°ƒç”¨ç®¡é“ä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–ç»ˆæ­¢è¯·æ±‚ã€‚</p><p>é€šè¿‡è°ƒç”¨ <code>Use&#123;Feature&#125;</code> æ‰©å±•æ–¹æ³•ï¼Œå‘ç®¡é“æ·»åŠ ä¸­é—´ä»¶ç»„ä»¶ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†ŒHTTPè¯·æ±‚ç®¡é“</span></span><br><span class="line"><span class="keyword">if</span> (app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseSwagger();</span><br><span class="line">    app.UseSwaggerUI();</span><br><span class="line">&#125;</span><br><span class="line">app.UseAuthorization();</span><br><span class="line"></span><br><span class="line">app.MapControllers();</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure><h2 id="wwwroot"><a href="#wwwroot" class="headerlink" title="wwwroot"></a>wwwroot</h2><p>å¯¹äºæ‰€æœ‰é¡¹ç›®ç±»å‹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«äº†é™æ€æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ã€æ ·å¼è¡¨ç­‰ã€‚</p><h2 id="App-razor"><a href="#App-razor" class="headerlink" title="App.razor"></a>App.razor</h2><p>è¿™æ˜¯åº”ç”¨ç¨‹åºçš„æ ¹ç»„ä»¶ã€‚å®ƒä½¿ç”¨äº†å†…ç½®çš„Routerç»„ä»¶ï¼Œå¹¶è®¾ç½®äº†å®¢æˆ·ç«¯è·¯ç”±ã€‚æ­£æ˜¯è¿™ä¸ªRouterç»„ä»¶æ‹¦æˆªäº†æµè§ˆå™¨çš„å¯¼èˆªï¼Œå¹¶æ¸²æŸ“å‡ºä¸è¯·æ±‚åœ°å€åŒ¹é…çš„é¡µé¢ã€‚å½“æ‰¾åˆ°åŒ¹é…åï¼ŒRouterä½¿ç”¨Foundå±æ€§æ¥æ˜¾ç¤ºå†…å®¹ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å†…å®¹ï¼ŒNotFoundå±æ€§ç”¨äºæ˜¾ç¤ºæ¶ˆæ¯â€“å¯¹ä¸èµ·ï¼Œè¿™ä¸ªåœ°å€æ²¡æœ‰ä»»ä½•å†…å®¹ã€‚</p><h2 id="é¡µé¢æ–‡ä»¶å¤¹"><a href="#é¡µé¢æ–‡ä»¶å¤¹" class="headerlink" title="é¡µé¢æ–‡ä»¶å¤¹"></a>é¡µé¢æ–‡ä»¶å¤¹</h2><p>è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«_Host  Razor Pageså’Œç»„æˆBrazoråº”ç”¨ç¨‹åºçš„å¯è·¯ç”±ç»„ä»¶ã€‚è¿™äº›ç»„ä»¶çš„æ‰©å±•åæ˜¯**.razor**ã€‚</p><ul><li>ç´¢å¼•ç»„ä»¶ (Index.razor) - å½“æˆ‘ä»¬å¯¼èˆªåˆ°æ ¹åº”ç”¨ç¨‹åºçš„URLæ—¶æ˜¾ç¤ºã€‚</li><li>Counterç»„ä»¶ (Counter.razor) - å½“æˆ‘ä»¬å¯¼èˆªåˆ°è·¯å¾„/counteræ—¶æ˜¾ç¤ºã€‚</li><li>FetchDataç»„ä»¶(FetchData.razor) - å½“æˆ‘ä»¬å¯¼èˆªåˆ°è·¯å¾„/fetchdataæ—¶æ˜¾ç¤ºã€‚</li><li>Errorç»„ä»¶(Error.razor) - å½“blazoråº”ç”¨ç¨‹åºä¸­å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸æ—¶ï¼Œä¼šè¢«æ¸²æŸ“ã€‚</li></ul><h2 id="å…±äº«æ–‡ä»¶å¤¹"><a href="#å…±äº«æ–‡ä»¶å¤¹" class="headerlink" title="å…±äº«æ–‡ä»¶å¤¹"></a>å…±äº«æ–‡ä»¶å¤¹</h2><p>å½“æˆ‘ä»¬å¯¼èˆªåˆ°/fetchdataçš„è·¯å¾„æ—¶æ˜¾ç¤ºã€‚é¡¾åæ€ä¹‰ï¼ŒåŒ…å«äº†å…±äº«çš„ç»„ä»¶</p><h2 id="MainLayoutç»„ä»¶-MainLayout-razor"><a href="#MainLayoutç»„ä»¶-MainLayout-razor" class="headerlink" title="MainLayoutç»„ä»¶ (MainLayout.razor)"></a>MainLayoutç»„ä»¶ (MainLayout.razor)</h2><p>åº”ç”¨ç¨‹åºçš„ä¸»è¦å¸ƒå±€ç»„ä»¶</p><h2 id="NavMenuç»„ä»¶-NavMenu-razor"><a href="#NavMenuç»„ä»¶-NavMenu-razor" class="headerlink" title="NavMenuç»„ä»¶ (NavMenu.razor)"></a>NavMenuç»„ä»¶ (NavMenu.razor)</h2><p>å®ç°äº†ä¾§è¾¹æ ä¸Šçš„å¯¼èˆªèœå•ã€‚NavLinkç»„ä»¶ï¼Œæ¸²æŸ“å¯¼èˆªé“¾æ¥åˆ°å…¶ä»–Razorç»„ä»¶ï¼Œå¦‚ç´¢å¼•ã€è®¡æ•°å™¨å’Œfetchdataç»„ä»¶ã€‚è¿™ä¸ªNavLinkç»„ä»¶è¶³å¤Ÿæ™ºèƒ½ï¼Œå¦‚æœå¯¼èˆªèœå•é¡¹å½“å‰æ˜¾ç¤ºçš„æ˜¯å®ƒçš„ç»„ä»¶ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥é«˜äº®æ˜¾ç¤ºå¯¼èˆªèœå•é¡¹ã€‚</p><h2 id="Imports-razor"><a href="#Imports-razor" class="headerlink" title="_Imports.razor"></a>_Imports.razor</h2><p>è¿™å°±åƒ<strong>Asp.Net Core MVC</strong>é¡¹ç›®ä¸­çš„**_ViewImports.cshtml**æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å¸¸ç”¨çš„å‘½åç©ºé—´ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸€ä¸ªrazorç»„ä»¶ä¸­éƒ½åŒ…å«å®ƒä»¬ã€‚</p><h2 id="wwwroot-index-html"><a href="#wwwroot-index-html" class="headerlink" title="wwwroot/index.html"></a>wwwroot/index.html</h2><p>è¿™æ˜¯<strong>Blazor WebAssembly</strong>é¡¹ç›®ä¸­çš„æ ¹é¡µé¢ï¼Œä»¥<strong>html</strong>é¡µé¢çš„å½¢å¼å®ç°ã€‚å½“ç¬¬ä¸€ä¸ªè¯·æ±‚è¿›å…¥åº”ç”¨ç¨‹åºæ—¶ï¼Œæœ€åˆæœåŠ¡çš„å°±æ˜¯è¿™ä¸ªé¡µé¢ã€‚å®ƒæœ‰æ ‡å‡†çš„HTMLã€HEADå’ŒBODYæ ‡è®°ã€‚å®ƒæŒ‡å®šäº†æ ¹åº”ç”¨ç¨‹åºç»„ä»¶<strong>App.razor</strong>åº”è¯¥è¢«æ¸²æŸ“åˆ°å“ªé‡Œã€‚å¯ä»¥åœ¨æ ¹é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°è¿™ä¸ªApp.razoræ ¹ç»„ä»¶ã€‚å®ƒä½œä¸ºä¸€ä¸ªHTMLå…ƒç´ <app>åŒ…å«åœ¨é¡µé¢ä¸­ã€‚æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„è§†é¢‘ä¸­è¯¦ç»†è®¨è®ºrazorç»„ä»¶ã€‚</p><p>è¿™ä¸ª<strong>index.html</strong>é¡µé¢è¿˜åŠ è½½äº†<strong>Blazor WebAssembly JavaScript</strong>æ–‡ä»¶ï¼ˆ**_framework/blazor.webassembly.js**ï¼‰ã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯è´Ÿè´£ä¸‹è½½çš„æ–‡ä»¶ã€‚</p><ul><li>ç¼–è¯‘åçš„blazoråº”ç”¨ç¨‹åºï¼Œå®ƒçš„ä¾èµ–å…³ç³»å’Œ.NETè¿è¡Œæ—¶ã€‚</li><li>å®ƒè¿˜ä¼šåˆå§‹åŒ–è¿è¡Œæ—¶ï¼Œä»¥ä¾¿åœ¨æµè§ˆå™¨ä¸­è¿è¡Œblazoråº”ç”¨ç¨‹åºã€‚</li></ul><h2 id="Pages-Host-cshtml"><a href="#Pages-Host-cshtml" class="headerlink" title="Pages/_Host.cshtml"></a>Pages/_Host.cshtml</h2><p>è¿™æ˜¯åº”ç”¨ç¨‹åºçš„æ ¹é¡µé¢ï¼Œé€šè¿‡è°ƒç”¨ MapFallbackToPage(â€œ/_Hostâ€) æ–¹æ³•æŒ‡å®šã€‚å®ƒçš„å®ç°æ˜¯<strong>Razor</strong>é¡µé¢ã€‚</p><p>è¿™ä¸ªé¡µé¢æ˜¯åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾åº”ç”¨ç¨‹åºæ—¶æä¾›çš„ã€‚å®ƒå…·æœ‰æ ‡å‡†çš„ HTMLã€HEAD å’Œ BODY æ ‡ç­¾ã€‚å®ƒè¿˜æŒ‡å®šäº†æ ¹åº”ç”¨ç¨‹åºç»„ä»¶ App ç»„ä»¶ (App.razor) å¿…é¡»å‘ˆç°çš„ä½ç½®ã€‚æœ€åï¼Œå®ƒè¿˜åŠ è½½ blazor.server.js JavaScript æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æµè§ˆå™¨ä¹‹é—´å»ºç«‹å®æ—¶ SignalR è¿æ¥ã€‚æ­¤è¿æ¥ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢ä¿¡æ¯ã€‚SignalR æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¡†æ¶ï¼Œç”¨äºå‘åº”ç”¨ç¨‹åºæ·»åŠ å®æ—¶ Web åŠŸèƒ½ã€‚ </p><h2 id="Data-folder-Blazor-Server"><a href="#Data-folder-Blazor-Server" class="headerlink" title="Data folder (Blazor Server)"></a>Data folder (Blazor Server)</h2><p>åŒ…å«ä¸ç¤ºä¾‹ WeatherForecast æœåŠ¡ç›¸å…³çš„ä»£ç æ–‡ä»¶</p><h2 id="appsettings-json-Blazor-Server"><a href="#appsettings-json-Blazor-Server" class="headerlink" title="appsettings.json (Blazor Server)"></a>appsettings.json (Blazor Server)</h2><p>å°±åƒ <strong>ASP.NET Core MVC</strong>é¡¹ç›®ä¸€æ ·ï¼ŒBlazor é¡¹ç›®ä¹Ÿä½¿ç”¨æ­¤æ–‡ä»¶æ¥å­˜å‚¨é…ç½®è®¾ç½®ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Blazor Server å’Œ Blazor WebAssembly åªæ˜¯æˆ‘ä»¬æ‰˜ç®¡ Blazor åº”ç”¨ç¨‹åºçš„ä¸¤ç§ä¸åŒæ–¹å¼ã€‚</p><p>Blazor åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯ razor ç»„ä»¶ã€‚ç»„ä»¶æ˜¯ Blazor åº”ç”¨ç¨‹åºçš„åŸºæœ¬æ„å»ºå—ã€‚</p><p>å¯¹äº Blazor æœåŠ¡å™¨åº”ç”¨å’Œ Blazor WebAssembly åº”ç”¨ï¼Œæˆ‘ä»¬æ„å»ºè¿™äº›ç»„ä»¶çš„æ–¹å¼æ˜¯ç›¸åŒçš„ã€‚</p><p>å› æ­¤ï¼Œåªæœ‰ä¸€ä¸ª Blazor æ¡†æ¶ï¼Œè€Œæ„å»ºçš„æ–¹å¼ï¼Œ<strong>Blazor Server</strong>åº”ç”¨ç¨‹åºå’Œ <strong>Blazor WebAssembly</strong> åº”ç”¨ç¨‹åºéå¸¸ç›¸ä¼¼ã€‚</p><p><strong>å”¯ä¸€çš„åŒºåˆ«</strong>åœ¨äºåº”ç”¨ç¨‹åºçš„<strong>æ‰˜ç®¡æ–¹å¼</strong>ã€‚</p>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—ç¿»è¯‘03-Blazoré¡¹ç›®ç»“æ„</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>Blazorç³»åˆ—æ–‡ç« ç›®å½•</title>
    <link href="https://jonty.top/2023/03/23/blazor-server-basic-tutorial/"/>
    <id>https://jonty.top/2023/03/23/blazor-server-basic-tutorial/</id>
    <published>2023-03-23T01:57:11.000Z</published>
    <updated>2023-04-26T03:11:02.070Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>Blazorå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡ŒC#ä»£ç ï¼Œä½¿ç”¨WebAssemblyã€‚å®ƒå’ŒAngularã€Reactã€Vueç­‰JavaScriptæ¡†æ¶ä¸€æ ·ï¼Œåœ¨ç›¸åŒçš„å®‰å…¨æ²™ç›’ä¸­è¿è¡Œã€‚ä¸ä»…ä»…æ˜¯C#ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨WebAssemblyåœ¨æµè§ˆå™¨ä¸­è¿è¡Œä»»ä½•ç±»å‹çš„ä»£ç ã€‚</p><p>WebAssemblyæ˜¯åŸºäºå¼€æ”¾çš„Webæ ‡å‡†ã€‚æ‰€ä»¥å®ƒæ˜¯æ‰€æœ‰ç°ä»£æµè§ˆå™¨åŒ…æ‹¬ç§»åŠ¨æµè§ˆå™¨çš„åŸç”Ÿéƒ¨åˆ†ã€‚è¿™æ„å‘³ç€blazoråº”ç”¨ç¨‹åºçš„å·¥ä½œï¼Œä¸éœ€è¦åƒ<code>silverlight</code>å’Œ<code>flash</code>æ—¶ä»£é‚£æ ·å®‰è£…ä»»ä½•ç‰¹æ®Šçš„æ’ä»¶ã€‚</p></div><h2 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h2><ul><li><input checked="" disabled="" type="checkbox"> <a href="/2023/02/15/what-is-blazor/" title="Blazor ç®€ä»‹">Blazor ç®€ä»‹</a></li><li><input checked="" disabled="" type="checkbox"> <a href="/2023/03/23/blazor-hosting-models/" title="Blazor æ‰˜ç®¡æ¨¡å‹">Blazor æ‰˜ç®¡æ¨¡å‹</a></li><li><input checked="" disabled="" type="checkbox"> <a href="/2023/03/23/blazor-project-structure/" title="Blazor é¡¹ç›®ç»“æ„">Blazor é¡¹ç›®ç»“æ„</a></li><li><input checked="" disabled="" type="checkbox"> <a href="/2023/03/23/razor-components/" title="Blazor Razor ç»„ä»¶">Blazor Razor ç»„ä»¶</a></li><li><input checked="" disabled="" type="checkbox"> <a href="/2023/04/26/split-razor-component/" title="Blazor æ‹†åˆ†ç»„ä»¶">Blazor æ‹†åˆ†ç»„ä»¶</a></li><li><input checked="" disabled="" type="checkbox"> <a href="/2023/04/26/blazor-model-classes/" title="Blazor æ¨¡å‹ç±»">Blazor æ¨¡å‹ç±»</a></li><li><input checked="" disabled="" type="checkbox"> <a href="/2023/04/26/blazor-component/" title="å‘˜å·¥åˆ—è¡¨ç»„ä»¶">å‘˜å·¥åˆ—è¡¨ç»„ä»¶</a></li><li><input disabled="" type="checkbox"> Blazor åŠ è½½æŒ‡ç¤ºå™¨</li><li><input disabled="" type="checkbox"> Blazor æ•°æ®è®¿é—®ç­–ç•¥</li><li><input disabled="" type="checkbox"> ä»€ä¹ˆæ˜¯ RESTful API</li><li><input disabled="" type="checkbox"> åˆ›å»º REST API</li><li><input disabled="" type="checkbox"> REST API æ•°æ®åº“ä¸Šä¸‹æ–‡</li><li><input disabled="" type="checkbox"> REST API ä¸­çš„å­˜å‚¨åº“æ¨¡å¼</li><li><input disabled="" type="checkbox"> REST API è·å–åˆ—è¡¨</li><li><input disabled="" type="checkbox"> REST API é€šè¿‡ ID è·å–</li><li><input disabled="" type="checkbox"> åœ¨ REST API ä¸­å‘å¸ƒ</li><li><input disabled="" type="checkbox"> REST API æ¨¡å‹éªŒè¯</li><li><input disabled="" type="checkbox"> ä½¿ç”¨ REST API</li><li><input disabled="" type="checkbox"> åœ¨ REST API ä¸­åˆ é™¤</li><li><input disabled="" type="checkbox"> åœ¨ REST API ä¸­æœç´¢</li><li><input disabled="" type="checkbox"> ä» Blazor è°ƒç”¨ REST API</li><li><input disabled="" type="checkbox"> Blazor è·¯ç”±å‚æ•°</li><li><input disabled="" type="checkbox"> æ¥è‡ªå¤šä¸ªè¡¨çš„æ•°æ®</li><li><input disabled="" type="checkbox"> Blazor äº‹ä»¶å¤„ç†</li><li><input disabled="" type="checkbox"> Blazor æ•°æ®ç»‘å®š</li><li><input disabled="" type="checkbox"> Blazor åŒå‘ç»‘å®š</li><li><input disabled="" type="checkbox"> ç»„ä»¶å‚æ•°</li><li><input disabled="" type="checkbox"> Blazor äº‹ä»¶å›è°ƒ</li><li><input disabled="" type="checkbox"> æ„å»º Blazor è¡¨å•</li><li><input disabled="" type="checkbox"> Blazor é€‰æ‹©åˆ—è¡¨</li><li><input disabled="" type="checkbox"> è‡ªå®šä¹‰è¾“å…¥ç»„ä»¶</li><li><input disabled="" type="checkbox"> RCL é¡¹ç›®</li><li><input disabled="" type="checkbox"> å°†æšä¸¾ç»‘å®šåˆ°é€‰æ‹©</li><li><input disabled="" type="checkbox"> Blazor æ—¥æœŸé€‰æ‹©å™¨</li><li><input disabled="" type="checkbox"> Blazor è¡¨å•éªŒè¯</li><li><input disabled="" type="checkbox"> è‡ªå®šä¹‰è¡¨å•éªŒè¯</li><li><input disabled="" type="checkbox"> æ¯”è¾ƒéªŒè¯</li><li><input disabled="" type="checkbox"> å¤æ‚æ¨¡å‹éªŒè¯</li><li><input disabled="" type="checkbox"> ASP.NET Core ä¸­çš„ AutoMapper</li><li><input disabled="" type="checkbox"> ç¼–è¾‘å’Œæ›´æ–°</li><li><input disabled="" type="checkbox"> åˆ›å»ºæ“ä½œ</li><li><input disabled="" type="checkbox"> å¼ºåˆ¶é‡æ–°åŠ è½½ç»„ä»¶</li><li><input disabled="" type="checkbox"> åˆ é™¤æ“ä½œ</li><li><input disabled="" type="checkbox"> ç»„ä»¶é€šä¿¡</li><li><input disabled="" type="checkbox"> åˆ é™¤ç¡®è®¤</li><li><input disabled="" type="checkbox"> å±æ€§æº…å°„</li><li><input disabled="" type="checkbox"> ä»»æ„å±æ€§</li><li><input disabled="" type="checkbox"> çº§è”å€¼</li><li><input disabled="" type="checkbox"> å¤šä¸ªçº§è”å‚æ•°</li><li><input disabled="" type="checkbox"> çº§è”å€¼æ€§èƒ½</li><li><input disabled="" type="checkbox"> Blazor ä¸­çš„èº«ä»½è®¾ç½®</li><li><input disabled="" type="checkbox"> Cookie èº«ä»½éªŒè¯</li><li><input disabled="" type="checkbox"> èº«ä»½éªŒè¯ - ç™»å½•é¡µé¢</li><li><input disabled="" type="checkbox"> èº«ä»½éªŒè¯ - æ³¨é”€é¡µé¢</li><li><input disabled="" type="checkbox"> Blazor ä¸­çš„æˆæƒ</li><li><input disabled="" type="checkbox"> Blazor æˆæƒå±æ€§</li><li><input disabled="" type="checkbox"> ä»£ç ä¸­çš„ Blazor æˆæƒ</li></ul>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—æ–‡ç« ç›®å½•</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>ã€Blazor-02ã€‘- Blazorçš„æ‰˜ç®¡æ¨¡å‹</title>
    <link href="https://jonty.top/2023/03/23/blazor-hosting-models/"/>
    <id>https://jonty.top/2023/03/23/blazor-hosting-models/</id>
    <published>2023-03-23T01:50:13.000Z</published>
    <updated>2023-03-23T02:20:04.989Z</updated>
    
    <content type="html"><![CDATA[<p>ä½ å¦‚æœè¿˜æ²¡æœ‰å®‰è£…å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥å‰å¾€<a href="./what-is-blazor.md#Blazor%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">Blazorä»‹ç»</a>çš„ä¸‹æ–¹æœ‰æœºå™¨é…ç½®è¯´æ˜</p><p>æˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªBlazoré¡¹ç›®ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å°†åˆ›å»º2ä¸ªBlazoré¡¹ç›®ã€‚</p><ul><li>ä¸€ä¸ªæ˜¯æœåŠ¡å™¨ç«¯æ‰˜ç®¡:Blazor Server</li><li>å¦ä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯æ‰˜ç®¡: Blazor WebAssembly</li></ul><p>ç„¶åï¼Œæˆ‘ä»¬å°†è¿è¡Œè¿™ä¸¤ä¸ªé¡¹ç›®ï¼Œçœ‹çœ‹å®ƒä»¬åœ¨æ‰§è¡Œä¸­çš„åŒºåˆ«ã€‚</p><ul><li>äº†è§£è¿™ä¸¤ç§æ‰˜ç®¡æ¨¡å¼çš„åŒºåˆ«ä»¥åŠå„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚</li></ul><h2 id="åˆ›å»ºBlazoråº”ç”¨ç¨‹åº"><a href="#åˆ›å»ºBlazoråº”ç”¨ç¨‹åº" class="headerlink" title="åˆ›å»ºBlazoråº”ç”¨ç¨‹åº"></a>åˆ›å»ºBlazoråº”ç”¨ç¨‹åº</h2><p><img data-src="https://cdn.jonty.top/img/image-20220411221907210.png" alt="image-20220411221907210"></p><h2 id="Bloazoræ‰˜ç®¡æ¨¡å¼"><a href="#Bloazoræ‰˜ç®¡æ¨¡å¼" class="headerlink" title="Bloazoræ‰˜ç®¡æ¨¡å¼"></a>Bloazoræ‰˜ç®¡æ¨¡å¼</h2><p>Blazoræœ‰ä¸¤ç§æ‰˜ç®¡æ¨¡å¼ï¼šBlazor WebAssemblyï¼ˆå®¢æˆ·ç«¯æ‰˜ç®¡æ¨¡å¼ï¼‰å’ŒBlazor Serverï¼ˆæœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼ï¼‰ã€‚</p><p><img data-src="https://cdn.jonty.top/img/blazorhostingmodelsexplained.png"></p><p>æ­£å¦‚æ¨¡æ¿åç§°æ‰€æš—ç¤ºçš„é‚£æ ·ï¼Œä½¿ç”¨Blazor Server Appæ¨¡æ¿æ¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼çš„Blazoråº”ç”¨ç¨‹åºï¼Œä½¿ç”¨Blazor WebAssemblyæ¨¡æ¿æ¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å®¢æˆ·ç«¯æ‰˜ç®¡æ¨¡å¼çš„Blazoråº”ç”¨ç¨‹åºã€‚</p><p>BlazoræœåŠ¡å™¨ä¸Blazor WebAssemblyçš„æ¯”è¾ƒ<br>2ç§é¡¹ç›®ç±»å‹çš„é¡¹ç›®ç»“æ„å’Œå¸ƒå±€æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ã€‚</p><h2 id="blazor-server-vs-blazor-webassembly"><a href="#blazor-server-vs-blazor-webassembly" class="headerlink" title="blazor server vs blazor webassembly"></a>blazor server vs blazor webassembly</h2><p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªèŠ‚ä¸­è¯¦ç»†è®¨è®ºè¿™äº›ä¸åŒæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ç›®çš„ã€‚</p><p><img data-src="https://cdn.jonty.top/img/blazorservervsblazorwebassembly.png"></p><h2 id="åœ¨-Visual-Studio-ä¸­é…ç½®å¤šä¸ªå¯åŠ¨é¡¹ç›®"><a href="#åœ¨-Visual-Studio-ä¸­é…ç½®å¤šä¸ªå¯åŠ¨é¡¹ç›®" class="headerlink" title="åœ¨ Visual Studio ä¸­é…ç½®å¤šä¸ªå¯åŠ¨é¡¹ç›®"></a>åœ¨ Visual Studio ä¸­é…ç½®å¤šä¸ªå¯åŠ¨é¡¹ç›®</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨Visual Studioä¸­é…ç½®å¤šä¸ªé¡¹ç›®ä½œä¸º<strong>StartUpé¡¹ç›®</strong>ã€‚</p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹:</p><p>åœ¨è§£å†³æ–¹æ¡ˆèµ„æºç®¡ç†å™¨ä¸­å³é”®ç‚¹å‡»è§£å†³æ–¹æ¡ˆåç§°ï¼Œé€‰æ‹©è®¾ç½®<strong>StartUpé¡¹ç›®</strong>é€‰é¡¹</p><p><img data-src="https://cdn.jonty.top/img/image-20220411222732534.png" alt="image-20220411222732534"></p><p>é€‰æ‹© <strong>å¤šä¸ªå¯åŠ¨é¡¹ç›®</strong>å•é€‰æŒ‰é’®ã€‚é’ˆå¯¹æ¯ä¸ªè¦è®¾ç½®ä¸ºå¯åŠ¨é¡¹ç›®çš„é¡¹ç›®ï¼Œä» <strong>æ“ä½œ</strong>ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹© <strong>å¯åŠ¨</strong>ã€‚</p><p><img data-src="https://cdn.jonty.top/img/image-20220411222844570.png" alt="image-20220411222844570"></p><h2 id="Blazor-WebAssemblyæ‰˜ç®¡æ¨¡å¼"><a href="#Blazor-WebAssemblyæ‰˜ç®¡æ¨¡å¼" class="headerlink" title="Blazor WebAssemblyæ‰˜ç®¡æ¨¡å¼"></a>Blazor WebAssemblyæ‰˜ç®¡æ¨¡å¼</h2><p>åœ¨è¿™ç§æ‰˜ç®¡æ¨¡å¼ä¸‹ï¼Œåº”ç”¨ç¨‹åºç›´æ¥åœ¨æµè§ˆå™¨ä¸­çš„WebAssemblyä¸Šã€‚</p><p>å› æ­¤ï¼Œåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„ä¸€åˆ‡ï¼Œå³ç¼–è¯‘åçš„åº”ç”¨ç¨‹åºï¼Œå®ƒçš„ä¾èµ–å…³ç³»å’Œ.NETè¿è¡Œæ—¶éƒ½ä¼šä»æœåŠ¡å™¨ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œè¿™ä¸€ç‚¹å’ŒAngularã€Vueã€Reactç­‰å¼€å‘æ¨¡å¼æ˜¯ä¸€è‡´çš„ã€‚<br>Blazor WebAssemblyåº”ç”¨ç¨‹åºå¯ä»¥å®Œå…¨åœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨Web APIè°ƒç”¨æˆ–SignalRæ¥é…ç½®å®ƒä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚</p><p><img data-src="https://cdn.jonty.top/img/BlazorWebAssemblyhostingmodel.png" alt="Blazor WebAssembly æ‰˜ç®¡æ¨¡å‹"></p><p><img data-src="https://cdn.jonty.top/img/image-20220411223744216.png" alt="image-20220411223744216"></p><h3 id="Blazor-WebAssemblyæ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„ã€‚"><a href="#Blazor-WebAssemblyæ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„ã€‚" class="headerlink" title="Blazor WebAssemblyæ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„ã€‚"></a>Blazor WebAssemblyæ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„ã€‚</h3><ul><li>ä¸€ä¸ªBlazor WebAssemblyåº”ç”¨ç¨‹åºå¯ä»¥å®Œå…¨åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šè¿è¡Œã€‚å®ƒå¯ä»¥ç¦»çº¿å·¥ä½œã€‚å½“å¤±å»äº†ä¸æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­è¿è¡Œ</li></ul><ul><li><p>å®ƒä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°ä½œä¸ºä¸€ä¸ªæ¸è¿›å¼çš„Web Appè¿è¡Œï¼Œè¿™æ„å‘³ç€å®¢æˆ·å¯ä»¥é€‰æ‹©å°†æˆ‘ä»¬çš„Appå®‰è£…åˆ°ä»–ä»¬çš„è®¾å¤‡ä¸Šï¼Œåœ¨æ²¡æœ‰ä»»ä½•ç½‘ç»œè¿æ¥çš„æƒ…å†µä¸‹éšæ—¶è¿è¡Œã€‚</p></li><li><p>Web Assemblyåœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼Œåœ¨æµè§ˆå™¨å†…éƒ¨ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºé™æ€æ–‡ä»¶éƒ¨ç½²ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç”±äºæµè§ˆå™¨çš„å®‰å…¨é™åˆ¶ï¼ŒBlazor Wasmåº”ç”¨ç¨‹åºä¸ä¼šç›´æ¥ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­è¿è¡Œã€‚</p></li></ul><ul><li>å½“åº”ç”¨ç¨‹åºä»æœåŠ¡å™¨ä¸‹è½½åˆ°å®¢æˆ·ç«¯åï¼Œå¹³æ—¶çš„è®¡ç®—å·¥ä½œä½¿ç”¨çš„æ˜¯å®¢æˆ·ç«¯çš„èµ„æºå’Œèƒ½åŠ›ã€‚åœ¨å®¢æˆ·æœºä¸Šè¿è¡Œçš„ä»£ç ï¼Œæ„å‘³ç€æœåŠ¡å™¨çš„è´Ÿè½½å¤§å¤§é™ä½ã€‚</li></ul><ul><li>æˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå®Œæ•´çš„ASP.NET Core webæœåŠ¡å™¨æ¥æ‰˜ç®¡åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬åªéœ€è¦ä¸€å°æœåŠ¡å™¨ï¼Œä¾¿å¯ä»¥å°†åº”ç”¨ç¨‹åºä¼ é€åˆ°å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸Šã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨äº’è”ç½‘ä¸Šçš„ä»»ä½•åœ°æ–¹ï¼Œåœ¨äº‘ç«¯ï¼Œåœ¨Azureä¸Šä½œä¸ºé™æ€ç½‘ç«™ï¼Œç”šè‡³åœ¨CDNå†…å®¹äº¤ä»˜ç½‘ç»œä¸Šï¼Œå°†åº”ç”¨ç¨‹åºæ‰˜ç®¡åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚</li></ul><h3 id="Blazor-WebAssemblyæ‰˜ç®¡çš„ç¼ºç‚¹"><a href="#Blazor-WebAssemblyæ‰˜ç®¡çš„ç¼ºç‚¹" class="headerlink" title="Blazor WebAssemblyæ‰˜ç®¡çš„ç¼ºç‚¹"></a>Blazor WebAssemblyæ‰˜ç®¡çš„ç¼ºç‚¹</h3><p>Blazor WebAssemblyç®€ç§°ä¸ºBlazor Wasmã€‚</p><ul><li><p>ç¬¬ä¸€æ¬¡è¯·æ±‚é€šå¸¸éœ€è¦è¾ƒé•¿çš„æ—¶é—´ï¼Œå› ä¸º<code>blazor.webassembly.js</code>æ–‡ä»¶å¯¹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè¿›è¡Œå¼•å¯¼,æ‰€ä»¥æ•´ä¸ªåº”ç”¨ç¨‹åºã€å…¶ä¾èµ–å…³ç³»å’Œ.NETè¿è¡Œæ—¶å¿…é¡»ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚ä½†è¯·è®°ä½ï¼Œè¿™åªæ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ‰€èŠ±è´¹çš„æ—¶é—´æ¯”å¹³æ—¶é•¿ã€‚å¦‚æœé‚£ä¸ªç›¸åŒçš„å®¢æˆ·ç«¯ç¨åè®¿é—®è¯¥åº”ç”¨ç¨‹åºï¼Œé€šå¸¸ä¼šå¿«é€Ÿå¯åŠ¨ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šç¼“å­˜æ–‡ä»¶ã€‚</p></li><li><p>ç”±äºåº”ç”¨ç¨‹åºå®Œå…¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œæ‰€ä»¥å®ƒå—é™äºæµè§ˆå™¨çš„è®¡ç®—èƒ½åŠ›ã€‚</p></li><li><p>æ ¹æ®åº”ç”¨çš„æ€§è´¨ï¼Œéœ€è¦æœ‰ä¸€å®šèƒ½åŠ›çš„å®¢æˆ·ç«¯ç¡¬ä»¶å’Œè½¯ä»¶ã€‚ä¾‹å¦‚ï¼Œä»è½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªæ”¯æŒWebAssemblyçš„æµè§ˆå™¨ã€‚</p></li></ul><ul><li><p>Monoæ¡†æ¶è§£é‡Šçš„æ˜¯.NETä¸­é—´è¯­è¨€ï¼Œå› æ­¤æ¯”è¿è¡ŒæœåŠ¡å™¨ç«¯Blazorè¦æ…¢ã€‚Ahead-of-time (AOT) ç¼–è¯‘è®¡åˆ’åœ¨æœªæ¥çš„ä¸€ä¸ªç‰ˆæœ¬ä¸­è¿›è¡Œã€‚</p></li><li><p>Blazor Wasmè¿˜ä¸æ”¯æŒä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å¤„ç†éƒ½å‘ç”Ÿåœ¨UIçº¿ç¨‹ä¸Šâ€“ä½†æœåŠ¡å™¨/JavaScriptç­‰çš„è°ƒç”¨æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œæ‰€ä»¥ä¸ä¼šé˜»ç¢UIçš„å“åº”é€Ÿåº¦ã€‚</p></li><li><p>ä¸æœåŠ¡å™¨ç«¯ä¸åŒçš„æ˜¯ï¼ŒBlazor Wasmè¿˜ä¸æ”¯æŒåœ¨Visual Studioä¸­è¿›è¡Œè°ƒè¯•ã€‚åœ¨æµè§ˆå™¨å†…è°ƒè¯•C#ä»£ç æ˜¯å¯èƒ½çš„ï¼Œä½†å°½ç®¡å¯è¡Œï¼Œä½†è¿™å¹¶ä¸æ˜¯æœ€å¥½çš„ä½“éªŒã€‚</p></li><li><p>æ­¤å¤–ï¼ŒBlazor Wasmåªé€‚ç”¨äºè¾ƒæ–°çš„æµè§ˆå™¨ï¼Œå¹¶ä¸”ä¸æ”¯æŒæœç´¢å¼•æ“ï¼ˆé™¤éæˆ‘ä»¬å¯ç”¨æœåŠ¡å™¨ç«¯é¢„æ¸²æŸ“ï¼‰ã€‚</p></li></ul><h2 id="Blazor-ServeræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼"><a href="#Blazor-ServeræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼" class="headerlink" title="Blazor ServeræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼"></a>Blazor ServeræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼</h2><p>åœ¨è¿™ç§æ‰˜ç®¡æ¨¡å¼ä¸‹ï¼Œåº”ç”¨ç¨‹åºéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªSignalRè¿æ¥ã€‚å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ç‚¹å‡»æŒ‰é’®ï¼Œäº‹ä»¶çš„ä¿¡æ¯é€šè¿‡SignalRè¿æ¥å‘é€åˆ°æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¤„ç†è¯¥äº‹ä»¶ï¼Œå¹¶è®¡ç®—å‡ºç”Ÿæˆçš„HTMLçš„å·®å¼‚ï¼ˆå·®å€¼ï¼‰ã€‚æ•´ä¸ªHTMLä¸ä¼šå†æ¬¡è¢«å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œåªæœ‰å·®å€¼é€šè¿‡SignalRè¿æ¥å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ç„¶åæµè§ˆå™¨æ›´æ–°UIã€‚ç”±äºåªåº”ç”¨äº†å·®å¼‚åŒ–çš„å†…å®¹æ¥æ›´æ–°UIï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºæ„Ÿè§‰æ›´å¿«ï¼Œå¯¹ç”¨æˆ·çš„å“åº”ä¹Ÿæ›´å¿«ã€‚</p><p><img data-src="https://cdn.jonty.top/img/BlazorServerhostingmodel.png" alt="Blazor æœåŠ¡å™¨æ‰˜ç®¡æ¨¡å‹"></p><p><img data-src="https://cdn.jonty.top/img/image-20220411223908163.png" alt="image-20220411223908163"></p><h3 id="BlazoræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„"><a href="#BlazoræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„" class="headerlink" title="BlazoræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„"></a>BlazoræœåŠ¡å™¨æ‰˜ç®¡æ¨¡å¼çš„å¥½å¤„</h3><ul><li><p>BlazoræœåŠ¡å™¨ç«¯åœ¨å°†HTMLå†…å®¹å‘é€åˆ°å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¹‹å‰ï¼Œä¼šé¢„å…ˆæ¸²æŸ“HTMLå†…å®¹ã€‚è¿™ä½¿å¾—å®ƒå¯¹æœç´¢å¼•æ“å‹å¥½ï¼Œè€Œä¸”æ²¡æœ‰æ˜æ˜¾çš„å¯åŠ¨æ—¶é—´ã€‚</p></li><li><p>ç”±äºä¸‹è½½é‡æ˜æ˜¾å°äºBlazor WebAssemblyåº”ç”¨ç¨‹åºï¼Œå› æ­¤åŠ è½½é€Ÿåº¦æ›´å¿«</p></li><li><p>ç”±äºè¯¥åº”ç”¨ç¨‹åºè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤å®ƒå¯ä»¥å……åˆ†åˆ©ç”¨æœåŠ¡å™¨çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½¿ç”¨ä»»ä½•.NET Coreå…¼å®¹çš„APIã€‚<br>å®¢æˆ·ç«¯åªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥ä½¿ç”¨è¯¥åº”ç”¨ã€‚å³ä½¿æ˜¯ä¸æ”¯æŒWebAssemblyçš„æµè§ˆå™¨ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p></li><li><p>æ›´åŠ å®‰å…¨ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºçš„.NET/C#ä»£ç ä¸ä¼šè¢«å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</p></li></ul><ul><li>BlazoræœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºå¯ä»¥åœ¨æ—§çš„æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œå› ä¸ºä¸éœ€è¦Webæ±‡ç¼–ï¼Œåªéœ€è¦HTMLå’ŒJavaScriptã€‚ç”±äºä»£ç æ˜¯åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åœ¨Visual Studioä¸­è°ƒè¯•æˆ‘ä»¬çš„.NETä»£ç ã€‚</li></ul><h3 id="BlazoræœåŠ¡å™¨æ‰˜ç®¡-NETçš„ç¼ºç‚¹ã€‚"><a href="#BlazoræœåŠ¡å™¨æ‰˜ç®¡-NETçš„ç¼ºç‚¹ã€‚" class="headerlink" title="BlazoræœåŠ¡å™¨æ‰˜ç®¡.NETçš„ç¼ºç‚¹ã€‚"></a>BlazoræœåŠ¡å™¨æ‰˜ç®¡.NETçš„ç¼ºç‚¹ã€‚</h3><ul><li>éœ€è¦ä¸€ä¸ªå®Œæ•´çš„ASP.NET CoreæœåŠ¡å™¨æ¥æ‰˜ç®¡åº”ç”¨ç¨‹åºã€‚åœ¨æ— æœåŠ¡å™¨éƒ¨ç½²åœºæ™¯ï¼Œæ¯”å¦‚å¸Œæœ›ä»CDNä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚</li><li>éœ€è¦å§‹ç»ˆä¿æŒä¸æœåŠ¡å™¨çš„ä¸»åŠ¨è¿æ¥ã€‚è¿™æ„å‘³ç€éœ€è¦ä¿æŒæœåŠ¡å™¨24å°æ—¶ä¸é—´æ–­åœ°è¿è¡Œã€‚å¦‚æœæœåŠ¡å™¨ç˜«ç—ªï¼Œåº”ç”¨ç¨‹åºå°±ä¼šåœæ­¢å·¥ä½œã€‚</li><li>ç”±äºæ¯ä¸ªç”¨æˆ·çš„äº¤äº’éƒ½éœ€è¦å¾€è¿”äºæœåŠ¡å™¨ä¹‹é—´ï¼Œä¸Blazor WebAssemblyæ‰˜ç®¡ç›¸æ¯”ï¼Œé€šå¸¸ä¼šæœ‰è¾ƒé«˜çš„å»¶è¿Ÿã€‚</li></ul><ul><li>BlazoræœåŠ¡å™¨ç«¯ä¸ºå½“å‰å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªå†…å­˜å†…ä¼šè¯ï¼Œå¹¶ä½¿ç”¨SignalRåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„.NETå’Œå®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚æ‰€æœ‰çš„å†…å­˜å’ŒCPUçš„ä½¿ç”¨éƒ½æ˜¯ä»¥æœåŠ¡å™¨ä¸ºä»£ä»·çš„ï¼Œå¯¹æ‰€æœ‰ç”¨æˆ·æ¥è¯´ã€‚è¿™ä¹Ÿæ„å‘³ç€å®¢æˆ·ç«¯è¢«ç»‘å®šåˆ°æœ€åˆæœåŠ¡äºå®ƒçš„æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥ä¸å…·å¤‡è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨Azure SignalRæœåŠ¡ä¸BlazoræœåŠ¡å™¨åº”ç”¨ç¨‹åºæ¥å…‹æœè¿™ä¸ªå¯æ‰©å±•æ€§é—®é¢˜ã€‚è¿™ä¸ªæœåŠ¡å¯ä»¥è®©Blazor Server appé€šè¿‡æ”¯æŒå¤§é‡çš„å¹¶å‘SignalRè¿æ¥æ¥å®ç°è‰¯å¥½çš„æ‰©å±•æ€§ã€‚</li></ul>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—ç¿»è¯‘02-Blazorçš„æ‰˜ç®¡æ¨¡å‹</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>AQLæŠ½æ ·æ–¹æ³•ä»‹ç»</title>
    <link href="https://jonty.top/2023/02/17/acceptance-quality-limit/"/>
    <id>https://jonty.top/2023/02/17/acceptance-quality-limit/</id>
    <published>2023-02-17T08:03:55.000Z</published>
    <updated>2023-03-23T01:56:11.471Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="https://cdn.jonty.top/img/AQL-rev-8.jpg" alt="AQL-rev-8"></p><h2 id="AQLçš„å®šä¹‰"><a href="#AQLçš„å®šä¹‰" class="headerlink" title="AQLçš„å®šä¹‰"></a>AQLçš„å®šä¹‰</h2><p>AQLåŸæ¥å«<strong>åˆæ ¼è´¨é‡æ°´å¹³ï¼ˆAcceptable Quality Levelï¼‰</strong>ï¼Œåœ¨æ–°ç‰ˆå›½å®¶æ ‡å‡†ã€ŠGB/T 2828.1-2003 è®¡æ•°æŠ½æ ·æ£€éªŒç¨‹åº ç¬¬1éƒ¨åˆ†ï¼šæŒ‰æ¥æ”¶è´¨é‡é™ï¼ˆAQLï¼‰æ£€ç´¢çš„é€æ‰¹æ£€éªŒæŠ½æ ·è®¡åˆ’ã€‹ä¸­ï¼ŒAQLçš„å…¨ç§°è¢«æ”¹ä¸ºäº†<strong>æ¥æ”¶è´¨é‡é™åˆ¶ï¼ˆAcceptance Quality Limitï¼‰</strong>ï¼Œå…¶å®šä¹‰ä¸ºï¼šå½“ä¸€ä¸ªè¿ç»­ç³»åˆ—æ‰¹è¢«æäº¤éªŒæ”¶æŠ½æ ·æ—¶ï¼Œå¯å…è®¸çš„æœ€å·®è¿‡ç¨‹å¹³å‡è´¨é‡æ°´å¹³ã€‚</p><h2 id="æ£€éªŒæ°´å¹³"><a href="#æ£€éªŒæ°´å¹³" class="headerlink" title="æ£€éªŒæ°´å¹³"></a>æ£€éªŒæ°´å¹³</h2><p>åœ¨AQLä¸­ï¼Œæœ‰ä¸‰ç§ä¸€èˆ¬æ£€éªŒæ°´å¹³ï¼ˆâ… ã€â…¡ã€â…¢ï¼‰å’Œå››ç§ç‰¹æ®Šæ£€éªŒæ°´å¹³ï¼ˆS-1ã€S-2ã€S-3ã€S-4ï¼‰ã€‚<br>åœ¨ä¸‰ç§ä¸€èˆ¬æ£€éªŒæ°´å¹³ä¸­ï¼ŒLEVELâ…¡æ˜¯å¸¸è§„æ°´å¹³ï¼Œä¹Ÿæ˜¯æœ€ç»å¸¸é‡‡ç”¨çš„æ°´å¹³ã€‚ä»LEVELâ… åˆ°LEVELâ…¢æŠ½æ ·çš„æ•°é‡é€æ¸å¢åŠ ã€‚LEVELâ… çš„æŠ½æ ·æ•°æ˜¯LEVELâ…¡çš„40ï¼…ï¼Œé€‚ç”¨äºå“è´¨è¾ƒä¸ºç¨³å®šæˆ–äº§å“å‡ºç°ä¸ä¸€è‡´å¯èƒ½æ€§æå°çš„çŠ¶å†µã€‚LEVELâ…¢çš„æŠ½æ ·æ•°æ˜¯LEVELâ…¡çš„160ï¼…ï¼ŒåŠ å¤§æ£€éªŒçš„æ ·æœ¬æ•°é‡å¯ä»¥é™ä½æ¥å—ä¸åˆæ ¼äº§å“çš„å¯èƒ½æ€§ã€‚<br>å››ç§ç‰¹æ®Šæ£€éªŒæ°´å¹³çš„ç‰¹ç‚¹æ˜¯æŠ½æ ·æ•°é‡å°‘ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æ£€éªŒçš„æˆæœ¬é«˜ã€æ£€éªŒæ‰€èŠ±è´¹çš„æ—¶é—´é•¿ã€è´§ç‰©çš„å“è´¨æ¯”è¾ƒç¨³å®šï¼ˆå•ä¸€äº§å“çš„é‡å¤åŠ å·¥ï¼‰ï¼Œé€šè¿‡å°‘é‡çš„æŠ½æ ·æ£€éªŒå°±å¯ä»¥ååº”æ€»ä½“çš„å“è´¨æ°´å¹³ã€‚ä»S-1åˆ°S-4æŠ½æ ·æ£€éªŒæ•°é€æ­¥å¢åŠ ã€‚åœ¨æœè£…è¾…æ–™çš„æ£€éªŒä¸­æœ‰æ—¶ä¼šé‡‡ç”¨ç‰¹æ®Šæ£€éªŒæ°´å¹³ï¼Œä¾‹å¦‚æ‹‰é“¾ã€çº½æ‰£ç­‰çš„æ£€éªŒã€‚</p><h2 id="æŠ½æ ·æ–¹æ¡ˆ"><a href="#æŠ½æ ·æ–¹æ¡ˆ" class="headerlink" title="æŠ½æ ·æ–¹æ¡ˆ"></a>æŠ½æ ·æ–¹æ¡ˆ</h2><p>AQLæœ‰ä¸€æ¬¡ã€äºŒæ¬¡ã€å¤šæ¬¡ï¼ˆäº”æ¬¡ï¼‰3ç§æŠ½æ ·æ–¹æ¡ˆã€‚ç¡®å®šæŠ½æ ·æ–¹æ¡ˆå¯ä»¥ä»ä¸‹é¢å‡ ä¸ªæ–¹é¢æ¥è€ƒè™‘ï¼š<br>1ï¼‰ç®€ä¾¿æ˜“è¡Œï¼šä¸€æ¬¡ä¼˜äºäºŒæ¬¡ï¼ŒäºŒæ¬¡ä¼˜äºäº”æ¬¡ã€‚<br>2ï¼‰å¹³å‡æ ·æœ¬é‡ï¼šäº”æ¬¡å°‘äºäºŒæ¬¡ï¼ŒäºŒæ¬¡å°‘äºä¸€æ¬¡ã€‚<br>3ï¼‰ç®¡ç†éš¾åº¦ï¼šäº”æ¬¡éš¾äºäºŒæ¬¡ï¼ŒäºŒæ¬¡éš¾äºä¸€æ¬¡ã€‚<br>4ï¼‰å–æ ·çš„éš¾æ˜“ç¨‹åº¦ï¼šå–æ ·éº»çƒ¦æ—¶ï¼Œä¸€æ¬¡ä¼˜äºäºŒæ¬¡ï¼ŒäºŒæ¬¡ä¼˜äºäº”æ¬¡ã€‚<br>5ï¼‰è¯•éªŒæ—¶é—´çš„é•¿çŸ­ï¼šæ ¹æ®å•ä¸ªè¯•éªŒæ—¶é—´çš„é•¿çŸ­å’Œæ˜¯å¦å¯ä»¥å¤šä¸ªæ ·å“åŒæ—¶è¿›è¡Œè¯•éªŒæ¥ç¡®å®šæ€»çš„è¯•éªŒæ—¶é—´ã€‚</p><h2 id="ä¸¥æ ¼ç¨‹åº¦"><a href="#ä¸¥æ ¼ç¨‹åº¦" class="headerlink" title="ä¸¥æ ¼ç¨‹åº¦"></a>ä¸¥æ ¼ç¨‹åº¦</h2><p>AQLä¸­åˆ¶å®šäº†ä¸‰ç§ä¸¥æ ¼ç¨‹åº¦ï¼šæ­£å¸¸ï¼ˆNORMALï¼‰ã€åŠ ä¸¥ï¼ˆTIGHTENEDï¼‰ã€æ”¾å®½ï¼ˆREDUCEDï¼‰ã€‚<br>æ­£å¸¸æ£€éªŒæ˜¯æœ€å¸¸ç”¨çš„æ£€éªŒæ°´å¹³ï¼Œåˆšå¼€å§‹æ£€éªŒæ–°çš„ä¾›åº”å•†ç”Ÿäº§çš„è´§ç‰©æ—¶ï¼Œåº”é‡‡ç”¨æ­£å¸¸æ£€éªŒã€‚<br>ä¸€æ—¦é‡‡ç”¨äº†æ­£å¸¸ã€ä¸¥æ ¼ã€æ”¾å®½ä¸­çš„ä»»ä½•ä¸€ç§ï¼Œé‚£ä¹ˆåœ¨ä»¥åå¯¹åŒç³»åˆ—æˆ–åŒç±»å‹äº§å“çš„æ£€éªŒä¸­éƒ½åº”é‡‡å–è¿™ä¸€æ ‡å‡†ï¼Œé™¤éä¾›åº”å•†çš„äº§å“å“è´¨å‘ç”Ÿäº†å˜åŠ¨ã€‚</p><h3 id="AQLå€¼"><a href="#AQLå€¼" class="headerlink" title="AQLå€¼"></a>AQLå€¼</h3><p>å¯¹äºä¸åŒçš„è´¨é‡æ°´å¹³æˆ–è¦æ±‚ï¼ŒAQLæœ‰å¤šç§è§„å®šçš„æ•°å€¼ï¼Œä»0.010~1000ã€‚æœè£…ä¸šæœ€å¸¸ç”¨çš„AQLå€¼æ˜¯2.5ï¼Œè¦æ±‚é«˜ä¸€äº›çš„ç”¨1.5ï¼Œè¦æ±‚ç¨ä½çš„ç”¨4.0ã€‚ä¸åŒçš„AQLå€¼ä½“ç°äº†ä¸åŒçš„è´¨é‡æ°´å¹³ï¼Œé€šå¸¸AQLå€¼è¶Šå°ä»£è¡¨å“è´¨è¦æ±‚è¶Šé«˜ã€‚</p><h2 id="è½¬ç§»è§„åˆ™å’Œç¨‹åº"><a href="#è½¬ç§»è§„åˆ™å’Œç¨‹åº" class="headerlink" title="è½¬ç§»è§„åˆ™å’Œç¨‹åº"></a>è½¬ç§»è§„åˆ™å’Œç¨‹åº</h2><h3 id="æ­£å¸¸åˆ°åŠ ä¸¥"><a href="#æ­£å¸¸åˆ°åŠ ä¸¥" class="headerlink" title="æ­£å¸¸åˆ°åŠ ä¸¥"></a>æ­£å¸¸åˆ°åŠ ä¸¥</h3><p>å½“æ­£åœ¨é‡‡ç”¨æ­£å¸¸æ£€éªŒæ—¶ï¼Œåªè¦åˆæ¬¡æ£€éªŒä¸­è¿ç»­5æ‰¹æˆ–å°‘äº5æ‰¹ä¸­æœ‰2æ‰¹æ˜¯ä¸å¯æ¥æ”¶çš„ï¼Œåˆ™è½¬ç§»åˆ°åŠ ä¸¥æ£€éªŒã€‚<br>ï¼ˆæ³¨ï¼šåˆæ¬¡æ£€éªŒæŒ‡ç¬¬ä¸€æ¬¡æ£€éªŒï¼ŒåŒºåˆ«äºæ‹’æ”¶åçš„å†æ¬¡æäº¤æ‰¹çš„æ£€éªŒã€‚å†æ¬¡æäº¤æ‰¹çš„æ£€éªŒç»“æœä¸å‚ä¸è½¬ç§»ã€‚ï¼‰</p><h3 id="åŠ ä¸¥åˆ°æ­£å¸¸"><a href="#åŠ ä¸¥åˆ°æ­£å¸¸" class="headerlink" title="åŠ ä¸¥åˆ°æ­£å¸¸"></a>åŠ ä¸¥åˆ°æ­£å¸¸</h3><p>å½“æ­£åœ¨é‡‡ç”¨åŠ ä¸¥æ£€éªŒæ—¶ï¼Œå¦‚æœåˆæ¬¡æ£€éªŒçš„æ¥è¿5æ‰¹å·²è¢«è®¤ä¸ºæ˜¯å¯æ¥æ”¶çš„ï¼Œåº”æ¢å¤æ­£å¸¸æ£€éªŒã€‚</p><h3 id="æ­£å¸¸åˆ°æ”¾å®½"><a href="#æ­£å¸¸åˆ°æ”¾å®½" class="headerlink" title="æ­£å¸¸åˆ°æ”¾å®½"></a>æ­£å¸¸åˆ°æ”¾å®½</h3><p>å½“æ­£åœ¨é‡‡ç”¨æ­£å¸¸æ£€éªŒæ—¶ï¼Œå¦‚æœè¿ç»­10æ¬¡æ£€éªŒéƒ½åˆæ ¼ã€å¹¶ä¸”ç”Ÿäº§å¤„äºç¨³å®šçŠ¶æ€çš„è¯ï¼Œå¯ä»¥è½¬ç§»åˆ°æ”¾å®½æ£€éªŒã€‚<br>ï¼ˆæ³¨ï¼šè¿™ä¸ªè·ŸGB/T 2828.1-2003çš„è§„å®šä¸åŒï¼Œå› ä¸ºGB/T 2828.1-2003çš„æ¡ä»¶æ¯”è¾ƒè´Ÿè´£ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘é‡‡ç”¨è¿™ä¸ªæ¯”è¾ƒç®€å•çš„æ–¹æ³•ã€‚ï¼‰</p><h3 id="æ”¾å®½åˆ°æ­£å¸¸"><a href="#æ”¾å®½åˆ°æ­£å¸¸" class="headerlink" title="æ”¾å®½åˆ°æ­£å¸¸"></a>æ”¾å®½åˆ°æ­£å¸¸</h3><p>å½“æ­£åœ¨æ‰§è¡Œæ”¾å®½æ£€éªŒæ—¶ï¼Œå¦‚æœåˆæ¬¡æ£€éªŒå‡ºç°ä¸‹åˆ—ä»»ä¸€æƒ…å†µï¼Œåº”æ¢å¤æ­£å¸¸æ£€éªŒï¼š<br>aï¼‰ä¸€ä¸ªæ‰¹æœªè¢«æ¥æ”¶ï¼›<br>bï¼‰ç”Ÿäº§ä¸ç¨³å®šæˆ–å»¶è¿Ÿï¼›<br>cï¼‰è®¤ä¸ºæ¢å¤æ­£å¸¸æ£€éªŒæ˜¯æ­£å½“çš„å…¶ä»–æƒ…å†µã€‚</p><h3 id="æš‚åœæ£€éªŒ"><a href="#æš‚åœæ£€éªŒ" class="headerlink" title="æš‚åœæ£€éªŒ"></a>æš‚åœæ£€éªŒ</h3><p>å¦‚æœåœ¨åˆæ¬¡åŠ ä¸¥æ£€éªŒçš„ä¸€ç³»åˆ—è¿ç»­æ‰¹ä¸­æœªæ¥å—æ‰¹çš„ç´¯è®¡æ•°è¾¾åˆ°5æ‰¹ï¼Œåº”æš‚æ—¶åœæ­¢æ£€éªŒã€‚ç›´åˆ°ä¾›åº”å•†ä¸ºæ”¹è¿›æ‰€æä¾›äº§å“æˆ–æœåŠ¡çš„è´¨é‡å·²é‡‡å–è¡ŒåŠ¨ï¼Œè€Œä¸”è´Ÿè´£éƒ¨é—¨æ‰¿è®¤æ­¤è¡ŒåŠ¨å¯èƒ½æœ‰æ•ˆæ—¶ï¼Œæ‰èƒ½æ¢å¤æ£€éªŒã€‚æ¢å¤æ£€éªŒåº”ä»ä½¿ç”¨åŠ ä¸¥æ£€éªŒå¼€å§‹ã€‚</p><p>æ”¾å®½æ£€éªŒæ˜¯éå¼ºåˆ¶æ€§çš„ï¼Œåœ¨æ¡ä»¶ä¸æˆç†Ÿæˆ–æ— æŠŠæ¡çš„æƒ…å†µä¸‹å¯ä»¥ä¸æ‰§è¡Œã€‚<br>æš‚åœæ£€éªŒä¹Ÿå¯ä»¥ä¸æ‰§è¡Œã€‚<br>è‡³å°‘è¦æ‰§è¡Œæ­£å¸¸å’ŒåŠ ä¸¥æ£€éªŒä¹‹é—´çš„è½¬ç§»è§„åˆ™ã€‚</p><h3 id="äºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆ"><a href="#äºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆ" class="headerlink" title="äºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆ"></a>äºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆ</h3><p>ç¬¬ä¸€æ¬¡æ£€éªŒçš„æ ·å“æ•°é‡åº”ç­‰äºè¯¥æ–¹æ¡ˆç»™å‡ºçš„ç¬¬ä¸€æ ·æœ¬é‡ã€‚å¦‚æœç¬¬ä¸€æ ·æœ¬ä¸­å‘ç°çš„ä¸åˆæ ¼æ•°å°äºæˆ–ç­‰äºç¬¬ä¸€æ¥æ”¶æ•°ï¼Œåˆ™è¯¥æ‰¹å¯æ¥æ”¶ï¼›å¦‚æœç¬¬ä¸€æ ·æœ¬ä¸­å‘ç°çš„ä¸åˆæ ¼å“æ•°å¤§äºæˆ–ç­‰äºç¬¬ä¸€æ‹’æ”¶æ•°ï¼Œåˆ™è¯¥æ‰¹ä¸å¯æ¥æ”¶ã€‚<br>å¦‚æœç¬¬ä¸€æ ·æœ¬ä¸­å‘ç°çš„ä¸åˆæ ¼å“æ•°ä»‹äºç¬¬ä¸€æ¥æ”¶æ•°ä¸ç¬¬äºŒæ‹’æ”¶æ•°ä¹‹é—´ï¼Œåº”æ£€éªŒç”±æ–¹æ¡ˆç»™å‡ºæ ·æœ¬é‡çš„ç¬¬äºŒæ ·æœ¬å¹¶ç´¯è®¡åœ¨ç¬¬ä¸€æ ·æœ¬å’Œç¬¬äºŒæ ·æœ¬ä¸­å‘ç°çš„ä¸åˆæ ¼å“æ•°ã€‚å¦‚æœä¸åˆæ ¼å“ç´¯è®¡æ•°å°äºæˆ–ç­‰äºç¬¬äºŒæ¥æ”¶æ•°ï¼Œåˆ™åˆ¤å®šæ‰¹å¯æ¥æ”¶ï¼›å¦‚æœä¸åˆæ ¼å“ç´¯è®¡æ•°å¤§äºæˆ–ç­‰äºç¬¬äºŒæ‹’æ”¶æ•°ï¼Œåˆ™åˆ¤å®šè¯¥æ‰¹ä¸å¯æ¥æ”¶ã€‚<br>äºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆçš„ç›®çš„æ˜¯é€šè¿‡æ£€éªŒè¾ƒå°‘æ ·å“æ•°è€ŒèŠ‚çº¦æ—¶é—´ï¼Œç„¶è€Œå½“å¿…é¡»è¿›è¡Œç¬¬äºŒæ¬¡æ£€éªŒæ—¶ï¼ŒæŠ½æ ·æ£€éªŒçš„æ€»æ•°è¦è¶…è¿‡ä¸€æ¬¡æŠ½æ ·æ£€éªŒçš„æ•°é‡ï¼Œæ‰€ä»¥äºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆé€‚åˆäºè´¨é‡æ¯”è¾ƒç¨³å®šçš„äº§å“ã€‚</p><h3 id="ä¸åˆæ ¼äº§å“çš„åˆ¤å®š"><a href="#ä¸åˆæ ¼äº§å“çš„åˆ¤å®š" class="headerlink" title="ä¸åˆæ ¼äº§å“çš„åˆ¤å®š"></a>ä¸åˆæ ¼äº§å“çš„åˆ¤å®š</h3><p>æ ¹æ®ä¸åŒç±»å‹çš„æœè£…å¯å‚è€ƒç›¸åº”çš„è¡Œä¸šæ ‡å‡†æˆ–ä¼ä¸šæ ‡å‡†ï¼Œå¦‚Tæ¤å’ŒPoloè¡«å¯å‚è€ƒçººç»‡è¡Œä¸šæ ‡å‡†ã€ŠFZ/T 73008-2002 é’ˆç»‡Tæ¤è¡«ã€‹ã€‚<br>æœ‰çš„å…¬å¸ä»¥ä¸€ä»¶è¡£æœä¸Šæœ‰ä¸€ä¸ªæˆ–ä»¥ä¸Šä¸¥é‡ç–µç‚¹ä¸ºä¸€ä¸ªä¸åˆæ ¼å“ï¼Œä¸€ä»¶è¡£æœä¸Šæœ‰3ä¸ªè½»å¾®ç–µç‚¹ä¹Ÿç®—ä¸€ä»¶ä¸åˆæ ¼å“ã€‚<br>æœ‰çš„å…¬å¸é‡‡ç”¨çš„æ˜¯è®°ç‚¹çš„æ–¹å¼ï¼Œå³è®¡ç®—æ ·æœ¬ä¸­çš„ä¸åˆæ ¼æ•°æ¥åˆ¤å®šã€‚</p><p>å½“æ ·æœ¬æ•°è¶…è¿‡æ‰¹é‡æ—¶ï¼Œåº”è¯¥ä»¥æ•´æ‰¹ä½œä¸ºæ ·æœ¬ï¼ˆå…¨æ£€ï¼‰ï¼Œåˆ¤å®šæ•°ä¸å˜ã€‚</p><h3 id="AQLæŠ½æ ·æ£€éªŒçš„æ–¹æ³•å’Œæ­¥éª¤"><a href="#AQLæŠ½æ ·æ£€éªŒçš„æ–¹æ³•å’Œæ­¥éª¤" class="headerlink" title="AQLæŠ½æ ·æ£€éªŒçš„æ–¹æ³•å’Œæ­¥éª¤"></a>AQLæŠ½æ ·æ£€éªŒçš„æ–¹æ³•å’Œæ­¥éª¤</h3><p>1ã€å†³å®šæ£€éªŒæ–¹æ¡ˆï¼ˆæ£€éªŒæ°´å¹³ã€æŠ½æ ·æ–¹æ¡ˆã€ä¸¥æ ¼ç¨‹åº¦å’ŒAQLå€¼ï¼‰ã€‚æ£€éªŒæ–¹æ¡ˆä¸€èˆ¬ç”±å®¢æˆ·å†³å®šï¼Œä¹Ÿæœ‰å®¢æˆ·å’Œä¾›åº”å•†åå•†å†³å®šçš„ã€‚<br>2ã€æ ¹æ®æ£€éªŒæ–¹æ¡ˆæŸ¥æ‰¾æ ·æœ¬é‡å­—ç ã€‚<br>3ã€æŠ½æ ·æ–¹æ¡ˆã€‚åœ¨AQLä¸­ç»™å‡ºäº†ä¸€ç³»åˆ—çš„æŠ½æ ·æ–¹æ¡ˆè¡¨æ ¼ï¼Œè¿™äº›è¡¨æ ¼ç»™å‡ºäº†åœ¨ä¸åŒçš„å“è´¨æ°´å¹³ä¸‹æŠ½æ ·æ£€éªŒçš„æ ·æœ¬æ•°å’Œæ¥æ”¶æ•°ï¼ˆAcï¼‰ã€æ‹’æ”¶æ•°ï¼ˆReï¼‰ã€‚<br>4ã€äº§å“æ£€éªŒã€‚ä»æ‰€è¦æ£€éªŒçš„äº§å“ä¸­ï¼ŒæŒ‰ç…§ä»¥ä¸Šæ‰€è¿°çš„æ ·æœ¬æ•°ï¼ŒéšæœºæŠ½å–æ ·å“ã€‚åœ¨æ£€éªŒä¸­åº”ä¿è¯100ï¼…åœ°æ£€éªŒæ‰€æŠ½å–çš„æ ·æœ¬ï¼Œæ—¢ä½¿åœ¨æ£€éªŒè‹¥å¹²ä»¶åï¼Œå‘ç°ä¸åˆæ ¼æ•°å·²ç»è¶…è¿‡æ‹’æ”¶æ•°ï¼Œä»ç„¶åº”è¯¥ç»§ç»­æ£€éªŒå‰©ä½™çš„æ ·æœ¬ï¼Œå› ä¸ºæ£€éªŒçš„ç›®çš„é™¤äº†è¦çŸ¥é“â€œæ¥å—â€æˆ–â€œæ‹’æ”¶â€çš„ç»“æœå¤–ï¼Œè¿˜éœ€è¦äº†è§£è´§ç‰©ç©¶ç«Ÿå¤„äºä½•ç§è´¨é‡æ°´å¹³ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç§¯ç´¯å†å²æ•°æ®æ¥åˆ¤æ–­ä¾›åº”å•†æ˜¯å¦åˆæ ¼å’Œå†³å®šä»¥åå¯¹ä¾›åº”å•†çš„æ£€éªŒæ–¹æ¡ˆã€‚å¯¹ä¾›åº”å•†æ¥è¯´ï¼Œä¹Ÿå¯ä»¥æ¸…æ¥šå¦‚ä½•å»æ”¹å–„äº§å“çš„å“è´¨ã€‚<br>5ã€ç»Ÿè®¡ä¸åˆæ ¼æ•°ã€‚<br>6ã€åˆ¤å®šæ˜¯å¦æ¥å—ã€‚å¯¹ç…§æŠ½æ ·æ–¹æ¡ˆè¡¨æ ¼ä¸­çš„æ¥æ”¶æ•°å’Œæ‹’æ”¶æ•°æ¥å†³å®šæ˜¯â€œæ¥å—â€è¿˜æ˜¯â€œæ‹’æ”¶â€ã€‚</p><p>ä¾‹ä¸€ï¼š<br>æ£€éªŒæ–¹æ¡ˆä¸ºä¸€èˆ¬æ£€éªŒæ°´å¹³â…¡ã€æ­£å¸¸æ£€éªŒä¸€æ¬¡æŠ½æ ·æ–¹æ¡ˆã€AQL 2.5ã€‚<br>å¦‚æœ‰ä¸€æ‰¹è¡£æœçš„æ•°é‡ä¸º5000ä»¶ï¼Œåˆ™æ‰¾åˆ°å¯¹åº”çš„â€œæ ·æœ¬é‡å­—ç â€ä¸ºâ€œLâ€ã€‚<br>åœ¨â€œæ­£å¸¸æ£€éªŒä¸€æ¬¡æŠ½æ ·æ–¹æ¡ˆï¼ˆä¸»è¡¨ï¼‰â€ä¸­æ‰¾åˆ°æ ·æœ¬é‡å­—ç Lï¼Œå¯¹åº”çš„æ ·æœ¬é‡ä¸ºâ€œ200â€ï¼Œè¡¨ç¤ºè¦æŠ½æŸ¥200ä»¶è¡£æœï¼›AQL 2.5å¯¹åº”çš„â€œæ¥æ”¶/æ‹’æ”¶æ•°â€ä¸ºâ€œ10 11â€ï¼Œè¡¨ç¤ºæŠ½æŸ¥çš„200ä»¶æ ·æœ¬ä¸­ï¼Œå¦‚æœå‘ç°çš„ä¸åˆæ ¼å“å°äºæˆ–ç­‰äº10ä»¶çš„è¯ï¼Œåˆ™è¯¥æ‰¹äº§å“å¯æ¥å—ï¼›å¦‚æœä¸åˆæ ¼å“ç­‰äºæˆ–å¤§äº11çš„è¯ï¼Œåˆ™è¯¥æ‰¹äº§å“ä¸å¯æ¥å—ã€‚</p><p>ä¾‹äºŒï¼š<br>æ£€éªŒæ–¹æ¡ˆä¸ºä¸€èˆ¬æ£€éªŒæ°´å¹³â…¡ã€æ­£å¸¸æ£€éªŒäºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆã€AQL 4.0ã€‚<br>å¦‚æœ‰ä¸€æ‰¹è¡£æœçš„æ•°é‡ä¸º20000ä»¶ï¼Œåˆ™æ‰¾åˆ°å¯¹åº”çš„æ ·æœ¬é‡å­—ç ä¸ºâ€œMâ€ã€‚<br>ä»â€œæ­£å¸¸æ£€éªŒäºŒæ¬¡æŠ½æ ·æ–¹æ¡ˆï¼ˆä¸»è¡¨ï¼‰â€ä¸­æŸ¥æ‰¾åˆ°å¯¹åº”çš„æ ·æœ¬é‡å’Œæ¥æ”¶/æ‹’æ”¶æ•°ã€‚<br>ç¬¬ä¸€æ¬¡æŠ½æ ·200ä»¶ï¼Œæ¥æ”¶/æ‹’æ”¶æ•°ä¸ºâ€œ11 16â€ï¼Œä¸åˆæ ¼å“æ•°å°äºæˆ–ç­‰äº11åˆ™æ¥å—ï¼Œä¸åˆæ ¼å“æ•°ç­‰äºæˆ–å¤§äº16åˆ™æ‹’æ”¶ï¼Œä¸åˆæ ¼å“æ•°ä¸º12~15ä¹‹é—´åˆ™è¿›è¡Œç¬¬äºŒæ¬¡æŠ½æŸ¥ï¼›<br>ç¬¬äºŒæ¬¡å†æŠ½æŸ¥200ä»¶ï¼Œæ¥æ”¶/æ‹’æ”¶æ•°ä¸ºâ€œ26 27â€ï¼Œç´¯è®¡ä¸åˆæ ¼å“æ•°ï¼ˆåŠ ä¸Šç¬¬ä¸€æ¬¡æŠ½æŸ¥å‘ç°çš„ä¸åˆæ ¼å“æ•°ï¼‰å°äºæˆ–ç­‰äº26åˆ™æ¥å—ï¼Œç´¯è®¡ä¸åˆæ ¼å“æ•°ç­‰äºæˆ–å¤§äº27åˆ™æ‹’æ”¶ã€‚</p>]]></content>
    
    
    <summary type="html">AQL-æ¥æ”¶è´¨é‡é™åˆ¶ï¼ˆAcceptance Quality Limitï¼‰</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="AQL" scheme="https://jonty.top/tags/AQL/"/>
    
  </entry>
  
  <entry>
    <title>ã€Blazor-01ã€‘-ä»€ä¹ˆæ˜¯Blazor?</title>
    <link href="https://jonty.top/2023/02/15/what-is-blazor/"/>
    <id>https://jonty.top/2023/02/15/what-is-blazor/</id>
    <published>2023-02-14T23:59:05.000Z</published>
    <updated>2023-03-23T02:20:23.171Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç°å¦‚ä»Šå¦‚ä½•å¼€å‘Webåº”ç”¨ç¨‹åº"><a href="#ç°å¦‚ä»Šå¦‚ä½•å¼€å‘Webåº”ç”¨ç¨‹åº" class="headerlink" title="ç°å¦‚ä»Šå¦‚ä½•å¼€å‘Webåº”ç”¨ç¨‹åº"></a>ç°å¦‚ä»Šå¦‚ä½•å¼€å‘Webåº”ç”¨ç¨‹åº</h2><p><img data-src="https://cdn.jonty.top/img/whatisblazor.png" alt="img"></p><ul><li>å¯¹äºæœåŠ¡ç«¯å¼€å‘ï¼Œæˆ‘ä»¬ä½¿ç”¨C#ã€Javaã€PHPç­‰ç¼–ç¨‹è¯­è¨€ï¼Œè¿™äº›éƒ½æ˜¯æœåŠ¡ç«¯ç¼–ç¨‹è¯­è¨€ã€‚</li><li>å¯¹äºå®¢æˆ·ç«¯å¼€å‘ï¼Œä½¿ç”¨ Angularã€Reactã€Vue ç­‰<strong>JavaScript</strong>æ¡†æ¶ï¼Œè¿™äº›JavaScriptæ¡†æ¶ä¹Ÿæ˜¯æœ€è¿‘å‡ å¹´å¼€å§‹ä¸»å¯¼å®¢æˆ·ç«¯å¼€å‘ã€‚</li></ul><p>ä½œä¸ºå¼€å‘äººå‘˜ï¼Œä¸ºäº†åœ¨ä¸šåŠ¡ä¸­æŒç»­ä¿æŒç«äº‰åŠ›ï¼Œæˆ‘ä»¬ä¸å¯é¿å…çš„è¦åŒæ—¶å­¦ä¹ æœåŠ¡ç«¯ç¼–ç¨‹è¯­è¨€å’Œå®¢æˆ·ç«¯ç¼–ç¨‹è¯­è¨€ã€‚ä½†é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å­¦ä¹ å’Œä½¿ç”¨ä¸¤å¥—ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶å‘¢ï¼Ÿ</p><h2 id="ä½¿ç”¨C-åŒæ—¶è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¼€å‘"><a href="#ä½¿ç”¨C-åŒæ—¶è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¼€å‘" class="headerlink" title="ä½¿ç”¨C#åŒæ—¶è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¼€å‘"></a>ä½¿ç”¨C#åŒæ—¶è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¼€å‘</h2><p><img data-src="https://cdn.jonty.top/img/whyshouldweuseblazor.png" alt="æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ blazor"></p><p>å¯ä»¥ä½¿ç”¨C#åŒæ—¶è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¼€å‘å—ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œå€ŸåŠ©<strong>Blazor</strong>,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨C#è€Œä¸æ˜¯JavaScriptæ„å»ºäº¤äº’å¼çš„Web UIã€‚C#ä»£ç å¯ä»¥åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æµè§ˆå™¨ä¸Šæ‰§è¡Œã€‚è¿™æ„å‘³ç€.Netå¼€å‘äººå‘˜å¯ä»¥é‡ç”¨ä»–ä»¬çš„C#æŠ€èƒ½ï¼Œè€Œä¸æ˜¯å­¦ä¹ æ–°çš„JavaScriptæ¡†æ¶è€Œå¸¦æ¥çš„å·¨å¤§çš„å­¦ä¹ æˆæœ¬ã€‚</p><h2 id="æµè§ˆå™¨å¦‚ä½•æ‰§è¡ŒC-ä»£ç "><a href="#æµè§ˆå™¨å¦‚ä½•æ‰§è¡ŒC-ä»£ç " class="headerlink" title="æµè§ˆå™¨å¦‚ä½•æ‰§è¡ŒC#ä»£ç "></a>æµè§ˆå™¨å¦‚ä½•æ‰§è¡ŒC#ä»£ç </h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæµè§ˆå™¨åªèƒ½æ‰§è¡ŒJavaScriptä»£ç ã€‚é‚£ä¹ˆå¦‚ä½•åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨æ‰§è¡ŒC#ä»£ç ï¼Ÿç­”æ¡ˆæ˜¯<strong>WebAssembly</strong></p><p><img data-src="https://cdn.jonty.top/img/blazorandwebassembly.png" alt="blazor å’Œ webassembly"></p><p>Blazor å¯ä»¥ä½¿ç”¨ WebAssembly åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¿è¡Œ C# ä»£ç ã€‚å®ƒä¸ Angularã€Reactã€Vue ç­‰ JavaScript æ¡†æ¶åœ¨åŒä¸€ä¸ªå®‰å…¨æ²™ç®±ä¸­è¿è¡Œã€‚</p><p>äº‹å®ä¸Šï¼Œä¸ä»…ä»…æ˜¯ C#ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ WebAssembly åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä»»ä½•ç±»å‹çš„ä»£ç ã€‚</p><p>WebAssembly åŸºäºå¼€æ”¾çš„ Web æ ‡å‡†ã€‚æ‰€ä»¥å®ƒæ˜¯æ‰€æœ‰ç°ä»£æµè§ˆå™¨çš„åŸç”Ÿéƒ¨åˆ†ï¼ŒåŒ…æ‹¬ç§»åŠ¨æµè§ˆå™¨ã€‚è¿™æ„å‘³ç€è¦æ˜¯Blazoråº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œï¼Œä¸éœ€è¦å®‰è£…ä»»ä½•æ’ä»¶ã€‚</p><h2 id="Blazoræ‰˜ç®¡æ¨¡å‹"><a href="#Blazoræ‰˜ç®¡æ¨¡å‹" class="headerlink" title="Blazoræ‰˜ç®¡æ¨¡å‹"></a>Blazoræ‰˜ç®¡æ¨¡å‹</h2><p>Blazor æä¾› 2 ç§æ‰˜ç®¡æ¨¡å‹ã€‚</p><ul><li> Blazor WebAssembly</li><li> Blazor Server</li></ul><p><img data-src="https://cdn.jonty.top/img/image-20220411220906408.png" alt="image-20220411220906408"></p><h3 id="Blazor-WebAssembly"><a href="#Blazor-WebAssembly" class="headerlink" title="Blazor WebAssembly"></a>Blazor WebAssembly</h3><p>å®¢æˆ·ç«¯æ‰˜ç®¡æ¨¡å‹ï¼šåº”ç”¨ç¨‹åºç›´æ¥åœ¨ WebAssembly çš„æµè§ˆå™¨ä¸­è¿è¡Œã€‚</p><p>å› æ­¤ï¼Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€åˆ‡ï¼Œå³ç¼–è¯‘åçš„åº”ç”¨ç¨‹åºä»£ç æœ¬èº«ã€å®ƒçš„ä¾èµ–é¡¹å’Œ .NET è¿è¡Œæ—¶éƒ½ä¸‹è½½åˆ°æµè§ˆå™¨ã€‚</p><blockquote><p> ä½¿ç”¨ <code>Blazor WebAssembly App </code>æ¨¡æ¿æ¥åˆ›å»ºå…·æœ‰å®¢æˆ·ç«¯æ‰˜ç®¡æ¨¡å‹çš„ Blazor åº”ç”¨ç¨‹åºã€‚</p></blockquote><h3 id="Blazor-server"><a href="#Blazor-server" class="headerlink" title="Blazor server"></a>Blazor server</h3><p>æœåŠ¡å™¨æ‰˜ç®¡æ¨¡å‹ï¼šåº”ç”¨ç¨‹åºåœ¨ ASP.NET Core åº”ç”¨ç¨‹åºå†…çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚</p><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œå»ºç«‹äº† <strong>SignalR</strong> è¿æ¥ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“å®¢æˆ·ç«¯ä¸Šå‘ç”Ÿäº‹ä»¶ï¼ˆä¾‹å¦‚å•å‡»æŒ‰é’®ï¼‰æ—¶ï¼Œæœ‰å…³äº‹ä»¶çš„ä¿¡æ¯å°†é€šè¿‡ SignalR è¿æ¥å‘é€åˆ°æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¤„ç†äº‹ä»¶å¹¶ä¸ºç”Ÿæˆçš„ HTML è®¡ç®—å·®å¼‚ã€‚æ•´ä¸ª HTML ä¸ä¼šå†æ¬¡å‘é€å›å®¢æˆ·ç«¯ï¼Œå®ƒåªæ˜¯é€šè¿‡å·²å»ºç«‹çš„ SignalR è¿æ¥å‘é€ç»™å®¢æˆ·ç«¯çš„å·®å¼‚ã€‚ç„¶åæµè§ˆå™¨æ›´æ–° UIã€‚Blazor é‡‡ç”¨å•é¡µé¢åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ã€‚</p><blockquote><p>ä½¿ç”¨ Blazor Serveråº”ç”¨ç¨‹åºæ¨¡æ¿æ¥åˆ›å»ºå…·æœ‰æœåŠ¡å™¨æ‰˜ç®¡æ¨¡å‹çš„ Blazor åº”ç”¨ç¨‹åº</p></blockquote><h2 id="Blazorå¼€å‘ç¯å¢ƒ"><a href="#Blazorå¼€å‘ç¯å¢ƒ" class="headerlink" title="Blazorå¼€å‘ç¯å¢ƒ"></a>Blazorå¼€å‘ç¯å¢ƒ</h2><p><a href="https://dotnet.microsoft.com/en-us/download/dotnet/6.0">å®‰è£….NET6æˆ–æ›´é«˜ç‰ˆæœ¬</a></p><p>éªŒè¯æœ¬åœ°å®‰è£…çš„.NET SDK</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet --list-sdks</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨Visual Studioã€Visual Studio Code æˆ– .NET Core CLI æ„å»º Blazor åº”ç”¨ç¨‹åºã€‚ </p><p><a href="https://visualstudio.microsoft.com/zh-hans/?rr=https://www.microsoft.com/zh-cn">ä¸‹è½½Visual Studio</a></p><h3 id="å…ˆå†³æ¡ä»¶"><a href="#å…ˆå†³æ¡ä»¶" class="headerlink" title="å…ˆå†³æ¡ä»¶"></a>å…ˆå†³æ¡ä»¶</h3><p><img data-src="https://cdn.jonty.top/img/image-20220411220940383.png" alt="image-20220411220940383"></p>]]></content>
    
    
    <summary type="html">Blazorç³»åˆ—ç¿»è¯‘01-ä»€ä¹ˆæ˜¯Blazor?</summary>
    
    
    
    <category term="æ¬ç –é‚£äº›äº‹å„¿" scheme="https://jonty.top/categories/%E6%90%AC%E7%A0%96%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    
    
    <category term="ASP.NET Core" scheme="https://jonty.top/tags/ASP-NET-Core/"/>
    
    <category term="Blazor" scheme="https://jonty.top/tags/Blazor/"/>
    
  </entry>
  
  <entry>
    <title>Redisé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²-Cluster</title>
    <link href="https://jonty.top/2023/02/03/docker-swarm-redis-cluster/"/>
    <id>https://jonty.top/2023/02/03/docker-swarm-redis-cluster/</id>
    <published>2023-02-03T15:08:58.000Z</published>
    <updated>2023-02-03T15:10:18.760Z</updated>
    
    <content type="html"><![CDATA[<p>Redis clusteræ˜¯redisçš„å®˜æ–¹é›†ç¾¤æ–¹æ¡ˆï¼Œä½†æ˜¯è¦æ±‚å®¢æˆ·ç«¯è‡ªå·±åšé‡å®šå‘ï¼Œæ‰€ä»¥è¿æ¥å•æœºrediså’Œé›†ç¾¤redisçš„å®¢æˆ·ç«¯ä¼šæœ‰äº›ä¸åŒï¼Œè¿æ¥é›†ç¾¤ç‰ˆredisçš„æ—¶å€™è¦å®¢æˆ·ç«¯è¿æ¥6ä¸ªrediså®ä¾‹ã€‚</p><p>å®˜æ–¹ä¸ºäº†å±è”½è¿™ç§å·®å¼‚ï¼Œåšäº†ä¸€ä¸ªredis-cluster-proxyï¼Œç»è¿‡è¿™ä¸ªproxyçš„ä»£ç†åï¼Œè¿æ¥redisé›†ç¾¤å°±å’Œè¿æ¥å•æœºredisä¸€æ ·äº†ã€‚</p><blockquote><p><a href="https://github.com/RedisLabs/redis-cluster-proxy">RedisLabs/redis-cluster-proxy: A proxy for Redis clusters. (github.com)</a></p></blockquote><p><img data-src="https://cdn.jonty.top/img/image-20230203142147518.png" alt="image-20230203142147518"></p><h2 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h2><h3 id="é›†ç¾¤è§„åˆ’"><a href="#é›†ç¾¤è§„åˆ’" class="headerlink" title="é›†ç¾¤è§„åˆ’"></a>é›†ç¾¤è§„åˆ’</h3><p>æ­å»º3master+3slave+1proxyï¼Œå…±ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>IP</th><th>hostname</th><th>éƒ¨ç½²å®ä¾‹</th></tr></thead><tbody><tr><td>192.168.2.213</td><td>manager</td><td>redis1ã€redis2ã€proxy(1å®ä¾‹)</td></tr><tr><td>192.168.2.214</td><td>worker1</td><td>redis3ã€redis4</td></tr><tr><td>192.168.2.215</td><td>worker2</td><td>redis5ã€redis5</td></tr></tbody></table><h3 id="æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"></a>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@manager ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux manager 3.10.0-957.el7.x86_64 <span class="comment">#1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">[root@manager ~]<span class="comment"># cat /etc/redhat-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br></pre></td></tr></table></figure><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>æŸ¥çœ‹Dockerç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@manager ~]<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.23</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.18.10</span><br><span class="line"> Git commit:        7155243</span><br><span class="line"> Built:             Thu Jan 19 17:36:21 2023</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.23</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.18.10</span><br><span class="line">  Git commit:       6051f14</span><br><span class="line">  Built:            Thu Jan 19 17:34:26 2023</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.6.15</span><br><span class="line">  GitCommit:        5b842e528e99d4d4c1686467debf2bd4b88ecd86</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.1.4</span><br><span class="line">  GitCommit:        v1.1.4-0-g5fd4c4d</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><p>æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€é›†ç¾¤åˆå§‹åŒ–æ‰€éœ€ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰node</span></span><br><span class="line">firewall-cmd --zone=public --add-port=2377/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=7946/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=7946/udp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=4789/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=4789/udp --permanent</span><br></pre></td></tr></table></figure><p>é‡å¯é˜²ç«å¢™ä»¥åŠDocker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰node</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h3><p>åˆ›å»º3ä¸ªmanagerèŠ‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p><p><img data-src="https://cdn.jonty.top/img/image-20230203101937613.png" alt="image-20230203101937613"></p><p>managerèŠ‚ç‚¹åˆå§‹åŒ–é›†ç¾¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --advertise-addr 192.168.2.213</span><br></pre></td></tr></table></figure><p>managerèŠ‚ç‚¹è·å–åŠ å…¥manager token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join-token manager</span><br></pre></td></tr></table></figure><p>workerèŠ‚ç‚¹ä»¥<code>manager</code>èº«ä»½åŠ å…¥é›†ç¾¤</p><pre><code>docker swarm join \--token SWMTKN-1-3pu6hszjas19xyp7ghgosyx9k8atbfcr8p2is99znpy26u2lkl-7p73s1dx5in4tatdymyhg9hu2 \192.168.2.213:2377</code></pre><h2 id="ç³»ç»Ÿéƒ¨ç½²"><a href="#ç³»ç»Ÿéƒ¨ç½²" class="headerlink" title="ç³»ç»Ÿéƒ¨ç½²"></a>ç³»ç»Ÿéƒ¨ç½²</h2><img data-src="https://cdn.jonty.top/img/2020-12-02-150023.jpg" alt="redis_cluster" style="zoom: 33%;" /><h3 id="éƒ¨ç½²å‡†å¤‡"><a href="#éƒ¨ç½²å‡†å¤‡" class="headerlink" title="éƒ¨ç½²å‡†å¤‡"></a>éƒ¨ç½²å‡†å¤‡</h3><h4 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir redis-cluster</span><br><span class="line"><span class="built_in">cd</span> redis-cluster</span><br></pre></td></tr></table></figure><h4 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h4><p>ç¼–å†™<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œéœ€è¦æ ¹æ®å®é™…IPåœ°å€åšè°ƒæ•´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yml</span><br></pre></td></tr></table></figure><p>docker-compose.yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.7&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  redis-node1:</span><br><span class="line">    image: redis:6.2.4</span><br><span class="line">    hostname: redis-node1</span><br><span class="line">    ports:</span><br><span class="line">      - 7001:6379</span><br><span class="line">      - 17001:16379</span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;redis-node1-data:/data&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: </span><br><span class="line">      - <span class="string">&quot;redis-server&quot;</span></span><br><span class="line">      - <span class="string">&quot;--appendonly yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-enabled yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-config-file nodes.conf&quot;</span></span><br><span class="line">      - <span class="string">&quot;--requirepass bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--masterauth bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-ip 192.168.2.213&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-port 7001&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-bus-port 17001&quot;</span></span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.hostname == manager</span><br><span class="line"></span><br><span class="line">  redis-node2:</span><br><span class="line">    image: redis:6.2.4</span><br><span class="line">    hostname: redis-node2</span><br><span class="line">    ports:</span><br><span class="line">      - 7002:6379</span><br><span class="line">      - 17002:16379</span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;redis-node2-data:/data&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: </span><br><span class="line">      - <span class="string">&quot;redis-server&quot;</span></span><br><span class="line">      - <span class="string">&quot;--appendonly yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-enabled yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-config-file nodes.conf&quot;</span></span><br><span class="line">      - <span class="string">&quot;--requirepass bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--masterauth bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-ip 192.168.2.213&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-port 7002&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-bus-port 17002&quot;</span></span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.hostname == manager</span><br><span class="line"></span><br><span class="line">  redis-node3:</span><br><span class="line">    image: redis:6.2.4</span><br><span class="line">    hostname: redis-node3</span><br><span class="line">    ports:</span><br><span class="line">      - 7003:6379</span><br><span class="line">      - 17003:16379</span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;redis-node3-data:/data&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: </span><br><span class="line">      - <span class="string">&quot;redis-server&quot;</span></span><br><span class="line">      - <span class="string">&quot;--appendonly yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-enabled yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-config-file nodes.conf&quot;</span></span><br><span class="line">      - <span class="string">&quot;--requirepass bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--masterauth bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-ip 192.168.2.214&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-port 7003&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-bus-port 17003&quot;</span></span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.hostname == worker1</span><br><span class="line"></span><br><span class="line">  redis-node4:</span><br><span class="line">    image: redis:6.2.4</span><br><span class="line">    hostname: redis-node4</span><br><span class="line">    ports:</span><br><span class="line">      - 7004:6379</span><br><span class="line">      - 17004:16379</span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;redis-node4-data:/data&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: </span><br><span class="line">      - <span class="string">&quot;--appendonly yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-enabled yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-config-file nodes.conf&quot;</span></span><br><span class="line">      - <span class="string">&quot;--requirepass bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--masterauth bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-ip 192.168.2.214&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-port 7004&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-bus-port 17004&quot;</span></span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.hostname == worker1</span><br><span class="line"></span><br><span class="line">  redis-node5:</span><br><span class="line">    image: redis:6.2.4</span><br><span class="line">    hostname: redis-node5</span><br><span class="line">    ports:</span><br><span class="line">      - 7005:6379</span><br><span class="line">      - 17005:16379</span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;redis-node5-data:/data&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: </span><br><span class="line">      - <span class="string">&quot;--appendonly yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-enabled yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-config-file nodes.conf&quot;</span></span><br><span class="line">      - <span class="string">&quot;--requirepass bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--masterauth bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-ip 192.168.2.215&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-port 7005&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-bus-port 17005&quot;</span></span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.hostname == worker2</span><br><span class="line"></span><br><span class="line">  redis-node6:</span><br><span class="line">    image: redis:6.2.4</span><br><span class="line">    hostname: redis-node6</span><br><span class="line">    ports:</span><br><span class="line">      - 7006:6379</span><br><span class="line">      - 17006:16379</span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;redis-node6-data:/data&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: </span><br><span class="line">      - <span class="string">&quot;--appendonly yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-enabled yes&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-config-file nodes.conf&quot;</span></span><br><span class="line">      - <span class="string">&quot;--requirepass bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--masterauth bb123456&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-ip 192.168.2.215&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-port 7006&quot;</span></span><br><span class="line">      - <span class="string">&quot;--cluster-announce-bus-port 17006&quot;</span></span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.hostname == worker2</span><br><span class="line"></span><br><span class="line">  redis-cluster:</span><br><span class="line">    image: redis:6.2.4</span><br><span class="line">    hostname: redis-cluster</span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis-node1</span><br><span class="line">      - redis-node2</span><br><span class="line">      - redis-node3</span><br><span class="line">      - redis-node4</span><br><span class="line">      - redis-node5</span><br><span class="line">      - redis-node6</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">&#x27;redis-cli --cluster create</span></span><br><span class="line"><span class="string">    192.168.2.213:7001 192.168.2.213:7002 192.168.2.214:7003</span></span><br><span class="line"><span class="string">    192.168.2.214:7004 192.168.2.215:7005 192.168.2.215:7006</span></span><br><span class="line"><span class="string">    --cluster-yes --cluster-replicas 1 -a bb123456&#x27;</span></span><br><span class="line">    deploy:</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">        delay: 5s</span><br><span class="line">        max_attempts: 5</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.hostname == manager</span><br><span class="line"></span><br><span class="line">  redis-proxy:</span><br><span class="line">    image: jontymax/redis-cluster-proxy:dev</span><br><span class="line">    hostname: redis-proxy</span><br><span class="line">    ports: </span><br><span class="line">      - <span class="string">&quot;7777:7777&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      - redis-swarm</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis-cluster</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">&#x27;redis-cluster-proxy --auth bb123456 192.168.2.213:7001 192.168.2.213:7002 192.168.2.214:7003 192.168.2.214:7004 192.168.2.215:7005 192.168.2.215:7006&#x27;</span></span><br><span class="line">    deploy:</span><br><span class="line">      mode: global</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  redis-swarm:</span><br><span class="line">    driver: overlay</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  redis-node1-data:</span><br><span class="line">  redis-node2-data:</span><br><span class="line">  redis-node3-data:</span><br><span class="line">  redis-node4-data:</span><br><span class="line">  redis-node5-data:</span><br><span class="line">  redis-node6-data:</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡éƒ¨ç½²"><a href="#æœåŠ¡éƒ¨ç½²" class="headerlink" title="æœåŠ¡éƒ¨ç½²"></a>æœåŠ¡éƒ¨ç½²</h3><h4 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml redis-cluster-proxy</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230203145125983.png" alt="image-20230203145125983"></p><h4 id="æŸ¥çœ‹æœåŠ¡"><a href="#æŸ¥çœ‹æœåŠ¡" class="headerlink" title="æŸ¥çœ‹æœåŠ¡"></a>æŸ¥çœ‹æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service ls | grep redis-cluster</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230203145230510.png" alt="image-20230203145230510"></p><p>redis-clusteræœåŠ¡ç”¨äºåˆå§‹åŒ–é›†ç¾¤ï¼Œå¯åŠ¨å®Œæˆæ—¥å¿—å¦‚ä¸‹:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Warning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.</span><br><span class="line">&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 192.168.2.214:7004 to 192.168.2.213:7001</span><br><span class="line">Adding replica 192.168.2.215:7006 to 192.168.2.214:7003</span><br><span class="line">Adding replica 192.168.2.213:7002 to 192.168.2.215:7005</span><br><span class="line">M: 9ee907ba218b782c264be77e4dd5ca53a79b7350 192.168.2.213:7001</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">S: 567cbca6ba03a2c4d1f4461882cf64a369daaafb 192.168.2.213:7002</span><br><span class="line">   replicates 98719ee5734cdc8b9b06519e2ebcf23b66041266</span><br><span class="line">M: c912e5bc90cdaed6159a5ca83725848556a8e68d 192.168.2.214:7003</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">S: 257d31f2f29f658103e9032584de8c2803bfb7b9 192.168.2.214:7004</span><br><span class="line">   replicates 9ee907ba218b782c264be77e4dd5ca53a79b7350</span><br><span class="line">M: 98719ee5734cdc8b9b06519e2ebcf23b66041266 192.168.2.215:7005</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: de5dbc1a51252d1c2ccf863470a85e5bd9e168bd 192.168.2.215:7006</span><br><span class="line">   replicates c912e5bc90cdaed6159a5ca83725848556a8e68d</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">......</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.2.213:7001)</span><br><span class="line">M: 9ee907ba218b782c264be77e4dd5ca53a79b7350 192.168.2.213:7001</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: c912e5bc90cdaed6159a5ca83725848556a8e68d 192.168.2.214:7003</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 567cbca6ba03a2c4d1f4461882cf64a369daaafb 192.168.2.213:7002</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 98719ee5734cdc8b9b06519e2ebcf23b66041266</span><br><span class="line">S: 257d31f2f29f658103e9032584de8c2803bfb7b9 192.168.2.214:7004</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 9ee907ba218b782c264be77e4dd5ca53a79b7350</span><br><span class="line">S: de5dbc1a51252d1c2ccf863470a85e5bd9e168bd 192.168.2.215:7006</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates c912e5bc90cdaed6159a5ca83725848556a8e68d</span><br><span class="line">M: 98719ee5734cdc8b9b06519e2ebcf23b66041266 192.168.2.215:7005</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check for open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure><p>redis-proxyæœåŠ¡ç”¨äºä»£ç†redis-clusterï¼Œç­‰å¾…redis-clusteråˆå§‹åŒ–å®Œæˆï¼Œå¯åŠ¨å®Œæˆæ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[2023-02-03 06:28:08.955/M] Redis Cluster Proxy v999.999.999 (unstable)</span><br><span class="line">[2023-02-03 06:28:08.955/M] Commit: (ac83840d/0)</span><br><span class="line">[2023-02-03 06:28:08.955/M] Git Branch: unstable</span><br><span class="line">[2023-02-03 06:28:08.955/M] PID: 1</span><br><span class="line">[2023-02-03 06:28:08.955/M] OS: Linux 3.10.0-957.el7.x86<span class="built_in">_</span>64 x86<span class="built_in">_</span>64</span><br><span class="line">[2023-02-03 06:28:08.955/M] Bits: 64</span><br><span class="line">[2023-02-03 06:28:08.955/M] Log level: info</span><br><span class="line">[2023-02-03 06:28:08.955/M] Connections pool size: 10 (respawn 2 every 50ms if below 10)</span><br><span class="line">[2023-02-03 06:28:08.955/M] The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">[2023-02-03 06:28:08.955/M] Listening on *:7777</span><br><span class="line">[2023-02-03 06:28:08.955/M] Starting 8 threads...</span><br><span class="line">[2023-02-03 06:28:08.955/M] Fetching cluster configuration...</span><br><span class="line">[2023-02-03 06:28:08.962/M] Cluster Address: 192.168.2.213:7001</span><br><span class="line">[2023-02-03 06:28:08.962/M] Cluster has 3 masters and 3 replica(s)</span><br><span class="line">[2023-02-03 06:28:09.057/M] All thread(s) started!</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœåˆå§‹åŒ–æˆ–ä»£ç†å¯åŠ¨å¤±è´¥ï¼Œå¯ä»¥å°è¯•ç§»é™¤æœåŠ¡é‡æ–°åˆ›å»º</p></blockquote><h4 id="ç§»é™¤æœåŠ¡"><a href="#ç§»é™¤æœåŠ¡" class="headerlink" title="ç§»é™¤æœåŠ¡"></a>ç§»é™¤æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm redis-cluster</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡è¿æ¥"><a href="#æœåŠ¡è¿æ¥" class="headerlink" title="æœåŠ¡è¿æ¥"></a>æœåŠ¡è¿æ¥</h2><h3 id="è¿æ¥åˆ°é›†ç¾¤"><a href="#è¿æ¥åˆ°é›†ç¾¤" class="headerlink" title="è¿æ¥åˆ°é›†ç¾¤"></a>è¿æ¥åˆ°é›†ç¾¤</h3><p>è¿æ¥ä»»æ„èŠ‚ç‚¹<code>IP:700x</code>å¯è¿æ¥åˆ°é›†ç¾¤</p><p><img data-src="https://cdn.jonty.top/img/image-20230203145831336.png" alt="image-20230203145831336"></p><p>å¯æ­£å¸¸ä½¿ç”¨</p><p><img data-src="https://cdn.jonty.top/img/image-20230203150113829.png" alt="image-20230203150113829"></p><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</p><p><img data-src="https://cdn.jonty.top/img/image-20230203150222570.png" alt="image-20230203150222570"></p><h3 id="è¿æ¥åˆ°ä»£ç†"><a href="#è¿æ¥åˆ°ä»£ç†" class="headerlink" title="è¿æ¥åˆ°ä»£ç†"></a>è¿æ¥åˆ°ä»£ç†</h3><p><img data-src="https://cdn.jonty.top/img/image-20230203145814034.png" alt="image-20230203145814034"></p><p><img data-src="https://cdn.jonty.top/img/image-20230203150312909.png" alt="image-20230203150312909"></p>]]></content>
    
    
    <summary type="html">Docker Swarméƒ¨ç½²Redis-Cluster+Proxyå®ç°å®¹ç¾</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Docker Swarm" scheme="https://jonty.top/tags/Docker-Swarm/"/>
    
    <category term="Redis" scheme="https://jonty.top/tags/Redis/"/>
    
    <category term="Redis Cluster" scheme="https://jonty.top/tags/Redis-Cluster/"/>
    
  </entry>
  
  <entry>
    <title>Redisé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²-Sentinel</title>
    <link href="https://jonty.top/2023/02/03/docker-swarm-redis-sentinel/"/>
    <id>https://jonty.top/2023/02/03/docker-swarm-redis-sentinel/</id>
    <published>2023-02-03T15:05:03.000Z</published>
    <updated>2023-02-03T15:08:43.556Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="https://cdn.jonty.top/img/redis-sentinel-haproxy.png" alt="redis-sentinel-haproxy"></p><p>Redisä½¿ç”¨ä½¿ç”¨<strong>å“¨å…µæ¨¡å¼</strong>è¿›è¡Œç»„ç½‘ï¼Œå“¨å…µè´Ÿè´£ä¸»èŠ‚ç‚¹çš„æ•…éšœè½¬ç§»ã€‚<br>HAProxyä½œä¸ºRedisé›†ç¾¤çš„ä»£ç†(HAProxyå·¥ä½œåœ¨TCPå±‚)ï¼Œå±è”½åº•å±‚redisçš„ç»„ç½‘ç»†èŠ‚ï¼Œå¯¹ä¸Šå±‚åº”ç”¨æ¥çœ‹å°±æ˜¯å•èŠ‚ç‚¹çš„redisã€‚</p><blockquote><p>å…³äº<a href="https://mp.weixin.qq.com/s?__biz=MzI3MjY1ODI2Ng==&mid=2247486094&idx=1&sn=f727b9fe6f53f4ebc5280dd09d6161ed&chksm=eb2e70bbdc59f9ad8157859f0c6eb5fa881c9e147d7e03ca9693633f7d2bff7215d0f813c847&scene=27">Redisé›†ç¾¤æ–¹æ¡ˆä»‹ç»+ä¼˜ç¼ºç‚¹å¯¹æ¯”</a></p></blockquote><h2 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h2><h3 id="é›†ç¾¤è§„åˆ’"><a href="#é›†ç¾¤è§„åˆ’" class="headerlink" title="é›†ç¾¤è§„åˆ’"></a>é›†ç¾¤è§„åˆ’</h3><p>æ­å»º1ä¸»2ä»3å“¨å…µï¼Œå…±ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>IP</th><th>hostname</th><th>éƒ¨ç½²å®ä¾‹</th></tr></thead><tbody><tr><td>192.168.2.213</td><td>manager</td><td>redis1ã€sentinel1ã€Haproxy(1å®ä¾‹)</td></tr><tr><td>192.168.2.214</td><td>worker1</td><td>redis2ã€sentinel2</td></tr><tr><td>192.168.2.215</td><td>worker2</td><td>redis3ã€sentinel3</td></tr></tbody></table><h3 id="æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"></a>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@manager ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux manager 3.10.0-957.el7.x86_64 <span class="comment">#1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">[root@manager ~]<span class="comment"># cat /etc/redhat-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core)</span><br></pre></td></tr></table></figure><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>æŸ¥çœ‹Dockerç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@manager ~]<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.23</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.18.10</span><br><span class="line"> Git commit:        7155243</span><br><span class="line"> Built:             Thu Jan 19 17:36:21 2023</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.23</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.18.10</span><br><span class="line">  Git commit:       6051f14</span><br><span class="line">  Built:            Thu Jan 19 17:34:26 2023</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.6.15</span><br><span class="line">  GitCommit:        5b842e528e99d4d4c1686467debf2bd4b88ecd86</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.1.4</span><br><span class="line">  GitCommit:        v1.1.4-0-g5fd4c4d</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><p>æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€é›†ç¾¤åˆå§‹åŒ–æ‰€éœ€ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰node</span></span><br><span class="line">firewall-cmd --zone=public --add-port=2377/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=7946/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=7946/udp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=4789/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=4789/udp --permanent</span><br></pre></td></tr></table></figure><p>é‡å¯é˜²ç«å¢™ä»¥åŠDocker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰node</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h3><p>åˆ›å»º3ä¸ªmanagerèŠ‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p><p><img data-src="https://cdn.jonty.top/img/image-20230203101937613.png" alt="image-20230203101937613"></p><p>managerèŠ‚ç‚¹åˆå§‹åŒ–é›†ç¾¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --advertise-addr 192.168.2.213</span><br></pre></td></tr></table></figure><p>managerèŠ‚ç‚¹è·å–åŠ å…¥manager token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join-token manager</span><br></pre></td></tr></table></figure><p>workerèŠ‚ç‚¹ä»¥<code>manager</code>èº«ä»½åŠ å…¥é›†ç¾¤</p><pre><code>docker swarm join \--token SWMTKN-1-3pu6hszjas19xyp7ghgosyx9k8atbfcr8p2is99znpy26u2lkl-7p73s1dx5in4tatdymyhg9hu2 \192.168.2.213:2377</code></pre><h2 id="ç³»ç»Ÿéƒ¨ç½²"><a href="#ç³»ç»Ÿéƒ¨ç½²" class="headerlink" title="ç³»ç»Ÿéƒ¨ç½²"></a>ç³»ç»Ÿéƒ¨ç½²</h2><h3 id="éƒ¨ç½²æ¶æ„å›¾"><a href="#éƒ¨ç½²æ¶æ„å›¾" class="headerlink" title="éƒ¨ç½²æ¶æ„å›¾"></a>éƒ¨ç½²æ¶æ„å›¾</h3><p><img data-src="https://cdn.jonty.top/img/image-20230203103602363.png" alt="redis-sentinel"></p><h3 id="éƒ¨ç½²å‡†å¤‡"><a href="#éƒ¨ç½²å‡†å¤‡" class="headerlink" title="éƒ¨ç½²å‡†å¤‡"></a>éƒ¨ç½²å‡†å¤‡</h3><h4 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir redis-sentinel</span><br><span class="line"><span class="built_in">cd</span> redis-sentinel</span><br><span class="line">mkdir haproxy</span><br></pre></td></tr></table></figure><h4 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h4><p>ç¼–å†™<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œéœ€è¦æ ¹æ®å®é™…IPåœ°å€åšè°ƒæ•´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yml</span><br></pre></td></tr></table></figure><p>docker-compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2.4</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-conf:/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-sentinel</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="comment"># cpus: &#x27;0.001&#x27;</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">5120M</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="comment"># cpus: &#x27;0.001&#x27;</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">512M</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">manager</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      bash -c &quot;if [ ! -f /conf/redis.conf ];then</span></span><br><span class="line"><span class="string">      echo &#x27;port 6379&#x27; &gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;bind 0.0.0.0&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;slave-announce-ip 192.168.2.213&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;slave-announce-port 6379&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;masterauth bb123456&#x27; &gt;&gt; /conf/redis.conf;</span></span><br><span class="line"><span class="string">      echo &#x27;requirepass bb123456&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;appendonly yes&#x27; &gt;&gt; /conf/redis.conf ; fi &amp;&amp;</span></span><br><span class="line"><span class="string">      redis-server /conf/redis.conf&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="attr">redis2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2.4</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-conf:/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-sentinel</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">worker1</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      bash -c &quot;if [ ! -f /conf/redis.conf ];then</span></span><br><span class="line"><span class="string">      echo &#x27;port 6379&#x27; &gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;bind 0.0.0.0&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;slave-announce-ip 192.168.2.214&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;slave-announce-port 6379&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;masterauth bb123456&#x27; &gt;&gt; /conf/redis.conf;</span></span><br><span class="line"><span class="string">      echo &#x27;requirepass bb123456&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;replicaof 192.168.2.213 6379&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;appendonly yes&#x27; &gt;&gt; /conf/redis.conf ; fi &amp;&amp;</span></span><br><span class="line"><span class="string">      redis-server /conf/redis.conf&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="attr">redis3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2.4</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-conf:/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-sentinel</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">worker2</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      bash -c &quot;if [ ! -f /conf/redis.conf ];then</span></span><br><span class="line"><span class="string">      echo &#x27;port 6379&#x27; &gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;bind 0.0.0.0&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;slave-announce-ip 192.168.2.215&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;slave-announce-port 6379&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;masterauth bb123456&#x27; &gt;&gt; /conf/redis.conf;</span></span><br><span class="line"><span class="string">      echo &#x27;requirepass bb123456&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;replicaof 192.168.2.213 6379&#x27; &gt;&gt; /conf/redis.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;appendonly yes&#x27; &gt;&gt; /conf/redis.conf ; fi &amp;&amp;</span></span><br><span class="line"><span class="string">      redis-server /conf/redis.conf&quot;</span></span><br><span class="line"><span class="string"></span>      </span><br><span class="line">  <span class="attr">sentinel1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2.4</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">26379</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">26379</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis3</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-conf:/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-sentinel</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">manager</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      bash -c &quot;if [ ! -f /conf/sentinel.conf ];then</span></span><br><span class="line"><span class="string">      echo &#x27;port 26379&#x27; &gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel announce-ip 192.168.2.213&#x27; &gt;&gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel monitor mymaster 192.168.2.213 6379 2&#x27; &gt;&gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel auth-pass mymaster bb123456&#x27; &gt;&gt; /conf/sentinel.conf ; fi &amp;&amp;</span></span><br><span class="line"><span class="string">      redis-server /conf/sentinel.conf --sentinel&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="attr">sentinel2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2.4</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">26379</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">26379</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis3</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-conf:/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-sentinel</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">worker1</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      bash -c &quot;if [ ! -f /conf/sentinel.conf ];then</span></span><br><span class="line"><span class="string">      echo &#x27;port 26379&#x27; &gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel announce-ip 192.168.2.214&#x27; &gt;&gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel monitor mymaster 192.168.2.213 6379 2&#x27; &gt;&gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel auth-pass mymaster bb123456&#x27; &gt;&gt; /conf/sentinel.conf ; fi &amp;&amp;</span></span><br><span class="line"><span class="string">      redis-server /conf/sentinel.conf --sentinel&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="attr">sentinel3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2.4</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">26379</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">26379</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis3</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-conf:/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-sentinel</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">worker2</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      bash -c &quot;if [ ! -f /conf/sentinel.conf ];then</span></span><br><span class="line"><span class="string">      echo &#x27;port 26379&#x27; &gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel announce-ip 192.168.2.215&#x27; &gt;&gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel monitor mymaster 192.168.2.213 6379 2&#x27; &gt;&gt; /conf/sentinel.conf ;</span></span><br><span class="line"><span class="string">      echo &#x27;sentinel auth-pass mymaster bb123456&#x27; &gt;&gt; /conf/sentinel.conf ; fi &amp;&amp;</span></span><br><span class="line"><span class="string">      redis-server /conf/sentinel.conf --sentinel&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="attr">haproxy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">haproxytech/haproxy-alpine:2.4</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sentinel1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sentinel2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sentinel3</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">haproxy_conf</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/usr/local/etc/haproxy/haproxy.cfg</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-sentinel</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;16379:16379&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">global</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">redis-sentinel:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">overlay</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">redis-data:</span></span><br><span class="line">  <span class="attr">redis-conf:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">haproxy_conf:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./haproxy/haproxy.cfg</span></span><br></pre></td></tr></table></figure><h4 id="haproxy-cfg"><a href="#haproxy-cfg" class="headerlink" title="haproxy.cfg"></a>haproxy.cfg</h4><p>åˆ›å»º<code>haproxy.cfg</code>é…ç½®æ–‡ä»¶</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Global settings</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="attribute">global</span></span><br><span class="line">    <span class="comment"># to have these messages end up in /var/log/haproxy.log you will</span></span><br><span class="line">    <span class="comment"># need to:</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 1) configure syslog to accept network log events.  This is done</span></span><br><span class="line">    <span class="comment">#    by adding the &#x27;-r&#x27; option to the SYSLOGD_OPTIONS in</span></span><br><span class="line">    <span class="comment">#    /etc/sysconfig/syslog</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 2) configure local2 events to go to the /var/log/haproxy.log</span></span><br><span class="line">    <span class="comment">#   file. A line like the following can be added to</span></span><br><span class="line">    <span class="comment">#   /etc/sysconfig/syslog</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#    local2.*                       /var/log/haproxy.log</span></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">  log stdout format raw local0 <span class="literal">info</span>  </span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will</span></span><br><span class="line"><span class="comment"># use if not designated in their block</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">defaults</span><br><span class="line">    log global</span><br><span class="line">    mode tcp</span><br><span class="line">    retries <span class="number">3</span></span><br><span class="line">    option redispatch</span><br><span class="line">    maxconn <span class="number">20000</span></span><br><span class="line">    timeout connect <span class="number">600s</span></span><br><span class="line">    timeout client <span class="number">600s</span></span><br><span class="line">    timeout server <span class="number">600s</span></span><br><span class="line">listen stats</span><br><span class="line">    bind <span class="number">0.0.0.0:8080</span> <span class="comment"># é¢æ¿ä»£ç†</span></span><br><span class="line">    mode http </span><br><span class="line">    stats uri /haproxy-status <span class="comment"># é¢æ¿åœ°å€</span></span><br><span class="line">    stats auth admin:admin <span class="comment"># é¢æ¿user:pwd</span></span><br><span class="line">    stats hide-version</span><br><span class="line">    stats refresh <span class="number">30s</span></span><br><span class="line">frontend redis16379 </span><br><span class="line">    bind :<span class="number">16379</span> <span class="comment"># ä»£ç†ç«¯å£</span></span><br><span class="line">    default_backend redis_16379_backend</span><br><span class="line">backend redis_16379_backend</span><br><span class="line">    option tcp-check</span><br><span class="line">    tcp-check connect</span><br><span class="line">    tcp-check send AUTH\ bb123456\r\n <span class="comment"># redis å¯†ç  æŒ‰éœ€è°ƒæ•´</span></span><br><span class="line">    tcp-check expect string +OK</span><br><span class="line">    tcp-check send PING\r\n</span><br><span class="line">    tcp-check expect string +PONG</span><br><span class="line">    tcp-check send <span class="literal">info</span>\ replication\r\n</span><br><span class="line">    tcp-check expect string role:master <span class="comment"># è½®è¯¢ masterèŠ‚ç‚¹</span></span><br><span class="line">    tcp-check send QUIT\r\n</span><br><span class="line">    tcp-check expect string +OK</span><br><span class="line">    server redis1 <span class="number">192.168.2.213:6379</span> check inter <span class="number">1s</span></span><br><span class="line">    server redis2 <span class="number">192.168.2.214:6379</span> check inter <span class="number">1s</span></span><br><span class="line">    server redis3 <span class="number">192.168.2.215:6379</span> check inter <span class="number">1s</span></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š</p><p><img data-src="https://cdn.jonty.top/img/image-20230203105159275.png" alt="image-20230203105159275"></p><h3 id="æœåŠ¡éƒ¨ç½²"><a href="#æœåŠ¡éƒ¨ç½²" class="headerlink" title="æœåŠ¡éƒ¨ç½²"></a>æœåŠ¡éƒ¨ç½²</h3><h4 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml redis-sentinel</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230203105502431.png" alt="image-20230203105502431"></p><h4 id="æŸ¥çœ‹æœåŠ¡"><a href="#æŸ¥çœ‹æœåŠ¡" class="headerlink" title="æŸ¥çœ‹æœåŠ¡"></a>æŸ¥çœ‹æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service ls | grep redis-sentinel</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230203105609286.png" alt="image-20230203105609286"></p><p><img data-src="https://cdn.jonty.top/img/image-20230203110439408.png" alt="image-20230203110439408"></p><h5 id="æœåŠ¡æ—¥å¿—"><a href="#æœåŠ¡æ—¥å¿—" class="headerlink" title="æœåŠ¡æ—¥å¿—"></a>æœåŠ¡æ—¥å¿—</h5><p>redis:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1:S 03 Feb 2023 09:07:22.284 * MASTER &lt;-&gt; REPLICA sync: receiving 214 bytes from master to disk</span><br><span class="line">1:S 03 Feb 2023 09:07:22.284 * MASTER &lt;-&gt; REPLICA sync: Flushing old data</span><br><span class="line">1:S 03 Feb 2023 09:07:22.284 * MASTER &lt;-&gt; REPLICA sync: Loading DB in memory</span><br><span class="line">1:S 03 Feb 2023 09:07:22.285 * Loading RDB produced by version 6.2.4</span><br><span class="line">1:S 03 Feb 2023 09:07:22.285 * RDB age 0 seconds</span><br><span class="line">1:S 03 Feb 2023 09:07:22.285 * RDB memory usage when created 1.85 Mb</span><br><span class="line">1:S 03 Feb 2023 09:07:22.285 * MASTER &lt;-&gt; REPLICA sync: Finished with success</span><br><span class="line">1:S 03 Feb 2023 09:07:22.286 * Background append only file rewriting started by pid 13</span><br><span class="line">1:S 03 Feb 2023 09:07:22.308 * AOF rewrite child asks to stop sending diffs.</span><br><span class="line">13:C 03 Feb 2023 09:07:22.308 * Parent agreed to stop sending diffs. Finalizing AOF...</span><br><span class="line">13:C 03 Feb 2023 09:07:22.308 * Concatenating 0.00 MB of AOF diff received from parent.</span><br><span class="line">13:C 03 Feb 2023 09:07:22.309 * SYNC append only file rewrite performed</span><br><span class="line">13:C 03 Feb 2023 09:07:22.309 * AOF rewrite: 4 MB of memory used by copy-on-write</span><br><span class="line">1:S 03 Feb 2023 09:07:22.348 * Background AOF rewrite terminated with success</span><br><span class="line">1:S 03 Feb 2023 09:07:22.348 * Residual parent diff successfully flushed to the rewritten AOF (0.00 MB)</span><br><span class="line">1:S 03 Feb 2023 09:07:22.348 * Background AOF rewrite finished successfully</span><br><span class="line">1:S 03 Feb 2023 10:07:14.007 * 1 changes in 3600 seconds. Saving...</span><br><span class="line">1:S 03 Feb 2023 10:07:14.009 * Background saving started by pid 15</span><br><span class="line">15:C 03 Feb 2023 10:07:14.012 * DB saved on disk</span><br><span class="line">15:C 03 Feb 2023 10:07:14.013 * RDB: 4 MB of memory used by copy-on-write</span><br><span class="line">1:S 03 Feb 2023 10:07:14.109 * Background saving terminated with success</span><br></pre></td></tr></table></figure><p>sentinel:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1:X 03 Feb 2023 09:07:24.787 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">1:X 03 Feb 2023 09:07:24.787 # Redis version=6.2.4, bits=64, commit=00000000, modified=0, pid=1, just started</span><br><span class="line">1:X 03 Feb 2023 09:07:24.787 # Configuration loaded</span><br><span class="line">1:X 03 Feb 2023 09:07:24.788 * monotonic clock: POSIX clock_gettime</span><br><span class="line">1:X 03 Feb 2023 09:07:24.788 * Running mode=sentinel, port=26379.</span><br><span class="line">1:X 03 Feb 2023 09:07:24.788 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">1:X 03 Feb 2023 09:07:24.789 # Sentinel ID is 49d6ef4a1346ec4a05bec6a6387e6fd66c2a177e</span><br><span class="line">1:X 03 Feb 2023 09:07:24.789 # +monitor master mymaster 192.168.2.12 6379 quorum 2</span><br><span class="line">1:X 03 Feb 2023 09:09:48.027 # +sdown sentinel 32c2d1980d2d054c811f474140f17bb60c1a6dde 192.168.2.214 26379 @ mymaster 192.168.2.215 6379</span><br><span class="line">1:X 03 Feb 2023 09:09:48.099 # +sdown slave 192.168.2.214:6379 192.168.2.11 6379 @ mymaster 192.168.2.12 6379</span><br><span class="line">1:X 03 Feb 2023 09:11:54.402 * +reboot slave 192.168.2.214:6379 192.168.2.11 6379 @ mymaster 192.168.2.12 6379</span><br><span class="line">1:X 03 Feb 2023 09:11:54.502 # -sdown slave 192.168.2.214:6379 192.168.2.11 6379 @ mymaster 192.168.2.12 6379</span><br><span class="line">1:X 03 Feb 2023 09:11:54.502 # -sdown sentinel 32c2d1980d2d054c811f474140f17bb60c1a6dde 192.168.2.11 26379 @ mymaster 192.168.2.215 6379</span><br></pre></td></tr></table></figure><p>haproxy:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[NOTICE]   (1) : New worker <span class="params">#1</span> (8) forked</span><br><span class="line">Connect from 10.0.0.2:3768 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Connect from 10.0.0.2:3767 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Connect from 10.0.0.2:3769 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Server redis<span class="built_in">_</span>16379<span class="built_in">_</span>backend/redis1 is DOWN, reason: Layer7 timeout, info: &quot; at step 7 of tcp-check (expect string &#x27;role:master&#x27;)&quot;, check duration: 1001ms. 2 active and 0 backup servers left. 2 sessions active, 0 requeued, 0 remaining in queue.</span><br><span class="line">[WARNING]  (8) : Server redis<span class="built_in">_</span>16379<span class="built_in">_</span>backend/redis1 is DOWN, reason: Layer7 timeout, info: &quot; at step 7 of tcp-check (expect string &#x27;role:master&#x27;)&quot;, check duration: 1001ms. 2 active and 0 backup servers left. 2 sessions active, 0 requeued, 0 remaining in queue.</span><br><span class="line">[WARNING]  (8) : Server redis<span class="built_in">_</span>16379<span class="built_in">_</span>backend/redis2 is DOWN, reason: Layer7 timeout, info: &quot; at step 7 of tcp-check (expect string &#x27;role:master&#x27;)&quot;, check duration: 1001ms. 1 active and 0 backup servers left. 1 sessions active, 0 requeued, 0 remaining in queue.</span><br><span class="line">Server redis<span class="built_in">_</span>16379<span class="built_in">_</span>backend/redis2 is DOWN, reason: Layer7 timeout, info: &quot; at step 7 of tcp-check (expect string &#x27;role:master&#x27;)&quot;, check duration: 1001ms. 1 active and 0 backup servers left. 1 sessions active, 0 requeued, 0 remaining in queue.</span><br><span class="line">Connect from 10.0.0.2:3765 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Connect from 10.0.0.2:3764 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Connect from 10.0.0.2:3770 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Connect from 10.0.0.2:3771 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Connect from 10.0.0.2:3766 to 10.0.0.249:16379 (redis16379/TCP)</span><br><span class="line">Connect from 10.0.0.2:3772 to 10.0.0.249:16379 (redis16379/TCP)</span><br></pre></td></tr></table></figure><h5 id="ä»£ç†é¢æ¿"><a href="#ä»£ç†é¢æ¿" class="headerlink" title="ä»£ç†é¢æ¿"></a>ä»£ç†é¢æ¿</h5><p>è®¿é—®<code>IP:8080/haproxy-status</code></p><p><img data-src="https://cdn.jonty.top/img/image-20230203112402342.png" alt="image-20230203112402342"></p><h4 id="åœæ­¢æœåŠ¡"><a href="#åœæ­¢æœåŠ¡" class="headerlink" title="åœæ­¢æœåŠ¡"></a>åœæ­¢æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm redis-sentinel</span><br></pre></td></tr></table></figure><h2 id="è¿æ¥æµ‹è¯•"><a href="#è¿æ¥æµ‹è¯•" class="headerlink" title="è¿æ¥æµ‹è¯•"></a>è¿æ¥æµ‹è¯•</h2><p>ä½¿ç”¨redisè¿æ¥å·¥å…·æµ‹è¯•è¿æ¥</p><h3 id="è¿æ¥åˆ°Rediså•å®ä¾‹"><a href="#è¿æ¥åˆ°Rediså•å®ä¾‹" class="headerlink" title="è¿æ¥åˆ°Rediså•å®ä¾‹"></a>è¿æ¥åˆ°Rediså•å®ä¾‹</h3><p>æ­£å¸¸è¿æ¥<code>IP:6379</code>å³å¯</p><p><img data-src="https://cdn.jonty.top/img/image-20230203110812313.png" alt="image-20230203110812313"></p><h3 id="è¿æ¥åˆ°Rediså“¨å…µ"><a href="#è¿æ¥åˆ°Rediså“¨å…µ" class="headerlink" title="è¿æ¥åˆ°Rediså“¨å…µ"></a>è¿æ¥åˆ°Rediså“¨å…µ</h3><p>è¿æ¥åˆ°<code>IP:26379</code></p><p><img data-src="https://cdn.jonty.top/img/image-20230203110947077.png" alt="image-20230203110947077"></p><h3 id="è¿æ¥åˆ°Haproxyä»£ç†"><a href="#è¿æ¥åˆ°Haproxyä»£ç†" class="headerlink" title="è¿æ¥åˆ°Haproxyä»£ç†"></a>è¿æ¥åˆ°Haproxyä»£ç†</h3><p>è¿æ¥åˆ°<code>haproxy:16379</code>ç«¯å£</p><p><img data-src="https://cdn.jonty.top/img/image-20230203111030197.png" alt="image-20230203111030197"></p><h3 id="æµ‹è¯•æ•°æ®åŒæ­¥"><a href="#æµ‹è¯•æ•°æ®åŒæ­¥" class="headerlink" title="æµ‹è¯•æ•°æ®åŒæ­¥"></a>æµ‹è¯•æ•°æ®åŒæ­¥</h3><p>é€šè¿‡Haproxyæ·»åŠ æ–°çš„é”®å€¼ï¼šname:jonty</p><p><img data-src="https://cdn.jonty.top/img/image-20230203111202530.png" alt="image-20230203111202530"></p><p>æ–°å¢æˆåŠŸ</p><p><img data-src="https://cdn.jonty.top/img/image-20230203111313941.png" alt="image-20230203111313941"></p><p>æŸ¥çœ‹å“¨å…µè¿æ¥ï¼š</p><p>å¯ä»¥çœ‹åˆ°å·²ç»åŒæ­¥æˆåŠŸ</p><p><img data-src="https://cdn.jonty.top/img/image-20230203111344072.png" alt="image-20230203111344072"></p><p>æŸ¥çœ‹åŒæ­¥æ—¥å¿—</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1:S 03 Feb 2023 11:11:55.079 * 1 changes in 3600 seconds. Saving...</span><br><span class="line">1:S 03 Feb 2023 11:11:55.081 * Background saving started by pid 16</span><br><span class="line">16:C 03 Feb 2023 11:11:55.083 * DB saved on disk</span><br><span class="line">16:C 03 Feb 2023 11:11:55.084 * RDB: 4 MB of memory used by copy-on-write</span><br><span class="line">1:S 03 Feb 2023 11:11:55.181 * Background saving terminated with success</span><br></pre></td></tr></table></figure><h2 id="å®¹ç¾æµ‹è¯•"><a href="#å®¹ç¾æµ‹è¯•" class="headerlink" title="å®¹ç¾æµ‹è¯•"></a>å®¹ç¾æµ‹è¯•</h2><p>å°†214ä¹Ÿå°±æ˜¯<code>worker1</code>åœæ­¢æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br><span class="line">systemctl stop docker.socket</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20230203111954001.png" alt="image-20230203111954001"></p><p>å¯ä»¥çœ‹åˆ°<code>worker1</code>èŠ‚ç‚¹çŠ¶æ€ä¸º<code>down</code></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@manager redis-swarm]<span class="params">#</span> docker node ls</span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">eyufo1vxn0m5xksslcns6gdau *   manager    Ready     Active         Reachable        20.10.23</span><br><span class="line">xki7hv7tw44394vqyhidco14w     worker1    Down      Active         Unreachable      20.10.23</span><br><span class="line">xv4fw7yzwg5iwypea65z9n9yn     worker2    Ready     Active         Leader           20.10.23</span><br></pre></td></tr></table></figure><p>214å®ä¾‹å·²æ— æ³•è®¿é—®</p><p><img data-src="https://cdn.jonty.top/img/image-20230203112527481.png" alt="image-20230203112527481"></p><p><img data-src="https://cdn.jonty.top/img/image-20230203112729076.png" alt="image-20230203112729076"></p><p>è¿æ¥HaProxyï¼ŒRedisæœåŠ¡æ­£å¸¸</p><p><img data-src="https://cdn.jonty.top/img/image-20230203112443957.png" alt="image-20230203112443957"></p><p>æ·»åŠ æ–°çš„é”®å€¼</p><p><img data-src="https://cdn.jonty.top/img/image-20230203112635960.png" alt="image-20230203112635960"></p><p>å¹¶é‡æ–°æ¢å¤worker1ï¼ŒæŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@worker1 ~]<span class="comment"># systemctl start docker</span></span><br><span class="line">[root@worker1 ~]<span class="comment"># systemctl start docker.socket</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>redis2</code>æœåŠ¡å·²ç»æ¢å¤</p><p><img data-src="https://cdn.jonty.top/img/image-20230203112739424.png" alt="image-20230203112739424"></p><p>æŸ¥çœ‹<code>redis2</code>æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»åŒæ­¥æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1:S 03 Feb 2023 11:26:55.825 * MASTER &lt;-&gt; REPLICA sync: Finished with success</span><br><span class="line">1:S 03 Feb 2023 11:26:55.825 * Background append only file rewriting started by pid 13</span><br><span class="line">1:S 03 Feb 2023 11:26:55.850 * AOF rewrite child asks to stop sending diffs.</span><br><span class="line">13:C 03 Feb 2023 11:26:55.850 * Parent agreed to stop sending diffs. Finalizing AOF...</span><br><span class="line">13:C 03 Feb 2023 11:26:55.850 * Concatenating 0.00 MB of AOF diff received from parent.</span><br><span class="line">13:C 03 Feb 2023 11:26:55.850 * SYNC append only file rewrite performed</span><br><span class="line">13:C 03 Feb 2023 11:26:55.851 * AOF rewrite: 6 MB of memory used by copy-on-write</span><br><span class="line">1:S 03 Feb 2023 11:26:55.927 * Background AOF rewrite terminated with success</span><br><span class="line">1:S 03 Feb 2023 11:26:55.927 * Residual parent diff successfully flushed to the rewritten AOF (0.00 MB)</span><br><span class="line">1:S 03 Feb 2023 11:26:55.927 * Background AOF rewrite finished successfully</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿æ¥å·¥å…·æŸ¥çœ‹ï¼Œæ²¡é—®é¢˜~</p><p><img data-src="https://cdn.jonty.top/img/image-20230203112848725.png" alt="image-20230203112848725"></p><p><img data-src="https://cdn.jonty.top/img/bar2.gif"></p>]]></content>
    
    
    <summary type="html">Docker Swarméƒ¨ç½²Redisä¸»ä»+å“¨å…µSentinel+HAProxyå®ç°å®¹ç¾</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Docker Swarm" scheme="https://jonty.top/tags/Docker-Swarm/"/>
    
    <category term="Redis" scheme="https://jonty.top/tags/Redis/"/>
    
    <category term="Redis Cluster" scheme="https://jonty.top/tags/Redis-Cluster/"/>
    
  </entry>
  
  <entry>
    <title>Docker Swarm èŠ‚ç‚¹ç®¡ç†</title>
    <link href="https://jonty.top/2022/12/01/docker-swarm-manage-nodes/"/>
    <id>https://jonty.top/2022/12/01/docker-swarm-manage-nodes/</id>
    <published>2022-12-01T14:44:09.000Z</published>
    <updated>2022-12-01T14:55:52.816Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-SwarmèŠ‚ç‚¹æ“ä½œ"><a href="#Docker-SwarmèŠ‚ç‚¹æ“ä½œ" class="headerlink" title="Docker SwarmèŠ‚ç‚¹æ“ä½œ"></a>Docker SwarmèŠ‚ç‚¹æ“ä½œ</h1><h2 id="åˆ—å‡ºèŠ‚ç‚¹"><a href="#åˆ—å‡ºèŠ‚ç‚¹" class="headerlink" title="åˆ—å‡ºèŠ‚ç‚¹"></a>åˆ—å‡ºèŠ‚ç‚¹</h2><p>ä»managerèŠ‚ç‚¹ä¸­è¿è¡Œ<code>docker node ls</code>æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">node</span> <span class="title">ls</span></span><br><span class="line"></span><br><span class="line">ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS</span><br><span class="line"><span class="number">46</span>aqrk4e473hjbt745z53cr3t    <span class="keyword">node</span><span class="title">-5</span>    Ready   Active        Reachable</span><br><span class="line"><span class="number">61</span>pi3d91s0w3b90ijw3deeb2q    <span class="keyword">node</span><span class="title">-4</span>    Ready   Active        Reachable</span><br><span class="line">a5b2m3oghd48m8eu391pefq5u    <span class="keyword">node</span><span class="title">-3</span>    Ready   Active</span><br><span class="line">e7p8btxeu3ioshyuj6lxiv6g0    <span class="keyword">node</span><span class="title">-2</span>    Ready   Active</span><br><span class="line">ehkv3bcimagdese79dn78otj5 *  <span class="keyword">node</span><span class="title">-1</span>    Ready   Active        Leader</span><br></pre></td></tr></table></figure><p>AVAILABILITYï¼šæ˜¯å¦å¯ä»¥åˆ†é…ä»»åŠ¡ç»™èŠ‚ç‚¹</p><ul><li>Activeï¼šè°ƒåº¦å™¨å¯ä»¥å°†ä»»åŠ¡åˆ†é…ç»™èŠ‚ç‚¹ã€‚</li><li>Pauseï¼šè°ƒåº¦å™¨ä¸ç»™èŠ‚ç‚¹åˆ†é…æ–°ä»»åŠ¡ï¼Œä½†ç°æœ‰çš„ä»»åŠ¡ä»åœ¨è¿è¡Œã€‚</li><li>Drainï¼šè°ƒåº¦å™¨ä¸ç»™è¯¥èŠ‚ç‚¹åˆ†é…æ–°çš„ä»»åŠ¡ã€‚è°ƒåº¦å™¨ä¼šå…³é—­ç°æœ‰çš„ä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬å®‰æ’åœ¨ä¸€ä¸ªå¯ç”¨çš„èŠ‚ç‚¹ä¸Šã€‚</li></ul><p>MANAGER STATUSï¼šæ˜¾ç¤ºèŠ‚ç‚¹å‚ä¸Raftå…±è¯†çš„æƒ…å†µ</p><ul><li>worker&lt;å°å¼Ÿ&gt;ï¼šæ— å€¼è¡¨ç¤ºä¸€ä¸ªä¸å‚ä¸Swarmç®¡ç†çš„å·¥ä½œèŠ‚ç‚¹ã€‚</li><li>Leader&lt;å¤´ç›®&gt;ï¼šè¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯ä¸»è¦çš„ç®¡ç†èŠ‚ç‚¹ï¼Œä¸ºé›†ç¾¤åšå‡ºæ‰€æœ‰çš„ç®¡ç†å’Œåè°ƒå†³å®šã€‚</li><li>Reachable&lt;è¢«é€‰ä¸¾è€…&gt;ï¼šè¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯å‚ä¸Raftå…±è¯†æ³•å®šäººæ•°çš„ç®¡ç†èŠ‚ç‚¹ã€‚å¦‚æœç®¡ç†èŠ‚ç‚¹å˜å¾—ä¸å¯ç”¨ï¼Œè¯¥èŠ‚ç‚¹æœ‰èµ„æ ¼å½“é€‰ä¸ºæ–°çš„é¢†å¯¼è€…ã€‚</li><li>Unavailable&lt;ä¸å¯ç”¨&gt;ï¼šæ„å‘³ç€è¯¥èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ— æ³•ä¸å…¶ä»–ç®¡ç†å™¨è¿›è¡Œé€šä¿¡çš„ç®¡ç†å™¨ã€‚å¦‚æœä¸€ä¸ªç®¡ç†å™¨èŠ‚ç‚¹å˜å¾—ä¸å¯ç”¨ï¼Œä½ åº”è¯¥åŠ å…¥ä¸€ä¸ªæ–°çš„ç®¡ç†å™¨èŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­ï¼Œæˆ–è€…æå‡ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸ºç®¡ç†å™¨ã€‚</li></ul><p>æœ‰å…³ç¾¤ç®¡ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.docker.com/engine/swarm/admin_guide/">ç®¡ç†å’Œç»´æŠ¤å¤§é‡ Docker å¼•æ“|ç å¤´å·¥äººæ–‡æ¡£</a></p><h2 id="æŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹"><a href="#æŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹" class="headerlink" title="æŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹"></a>æŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹</h2><p>ä½ å¯ä»¥åœ¨ç®¡ç†å™¨èŠ‚ç‚¹ä¸Šè¿è¡Œï¼ŒæŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹ä¿¡æ¯ï¼Œè¾“å‡ºæ ¼å¼é»˜è®¤ä¸ºJSONï¼Œå¯ä»¥é€šè¿‡æ ‡å¿—æ¥æ‰“å°å¯è¯»æ ¼å¼çš„ç»“æœã€‚</p><p>ä¾‹å¦‚ï¼š<code>docker node inspect &lt;NODE-ID&gt; --pretty</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">node</span> <span class="string">inspect</span> <span class="string">self</span> <span class="string">--pretty</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ID:</span>                     <span class="string">ehkv3bcimagdese79dn78otj5</span></span><br><span class="line"><span class="attr">Hostname:</span>               <span class="string">node-1</span></span><br><span class="line"><span class="attr">Joined at:</span>              <span class="number">2016-06-16 22:52:44.9910662</span> <span class="string">+0000</span> <span class="string">utc</span></span><br><span class="line"><span class="attr">Status:</span></span><br><span class="line"> <span class="attr">State:</span>                 <span class="string">Ready</span></span><br><span class="line"> <span class="attr">Availability:</span>          <span class="string">Active</span></span><br><span class="line"><span class="attr">Manager Status:</span></span><br><span class="line"> <span class="attr">Address:</span>               <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span><span class="string">:2377</span></span><br><span class="line"> <span class="attr">Raft Status:</span>           <span class="string">Reachable</span></span><br><span class="line"> <span class="attr">Leader:</span>                <span class="literal">Yes</span></span><br><span class="line"><span class="attr">Platform:</span></span><br><span class="line"> <span class="attr">Operating System:</span>      <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span>          <span class="string">x86_64</span></span><br><span class="line"><span class="attr">Resources:</span></span><br><span class="line"> <span class="attr">CPUs:</span>                  <span class="number">2</span></span><br><span class="line"> <span class="attr">Memory:</span>                <span class="number">1.954</span> <span class="string">GiB</span></span><br><span class="line"><span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Network:</span>              <span class="string">overlay,</span> <span class="string">host,</span> <span class="string">bridge,</span> <span class="string">overlay,</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">Volume:</span>               <span class="string">local</span></span><br><span class="line"><span class="attr">Engine Version:</span>         <span class="number">1.12</span><span class="number">.0</span><span class="string">-dev</span></span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°èŠ‚ç‚¹"><a href="#æ›´æ–°èŠ‚ç‚¹" class="headerlink" title="æ›´æ–°èŠ‚ç‚¹"></a>æ›´æ–°èŠ‚ç‚¹</h2><h3 id="æ›´æ”¹èŠ‚ç‚¹å¯ç”¨æ€§"><a href="#æ›´æ”¹èŠ‚ç‚¹å¯ç”¨æ€§" class="headerlink" title="æ›´æ”¹èŠ‚ç‚¹å¯ç”¨æ€§"></a>æ›´æ”¹èŠ‚ç‚¹å¯ç”¨æ€§</h3><p>é€šè¿‡æ›´æ”¹èŠ‚ç‚¹å¯ç”¨æ€§ï¼Œå¯ä»¥ï¼š</p><ul><li>æ¸…ç©ºç®¡ç†èŠ‚ç‚¹ï¼Œä»¥ä¾¿ä»…æ‰§è¡Œé›†ç¾¤ç®¡ç†ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸å¯ç”¨äºä»»åŠ¡åˆ†é…</li><li>æ’ç©ºèŠ‚ç‚¹ï¼Œä»¥ä¾¿å°†å…¶è„±æœºç»´æŠ¤</li><li>æš‚åœèŠ‚ç‚¹ï¼Œä½¿å…¶æ— æ³•æ¥æ”¶æ–°ä»»åŠ¡</li><li>æ¢å¤ä¸å¯ç”¨æˆ–æš‚åœçš„èŠ‚ç‚¹å¯ç”¨çŠ¶æ€</li></ul><p>ä¾‹å¦‚ï¼Œè¦å°†ä¸€ä¸ªç®¡ç†èŠ‚ç‚¹æ”¹ä¸ºå¯ç”¨æ€§æ”¹ä¸ºï¼šDrain</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">node</span> <span class="title">update</span> --availability drain <span class="keyword">node</span><span class="title">-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">node</span><span class="title">-1</span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æˆ–æ·»åŠ æ ‡ç­¾"><a href="#åˆ é™¤æˆ–æ·»åŠ æ ‡ç­¾" class="headerlink" title="åˆ é™¤æˆ–æ·»åŠ æ ‡ç­¾"></a>åˆ é™¤æˆ–æ·»åŠ æ ‡ç­¾</h3><p>èŠ‚ç‚¹æ ‡ç­¾æä¾›äº†ä¸€ç§çµæ´»çš„èŠ‚ç‚¹ç»„ç»‡æ–¹æ³•ï¼Œå¯ä»¥åœ¨æœåŠ¡çº¦æŸä¸­ä½¿ç”¨èŠ‚ç‚¹æ ‡ç­¾ã€‚</p><p>å½“åˆ›å»ºä¸€ä¸ªæœåŠ¡æ—¶ï¼Œåº”ç”¨çº¦æŸæ¥é™åˆ¶è°ƒåº¦å™¨ä¸ºæœåŠ¡åˆ†é…ä»»åŠ¡çš„èŠ‚ç‚¹ã€‚</p><p>åœ¨ç®¡ç†å™¨èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå‘èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾å…ƒæ•°æ®ã€‚æ ‡ç­¾æ”¯æŒå•ä¸ªæˆ–1å¯¹</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node <span class="meta">update</span> --<span class="meta">label</span>-<span class="meta">add</span>--<span class="meta">label</span>-<span class="meta">add</span>&lt;<span class="meta">key</span>&gt;&lt;<span class="meta">key</span>&gt;=&lt;value&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>--label-add</code>ç»™èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">node</span> <span class="title">update</span> --label-add foo --label-add <span class="attr">bar=</span>baz <span class="keyword">node</span><span class="title">-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">node</span><span class="title">-1</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨dockerèŠ‚ç‚¹æ›´æ–°ä¸ºèŠ‚ç‚¹è®¾ç½®çš„æ ‡ç­¾ä»…é€‚ç”¨äºé›†ç¾¤ä¸­çš„èŠ‚ç‚¹å®ä½“ã€‚ä¸è¦å°†å®ƒä»¬ä¸<code>dockerd</code>çš„<code>docker</code>å®ˆæŠ¤ç¨‹åºæ ‡ç­¾æ··æ·†ã€‚</p><p>å› æ­¤ï¼ŒèŠ‚ç‚¹æ ‡ç­¾å¯ç”¨äºå°†å…³é”®ä»»åŠ¡é™åˆ¶åœ¨æ»¡è¶³æŸäº›è¦æ±‚çš„èŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚ï¼Œåªåœ¨åº”è¯¥è¿è¡Œç‰¹æ®Šå·¥ä½œè´Ÿè½½çš„æœºå™¨ä¸Šå®‰æ’ï¼Œå¦‚ç¬¦åˆPCI-SSæ ‡å‡†çš„æœºå™¨ã€‚</p><p>å—æŸçš„å·¥ä½œçº¿ç¨‹æ— æ³•ç ´åè¿™äº›ç‰¹æ®Šå·¥ä½œè´Ÿè½½ï¼Œå› ä¸ºå®ƒæ— æ³•æ›´æ”¹èŠ‚ç‚¹æ ‡ç­¾ã€‚</p><p>ç„¶è€Œï¼Œå¼•æ“æ ‡ç­¾ä»ç„¶æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºä¸€äº›ä¸å½±å“å®¹å™¨å®‰å…¨åè°ƒçš„åŠŸèƒ½å¯èƒ½æœ€å¥½ä»¥åˆ†æ•£çš„æ–¹å¼è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¼•æ“å¯ä»¥æœ‰ä¸€ä¸ªæ ‡ç­¾æ¥è¡¨æ˜å®ƒæœ‰æŸç§ç±»å‹çš„ç£ç›˜è®¾å¤‡ï¼Œè¿™å¯èƒ½ä¸å®‰å…¨æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚è¿™äº›æ ‡ç­¾æ›´å®¹æ˜“è¢«é›†ç¾¤åè°ƒå™¨ â€œä¿¡ä»»â€ã€‚</p><p>æœ‰å…³æœåŠ¡çº¦æŸçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.docker.com/engine/reference/commandline/service_create/">CLI å‚è€ƒ</a>ã€‚<code>docker service create</code></p><h2 id="èŠ‚ç‚¹é™çº§æˆ–å‡çº§"><a href="#èŠ‚ç‚¹é™çº§æˆ–å‡çº§" class="headerlink" title="èŠ‚ç‚¹é™çº§æˆ–å‡çº§"></a>èŠ‚ç‚¹é™çº§æˆ–å‡çº§</h2><p>å¯ä»¥å°†ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹æå‡ä¸ºç®¡ç†è§’è‰²ï¼Œå½“ä¸€ä¸ªç®¡ç†èŠ‚ç‚¹å˜å¾—ä¸å¯ç”¨ï¼Œæˆ–è€…å½“ä¸€ä¸ªç®¡ç†è„±æœºç»´æŠ¤æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚</p><p>åŒæ ·åœ°ï¼Œå¯ä»¥å°†ä¸€ä¸ªç®¡ç†èŠ‚ç‚¹é™çº§ä¸ºå·¥ä½œèŠ‚ç‚¹ã€‚</p><blockquote><p>æ³¨æ„ï¼šæ— è®ºå‡ºäºä»€ä¹ˆåŸå› è¦æå‡æˆ–é™çº§ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å¿…é¡»å§‹ç»ˆä¿æŒé›†ç¾¤ç®¡ç†èŠ‚ç‚¹çš„æ³•å®šæ•°é‡</p></blockquote><p>è¦å‡çº§ä¸€ä¸ªèŠ‚ç‚¹æˆ–ä¸€ç»„èŠ‚ç‚¹ï¼š<code>docker node promote</code></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">node</span> <span class="title">promote</span> <span class="keyword">node</span><span class="title">-3</span> <span class="keyword">node</span><span class="title">-2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Node</span> <span class="title">node-3</span> promoted to a manager <span class="keyword">in</span> the swarm.</span><br><span class="line"><span class="keyword">Node</span> <span class="title">node-2</span> promoted to a manager <span class="keyword">in</span> the swarm.</span><br></pre></td></tr></table></figure><p>è¦é™çº§ä¸€ä¸ªèŠ‚ç‚¹æˆ–ä¸€ç»„èŠ‚ç‚¹ï¼š<code>docker node demote</code></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">node</span> <span class="title">demote</span> <span class="keyword">node</span><span class="title">-3</span> <span class="keyword">node</span><span class="title">-2</span></span><br><span class="line"></span><br><span class="line">Manager <span class="keyword">node</span><span class="title">-3</span> demoted <span class="keyword">in</span> the swarm.</span><br><span class="line">Manager <span class="keyword">node</span><span class="title">-2</span> demoted <span class="keyword">in</span> the swarm.</span><br></pre></td></tr></table></figure><p>ç­‰åŒäºä»¥ä¸‹å‘½ä»¤çš„å¿«æ·æŒ‡ä»¤</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">node</span> <span class="title">promote</span>`ï¼š`docker <span class="keyword">node</span> <span class="title">update</span> --<span class="keyword">role</span> <span class="title">manager</span></span><br><span class="line">docker <span class="keyword">node</span> <span class="title">demote</span>`ï¼š`docker <span class="keyword">node</span> <span class="title">update</span> --<span class="keyword">role</span> <span class="title">worker</span></span><br></pre></td></tr></table></figure><h2 id="ç¦»å¼€é›†ç¾¤"><a href="#ç¦»å¼€é›†ç¾¤" class="headerlink" title="ç¦»å¼€é›†ç¾¤"></a>ç¦»å¼€é›†ç¾¤</h2><p>åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œ<code>docker swarm leave</code>ä»¥å°†å…¶ä»é›†ç¾¤ä¸­åˆ é™¤ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦å°†é›†ç¾¤ç•™åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker swarm leave</span><br><span class="line"></span><br><span class="line"><span class="keyword">Node</span> <span class="title">left</span> the swarm.</span><br></pre></td></tr></table></figure><p>å½“èŠ‚ç‚¹ç¦»å¼€ç¾¤é›†æ—¶ï¼ŒDockerå¼•æ“åœæ­¢ä»¥ç¾¤é›†æ¨¡å¼è¿è¡Œï¼Œç¼–æ’å™¨ä¸å†å°†ä»»åŠ¡è°ƒåº¦åˆ°èŠ‚ç‚¹ã€‚</p><p>å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ç®¡ç†å™¨èŠ‚ç‚¹ï¼Œåˆ™ä¼šæ”¶åˆ°æœ‰å…³ç»´æŠ¤ä»²è£çš„è­¦å‘Šã€‚è¦è¦†ç›–è­¦å‘Šï¼Œè¯·ä½¿ç”¨<code>--force</code>ã€‚å¦‚æœæœ€åä¸€ä¸ªç®¡ç†å™¨èŠ‚ç‚¹ç¦»å¼€ç¾¤ï¼Œåˆ™ç¾¤å°†å˜å¾—ä¸å¯ç”¨ï¼Œéœ€è¦é‡‡å–ç¾éš¾æ¢å¤æªæ–½ã€‚</p><p>æœ‰å…³ç»´æŠ¤æ³•å®šäººæ•°å’Œç¾éš¾æ¢å¤çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…Swarmç®¡ç†æŒ‡å—ã€‚ èŠ‚ç‚¹ç¦»å¼€ç¾¤é›†åï¼Œå¯ä»¥åœ¨ç®¡ç†å™¨èŠ‚ç‚¹ä¸Šè¿è¡Œ<code>docker node rm</code>å‘½ä»¤ï¼Œä»èŠ‚ç‚¹åˆ—è¡¨ä¸­åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">node</span> <span class="title">rm</span> <span class="keyword">node</span><span class="title">-2</span></span><br></pre></td></tr></table></figure><h2 id="è§£æ•£é›†ç¾¤"><a href="#è§£æ•£é›†ç¾¤" class="headerlink" title="è§£æ•£é›†ç¾¤"></a>è§£æ•£é›†ç¾¤</h2><ol><li>æ’ç©ºèŠ‚ç‚¹ä¸Šçš„é›†ç¾¤å®¹å™¨</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> node update --availabiltity drain g<span class="number">36</span>lvv<span class="number">23</span>ypjd<span class="number">8</span>v<span class="number">7</span>ovlst<span class="number">2</span>n<span class="number">3</span>yt</span><br></pre></td></tr></table></figure><ol><li>ä¸»åŠ¨ç¦»å¼€é›†ç¾¤ï¼Œè®©èŠ‚ç‚¹å¤„äº<code>down</code>çŠ¶æ€ï¼Œæ‰èƒ½åˆ é™¤</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker swarm leave</span></span><br></pre></td></tr></table></figure><ol><li>åˆ é™¤æŒ‡å®šèŠ‚ç‚¹ï¼ˆç®¡ç†èŠ‚ç‚¹æ“ä½œï¼‰</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> node rm g<span class="number">36</span>lvv<span class="number">23</span>ypjd<span class="number">8</span>v<span class="number">7</span>ovlst<span class="number">2</span>n<span class="number">3</span>yt</span><br></pre></td></tr></table></figure><ol><li>ç®¡ç†èŠ‚ç‚¹ã€è§£æ•£é›†ç¾¤</li></ol><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm <span class="literal">leave</span> --<span class="literal">force</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Docker Swarm èŠ‚ç‚¹ç®¡ç†ã€è§£æ•£é›†ç¾¤ - ã€ç¿»è¯‘æ–‡æ¡£ã€‘</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Docker Swarm" scheme="https://jonty.top/tags/Docker-Swarm/"/>
    
  </entry>
  
  <entry>
    <title>Dockeréƒ¨ç½²SQL Serveré›†ç¾¤</title>
    <link href="https://jonty.top/2022/10/20/sql-server-2019-alwayson-availability-group-on-docker-containers/"/>
    <id>https://jonty.top/2022/10/20/sql-server-2019-alwayson-availability-group-on-docker-containers/</id>
    <published>2022-10-20T08:40:18.000Z</published>
    <updated>2022-12-01T14:48:57.033Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>SQL Serveråœ¨2016å¹´å¼€å§‹æ”¯æŒLinuxã€‚éšç€2017å’Œ2019ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå®ƒå¼€å§‹æ”¯æŒLinuxå’Œå®¹å™¨å¹³å°ä¸Šçš„HA/DRã€Kuberneteså’Œå¤§æ•°æ®é›†ç¾¤è§£å†³æ–¹æ¡ˆã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨3ä¸ªèŠ‚ç‚¹çš„Dockerå®¹å™¨ä¸Šå®‰è£…SQL Server 2019ï¼Œå¹¶åˆ›å»ºAlwaysOnå¯ç”¨æ€§ç»„ã€‚</p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨å•ä¸ªé…ç½®æ–‡ä»¶å¿«é€Ÿå‡†å¤‡å¥½ç¯å¢ƒã€‚</p><p>å› æ­¤ï¼Œå¼€å‘äººå‘˜æˆ–æµ‹è¯•å›¢é˜Ÿå¯ä»¥å¿«é€Ÿæ‰§è¡Œè¯¸å¦‚å…¼å®¹æ€§ã€è¿é€šæ€§ã€ä»£ç åŠŸèƒ½ç­‰æµ‹è¯•ã€‚</p><p>é‡è¦æç¤ºï¼š<strong>ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œæ“ä½œ</strong>ã€‚</p></div><h2 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h2><p><a href="../install-docker-on-centos/">å¿«é€Ÿå®‰è£…Docker</a></p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç«¯å£</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>sqlNode1</td><td>å®¿ä¸»æœºIP</td><td>1501:1433</td><td>ä¸»</td></tr><tr><td>sqlNode2</td><td>å®¿ä¸»æœºIP</td><td>1502:1433</td><td>å‰¯</td></tr><tr><td>sqlNode3</td><td>å®¿ä¸»æœºIP</td><td>1503:1433</td><td>å‰¯</td></tr></tbody></table><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>ç¯å¢ƒå‡†å¤‡å®Œæ¯•åï¼Œå¼€å§‹æ­£å¼çš„é…ç½®å®‰è£…ã€‚</p><h3 id="åˆ›å»ºå®¹å™¨"><a href="#åˆ›å»ºå®¹å™¨" class="headerlink" title="åˆ›å»ºå®¹å™¨"></a>åˆ›å»ºå®¹å™¨</h3><p>é€šè¿‡<code>docker-compose</code>æ–‡ä»¶æ¥åˆ›å»ºã€é…ç½®3ä¸ªå®¹å™¨ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yml</span><br></pre></td></tr></table></figure><p>æ’å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"> </span><br><span class="line">services:</span><br><span class="line">  db1:</span><br><span class="line">    container_name: sqlNode1</span><br><span class="line">    image: mcr.microsoft.com/mssql/server:2019-latest</span><br><span class="line">    hostname: sqlNode1</span><br><span class="line">    domainname: lab.local</span><br><span class="line">    environment:</span><br><span class="line">      MSSQL_SA_PASSWORD: <span class="string">&quot;bb123456??&quot;</span></span><br><span class="line">      ACCEPT_EULA: <span class="string">&quot;Y&quot;</span></span><br><span class="line">      MSSQL_ENABLE_HADR: 1</span><br><span class="line">      MSSQL_AGENT_ENABLED: <span class="string">&quot;true&quot;</span></span><br><span class="line">    ports:</span><br><span class="line">    - <span class="string">&quot;1501:1433&quot;</span></span><br><span class="line">    extra_hosts:</span><br><span class="line">      sqlNode2.labl.local: <span class="string">&quot;172.16.238.22&quot;</span></span><br><span class="line">      sqlNode3.labl.local: <span class="string">&quot;172.16.238.23&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">        internal:</span><br><span class="line">                ipv4_address: 172.16.238.21</span><br><span class="line"> </span><br><span class="line">  db2:</span><br><span class="line">    container_name: sqlNode2</span><br><span class="line">    image: mcr.microsoft.com/mssql/server:2019-latest</span><br><span class="line">    hostname: sqlNode2</span><br><span class="line">    domainname: lab.local</span><br><span class="line">    environment:</span><br><span class="line">      MSSQL_SA_PASSWORD: <span class="string">&quot;bb123456??&quot;</span></span><br><span class="line">      ACCEPT_EULA: <span class="string">&quot;Y&quot;</span></span><br><span class="line">      MSSQL_ENABLE_HADR: 1</span><br><span class="line">      MSSQL_AGENT_ENABLED: <span class="string">&quot;true&quot;</span></span><br><span class="line">    ports:</span><br><span class="line">    - <span class="string">&quot;1502:1433&quot;</span></span><br><span class="line">    extra_hosts:</span><br><span class="line">      sqlNode1.lab.local: <span class="string">&quot;172.16.238.21&quot;</span></span><br><span class="line">      sqlNode3.lab.local: <span class="string">&quot;172.16.238.23&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">        internal:</span><br><span class="line">                ipv4_address: 172.16.238.22</span><br><span class="line"> </span><br><span class="line">  db3:</span><br><span class="line">    container_name: sqlNode3</span><br><span class="line">    image: mcr.microsoft.com/mssql/server:2019-latest</span><br><span class="line">    hostname: sqlNode3</span><br><span class="line">    domainname: lab.local</span><br><span class="line">    environment:</span><br><span class="line">      MSSQL_SA_PASSWORD: <span class="string">&quot;bb123456??&quot;</span></span><br><span class="line">      ACCEPT_EULA: <span class="string">&quot;Y&quot;</span></span><br><span class="line">      MSSQL_ENABLE_HADR: 1</span><br><span class="line">      MSSQL_AGENT_ENABLED: <span class="string">&quot;true&quot;</span></span><br><span class="line">    ports:</span><br><span class="line">    - <span class="string">&quot;1503:1433&quot;</span></span><br><span class="line">    extra_hosts:</span><br><span class="line">      sqlNode1.lab.local: <span class="string">&quot;172.16.238.21&quot;</span></span><br><span class="line">      sqlNode2.lab.local: <span class="string">&quot;172.16.238.22&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">        internal:</span><br><span class="line">                ipv4_address: 172.16.238.23</span><br><span class="line"> </span><br><span class="line">networks:</span><br><span class="line">    internal:</span><br><span class="line">      ipam:</span><br><span class="line">            driver: default</span><br><span class="line">            config:</span><br><span class="line">                - subnet: 172.16.238.0/24</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h3><p>ç„¶åé€šè¿‡<code>docker-compose up -d</code>å‘½ä»¤å¯åŠ¨ä¸‰ä¸ªå®¹å™¨ï¼Œå…¶ä¸­<code>-d</code>è¡¨ç¤ºåœ¨åå°è¿è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p><img data-src="https://cdn.jonty.top/img/image-20221020160443178.png" alt="image-20221020160443178"></p><p>æŸ¥çœ‹å®¹å™¨çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@acme-1 ~]<span class="comment"># docker compose ps</span></span><br><span class="line">NAME                COMMAND                  SERVICE             STATUS              PORTS</span><br><span class="line">sqlNode1            <span class="string">&quot;/opt/mssql/bin/permâ€¦&quot;</span>   db1                 running             0.0.0.0:1501-&gt;1433/tcp, :::1501-&gt;1433/tcp</span><br><span class="line">sqlNode2            <span class="string">&quot;/opt/mssql/bin/permâ€¦&quot;</span>   db2                 running             0.0.0.0:1502-&gt;1433/tcp, :::1502-&gt;1433/tcp</span><br><span class="line">sqlNode3            <span class="string">&quot;/opt/mssql/bin/permâ€¦&quot;</span>   db3                 running             0.0.0.0:1503-&gt;1433/tcp, :::1503-&gt;1433/tcp</span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>é€šè¿‡å®¿ä¸»æœºçš„å¤–ç½‘IP+ç«¯å£è¿æ¥ç›¸åº”çš„æ•°æ®åº“ï¼Œå¦‚ä¸‹ï¼š</p><p><img data-src="https://cdn.jonty.top/img/image-20221020161204446.png" alt="image-20221020161204446"></p><p><img data-src="https://cdn.jonty.top/img/image-20221020161232090.png" alt="image-20221020161232090"></p><h3 id="é…ç½®äº’ä¿¡"><a href="#é…ç½®äº’ä¿¡" class="headerlink" title="é…ç½®äº’ä¿¡"></a>é…ç½®äº’ä¿¡</h3><h4 id="ä¸»åº“-ç”Ÿæˆå¯†é’¥"><a href="#ä¸»åº“-ç”Ÿæˆå¯†é’¥" class="headerlink" title="ä¸»åº“-ç”Ÿæˆå¯†é’¥"></a>ä¸»åº“-ç”Ÿæˆå¯†é’¥</h4><p>è¿æ¥åˆ°ä¸»åº“ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹1ï¼Œç«¯å£æ˜¯<code>1501</code></p><p>å°†è¯ä¹¦å’Œç§é’¥æå–åˆ°<code>/tmp/dbm_certificate.cer</code>å’Œ<code>/tmp/dbm_certificate.pvk</code>æ–‡ä»¶ä¸­</p><p>å°†æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®ä»¥ä¸‹æ–‡ä»¶åˆ›å»ºä¸»å¯†é’¥å’Œè¯ä¹¦ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">USE master</span><br><span class="line">GO</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> LOGIN dbm_login <span class="keyword">WITH</span> PASSWORD <span class="operator">=</span> <span class="string">&#x27;bb123456??&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> dbm_user <span class="keyword">FOR</span> LOGIN dbm_login;</span><br><span class="line">GO</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> MASTER KEY ENCRYPTION <span class="keyword">BY</span> PASSWORD <span class="operator">=</span> <span class="string">&#x27;bb123456??&#x27;</span>;</span><br><span class="line">go</span><br><span class="line"><span class="keyword">CREATE</span> CERTIFICATE dbm_certificate <span class="keyword">WITH</span> SUBJECT <span class="operator">=</span> <span class="string">&#x27;dbm&#x27;</span>;</span><br><span class="line">BACKUP CERTIFICATE dbm_certificate</span><br><span class="line"><span class="keyword">TO</span> FILE <span class="operator">=</span> <span class="string">&#x27;/tmp/dbm_certificate.cer&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> PRIVATE KEY (</span><br><span class="line">        FILE <span class="operator">=</span> <span class="string">&#x27;/tmp/dbm_certificate.pvk&#x27;</span>,</span><br><span class="line">        ENCRYPTION <span class="keyword">BY</span> PASSWORD <span class="operator">=</span> <span class="string">&#x27;bb123456??&#x27;</span></span><br><span class="line">    );</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><p>å°†æ–‡ä»¶æ‹·è´åˆ°å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ï¼š</p><p>åœ¨æœåŠ¡å™¨ä¸­æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker cp sqlNode1:/tmp/dbm_certificate.cer .</span><br><span class="line">docker cp sqlNode1:/tmp/dbm_certificate.pvk .</span><br><span class="line">docker cp dbm_certificate.cer sqlNode2:/tmp/</span><br><span class="line">docker cp dbm_certificate.pvk sqlNode2:/tmp/</span><br><span class="line">docker cp dbm_certificate.cer sqlNode3:/tmp/</span><br><span class="line">docker cp dbm_certificate.pvk sqlNode3:/tmp/</span><br></pre></td></tr></table></figure><h4 id="ä»åº“-å¯¼å…¥å¯†é’¥"><a href="#ä»åº“-å¯¼å…¥å¯†é’¥" class="headerlink" title="ä»åº“-å¯¼å…¥å¯†é’¥"></a>ä»åº“-å¯¼å…¥å¯†é’¥</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> LOGIN dbm_login <span class="keyword">WITH</span> PASSWORD <span class="operator">=</span> <span class="string">&#x27;bb123456??&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> dbm_user <span class="keyword">FOR</span> LOGIN dbm_login;</span><br><span class="line">GO</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> MASTER KEY ENCRYPTION <span class="keyword">BY</span> PASSWORD <span class="operator">=</span> <span class="string">&#x27;bb123456??&#x27;</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> CERTIFICATE dbm_certificate   </span><br><span class="line">    <span class="keyword">AUTHORIZATION</span> dbm_user</span><br><span class="line">    <span class="keyword">FROM</span> FILE <span class="operator">=</span> <span class="string">&#x27;/tmp/dbm_certificate.cer&#x27;</span></span><br><span class="line">    <span class="keyword">WITH</span> PRIVATE KEY (</span><br><span class="line">    FILE <span class="operator">=</span> <span class="string">&#x27;/tmp/dbm_certificate.pvk&#x27;</span>,</span><br><span class="line">    DECRYPTION <span class="keyword">BY</span> PASSWORD <span class="operator">=</span> <span class="string">&#x27;bb123456??&#x27;</span></span><br><span class="line">);</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><h3 id="ç›‘å¬å’Œé‡å¯"><a href="#ç›‘å¬å’Œé‡å¯" class="headerlink" title="ç›‘å¬å’Œé‡å¯"></a>ç›‘å¬å’Œé‡å¯</h3><p>æœ€ååœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ENDPOINT [Hadr_endpoint]</span><br><span class="line">    <span class="keyword">AS</span> TCP (LISTENER_IP <span class="operator">=</span> (<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>), LISTENER_PORT <span class="operator">=</span> <span class="number">5022</span>)</span><br><span class="line">    <span class="keyword">FOR</span> DATA_MIRRORING (</span><br><span class="line">        ROLE <span class="operator">=</span> <span class="keyword">ALL</span>,</span><br><span class="line">        AUTHENTICATION <span class="operator">=</span> CERTIFICATE dbm_certificate,</span><br><span class="line">        ENCRYPTION <span class="operator">=</span> REQUIRED ALGORITHM AES</span><br><span class="line">        );</span><br><span class="line"><span class="keyword">ALTER</span> ENDPOINT [Hadr_endpoint] STATE <span class="operator">=</span> STARTED;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CONNECT</span> <span class="keyword">ON</span> ENDPOINT::[Hadr_endpoint] <span class="keyword">TO</span> [dbm_login];</span><br></pre></td></tr></table></figure><p>å¯ç”¨å¼€æœºè‡ªå¯åŠ¨ALWAYONï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> EVENT SESSION  AlwaysOn_health <span class="keyword">ON</span> SERVER <span class="keyword">WITH</span> (STARTUP_STATE<span class="operator">=</span><span class="keyword">ON</span>);</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºé«˜å¯ç”¨ç»„"><a href="#åˆ›å»ºé«˜å¯ç”¨ç»„" class="headerlink" title="åˆ›å»ºé«˜å¯ç”¨ç»„"></a>åˆ›å»ºé«˜å¯ç”¨ç»„</h3><p>è¡Œä»¥ä¸‹è„šæœ¬åœ¨ä¸»èŠ‚ç‚¹ä¸­åˆ›å»ºä¸€ä¸ªå¯ç”¨æ€§ç»„ã€‚ </p><blockquote><p>è¯·æ³¨æ„ï¼Œé€‰æ‹©CLUSTER_TYPE = NONEé€‰é¡¹æ˜¯å› ä¸ºå®ƒæ˜¯åœ¨æ²¡æœ‰è¯¸å¦‚Pacemakeræˆ–Windows Serveræ•…éšœè½¬ç§»ç¾¤é›†ä¹‹ç±»çš„ç¾¤é›†ç®¡ç†å¹³å°çš„æƒ…å†µä¸‹å®‰è£…çš„ã€‚</p><p>å¦‚æœè¦åœ¨Linuxä¸Šå®‰è£…AlwaysOn AGï¼Œåˆ™åº”ä¸ºPacemakeré€‰æ‹©CLUSTER_TYPE = EXTERNALï¼š</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> AVAILABILITY <span class="keyword">GROUP</span> [AG1]</span><br><span class="line">        <span class="keyword">WITH</span> (CLUSTER_TYPE <span class="operator">=</span> <span class="keyword">NONE</span>)</span><br><span class="line">        <span class="keyword">FOR</span> REPLICA <span class="keyword">ON</span></span><br><span class="line">        N<span class="string">&#x27;sqlNode1&#x27;</span></span><br><span class="line">            <span class="keyword">WITH</span> (</span><br><span class="line">            ENDPOINT_URL <span class="operator">=</span> N<span class="string">&#x27;tcp://sqlNode1:5022&#x27;</span>,</span><br><span class="line">            AVAILABILITY_MODE <span class="operator">=</span> ASYNCHRONOUS_COMMIT,</span><br><span class="line">                SEEDING_MODE <span class="operator">=</span> AUTOMATIC,</span><br><span class="line">                FAILOVER_MODE <span class="operator">=</span> MANUAL,</span><br><span class="line">            SECONDARY_ROLE (ALLOW_CONNECTIONS <span class="operator">=</span> <span class="keyword">ALL</span>)</span><br><span class="line">                ),</span><br><span class="line">        N<span class="string">&#x27;sqlNode2&#x27;</span></span><br><span class="line">            <span class="keyword">WITH</span> (</span><br><span class="line">            ENDPOINT_URL <span class="operator">=</span> N<span class="string">&#x27;tcp://sqlNode2:5022&#x27;</span>,</span><br><span class="line">            AVAILABILITY_MODE <span class="operator">=</span> ASYNCHRONOUS_COMMIT,</span><br><span class="line">                SEEDING_MODE <span class="operator">=</span> AUTOMATIC,</span><br><span class="line">                FAILOVER_MODE <span class="operator">=</span> MANUAL,</span><br><span class="line">            SECONDARY_ROLE (ALLOW_CONNECTIONS <span class="operator">=</span> <span class="keyword">ALL</span>)</span><br><span class="line">                ),</span><br><span class="line">        N<span class="string">&#x27;sqlNode3&#x27;</span></span><br><span class="line">            <span class="keyword">WITH</span> (</span><br><span class="line">            ENDPOINT_URL <span class="operator">=</span> N<span class="string">&#x27;tcp://sqlNode3:5022&#x27;</span>,</span><br><span class="line">            AVAILABILITY_MODE <span class="operator">=</span> ASYNCHRONOUS_COMMIT,</span><br><span class="line">                SEEDING_MODE <span class="operator">=</span> AUTOMATIC,</span><br><span class="line">                FAILOVER_MODE <span class="operator">=</span> MANUAL,</span><br><span class="line">            SECONDARY_ROLE (ALLOW_CONNECTIONS <span class="operator">=</span> <span class="keyword">ALL</span>)</span><br><span class="line">                );</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><p>åœ¨ä»åº“ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†ä»åº“åŠ å…¥åˆ°AGç»„ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> AVAILABILITY <span class="keyword">GROUP</span> [ag1] <span class="keyword">JOIN</span> <span class="keyword">WITH</span> (CLUSTER_TYPE <span class="operator">=</span> <span class="keyword">NONE</span>);</span><br><span class="line"><span class="keyword">ALTER</span> AVAILABILITY <span class="keyword">GROUP</span> [ag1] <span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">ANY</span> DATABASE;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><p>è‡³æ­¤åœ¨Dockerå®¹å™¨ä¸­å®‰è£…SQL Server Alwaysoné›†ç¾¤å·²ç»å®Œæˆäº†</p><h3 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h3><p>æ³¨æ„ï¼šå½“æŒ‡å®š<code>CLUSTER_TYPE = NONE</code>åˆ›å»ºå¯ç”¨ç»„æ—¶æ— æ³•è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œåœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶éœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶æ£€æŸ¥è¦æ‰§è¡Œæ•…éšœè½¬ç§»çš„è¾…åŠ©èŠ‚ç‚¹çš„<strong>æœ€åæäº¤æ—¶é—´</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> AVAILABILITY <span class="keyword">GROUP</span> [ag1] FORCE_FAILOVER_ALLOW_DATA_LOSS</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>åœ¨ä¸»åº“ä¸Šåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶åŠ å…¥åˆ°å¯ç”¨ç»„AGä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE agtestdb;</span><br><span class="line">GO</span><br><span class="line">ALTER DATABASE agtestdb SET RECOVERY FULL;</span><br><span class="line">GO</span><br><span class="line">BACKUP DATABASE agtestdb TO DISK = <span class="string">&#x27;/var/opt/mssql/data/agtestdb.bak&#x27;</span>;</span><br><span class="line">GO</span><br><span class="line">ALTER AVAILABILITY GROUP [ag1] ADD DATABASE [agtestdb];</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒæ–‡æ¡£ï¼š</p><p><a href="https://learn.microsoft.com/zh-cn/sql/linux/sql-server-linux-configure-environment-variables?view=sql-server-ver15">ä¸º Linux ä¸Šçš„ SQL Server é…ç½®ç¯å¢ƒå˜é‡ - SQL Server | Microsoft Learn</a></p></blockquote>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Dockerå¿«é€Ÿéƒ¨ç½²SQL Server Always Oné›†ç¾¤æµ‹è¯•ç¯å¢ƒ</summary>
    
    
    
    <category term="DBA" scheme="https://jonty.top/categories/DBA/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="SQL Server" scheme="https://jonty.top/tags/SQL-Server/"/>
    
    <category term="AlwaysOn" scheme="https://jonty.top/tags/AlwaysOn/"/>
    
    <category term="HAé«˜å¯ç”¨" scheme="https://jonty.top/tags/HA%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>CentOSä¸­å¿«é€Ÿå®‰è£…Docker</title>
    <link href="https://jonty.top/2022/10/20/install-docker-on-centos/"/>
    <id>https://jonty.top/2022/10/20/install-docker-on-centos/</id>
    <published>2022-10-20T08:35:37.000Z</published>
    <updated>2022-10-20T08:38:49.750Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¿«é€Ÿå®‰è£…"><a href="#å¿«é€Ÿå®‰è£…" class="headerlink" title="å¿«é€Ÿå®‰è£…"></a>å¿«é€Ÿå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http<span class="variable">s:</span>//<span class="built_in">get</span>.daocloud.io/docker | <span class="keyword">sh</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨å®‰è£…"><a href="#æ‰‹åŠ¨å®‰è£…" class="headerlink" title="æ‰‹åŠ¨å®‰è£…"></a>æ‰‹åŠ¨å®‰è£…</h2><h3 id="å¸è½½æ—§ç‰ˆæœ¬"><a href="#å¸è½½æ—§ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬"></a>å¸è½½æ—§ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®yumä»“åº“"><a href="#è®¾ç½®yumä»“åº“" class="headerlink" title="è®¾ç½®yumä»“åº“"></a>è®¾ç½®yumä»“åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…Dockerå¼•æ“"><a href="#å®‰è£…Dockerå¼•æ“" class="headerlink" title="å®‰è£…Dockerå¼•æ“"></a>å®‰è£…Dockerå¼•æ“</h3><blockquote><p>æ³¨æ„ï¼šdocker-compose-pluginå³å®‰è£…docker-composeï¼Œä¸éœ€è¦å†è¿›è¡Œæ‰‹åŠ¨å®‰è£…</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨Docker"><a href="#å¯åŠ¨Docker" class="headerlink" title="å¯åŠ¨Docker"></a>å¯åŠ¨Docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">CentOSä¸­å¿«é€Ÿæ­å»ºDockerç¯å¢ƒ</summary>
    
    
    
    <category term="DevOps" scheme="https://jonty.top/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://jonty.top/tags/Docker/"/>
    
    <category term="Shell" scheme="https://jonty.top/tags/Shell/"/>
    
  </entry>
  
</feed>
